<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DPDK: examples/ipsec-secgw/flow.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">20.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">examples/ipsec-secgw/flow.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/* SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2020 Marvell International Ltd.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__common_8h.html">rte_common.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__flow_8h.html">rte_flow.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ip_8h.html">rte_ip.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;flow.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ipsec-secgw.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;parser.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define FLOW_RULES_MAX 128</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>flow_rule_entry {</div>
<div class="line">    uint8_t is_ipv4;</div>
<div class="line">    <a name="a0"></a><a class="code" href="rte__common_8h.html#aef7d28b28ed75cf43a62bfab9bb4b6da">RTE_STD_C11</a></div>
<div class="line">    <span class="keyword">union </span>{</div>
<div class="line">        <span class="keyword">struct </span>{</div>
<div class="line">            <span class="keyword">struct </span><a name="_a1"></a><a class="code" href="structrte__flow__item__ipv4.html">rte_flow_item_ipv4</a> spec;</div>
<div class="line">            <span class="keyword">struct </span><a class="code" href="structrte__flow__item__ipv4.html">rte_flow_item_ipv4</a> mask;</div>
<div class="line">        } ipv4;</div>
<div class="line">        <span class="keyword">struct </span>{</div>
<div class="line">            <span class="keyword">struct </span><a name="_a2"></a><a class="code" href="structrte__flow__item__ipv6.html">rte_flow_item_ipv6</a> spec;</div>
<div class="line">            <span class="keyword">struct </span><a class="code" href="structrte__flow__item__ipv6.html">rte_flow_item_ipv6</a> mask;</div>
<div class="line">        } ipv6;</div>
<div class="line">    };</div>
<div class="line">    uint16_t port;</div>
<div class="line">    uint16_t queue;</div>
<div class="line">    <span class="keyword">struct </span>rte_flow *flow;</div>
<div class="line">} flow_rule_tbl[FLOW_RULES_MAX];</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> nb_flow_rule;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">ipv4_hdr_print(<span class="keyword">struct</span> <a name="_a3"></a><a class="code" href="structrte__ipv4__hdr.html">rte_ipv4_hdr</a> *hdr)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> a, b, c, d;</div>
<div class="line"> </div>
<div class="line">    uint32_t_to_char(<a name="a4"></a><a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(hdr-&gt;<a name="a5"></a><a class="code" href="structrte__ipv4__hdr.html#a754f9498bdbcee21d8eeb1fcff22dd95">src_addr</a>), &amp;a, &amp;b, &amp;c, &amp;d);</div>
<div class="line">    printf(<span class="stringliteral">&quot;src: %3hhu.%3hhu.%3hhu.%3hhu \t&quot;</span>, a, b, c, d);</div>
<div class="line"> </div>
<div class="line">    uint32_t_to_char(<a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(hdr-&gt;<a name="a6"></a><a class="code" href="structrte__ipv4__hdr.html#a57cd4df77fa494510d4203ccaace0bd7">dst_addr</a>), &amp;a, &amp;b, &amp;c, &amp;d);</div>
<div class="line">    printf(<span class="stringliteral">&quot;dst: %3hhu.%3hhu.%3hhu.%3hhu&quot;</span>, a, b, c, d);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">ipv4_addr_cpy(<a class="code" href="rte__byteorder_8h.html#a8564b84c8c690237e99e6dfe183f8a66">rte_be32_t</a> *spec, <a class="code" href="rte__byteorder_8h.html#a8564b84c8c690237e99e6dfe183f8a66">rte_be32_t</a> *mask, <span class="keywordtype">char</span> *token,</div>
<div class="line">          <span class="keyword">struct</span> parse_status *status)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>in_addr ip;</div>
<div class="line">    uint32_t depth;</div>
<div class="line"> </div>
<div class="line">    APP_CHECK(parse_ipv4_addr(token, &amp;ip, &amp;depth) == 0, status,</div>
<div class="line">         <span class="stringliteral">&quot;unrecognized input \&quot;%s\&quot;, expect valid ipv4 addr&quot;</span>, token);</div>
<div class="line">    <span class="keywordflow">if</span> (status-&gt;status &lt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (depth &gt; 32)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    memcpy(mask, &amp;<a name="a7"></a><a class="code" href="rte__flow_8h.html#ac2215329b636beb0199b939cbdc2a23e">rte_flow_item_ipv4_mask</a>.<a name="a8"></a><a class="code" href="structrte__flow__item__ipv4.html#a8442cc7b49a6760cfba00d3f5221044b">hdr</a>.<a class="code" href="structrte__ipv4__hdr.html#a754f9498bdbcee21d8eeb1fcff22dd95">src_addr</a>, <span class="keyword">sizeof</span>(ip));</div>
<div class="line"> </div>
<div class="line">    *spec = ip.s_addr;</div>
<div class="line">    <span class="keywordflow">if</span> (depth &lt; 32)</div>
<div class="line">        *mask = *mask &lt;&lt; (32-depth);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">ipv6_hdr_print(<span class="keyword">struct</span> <a name="_a9"></a><a class="code" href="structrte__ipv6__hdr.html">rte_ipv6_hdr</a> *hdr)</div>
<div class="line">{</div>
<div class="line">    uint8_t *addr;</div>
<div class="line"> </div>
<div class="line">    addr = hdr-&gt;<a name="a10"></a><a class="code" href="structrte__ipv6__hdr.html#a6986cf27ec82df0bdd16f9d574a9a009">src_addr</a>;</div>
<div class="line">    printf(<span class="stringliteral">&quot;src: %4hx:%4hx:%4hx:%4hx:%4hx:%4hx:%4hx:%4hx \t&quot;</span>,</div>
<div class="line">           (uint16_t)((addr[0] &lt;&lt; 8) | addr[1]),</div>
<div class="line">           (uint16_t)((addr[2] &lt;&lt; 8) | addr[3]),</div>
<div class="line">           (uint16_t)((addr[4] &lt;&lt; 8) | addr[5]),</div>
<div class="line">           (uint16_t)((addr[6] &lt;&lt; 8) | addr[7]),</div>
<div class="line">           (uint16_t)((addr[8] &lt;&lt; 8) | addr[9]),</div>
<div class="line">           (uint16_t)((addr[10] &lt;&lt; 8) | addr[11]),</div>
<div class="line">           (uint16_t)((addr[12] &lt;&lt; 8) | addr[13]),</div>
<div class="line">           (uint16_t)((addr[14] &lt;&lt; 8) | addr[15]));</div>
<div class="line"> </div>
<div class="line">    addr = hdr-&gt;<a name="a11"></a><a class="code" href="structrte__ipv6__hdr.html#a25c3a64d5cf7e63211898df5ed65cd22">dst_addr</a>;</div>
<div class="line">    printf(<span class="stringliteral">&quot;dst: %4hx:%4hx:%4hx:%4hx:%4hx:%4hx:%4hx:%4hx&quot;</span>,</div>
<div class="line">           (uint16_t)((addr[0] &lt;&lt; 8) | addr[1]),</div>
<div class="line">           (uint16_t)((addr[2] &lt;&lt; 8) | addr[3]),</div>
<div class="line">           (uint16_t)((addr[4] &lt;&lt; 8) | addr[5]),</div>
<div class="line">           (uint16_t)((addr[6] &lt;&lt; 8) | addr[7]),</div>
<div class="line">           (uint16_t)((addr[8] &lt;&lt; 8) | addr[9]),</div>
<div class="line">           (uint16_t)((addr[10] &lt;&lt; 8) | addr[11]),</div>
<div class="line">           (uint16_t)((addr[12] &lt;&lt; 8) | addr[13]),</div>
<div class="line">           (uint16_t)((addr[14] &lt;&lt; 8) | addr[15]));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">ipv6_addr_cpy(uint8_t *spec, uint8_t *mask, <span class="keywordtype">char</span> *token,</div>
<div class="line">          <span class="keyword">struct</span> parse_status *status)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>in6_addr ip;</div>
<div class="line">    uint32_t depth, i;</div>
<div class="line"> </div>
<div class="line">    APP_CHECK(parse_ipv6_addr(token, &amp;ip, &amp;depth) == 0, status,</div>
<div class="line">        <span class="stringliteral">&quot;unrecognized input \&quot;%s\&quot;, expect valid ipv6 address&quot;</span>, token);</div>
<div class="line">    <span class="keywordflow">if</span> (status-&gt;status &lt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    memcpy(mask, &amp;<a name="a12"></a><a class="code" href="rte__flow_8h.html#a865bcafbcac0dc0ed5047a75ce24e6a0">rte_flow_item_ipv6_mask</a>.<a name="a13"></a><a class="code" href="structrte__flow__item__ipv6.html#a4687007c5728099de9e0b0c6ecb78bad">hdr</a>.<a class="code" href="structrte__ipv6__hdr.html#a6986cf27ec82df0bdd16f9d574a9a009">src_addr</a>, <span class="keyword">sizeof</span>(ip));</div>
<div class="line">    memcpy(spec, ip.s6_addr, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> in6_addr));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; depth &amp;&amp; (i%8 &lt;= <span class="keyword">sizeof</span>(<span class="keyword">struct </span>in6_addr)); i++)</div>
<div class="line">        mask[i/8] &amp;= ~(1 &lt;&lt; (7-i%8));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">parse_flow_tokens(<span class="keywordtype">char</span> **tokens, uint32_t n_tokens,</div>
<div class="line">          <span class="keyword">struct</span> parse_status *status)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>flow_rule_entry *rule;</div>
<div class="line">    uint32_t ti;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (nb_flow_rule &gt;= FLOW_RULES_MAX) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Too many flow rules\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    rule = &amp;flow_rule_tbl[nb_flow_rule];</div>
<div class="line">    memset(rule, 0, <span class="keyword">sizeof</span>(*rule));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(tokens[0], <span class="stringliteral">&quot;ipv4&quot;</span>) == 0) {</div>
<div class="line">        rule-&gt;is_ipv4 = 1;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(tokens[0], <span class="stringliteral">&quot;ipv6&quot;</span>) == 0) {</div>
<div class="line">        rule-&gt;is_ipv4 = 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        APP_CHECK(0, status, <span class="stringliteral">&quot;unrecognized input \&quot;%s\&quot;&quot;</span>, tokens[0]);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (ti = 1; ti &lt; n_tokens; ti++) {</div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(tokens[ti], <span class="stringliteral">&quot;src&quot;</span>) == 0) {</div>
<div class="line">            INCREMENT_TOKEN_INDEX(ti, n_tokens, status);</div>
<div class="line">            <span class="keywordflow">if</span> (status-&gt;status &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (rule-&gt;is_ipv4) {</div>
<div class="line">                <span class="keywordflow">if</span> (ipv4_addr_cpy(&amp;rule-&gt;ipv4.spec.hdr.src_addr,</div>
<div class="line">                          &amp;rule-&gt;ipv4.mask.hdr.src_addr,</div>
<div class="line">                          tokens[ti], status))</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">if</span> (ipv6_addr_cpy(rule-&gt;ipv6.spec.hdr.src_addr,</div>
<div class="line">                          rule-&gt;ipv6.mask.hdr.src_addr,</div>
<div class="line">                          tokens[ti], status))</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(tokens[ti], <span class="stringliteral">&quot;dst&quot;</span>) == 0) {</div>
<div class="line">            INCREMENT_TOKEN_INDEX(ti, n_tokens, status);</div>
<div class="line">            <span class="keywordflow">if</span> (status-&gt;status &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (rule-&gt;is_ipv4) {</div>
<div class="line">                <span class="keywordflow">if</span> (ipv4_addr_cpy(&amp;rule-&gt;ipv4.spec.hdr.dst_addr,</div>
<div class="line">                          &amp;rule-&gt;ipv4.mask.hdr.dst_addr,</div>
<div class="line">                          tokens[ti], status))</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">if</span> (ipv6_addr_cpy(rule-&gt;ipv6.spec.hdr.dst_addr,</div>
<div class="line">                          rule-&gt;ipv6.mask.hdr.dst_addr,</div>
<div class="line">                          tokens[ti], status))</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(tokens[ti], <span class="stringliteral">&quot;port&quot;</span>) == 0) {</div>
<div class="line">            INCREMENT_TOKEN_INDEX(ti, n_tokens, status);</div>
<div class="line">            <span class="keywordflow">if</span> (status-&gt;status &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            APP_CHECK_TOKEN_IS_NUM(tokens, ti, status);</div>
<div class="line">            <span class="keywordflow">if</span> (status-&gt;status &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">            rule-&gt;port = atoi(tokens[ti]);</div>
<div class="line"> </div>
<div class="line">            INCREMENT_TOKEN_INDEX(ti, n_tokens, status);</div>
<div class="line">            <span class="keywordflow">if</span> (status-&gt;status &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            APP_CHECK_TOKEN_IS_NUM(tokens, ti, status);</div>
<div class="line">            <span class="keywordflow">if</span> (status-&gt;status &lt; 0)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">            rule-&gt;queue = atoi(tokens[ti]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    nb_flow_rule++;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_RTE_FLOW_PATTERN (3)</span></div>
<div class="line"><span class="preprocessor">#define MAX_RTE_FLOW_ACTIONS (2)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">flow_init_single(<span class="keyword">struct</span> flow_rule_entry *rule)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a14"></a><a class="code" href="structrte__flow__item.html">rte_flow_item</a> pattern[MAX_RTE_FLOW_PATTERN] = {};</div>
<div class="line">    <span class="keyword">struct </span>rte_flow_action action[MAX_RTE_FLOW_ACTIONS] = {};</div>
<div class="line">    <span class="keyword">struct </span><a name="_a15"></a><a class="code" href="structrte__flow__attr.html">rte_flow_attr</a> attr = {};</div>
<div class="line">    <span class="keyword">struct </span><a name="_a16"></a><a class="code" href="structrte__flow__error.html">rte_flow_error</a> err;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    attr.<a name="a17"></a><a class="code" href="structrte__flow__attr.html#a33bdc3cfc314d71f3187a8186bc570a9">egress</a> = 0;</div>
<div class="line">    attr.<a name="a18"></a><a class="code" href="structrte__flow__attr.html#ae4d19341d5298a2bc61f9eb941b1179c">ingress</a> = 1;</div>
<div class="line"> </div>
<div class="line">    action[0].type = <a name="a19"></a><a class="code" href="rte__flow_8h.html#a78f0386e683cfc491462a771df8b971aa7a913800d2a0c7655ec296ce651b6306">RTE_FLOW_ACTION_TYPE_QUEUE</a>;</div>
<div class="line">    action[0].conf = &amp;(<span class="keyword">struct </span><a name="_a20"></a><a class="code" href="structrte__flow__action__queue.html">rte_flow_action_queue</a>) {</div>
<div class="line">                .index = rule-&gt;queue,</div>
<div class="line">    };</div>
<div class="line">    action[1].type = <a name="a21"></a><a class="code" href="rte__flow_8h.html#a78f0386e683cfc491462a771df8b971aa7bc270d4629785c13b81dccca71f67e3">RTE_FLOW_ACTION_TYPE_END</a>;</div>
<div class="line"> </div>
<div class="line">    pattern[0].<a name="a22"></a><a class="code" href="structrte__flow__item.html#aab2e979e81ee63a9338a69e49220c388">type</a> = <a name="a23"></a><a class="code" href="rte__flow_8h.html#af10e2b0af33527be504e883406a84ca1abb502c9d1fc4678e1e36187090494aca">RTE_FLOW_ITEM_TYPE_ETH</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rule-&gt;is_ipv4) {</div>
<div class="line">        pattern[1].<a class="code" href="structrte__flow__item.html#aab2e979e81ee63a9338a69e49220c388">type</a> = <a name="a24"></a><a class="code" href="rte__flow_8h.html#af10e2b0af33527be504e883406a84ca1a04512db8022f42e5935cfc2ecdde66b2">RTE_FLOW_ITEM_TYPE_IPV4</a>;</div>
<div class="line">        pattern[1].<a name="a25"></a><a class="code" href="structrte__flow__item.html#a3793ece0c794f057bf051e709f4c81fc">spec</a> = &amp;rule-&gt;ipv4.spec;</div>
<div class="line">        pattern[1].<a name="a26"></a><a class="code" href="structrte__flow__item.html#a88f88699781927b5e525950a417baf9f">mask</a> = &amp;rule-&gt;ipv4.mask;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        pattern[1].<a class="code" href="structrte__flow__item.html#aab2e979e81ee63a9338a69e49220c388">type</a> = <a name="a27"></a><a class="code" href="rte__flow_8h.html#af10e2b0af33527be504e883406a84ca1ae4196d14795c390875542f9c8c9e2d60">RTE_FLOW_ITEM_TYPE_IPV6</a>;</div>
<div class="line">        pattern[1].<a class="code" href="structrte__flow__item.html#a3793ece0c794f057bf051e709f4c81fc">spec</a> = &amp;rule-&gt;ipv6.spec;</div>
<div class="line">        pattern[1].<a class="code" href="structrte__flow__item.html#a88f88699781927b5e525950a417baf9f">mask</a> = &amp;rule-&gt;ipv6.mask;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pattern[2].<a class="code" href="structrte__flow__item.html#aab2e979e81ee63a9338a69e49220c388">type</a> = <a name="a28"></a><a class="code" href="rte__flow_8h.html#af10e2b0af33527be504e883406a84ca1a51161f8ef75cba3968e32fc0472575d7">RTE_FLOW_ITEM_TYPE_END</a>;</div>
<div class="line"> </div>
<div class="line">    ret = <a name="a29"></a><a class="code" href="rte__flow_8h.html#a3fc6e9416462572d5a978e77d9ea2ec8">rte_flow_validate</a>(rule-&gt;port, &amp;attr, pattern, action, &amp;err);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        <a name="a30"></a><a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, IPSEC, <span class="stringliteral">&quot;Flow validation failed %s\n&quot;</span>, err.message);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    rule-&gt;flow = <a name="a31"></a><a class="code" href="rte__flow_8h.html#a698ab49350e51414a31b9c511a7abe4e">rte_flow_create</a>(rule-&gt;port, &amp;attr, pattern, action, &amp;err);</div>
<div class="line">    <span class="keywordflow">if</span> (rule-&gt;flow == NULL)</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, IPSEC, <span class="stringliteral">&quot;Flow creation return %s\n&quot;</span>, err.message);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">flow_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>flow_rule_entry *rule;</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_flow_rule; i++) {</div>
<div class="line">        rule = &amp;flow_rule_tbl[i];</div>
<div class="line">        flow_init_single(rule);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_flow_rule; i++) {</div>
<div class="line">        rule = &amp;flow_rule_tbl[i];</div>
<div class="line">        <span class="keywordflow">if</span> (rule-&gt;is_ipv4) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Flow #%3d: spec ipv4 &quot;</span>, i);</div>
<div class="line">            ipv4_hdr_print(&amp;rule-&gt;ipv4.spec.hdr);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;           mask ipv4 &quot;</span>);</div>
<div class="line">            ipv4_hdr_print(&amp;rule-&gt;ipv4.mask.hdr);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Flow #%3d: spec ipv6 &quot;</span>, i);</div>
<div class="line">            ipv6_hdr_print(&amp;rule-&gt;ipv6.spec.hdr);</div>
<div class="line">            printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;           mask ipv6 &quot;</span>);</div>
<div class="line">            ipv6_hdr_print(&amp;rule-&gt;ipv6.mask.hdr);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;\tPort: %d, Queue: %d&quot;</span>, rule-&gt;port, rule-&gt;queue);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (rule-&gt;flow == NULL)</div>
<div class="line">            printf(<span class="stringliteral">&quot; [UNSUPPORTED]&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="astructrte__flow__item__ipv4_html_a8442cc7b49a6760cfba00d3f5221044b"><div class="ttname"><a href="structrte__flow__item__ipv4.html#a8442cc7b49a6760cfba00d3f5221044b">rte_flow_item_ipv4::hdr</a></div><div class="ttdeci">struct rte_ipv4_hdr hdr</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00773">rte_flow.h:792</a></div></div>
<div class="ttc" id="astructrte__ipv4__hdr_html_a57cd4df77fa494510d4203ccaace0bd7"><div class="ttname"><a href="structrte__ipv4__hdr.html#a57cd4df77fa494510d4203ccaace0bd7">rte_ipv4_hdr::dst_addr</a></div><div class="ttdeci">rte_be32_t dst_addr</div><div class="ttdef"><b>Definition:</b> <a href="rte__ip_8h_source.html#l00043">rte_ip.h:43</a></div></div>
<div class="ttc" id="astructrte__flow__attr_html_a33bdc3cfc314d71f3187a8186bc570a9"><div class="ttname"><a href="structrte__flow__attr.html#a33bdc3cfc314d71f3187a8186bc570a9">rte_flow_attr::egress</a></div><div class="ttdeci">uint32_t egress</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00080">rte_flow.h:80</a></div></div>
<div class="ttc" id="astructrte__ipv6__hdr_html_a6986cf27ec82df0bdd16f9d574a9a009"><div class="ttname"><a href="structrte__ipv6__hdr.html#a6986cf27ec82df0bdd16f9d574a9a009">rte_ipv6_hdr::src_addr</a></div><div class="ttdeci">uint8_t src_addr[16]</div><div class="ttdef"><b>Definition:</b> <a href="rte__ip_8h_source.html#l00392">rte_ip.h:392</a></div></div>
<div class="ttc" id="astructrte__flow__attr_html_ae4d19341d5298a2bc61f9eb941b1179c"><div class="ttname"><a href="structrte__flow__attr.html#ae4d19341d5298a2bc61f9eb941b1179c">rte_flow_attr::ingress</a></div><div class="ttdeci">uint32_t ingress</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00079">rte_flow.h:79</a></div></div>
<div class="ttc" id="arte__byteorder_8h_html_a8564b84c8c690237e99e6dfe183f8a66"><div class="ttname"><a href="rte__byteorder_8h.html#a8564b84c8c690237e99e6dfe183f8a66">rte_be32_t</a></div><div class="ttdeci">uint32_t rte_be32_t</div><div class="ttdef"><b>Definition:</b> <a href="rte__byteorder_8h_source.html#l00111">rte_byteorder.h:111</a></div></div>
<div class="ttc" id="astructrte__ipv6__hdr_html_a25c3a64d5cf7e63211898df5ed65cd22"><div class="ttname"><a href="structrte__ipv6__hdr.html#a25c3a64d5cf7e63211898df5ed65cd22">rte_ipv6_hdr::dst_addr</a></div><div class="ttdeci">uint8_t dst_addr[16]</div><div class="ttdef"><b>Definition:</b> <a href="rte__ip_8h_source.html#l00393">rte_ip.h:393</a></div></div>
<div class="ttc" id="arte__flow_8h_html_a78f0386e683cfc491462a771df8b971aa7bc270d4629785c13b81dccca71f67e3"><div class="ttname"><a href="rte__flow_8h.html#a78f0386e683cfc491462a771df8b971aa7bc270d4629785c13b81dccca71f67e3">RTE_FLOW_ACTION_TYPE_END</a></div><div class="ttdeci">@ RTE_FLOW_ACTION_TYPE_END</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l01703">rte_flow.h:1703</a></div></div>
<div class="ttc" id="arte__flow_8h_html_a698ab49350e51414a31b9c511a7abe4e"><div class="ttname"><a href="rte__flow_8h.html#a698ab49350e51414a31b9c511a7abe4e">rte_flow_create</a></div><div class="ttdeci">struct rte_flow * rte_flow_create(uint16_t port_id, const struct rte_flow_attr *attr, const struct rte_flow_item pattern[], const struct rte_flow_action actions[], struct rte_flow_error *error)</div></div>
<div class="ttc" id="astructrte__flow__item__ipv4_html"><div class="ttname"><a href="structrte__flow__item__ipv4.html">rte_flow_item_ipv4</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00791">rte_flow.h:791</a></div></div>
<div class="ttc" id="astructrte__flow__item_html"><div class="ttname"><a href="structrte__flow__item.html">rte_flow_item</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l01663">rte_flow.h:1663</a></div></div>
<div class="ttc" id="astructrte__flow__item_html_aab2e979e81ee63a9338a69e49220c388"><div class="ttname"><a href="structrte__flow__item.html#aab2e979e81ee63a9338a69e49220c388">rte_flow_item::type</a></div><div class="ttdeci">enum rte_flow_item_type type</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l01596">rte_flow.h:1664</a></div></div>
<div class="ttc" id="astructrte__flow__item_html_a3793ece0c794f057bf051e709f4c81fc"><div class="ttname"><a href="structrte__flow__item.html#a3793ece0c794f057bf051e709f4c81fc">rte_flow_item::spec</a></div><div class="ttdeci">const void * spec</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l01665">rte_flow.h:1665</a></div></div>
<div class="ttc" id="arte__flow_8h_html_af10e2b0af33527be504e883406a84ca1a51161f8ef75cba3968e32fc0472575d7"><div class="ttname"><a href="rte__flow_8h.html#af10e2b0af33527be504e883406a84ca1a51161f8ef75cba3968e32fc0472575d7">RTE_FLOW_ITEM_TYPE_END</a></div><div class="ttdeci">@ RTE_FLOW_ITEM_TYPE_END</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00128">rte_flow.h:128</a></div></div>
<div class="ttc" id="arte__byteorder_8h_html_aa1ddd507bcc0a87bbcfc5fdd9113094a"><div class="ttname"><a href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a></div><div class="ttdeci">static uint32_t rte_bswap32(uint32_t x)</div></div>
<div class="ttc" id="arte__flow_8h_html_af10e2b0af33527be504e883406a84ca1a04512db8022f42e5935cfc2ecdde66b2"><div class="ttname"><a href="rte__flow_8h.html#af10e2b0af33527be504e883406a84ca1a04512db8022f42e5935cfc2ecdde66b2">RTE_FLOW_ITEM_TYPE_IPV4</a></div><div class="ttdeci">@ RTE_FLOW_ITEM_TYPE_IPV4</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00224">rte_flow.h:224</a></div></div>
<div class="ttc" id="astructrte__flow__action__queue_html"><div class="ttname"><a href="structrte__flow__action__queue.html">rte_flow_action_queue</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l02238">rte_flow.h:2238</a></div></div>
<div class="ttc" id="arte__flow_8h_html"><div class="ttname"><a href="rte__flow_8h.html">rte_flow.h</a></div></div>
<div class="ttc" id="arte__ip_8h_html"><div class="ttname"><a href="rte__ip_8h.html">rte_ip.h</a></div></div>
<div class="ttc" id="arte__flow_8h_html_a865bcafbcac0dc0ed5047a75ce24e6a0"><div class="ttname"><a href="rte__flow_8h.html#a865bcafbcac0dc0ed5047a75ce24e6a0">rte_flow_item_ipv6_mask</a></div><div class="ttdeci">static const struct rte_flow_item_ipv6 rte_flow_item_ipv6_mask</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00553">rte_flow.h:838</a></div></div>
<div class="ttc" id="arte__flow_8h_html_ac2215329b636beb0199b939cbdc2a23e"><div class="ttname"><a href="rte__flow_8h.html#ac2215329b636beb0199b939cbdc2a23e">rte_flow_item_ipv4_mask</a></div><div class="ttdeci">static const struct rte_flow_item_ipv4 rte_flow_item_ipv4_mask</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00553">rte_flow.h:797</a></div></div>
<div class="ttc" id="arte__common_8h_html"><div class="ttname"><a href="rte__common_8h.html">rte_common.h</a></div></div>
<div class="ttc" id="astructrte__ipv4__hdr_html_a754f9498bdbcee21d8eeb1fcff22dd95"><div class="ttname"><a href="structrte__ipv4__hdr.html#a754f9498bdbcee21d8eeb1fcff22dd95">rte_ipv4_hdr::src_addr</a></div><div class="ttdeci">rte_be32_t src_addr</div><div class="ttdef"><b>Definition:</b> <a href="rte__ip_8h_source.html#l00042">rte_ip.h:42</a></div></div>
<div class="ttc" id="arte__flow_8h_html_af10e2b0af33527be504e883406a84ca1ae4196d14795c390875542f9c8c9e2d60"><div class="ttname"><a href="rte__flow_8h.html#af10e2b0af33527be504e883406a84ca1ae4196d14795c390875542f9c8c9e2d60">RTE_FLOW_ITEM_TYPE_IPV6</a></div><div class="ttdeci">@ RTE_FLOW_ITEM_TYPE_IPV6</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00231">rte_flow.h:231</a></div></div>
<div class="ttc" id="astructrte__flow__item_html_a88f88699781927b5e525950a417baf9f"><div class="ttname"><a href="structrte__flow__item.html#a88f88699781927b5e525950a417baf9f">rte_flow_item::mask</a></div><div class="ttdeci">const void * mask</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l01667">rte_flow.h:1667</a></div></div>
<div class="ttc" id="arte__flow_8h_html_a78f0386e683cfc491462a771df8b971aa7a913800d2a0c7655ec296ce651b6306"><div class="ttname"><a href="rte__flow_8h.html#a78f0386e683cfc491462a771df8b971aa7a913800d2a0c7655ec296ce651b6306">RTE_FLOW_ACTION_TYPE_QUEUE</a></div><div class="ttdeci">@ RTE_FLOW_ACTION_TYPE_QUEUE</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l01751">rte_flow.h:1751</a></div></div>
<div class="ttc" id="arte__flow_8h_html_a3fc6e9416462572d5a978e77d9ea2ec8"><div class="ttname"><a href="rte__flow_8h.html#a3fc6e9416462572d5a978e77d9ea2ec8">rte_flow_validate</a></div><div class="ttdeci">int rte_flow_validate(uint16_t port_id, const struct rte_flow_attr *attr, const struct rte_flow_item pattern[], const struct rte_flow_action actions[], struct rte_flow_error *error)</div></div>
<div class="ttc" id="astructrte__flow__attr_html"><div class="ttname"><a href="structrte__flow__attr.html">rte_flow_attr</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00076">rte_flow.h:76</a></div></div>
<div class="ttc" id="astructrte__flow__item__ipv6_html_a4687007c5728099de9e0b0c6ecb78bad"><div class="ttname"><a href="structrte__flow__item__ipv6.html#a4687007c5728099de9e0b0c6ecb78bad">rte_flow_item_ipv6::hdr</a></div><div class="ttdeci">struct rte_ipv6_hdr hdr</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00773">rte_flow.h:813</a></div></div>
<div class="ttc" id="astructrte__ipv4__hdr_html"><div class="ttname"><a href="structrte__ipv4__hdr.html">rte_ipv4_hdr</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ip_8h_source.html#l00033">rte_ip.h:33</a></div></div>
<div class="ttc" id="arte__common_8h_html_aef7d28b28ed75cf43a62bfab9bb4b6da"><div class="ttname"><a href="rte__common_8h.html#aef7d28b28ed75cf43a62bfab9bb4b6da">RTE_STD_C11</a></div><div class="ttdeci">#define RTE_STD_C11</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00040">rte_common.h:40</a></div></div>
<div class="ttc" id="arte__log_8h_html_ac23caeb9833fd0fd0665c6c05ec806fe"><div class="ttname"><a href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a></div><div class="ttdeci">#define RTE_LOG(l, t,...)</div><div class="ttdef"><b>Definition:</b> <a href="rte__log_8h_source.html#l00331">rte_log.h:331</a></div></div>
<div class="ttc" id="astructrte__ipv6__hdr_html"><div class="ttname"><a href="structrte__ipv6__hdr.html">rte_ipv6_hdr</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ip_8h_source.html#l00387">rte_ip.h:387</a></div></div>
<div class="ttc" id="astructrte__flow__item__ipv6_html"><div class="ttname"><a href="structrte__flow__item__ipv6.html">rte_flow_item_ipv6</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00812">rte_flow.h:812</a></div></div>
<div class="ttc" id="astructrte__flow__error_html"><div class="ttname"><a href="structrte__flow__error.html">rte_flow_error</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l02901">rte_flow.h:2901</a></div></div>
<div class="ttc" id="arte__flow_8h_html_af10e2b0af33527be504e883406a84ca1abb502c9d1fc4678e1e36187090494aca"><div class="ttname"><a href="rte__flow_8h.html#af10e2b0af33527be504e883406a84ca1abb502c9d1fc4678e1e36187090494aca">RTE_FLOW_ITEM_TYPE_ETH</a></div><div class="ttdeci">@ RTE_FLOW_ITEM_TYPE_ETH</div><div class="ttdef"><b>Definition:</b> <a href="rte__flow_8h_source.html#l00210">rte_flow.h:210</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
