<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DPDK: examples/ntb/ntb_fwd.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">20.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">examples/ntb/ntb_fwd.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/* SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><span class="comment"> * Copyright(c) 2019 Intel Corporation</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_socket.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cmdline_8h.html">cmdline.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__common_8h.html">rte_common.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__rawdev_8h.html">rte_rawdev.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ethdev_8h.html">rte_ethdev.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__lcore_8h.html">rte_lcore.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__cycles_8h.html">rte_cycles.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;rte_pmd_ntb.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__mbuf__pool__ops_8h.html">rte_mbuf_pool_ops.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Per-port statistics struct */</span></div>
<div class="line"><span class="keyword">struct </span>ntb_port_statistics {</div>
<div class="line">    uint64_t tx;</div>
<div class="line">    uint64_t rx;</div>
<div class="line">} <a name="a0"></a><a class="code" href="rte__common_8h.html#a38e32f822bc941e90fdcbe5a9c69b178">__rte_cache_aligned</a>;</div>
<div class="line"><span class="comment">/* Port 0: NTB dev, Port 1: ethdev when iofwd. */</span></div>
<div class="line"><span class="keyword">struct </span>ntb_port_statistics ntb_port_stats[2];</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>ntb_fwd_stream {</div>
<div class="line">    uint16_t tx_port;</div>
<div class="line">    uint16_t rx_port;</div>
<div class="line">    uint16_t qp_id;</div>
<div class="line">    uint8_t tx_ntb;  <span class="comment">/* If ntb device is tx port. */</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>ntb_fwd_lcore_conf {</div>
<div class="line">    uint16_t stream_id;</div>
<div class="line">    uint16_t nb_stream;</div>
<div class="line">    uint8_t stopped;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> ntb_fwd_mode {</div>
<div class="line">    FILE_TRANS = 0,</div>
<div class="line">    RXONLY,</div>
<div class="line">    TXONLY,</div>
<div class="line">    IOFWD,</div>
<div class="line">    MAX_FWD_MODE,</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> fwd_mode_s[] = {</div>
<div class="line">    <span class="stringliteral">&quot;file-trans&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;rxonly&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;txonly&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;iofwd&quot;</span>,</div>
<div class="line">    NULL,</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">enum</span> ntb_fwd_mode fwd_mode = MAX_FWD_MODE;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>ntb_fwd_lcore_conf fwd_lcore_conf[RTE_MAX_LCORE];</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>ntb_fwd_stream *fwd_streams;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a name="_a1"></a><a class="code" href="structrte__mempool.html">rte_mempool</a> *mbuf_pool;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NTB_DRV_NAME_LEN 7</span></div>
<div class="line"><span class="preprocessor">#define MEMPOOL_CACHE_SIZE 256</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> uint8_t in_test;</div>
<div class="line"><span class="keyword">static</span> uint8_t interactive = 1;</div>
<div class="line"><span class="keyword">static</span> uint16_t eth_port_id = RTE_MAX_ETHPORTS;</div>
<div class="line"><span class="keyword">static</span> uint16_t dev_id;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Number of queues, default set as 1 */</span></div>
<div class="line"><span class="keyword">static</span> uint16_t num_queues = 1;</div>
<div class="line"><span class="keyword">static</span> uint16_t ntb_buf_size = RTE_MBUF_DEFAULT_BUF_SIZE;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Configurable number of descriptors */</span></div>
<div class="line"><span class="preprocessor">#define NTB_DEFAULT_NUM_DESCS 1024</span></div>
<div class="line"><span class="keyword">static</span> uint16_t nb_desc = NTB_DEFAULT_NUM_DESCS;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> uint16_t tx_free_thresh;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NTB_MAX_PKT_BURST 32</span></div>
<div class="line"><span class="preprocessor">#define NTB_DFLT_PKT_BURST 32</span></div>
<div class="line"><span class="keyword">static</span> uint16_t pkt_burst = NTB_DFLT_PKT_BURST;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define BURST_TX_RETRIES 64</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a name="_a2"></a><a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> eth_port_conf = {</div>
<div class="line">    .<a name="a3"></a><a class="code" href="structrte__eth__conf.html#a346eef99c24f617b74c440c1aa565d01">rxmode</a> = {</div>
<div class="line">        .<a name="a4"></a><a class="code" href="structrte__eth__rxmode.html#aa0562513c4569f1aa53050f1beac6b5d">mq_mode</a> = <a name="a5"></a><a class="code" href="rte__ethdev_8h.html#a586b8e86131b4ec0ccaf464e847ccf3eaa06694239b7ecf1efa3c9243b9e7b4c0">ETH_MQ_RX_RSS</a>,</div>
<div class="line">        .split_hdr_size = 0,</div>
<div class="line">    },</div>
<div class="line">    .rx_adv_conf = {</div>
<div class="line">        .rss_conf = {</div>
<div class="line">            .rss_key = NULL,</div>
<div class="line">            .rss_hf = ETH_RSS_IP,</div>
<div class="line">        },</div>
<div class="line">    },</div>
<div class="line">    .txmode = {</div>
<div class="line">        .mq_mode = <a name="a6"></a><a class="code" href="rte__ethdev_8h.html#a4834f572f4dd4e46d81ad09b7d5fffd5aada568551470d5f419cd2f3d6b6bfedc">ETH_MQ_TX_NONE</a>,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* *** Help command with introduction. *** */</span></div>
<div class="line"><span class="keyword">struct </span>cmd_help_result {</div>
<div class="line">    cmdline_fixed_string_t help;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_help_parsed(<a name="a7"></a><a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">        <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    cmdline_printf(</div>
<div class="line">        cl,</div>
<div class="line">        <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;The following commands are currently available:\n\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;Control:\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;    quit                                      :&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; Quit the application.\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\nTransmission:\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;    send [path]                               :&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; Send [path] file. Only take effect in file-trans mode\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;    start                                     :&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; Start transmissions.\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;    stop                                      :&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; Stop transmissions.\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;    clear/show port stats                     :&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; Clear/show port stats.\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;    set fwd file-trans/rxonly/txonly/iofwd    :&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; Set packet forwarding mode.\n&quot;</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">cmdline_parse_token_string_t cmd_help_help =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_help_result, help, <span class="stringliteral">&quot;help&quot;</span>);</div>
<div class="line"> </div>
<div class="line">cmdline_parse_inst_t cmd_help = {</div>
<div class="line">    .f = cmd_help_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;show help&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_help_help,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* *** QUIT *** */</span></div>
<div class="line"><span class="keyword">struct </span>cmd_quit_result {</div>
<div class="line">    cmdline_fixed_string_t quit;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_quit_parsed(<a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">        <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_lcore_conf *conf;</div>
<div class="line">    uint32_t lcore_id;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Stop transmission first. */</span></div>
<div class="line">    <a name="a8"></a><a class="code" href="rte__lcore_8h.html#ac779e61584eb9d087c3e20bf2d1150c8">RTE_LCORE_FOREACH_WORKER</a>(lcore_id) {</div>
<div class="line">        conf = &amp;fwd_lcore_conf[lcore_id];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!conf-&gt;nb_stream)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (conf-&gt;stopped)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        conf-&gt;stopped = 1;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nWaiting for lcores to finish...\n&quot;</span>);</div>
<div class="line">    <a name="a9"></a><a class="code" href="rte__launch_8h.html#a7760d6e89a309af9b80767be641bfa18">rte_eal_mp_wait_lcore</a>();</div>
<div class="line">    in_test = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Stop traffic and Close port. */</span></div>
<div class="line">    <a name="a10"></a><a class="code" href="rte__rawdev_8h.html#a5395321daab8ff98447a296880cc4ae9">rte_rawdev_stop</a>(dev_id);</div>
<div class="line">    <a name="a11"></a><a class="code" href="rte__rawdev_8h.html#adfa4a26f63848ac2e8162fd2c19b332d">rte_rawdev_close</a>(dev_id);</div>
<div class="line">    <span class="keywordflow">if</span> (eth_port_id &lt; RTE_MAX_ETHPORTS &amp;&amp; fwd_mode == IOFWD) {</div>
<div class="line">        <a name="a12"></a><a class="code" href="rte__ethdev_8h.html#a6fc010cf6216331c50bc02d2fd4e614f">rte_eth_dev_stop</a>(eth_port_id);</div>
<div class="line">        <a name="a13"></a><a class="code" href="rte__ethdev_8h.html#ac2c7507787a5520e8049fff94432169e">rte_eth_dev_close</a>(eth_port_id);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    cmdline_quit(cl);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">cmdline_parse_token_string_t cmd_quit_quit =</div>
<div class="line">        TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_quit_result, quit, <span class="stringliteral">&quot;quit&quot;</span>);</div>
<div class="line"> </div>
<div class="line">cmdline_parse_inst_t cmd_quit = {</div>
<div class="line">    .f = cmd_quit_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;exit application&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_quit_quit,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* *** SEND FILE PARAMETERS *** */</span></div>
<div class="line"><span class="keyword">struct </span>cmd_sendfile_result {</div>
<div class="line">    cmdline_fixed_string_t send_string;</div>
<div class="line">    <span class="keywordtype">char</span> filepath[];</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_sendfile_parsed(<span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_sendfile_result *res = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>rte_rawdev_buf *pkts_send[NTB_MAX_PKT_BURST];</div>
<div class="line">    <span class="keyword">struct </span><a name="_a14"></a><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *mbuf_send[NTB_MAX_PKT_BURST];</div>
<div class="line">    uint64_t size, count, i, j, nb_burst;</div>
<div class="line">    uint16_t nb_tx, buf_size;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nb_pkt;</div>
<div class="line">    <span class="keywordtype">size_t</span> queue_id = 0;</div>
<div class="line">    uint16_t retry = 0;</div>
<div class="line">    uint32_t val;</div>
<div class="line">    FILE *file;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num_queues != 1) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;File transmission only supports 1 queue.\n&quot;</span>);</div>
<div class="line">        num_queues = 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    file = fopen(res-&gt;filepath, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (file == NULL) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Fail to open the file.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fseek(file, 0, SEEK_END) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Fail to get file size.\n&quot;</span>);</div>
<div class="line">        fclose(file);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    size = ftell(file);</div>
<div class="line">    <span class="keywordflow">if</span> (fseek(file, 0, SEEK_SET) &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Fail to get file size.\n&quot;</span>);</div>
<div class="line">        fclose(file);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Tell remote about the file size. */</span></div>
<div class="line">    val = size &gt;&gt; 32;</div>
<div class="line">    <a name="a15"></a><a class="code" href="rte__rawdev_8h.html#a89055cb62b725345bfd536e608ab939f">rte_rawdev_set_attr</a>(dev_id, <span class="stringliteral">&quot;spad_user_0&quot;</span>, val);</div>
<div class="line">    val = size;</div>
<div class="line">    <a class="code" href="rte__rawdev_8h.html#a89055cb62b725345bfd536e608ab939f">rte_rawdev_set_attr</a>(dev_id, <span class="stringliteral">&quot;spad_user_1&quot;</span>, val);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Sending file, size is %&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>, size);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NTB_MAX_PKT_BURST; i++)</div>
<div class="line">        pkts_send[i] = (<span class="keyword">struct</span> rte_rawdev_buf *)</div>
<div class="line">                malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> rte_rawdev_buf));</div>
<div class="line"> </div>
<div class="line">    buf_size = ntb_buf_size - RTE_PKTMBUF_HEADROOM;</div>
<div class="line">    count = (size + buf_size - 1) / buf_size;</div>
<div class="line">    nb_burst = (count + pkt_burst - 1) / pkt_burst;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_burst; i++) {</div>
<div class="line">        val = <a name="a16"></a><a class="code" href="rte__common_8h.html#a4c7571cbcdbfe9b63431036af811bee9">RTE_MIN</a>(count, pkt_burst);</div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a17"></a><a class="code" href="rte__mempool_8h.html#a0d326354d53ef5068d86a8b7d9ec2d61">rte_mempool_get_bulk</a>(mbuf_pool, (<span class="keywordtype">void</span> **)mbuf_send,</div>
<div class="line">                    val) == 0) {</div>
<div class="line">            <span class="keywordflow">for</span> (nb_pkt = 0; nb_pkt &lt; val; nb_pkt++) {</div>
<div class="line">                mbuf_send[nb_pkt]-&gt;port = dev_id;</div>
<div class="line">                mbuf_send[nb_pkt]-&gt;data_len =</div>
<div class="line">                fread(<a name="a18"></a><a class="code" href="rte__mbuf__core_8h.html#a2a8b10263496c7b580e9d0c7f2a1f073">rte_pktmbuf_mtod</a>(mbuf_send[nb_pkt],</div>
<div class="line">                    <span class="keywordtype">void</span> *), 1, buf_size, file);</div>
<div class="line">                mbuf_send[nb_pkt]-&gt;pkt_len =</div>
<div class="line">                    mbuf_send[nb_pkt]-&gt;data_len;</div>
<div class="line">                pkts_send[nb_pkt]-&gt;buf_addr = mbuf_send[nb_pkt];</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">for</span> (nb_pkt = 0; nb_pkt &lt; val; nb_pkt++) {</div>
<div class="line">                mbuf_send[nb_pkt] =</div>
<div class="line">                    <a name="a19"></a><a class="code" href="rte__mbuf_8h.html#a008287388f5c32ebc812eaa166017a50">rte_mbuf_raw_alloc</a>(mbuf_pool);</div>
<div class="line">                <span class="keywordflow">if</span> (mbuf_send[nb_pkt] == NULL)</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                mbuf_send[nb_pkt]-&gt;port = dev_id;</div>
<div class="line">                mbuf_send[nb_pkt]-&gt;data_len =</div>
<div class="line">                fread(<a class="code" href="rte__mbuf__core_8h.html#a2a8b10263496c7b580e9d0c7f2a1f073">rte_pktmbuf_mtod</a>(mbuf_send[nb_pkt],</div>
<div class="line">                    <span class="keywordtype">void</span> *), 1, buf_size, file);</div>
<div class="line">                mbuf_send[nb_pkt]-&gt;pkt_len =</div>
<div class="line">                    mbuf_send[nb_pkt]-&gt;data_len;</div>
<div class="line">                pkts_send[nb_pkt]-&gt;buf_addr = mbuf_send[nb_pkt];</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a20"></a><a class="code" href="rte__rawdev_8h.html#a0bd0c1f93d46bd0de6766ce35438727b">rte_rawdev_enqueue_buffers</a>(dev_id, pkts_send, nb_pkt,</div>
<div class="line">                        (<span class="keywordtype">void</span> *)queue_id);</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Enqueue failed with err %d\n&quot;</span>, ret);</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; nb_pkt; j++)</div>
<div class="line">                <a name="a21"></a><a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(mbuf_send[j]);</div>
<div class="line">            <span class="keywordflow">goto</span> clean;</div>
<div class="line">        }</div>
<div class="line">        nb_tx = ret;</div>
<div class="line">        <span class="keywordflow">while</span> (nb_tx != nb_pkt &amp;&amp; retry &lt; BURST_TX_RETRIES) {</div>
<div class="line">            <a name="a22"></a><a class="code" href="rte__cycles_8h.html#ab1c632a1dbe8e69c028fce82c055feb7">rte_delay_us</a>(1);</div>
<div class="line">            ret = <a class="code" href="rte__rawdev_8h.html#a0bd0c1f93d46bd0de6766ce35438727b">rte_rawdev_enqueue_buffers</a>(dev_id,</div>
<div class="line">                    &amp;pkts_send[nb_tx], nb_pkt - nb_tx,</div>
<div class="line">                    (<span class="keywordtype">void</span> *)queue_id);</div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Enqueue failed with err %d\n&quot;</span>, ret);</div>
<div class="line">                <span class="keywordflow">for</span> (j = nb_tx; j &lt; nb_pkt; j++)</div>
<div class="line">                    <a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(mbuf_send[j]);</div>
<div class="line">                <span class="keywordflow">goto</span> clean;</div>
<div class="line">            }</div>
<div class="line">            nb_tx += ret;</div>
<div class="line">        }</div>
<div class="line">        count -= nb_pkt;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Clear register after file sending done. */</span></div>
<div class="line">    <a class="code" href="rte__rawdev_8h.html#a89055cb62b725345bfd536e608ab939f">rte_rawdev_set_attr</a>(dev_id, <span class="stringliteral">&quot;spad_user_0&quot;</span>, 0);</div>
<div class="line">    <a class="code" href="rte__rawdev_8h.html#a89055cb62b725345bfd536e608ab939f">rte_rawdev_set_attr</a>(dev_id, <span class="stringliteral">&quot;spad_user_1&quot;</span>, 0);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Done sending file.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">clean:</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NTB_MAX_PKT_BURST; i++)</div>
<div class="line">        free(pkts_send[i]);</div>
<div class="line">    fclose(file);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">cmdline_parse_token_string_t cmd_send_file_send =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_sendfile_result, send_string,</div>
<div class="line">                 <span class="stringliteral">&quot;send&quot;</span>);</div>
<div class="line">cmdline_parse_token_string_t cmd_send_file_filepath =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_sendfile_result, filepath, NULL);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">cmdline_parse_inst_t cmd_send_file = {</div>
<div class="line">    .f = cmd_sendfile_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;send &lt;file_path&gt;&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_send_file_send,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_send_file_filepath,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define RECV_FILE_LEN 30</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">start_polling_recv_file(<span class="keywordtype">void</span> *param)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>rte_rawdev_buf *pkts_recv[NTB_MAX_PKT_BURST];</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_lcore_conf *conf = param;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *mbuf;</div>
<div class="line">    <span class="keywordtype">char</span> filepath[RECV_FILE_LEN];</div>
<div class="line">    uint64_t val, size, file_len;</div>
<div class="line">    uint16_t nb_rx, i, file_no;</div>
<div class="line">    <span class="keywordtype">size_t</span> queue_id = 0;</div>
<div class="line">    FILE *file;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NTB_MAX_PKT_BURST; i++)</div>
<div class="line">        pkts_recv[i] = (<span class="keyword">struct</span> rte_rawdev_buf *)</div>
<div class="line">                malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> rte_rawdev_buf));</div>
<div class="line"> </div>
<div class="line">    file_no = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (!conf-&gt;stopped) {</div>
<div class="line">        snprintf(filepath, RECV_FILE_LEN, <span class="stringliteral">&quot;ntb_recv_file%d&quot;</span>, file_no);</div>
<div class="line">        file = fopen(filepath, <span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (file == NULL) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Fail to open the file.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a name="a23"></a><a class="code" href="rte__rawdev_8h.html#a59bb29d3791a9866fab73ab97f44b568">rte_rawdev_get_attr</a>(dev_id, <span class="stringliteral">&quot;spad_user_0&quot;</span>, &amp;val);</div>
<div class="line">        size = val &lt;&lt; 32;</div>
<div class="line">        <a class="code" href="rte__rawdev_8h.html#a59bb29d3791a9866fab73ab97f44b568">rte_rawdev_get_attr</a>(dev_id, <span class="stringliteral">&quot;spad_user_1&quot;</span>, &amp;val);</div>
<div class="line">        size |= val;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!size) {</div>
<div class="line">            fclose(file);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        file_len = 0;</div>
<div class="line">        nb_rx = NTB_MAX_PKT_BURST;</div>
<div class="line">        <span class="keywordflow">while</span> (file_len &lt; size &amp;&amp; !conf-&gt;stopped) {</div>
<div class="line">            ret = <a name="a24"></a><a class="code" href="rte__rawdev_8h.html#a850206928a35e126b04f206294369998">rte_rawdev_dequeue_buffers</a>(dev_id, pkts_recv,</div>
<div class="line">                    pkt_burst, (<span class="keywordtype">void</span> *)queue_id);</div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Dequeue failed with err %d\n&quot;</span>, ret);</div>
<div class="line">                fclose(file);</div>
<div class="line">                <span class="keywordflow">goto</span> clean;</div>
<div class="line">            }</div>
<div class="line">            nb_rx = ret;</div>
<div class="line">            ntb_port_stats[0].rx += nb_rx;</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; nb_rx; i++) {</div>
<div class="line">                mbuf = pkts_recv[i]-&gt;<a name="a25"></a><a class="code" href="structrte__mbuf.html#a9db3d388a1381e68e509017a6e7d0f12">buf_addr</a>;</div>
<div class="line">                fwrite(<a class="code" href="rte__mbuf__core_8h.html#a2a8b10263496c7b580e9d0c7f2a1f073">rte_pktmbuf_mtod</a>(mbuf, <span class="keywordtype">void</span> *), 1,</div>
<div class="line">                    mbuf-&gt;<a name="a26"></a><a class="code" href="structrte__mbuf.html#ad1a572736a10ff6b282c5f43c4ea1ccf">data_len</a>, file);</div>
<div class="line">                file_len += mbuf-&gt;<a class="code" href="structrte__mbuf.html#ad1a572736a10ff6b282c5f43c4ea1ccf">data_len</a>;</div>
<div class="line">                <a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(mbuf);</div>
<div class="line">                pkts_recv[i]-&gt;buf_addr = NULL;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;Received file (size: %&quot;</span> PRIu64 <span class="stringliteral">&quot;) from peer to %s.\n&quot;</span>,</div>
<div class="line">            size, filepath);</div>
<div class="line">        fclose(file);</div>
<div class="line">        file_no++;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">clean:</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NTB_MAX_PKT_BURST; i++)</div>
<div class="line">        free(pkts_recv[i]);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">start_iofwd_per_lcore(<span class="keywordtype">void</span> *param)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>rte_rawdev_buf *ntb_buf[NTB_MAX_PKT_BURST];</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *pkts_burst[NTB_MAX_PKT_BURST];</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_lcore_conf *conf = param;</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_stream fs;</div>
<div class="line">    uint16_t nb_rx, nb_tx;</div>
<div class="line">    <span class="keywordtype">int</span> i, j, ret;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NTB_MAX_PKT_BURST; i++)</div>
<div class="line">        ntb_buf[i] = (<span class="keyword">struct</span> rte_rawdev_buf *)</div>
<div class="line">                 malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> rte_rawdev_buf));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (!conf-&gt;stopped) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; conf-&gt;nb_stream; i++) {</div>
<div class="line">            fs = fwd_streams[conf-&gt;stream_id + i];</div>
<div class="line">            <span class="keywordflow">if</span> (fs.tx_ntb) {</div>
<div class="line">                nb_rx = <a name="a27"></a><a class="code" href="rte__ethdev_8h.html#a3e7d76a451b46348686ea97d6367f102">rte_eth_rx_burst</a>(fs.rx_port,</div>
<div class="line">                        fs.qp_id, pkts_burst,</div>
<div class="line">                        pkt_burst);</div>
<div class="line">                <span class="keywordflow">if</span> (<a name="a28"></a><a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(nb_rx == 0))</div>
<div class="line">                    <span class="keywordflow">continue</span>;</div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; nb_rx; j++)</div>
<div class="line">                    ntb_buf[j]-&gt;buf_addr = pkts_burst[j];</div>
<div class="line">                ret = <a class="code" href="rte__rawdev_8h.html#a0bd0c1f93d46bd0de6766ce35438727b">rte_rawdev_enqueue_buffers</a>(fs.tx_port,</div>
<div class="line">                        ntb_buf, nb_rx,</div>
<div class="line">                        (<span class="keywordtype">void</span> *)(<span class="keywordtype">size_t</span>)fs.qp_id);</div>
<div class="line">                <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Enqueue failed with err %d\n&quot;</span>,</div>
<div class="line">                        ret);</div>
<div class="line">                    <span class="keywordflow">for</span> (j = 0; j &lt; nb_rx; j++)</div>
<div class="line">                        <a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(pkts_burst[j]);</div>
<div class="line">                    <span class="keywordflow">goto</span> clean;</div>
<div class="line">                }</div>
<div class="line">                nb_tx = ret;</div>
<div class="line">                ntb_port_stats[0].tx += nb_tx;</div>
<div class="line">                ntb_port_stats[1].rx += nb_rx;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                ret = <a class="code" href="rte__rawdev_8h.html#a850206928a35e126b04f206294369998">rte_rawdev_dequeue_buffers</a>(fs.rx_port,</div>
<div class="line">                        ntb_buf, pkt_burst,</div>
<div class="line">                        (<span class="keywordtype">void</span> *)(<span class="keywordtype">size_t</span>)fs.qp_id);</div>
<div class="line">                <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Dequeue failed with err %d\n&quot;</span>,</div>
<div class="line">                        ret);</div>
<div class="line">                    <span class="keywordflow">goto</span> clean;</div>
<div class="line">                }</div>
<div class="line">                nb_rx = ret;</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(nb_rx == 0))</div>
<div class="line">                    <span class="keywordflow">continue</span>;</div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; nb_rx; j++)</div>
<div class="line">                    pkts_burst[j] = ntb_buf[j]-&gt;buf_addr;</div>
<div class="line">                nb_tx = <a name="a29"></a><a class="code" href="rte__ethdev_8h.html#a83e56cabbd31637efd648e3fc010392b">rte_eth_tx_burst</a>(fs.tx_port,</div>
<div class="line">                    fs.qp_id, pkts_burst, nb_rx);</div>
<div class="line">                ntb_port_stats[1].tx += nb_tx;</div>
<div class="line">                ntb_port_stats[0].rx += nb_rx;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(nb_tx &lt; nb_rx)) {</div>
<div class="line">                <span class="keywordflow">do</span> {</div>
<div class="line">                    <a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(pkts_burst[nb_tx]);</div>
<div class="line">                } <span class="keywordflow">while</span> (++nb_tx &lt; nb_rx);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">clean:</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NTB_MAX_PKT_BURST; i++)</div>
<div class="line">        free(ntb_buf[i]);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">start_rxonly_per_lcore(<span class="keywordtype">void</span> *param)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>rte_rawdev_buf *ntb_buf[NTB_MAX_PKT_BURST];</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_lcore_conf *conf = param;</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_stream fs;</div>
<div class="line">    uint16_t nb_rx;</div>
<div class="line">    <span class="keywordtype">int</span> i, j, ret;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NTB_MAX_PKT_BURST; i++)</div>
<div class="line">        ntb_buf[i] = (<span class="keyword">struct</span> rte_rawdev_buf *)</div>
<div class="line">                 malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> rte_rawdev_buf));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (!conf-&gt;stopped) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; conf-&gt;nb_stream; i++) {</div>
<div class="line">            fs = fwd_streams[conf-&gt;stream_id + i];</div>
<div class="line">            ret = <a class="code" href="rte__rawdev_8h.html#a850206928a35e126b04f206294369998">rte_rawdev_dequeue_buffers</a>(fs.rx_port,</div>
<div class="line">                  ntb_buf, pkt_burst, (<span class="keywordtype">void</span> *)(<span class="keywordtype">size_t</span>)fs.qp_id);</div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Dequeue failed with err %d\n&quot;</span>, ret);</div>
<div class="line">                <span class="keywordflow">goto</span> clean;</div>
<div class="line">            }</div>
<div class="line">            nb_rx = ret;</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(nb_rx == 0))</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            ntb_port_stats[0].rx += nb_rx;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; nb_rx; j++)</div>
<div class="line">                <a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(ntb_buf[j]-&gt;buf_addr);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">clean:</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NTB_MAX_PKT_BURST; i++)</div>
<div class="line">        free(ntb_buf[i]);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">start_txonly_per_lcore(<span class="keywordtype">void</span> *param)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>rte_rawdev_buf *ntb_buf[NTB_MAX_PKT_BURST];</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *pkts_burst[NTB_MAX_PKT_BURST];</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_lcore_conf *conf = param;</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_stream fs;</div>
<div class="line">    uint16_t nb_pkt, nb_tx;</div>
<div class="line">    <span class="keywordtype">int</span> i, j, ret;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NTB_MAX_PKT_BURST; i++)</div>
<div class="line">        ntb_buf[i] = (<span class="keyword">struct</span> rte_rawdev_buf *)</div>
<div class="line">                 malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> rte_rawdev_buf));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (!conf-&gt;stopped) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; conf-&gt;nb_stream; i++) {</div>
<div class="line">            fs = fwd_streams[conf-&gt;stream_id + i];</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__mempool_8h.html#a0d326354d53ef5068d86a8b7d9ec2d61">rte_mempool_get_bulk</a>(mbuf_pool, (<span class="keywordtype">void</span> **)pkts_burst,</div>
<div class="line">                  pkt_burst) == 0) {</div>
<div class="line">                <span class="keywordflow">for</span> (nb_pkt = 0; nb_pkt &lt; pkt_burst; nb_pkt++) {</div>
<div class="line">                    pkts_burst[nb_pkt]-&gt;port = dev_id;</div>
<div class="line">                    pkts_burst[nb_pkt]-&gt;data_len =</div>
<div class="line">                        pkts_burst[nb_pkt]-&gt;buf_len -</div>
<div class="line">                        RTE_PKTMBUF_HEADROOM;</div>
<div class="line">                    pkts_burst[nb_pkt]-&gt;pkt_len =</div>
<div class="line">                        pkts_burst[nb_pkt]-&gt;data_len;</div>
<div class="line">                    ntb_buf[nb_pkt]-&gt;buf_addr =</div>
<div class="line">                        pkts_burst[nb_pkt];</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">for</span> (nb_pkt = 0; nb_pkt &lt; pkt_burst; nb_pkt++) {</div>
<div class="line">                    pkts_burst[nb_pkt] =</div>
<div class="line">                        <a name="a30"></a><a class="code" href="rte__mbuf_8h.html#ad4d1c289d8cffc831dfb77c64f52447b">rte_pktmbuf_alloc</a>(mbuf_pool);</div>
<div class="line">                    <span class="keywordflow">if</span> (pkts_burst[nb_pkt] == NULL)</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    pkts_burst[nb_pkt]-&gt;port = dev_id;</div>
<div class="line">                    pkts_burst[nb_pkt]-&gt;data_len =</div>
<div class="line">                        pkts_burst[nb_pkt]-&gt;buf_len -</div>
<div class="line">                        RTE_PKTMBUF_HEADROOM;</div>
<div class="line">                    pkts_burst[nb_pkt]-&gt;pkt_len =</div>
<div class="line">                        pkts_burst[nb_pkt]-&gt;data_len;</div>
<div class="line">                    ntb_buf[nb_pkt]-&gt;buf_addr =</div>
<div class="line">                        pkts_burst[nb_pkt];</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            ret = <a class="code" href="rte__rawdev_8h.html#a0bd0c1f93d46bd0de6766ce35438727b">rte_rawdev_enqueue_buffers</a>(fs.tx_port, ntb_buf,</div>
<div class="line">                    nb_pkt, (<span class="keywordtype">void</span> *)(<span class="keywordtype">size_t</span>)fs.qp_id);</div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Enqueue failed with err %d\n&quot;</span>, ret);</div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; nb_pkt; j++)</div>
<div class="line">                    <a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(pkts_burst[j]);</div>
<div class="line">                <span class="keywordflow">goto</span> clean;</div>
<div class="line">            }</div>
<div class="line">            nb_tx = ret;</div>
<div class="line">            ntb_port_stats[0].tx += nb_tx;</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(nb_tx &lt; nb_pkt)) {</div>
<div class="line">                <span class="keywordflow">do</span> {</div>
<div class="line">                    <a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(pkts_burst[nb_tx]);</div>
<div class="line">                } <span class="keywordflow">while</span> (++nb_tx &lt; nb_pkt);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">clean:</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; NTB_MAX_PKT_BURST; i++)</div>
<div class="line">        free(ntb_buf[i]);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">ntb_fwd_config_setup(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint16_t i;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Make sure iofwd has valid ethdev. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (fwd_mode == IOFWD &amp;&amp; eth_port_id &gt;= RTE_MAX_ETHPORTS) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;No ethdev, cannot be in iofwd mode.&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fwd_mode == IOFWD) {</div>
<div class="line">        fwd_streams = <a name="a31"></a><a class="code" href="rte__malloc_8h.html#aaf0f048a5fd1672688c662cdfb4536b3">rte_zmalloc</a>(<span class="stringliteral">&quot;ntb_fwd: fwd_streams&quot;</span>,</div>
<div class="line">            <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ntb_fwd_stream) * num_queues * 2,</div>
<div class="line">            RTE_CACHE_LINE_SIZE);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; num_queues; i++) {</div>
<div class="line">            fwd_streams[i * 2].qp_id = i;</div>
<div class="line">            fwd_streams[i * 2].tx_port = dev_id;</div>
<div class="line">            fwd_streams[i * 2].rx_port = eth_port_id;</div>
<div class="line">            fwd_streams[i * 2].tx_ntb = 1;</div>
<div class="line"> </div>
<div class="line">            fwd_streams[i * 2 + 1].qp_id = i;</div>
<div class="line">            fwd_streams[i * 2 + 1].tx_port = eth_port_id;</div>
<div class="line">            fwd_streams[i * 2 + 1].rx_port = dev_id;</div>
<div class="line">            fwd_streams[i * 2 + 1].tx_ntb = 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fwd_mode == RXONLY || fwd_mode == FILE_TRANS) {</div>
<div class="line">        <span class="comment">/* Only support 1 queue in file-trans for in order. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (fwd_mode == FILE_TRANS)</div>
<div class="line">            num_queues = 1;</div>
<div class="line"> </div>
<div class="line">        fwd_streams = <a class="code" href="rte__malloc_8h.html#aaf0f048a5fd1672688c662cdfb4536b3">rte_zmalloc</a>(<span class="stringliteral">&quot;ntb_fwd: fwd_streams&quot;</span>,</div>
<div class="line">                <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ntb_fwd_stream) * num_queues,</div>
<div class="line">                RTE_CACHE_LINE_SIZE);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; num_queues; i++) {</div>
<div class="line">            fwd_streams[i].qp_id = i;</div>
<div class="line">            fwd_streams[i].tx_port = RTE_MAX_ETHPORTS;</div>
<div class="line">            fwd_streams[i].rx_port = dev_id;</div>
<div class="line">            fwd_streams[i].tx_ntb = 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fwd_mode == TXONLY) {</div>
<div class="line">        fwd_streams = <a class="code" href="rte__malloc_8h.html#aaf0f048a5fd1672688c662cdfb4536b3">rte_zmalloc</a>(<span class="stringliteral">&quot;ntb_fwd: fwd_streams&quot;</span>,</div>
<div class="line">                <span class="keyword">sizeof</span>(<span class="keyword">struct</span> ntb_fwd_stream) * num_queues,</div>
<div class="line">                RTE_CACHE_LINE_SIZE);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; num_queues; i++) {</div>
<div class="line">            fwd_streams[i].qp_id = i;</div>
<div class="line">            fwd_streams[i].tx_port = dev_id;</div>
<div class="line">            fwd_streams[i].rx_port = RTE_MAX_ETHPORTS;</div>
<div class="line">            fwd_streams[i].tx_ntb = 1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">assign_stream_to_lcores(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_lcore_conf *conf;</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_stream *fs;</div>
<div class="line">    uint16_t nb_streams, sm_per_lcore, sm_id, i;</div>
<div class="line">    uint32_t lcore_id;</div>
<div class="line">    uint8_t lcore_num, nb_extra;</div>
<div class="line"> </div>
<div class="line">    lcore_num = <a name="a32"></a><a class="code" href="rte__lcore_8h.html#a1728dc7f14571ba778d3b5b41aa09283">rte_lcore_count</a>();</div>
<div class="line">    <span class="comment">/* Exclude main core */</span></div>
<div class="line">    lcore_num--;</div>
<div class="line"> </div>
<div class="line">    nb_streams = (fwd_mode == IOFWD) ? num_queues * 2 : num_queues;</div>
<div class="line"> </div>
<div class="line">    sm_per_lcore = nb_streams / lcore_num;</div>
<div class="line">    nb_extra = nb_streams % lcore_num;</div>
<div class="line">    sm_id = 0;</div>
<div class="line">    i = 0;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__lcore_8h.html#ac779e61584eb9d087c3e20bf2d1150c8">RTE_LCORE_FOREACH_WORKER</a>(lcore_id) {</div>
<div class="line">        conf = &amp;fwd_lcore_conf[lcore_id];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (i &lt; nb_extra) {</div>
<div class="line">            conf-&gt;nb_stream = sm_per_lcore + 1;</div>
<div class="line">            conf-&gt;stream_id = sm_id;</div>
<div class="line">            sm_id = sm_id + sm_per_lcore + 1;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            conf-&gt;nb_stream = sm_per_lcore;</div>
<div class="line">            conf-&gt;stream_id = sm_id;</div>
<div class="line">            sm_id = sm_id + sm_per_lcore;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        i++;</div>
<div class="line">        <span class="keywordflow">if</span> (sm_id &gt;= nb_streams)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Print packet forwading config. */</span></div>
<div class="line">    <a class="code" href="rte__lcore_8h.html#ac779e61584eb9d087c3e20bf2d1150c8">RTE_LCORE_FOREACH_WORKER</a>(lcore_id) {</div>
<div class="line">        conf = &amp;fwd_lcore_conf[lcore_id];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!conf-&gt;nb_stream)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;Streams on Lcore %u :\n&quot;</span>, lcore_id);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; conf-&gt;nb_stream; i++) {</div>
<div class="line">            fs = &amp;fwd_streams[conf-&gt;stream_id + i];</div>
<div class="line">            <span class="keywordflow">if</span> (fwd_mode == IOFWD)</div>
<div class="line">                printf(<span class="stringliteral">&quot; + Stream %u : %s%u RX -&gt; %s%u TX,&quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot; Q=%u\n&quot;</span>, conf-&gt;stream_id + i,</div>
<div class="line">                    fs-&gt;tx_ntb ? <span class="stringliteral">&quot;Eth&quot;</span> : <span class="stringliteral">&quot;NTB&quot;</span>, fs-&gt;rx_port,</div>
<div class="line">                    fs-&gt;tx_ntb ? <span class="stringliteral">&quot;NTB&quot;</span> : <span class="stringliteral">&quot;Eth&quot;</span>, fs-&gt;tx_port,</div>
<div class="line">                    fs-&gt;qp_id);</div>
<div class="line">            <span class="keywordflow">if</span> (fwd_mode == FILE_TRANS || fwd_mode == RXONLY)</div>
<div class="line">                printf(<span class="stringliteral">&quot; + Stream %u : %s%u RX only\n&quot;</span>,</div>
<div class="line">                    conf-&gt;stream_id, <span class="stringliteral">&quot;NTB&quot;</span>, fs-&gt;rx_port);</div>
<div class="line">            <span class="keywordflow">if</span> (fwd_mode == TXONLY)</div>
<div class="line">                printf(<span class="stringliteral">&quot; + Stream %u : %s%u TX only\n&quot;</span>,</div>
<div class="line">                    conf-&gt;stream_id, <span class="stringliteral">&quot;NTB&quot;</span>, fs-&gt;tx_port);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">start_pkt_fwd(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_lcore_conf *conf;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a33"></a><a class="code" href="structrte__eth__link.html">rte_eth_link</a> eth_link;</div>
<div class="line">    uint32_t lcore_id;</div>
<div class="line">    <span class="keywordtype">int</span> ret, i;</div>
<div class="line">    <span class="keywordtype">char</span> link_status_text[<a name="a34"></a><a class="code" href="rte__ethdev_8h.html#a7a31d6736244603b6a1d7efdd32a8834">RTE_ETH_LINK_MAX_STR_LEN</a>];</div>
<div class="line"> </div>
<div class="line">    ret = ntb_fwd_config_setup();</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Cannot start traffic. Please reset fwd mode.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* If using iofwd, checking ethdev link status first. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (fwd_mode == IOFWD) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Checking eth link status...\n&quot;</span>);</div>
<div class="line">        <span class="comment">/* Wait for eth link up at most 100 times. */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; 100; i++) {</div>
<div class="line">            ret = <a name="a35"></a><a class="code" href="rte__ethdev_8h.html#a56200b0c25f3ecab5abe9bd2b647c215">rte_eth_link_get</a>(eth_port_id, &amp;eth_link);</div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Link get failed with err %d\n&quot;</span>, ret);</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (eth_link.link_status) {</div>
<div class="line">                <a name="a36"></a><a class="code" href="rte__ethdev_8h.html#a5f51139368b8d1a2c22fdecd90bc4d98">rte_eth_link_to_str</a>(link_status_text,</div>
<div class="line">                    <span class="keyword">sizeof</span>(link_status_text),</div>
<div class="line">                    &amp;eth_link);</div>
<div class="line">                printf(<span class="stringliteral">&quot;Eth%u %s\n&quot;</span>, eth_port_id,</div>
<div class="line">                       link_status_text);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!eth_link.link_status) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Eth%u link down. Cannot start traffic.\n&quot;</span>,</div>
<div class="line">                eth_port_id);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    assign_stream_to_lcores();</div>
<div class="line">    in_test = 1;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__lcore_8h.html#ac779e61584eb9d087c3e20bf2d1150c8">RTE_LCORE_FOREACH_WORKER</a>(lcore_id) {</div>
<div class="line">        conf = &amp;fwd_lcore_conf[lcore_id];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!conf-&gt;nb_stream)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        conf-&gt;stopped = 0;</div>
<div class="line">        <span class="keywordflow">if</span> (fwd_mode == FILE_TRANS)</div>
<div class="line">            <a name="a37"></a><a class="code" href="rte__launch_8h.html#a2bf98eda211728b3dc69aa7694758c6d">rte_eal_remote_launch</a>(start_polling_recv_file,</div>
<div class="line">                          conf, lcore_id);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fwd_mode == IOFWD)</div>
<div class="line">            <a class="code" href="rte__launch_8h.html#a2bf98eda211728b3dc69aa7694758c6d">rte_eal_remote_launch</a>(start_iofwd_per_lcore,</div>
<div class="line">                          conf, lcore_id);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fwd_mode == RXONLY)</div>
<div class="line">            <a class="code" href="rte__launch_8h.html#a2bf98eda211728b3dc69aa7694758c6d">rte_eal_remote_launch</a>(start_rxonly_per_lcore,</div>
<div class="line">                          conf, lcore_id);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fwd_mode == TXONLY)</div>
<div class="line">            <a class="code" href="rte__launch_8h.html#a2bf98eda211728b3dc69aa7694758c6d">rte_eal_remote_launch</a>(start_txonly_per_lcore,</div>
<div class="line">                          conf, lcore_id);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* *** START FWD PARAMETERS *** */</span></div>
<div class="line"><span class="keyword">struct </span>cmd_start_result {</div>
<div class="line">    cmdline_fixed_string_t start;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_start_parsed(<a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">                <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">                <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    start_pkt_fwd();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">cmdline_parse_token_string_t cmd_start_start =</div>
<div class="line">        TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_start_result, start, <span class="stringliteral">&quot;start&quot;</span>);</div>
<div class="line"> </div>
<div class="line">cmdline_parse_inst_t cmd_start = {</div>
<div class="line">    .f = cmd_start_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;start pkt fwd between ntb and ethdev&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_start_start,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* *** STOP *** */</span></div>
<div class="line"><span class="keyword">struct </span>cmd_stop_result {</div>
<div class="line">    cmdline_fixed_string_t stop;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_stop_parsed(<a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>ntb_fwd_lcore_conf *conf;</div>
<div class="line">    uint32_t lcore_id;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__lcore_8h.html#ac779e61584eb9d087c3e20bf2d1150c8">RTE_LCORE_FOREACH_WORKER</a>(lcore_id) {</div>
<div class="line">        conf = &amp;fwd_lcore_conf[lcore_id];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!conf-&gt;nb_stream)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (conf-&gt;stopped)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        conf-&gt;stopped = 1;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nWaiting for lcores to finish...\n&quot;</span>);</div>
<div class="line">    <a class="code" href="rte__launch_8h.html#a7760d6e89a309af9b80767be641bfa18">rte_eal_mp_wait_lcore</a>();</div>
<div class="line">    in_test = 0;</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nDone.\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">cmdline_parse_token_string_t cmd_stop_stop =</div>
<div class="line">        TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_stop_result, stop, <span class="stringliteral">&quot;stop&quot;</span>);</div>
<div class="line"> </div>
<div class="line">cmdline_parse_inst_t cmd_stop = {</div>
<div class="line">    .f = cmd_stop_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;stop: Stop packet forwarding&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_stop_stop,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">ntb_stats_clear(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> nb_ids, i;</div>
<div class="line">    uint32_t *ids;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Clear NTB dev stats */</span></div>
<div class="line">    nb_ids = <a name="a38"></a><a class="code" href="rte__rawdev_8h.html#ae293a5d25d141ee348012c140d48b450">rte_rawdev_xstats_names_get</a>(dev_id, NULL, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (nb_ids  &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error: Cannot get count of xstats\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    ids = malloc(<span class="keyword">sizeof</span>(uint32_t) * nb_ids);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_ids; i++)</div>
<div class="line">        ids[i] = i;</div>
<div class="line">    <a name="a39"></a><a class="code" href="rte__rawdev_8h.html#a30147de390b2761c57c33ea52b503983">rte_rawdev_xstats_reset</a>(dev_id, ids, nb_ids);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n  statistics for NTB port %d cleared\n&quot;</span>, dev_id);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Clear Ethdev stats if have any */</span></div>
<div class="line">    <span class="keywordflow">if</span> (fwd_mode == IOFWD &amp;&amp; eth_port_id != RTE_MAX_ETHPORTS) {</div>
<div class="line">        <a name="a40"></a><a class="code" href="rte__ethdev_8h.html#af3ff61eaf3b5bd61fe10923e406298ed">rte_eth_stats_reset</a>(eth_port_id);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n  statistics for ETH port %d cleared\n&quot;</span>, eth_port_id);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span></div>
<div class="line">ntb_calculate_throughput(uint16_t port) {</div>
<div class="line">    uint64_t diff_pkts_rx, diff_pkts_tx, diff_cycles;</div>
<div class="line">    uint64_t mpps_rx, mpps_tx;</div>
<div class="line">    <span class="keyword">static</span> uint64_t prev_pkts_rx[2];</div>
<div class="line">    <span class="keyword">static</span> uint64_t prev_pkts_tx[2];</div>
<div class="line">    <span class="keyword">static</span> uint64_t prev_cycles[2];</div>
<div class="line"> </div>
<div class="line">    diff_cycles = prev_cycles[port];</div>
<div class="line">    prev_cycles[port] = rte_rdtsc();</div>
<div class="line">    <span class="keywordflow">if</span> (diff_cycles &gt; 0)</div>
<div class="line">        diff_cycles = prev_cycles[port] - diff_cycles;</div>
<div class="line">    diff_pkts_rx = (ntb_port_stats[port].rx &gt; prev_pkts_rx[port]) ?</div>
<div class="line">        (ntb_port_stats[port].rx - prev_pkts_rx[port]) : 0;</div>
<div class="line">    diff_pkts_tx = (ntb_port_stats[port].tx &gt; prev_pkts_tx[port]) ?</div>
<div class="line">        (ntb_port_stats[port].tx - prev_pkts_tx[port]) : 0;</div>
<div class="line">    prev_pkts_rx[port] = ntb_port_stats[port].rx;</div>
<div class="line">    prev_pkts_tx[port] = ntb_port_stats[port].tx;</div>
<div class="line">    mpps_rx = diff_cycles &gt; 0 ?</div>
<div class="line">        diff_pkts_rx * <a name="a41"></a><a class="code" href="rte__cycles_8h.html#ae016e608f344823e677819d8f04264c5">rte_get_tsc_hz</a>() / diff_cycles : 0;</div>
<div class="line">    mpps_tx = diff_cycles &gt; 0 ?</div>
<div class="line">        diff_pkts_tx * <a class="code" href="rte__cycles_8h.html#ae016e608f344823e677819d8f04264c5">rte_get_tsc_hz</a>() / diff_cycles : 0;</div>
<div class="line">    printf(<span class="stringliteral">&quot;  Throughput (since last show)\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;  Rx-pps: %12&quot;</span>PRIu64<span class="stringliteral">&quot;\n  Tx-pps: %12&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">            mpps_rx, mpps_tx);</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">ntb_stats_display(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a42"></a><a class="code" href="structrte__rawdev__xstats__name.html">rte_rawdev_xstats_name</a> *xstats_names;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a43"></a><a class="code" href="structrte__eth__stats.html">rte_eth_stats</a> stats;</div>
<div class="line">    uint64_t *values;</div>
<div class="line">    uint32_t *ids;</div>
<div class="line">    <span class="keywordtype">int</span> nb_ids, i;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;###### statistics for NTB port %d #######\n&quot;</span>, dev_id);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Get NTB dev stats and stats names */</span></div>
<div class="line">    nb_ids = <a class="code" href="rte__rawdev_8h.html#ae293a5d25d141ee348012c140d48b450">rte_rawdev_xstats_names_get</a>(dev_id, NULL, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (nb_ids  &lt; 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error: Cannot get count of xstats\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    xstats_names = malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structrte__rawdev__xstats__name.html">rte_rawdev_xstats_name</a>) * nb_ids);</div>
<div class="line">    <span class="keywordflow">if</span> (xstats_names == NULL) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Cannot allocate memory for xstats lookup\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (nb_ids != <a class="code" href="rte__rawdev_8h.html#ae293a5d25d141ee348012c140d48b450">rte_rawdev_xstats_names_get</a>(</div>
<div class="line">            dev_id, xstats_names, nb_ids)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error: Cannot get xstats lookup\n&quot;</span>);</div>
<div class="line">        free(xstats_names);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    ids = malloc(<span class="keyword">sizeof</span>(uint32_t) * nb_ids);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_ids; i++)</div>
<div class="line">        ids[i] = i;</div>
<div class="line">    values = malloc(<span class="keyword">sizeof</span>(uint64_t) * nb_ids);</div>
<div class="line">    <span class="keywordflow">if</span> (nb_ids != <a name="a44"></a><a class="code" href="rte__rawdev_8h.html#a23a6cb31d4c8ff7d7f46d9e24aa71230">rte_rawdev_xstats_get</a>(dev_id, ids, values, nb_ids)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Error: Unable to get xstats\n&quot;</span>);</div>
<div class="line">        free(xstats_names);</div>
<div class="line">        free(values);</div>
<div class="line">        free(ids);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Display NTB dev stats */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_ids; i++)</div>
<div class="line">        printf(<span class="stringliteral">&quot;  %s: %&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>, xstats_names[i].name, values[i]);</div>
<div class="line">    ntb_calculate_throughput(0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Get Ethdev stats if have any */</span></div>
<div class="line">    <span class="keywordflow">if</span> (fwd_mode == IOFWD &amp;&amp; eth_port_id != RTE_MAX_ETHPORTS) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;###### statistics for ETH port %d ######\n&quot;</span>,</div>
<div class="line">            eth_port_id);</div>
<div class="line">        <a name="a45"></a><a class="code" href="rte__ethdev_8h.html#adec226574c53ae413252c9b15f6f4bab">rte_eth_stats_get</a>(eth_port_id, &amp;stats);</div>
<div class="line">        printf(<span class="stringliteral">&quot;  RX-packets: %&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>, stats.ipackets);</div>
<div class="line">        printf(<span class="stringliteral">&quot;  RX-bytes: %&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>, stats.ibytes);</div>
<div class="line">        printf(<span class="stringliteral">&quot;  RX-errors: %&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>, stats.ierrors);</div>
<div class="line">        printf(<span class="stringliteral">&quot;  RX-missed: %&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>, stats.imissed);</div>
<div class="line">        printf(<span class="stringliteral">&quot;  TX-packets: %&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>, stats.opackets);</div>
<div class="line">        printf(<span class="stringliteral">&quot;  TX-bytes: %&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>, stats.obytes);</div>
<div class="line">        printf(<span class="stringliteral">&quot;  TX-errors: %&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>, stats.oerrors);</div>
<div class="line">        ntb_calculate_throughput(1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    free(xstats_names);</div>
<div class="line">    free(values);</div>
<div class="line">    free(ids);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* *** SHOW/CLEAR PORT STATS *** */</span></div>
<div class="line"><span class="keyword">struct </span>cmd_stats_result {</div>
<div class="line">    cmdline_fixed_string_t show;</div>
<div class="line">    cmdline_fixed_string_t port;</div>
<div class="line">    cmdline_fixed_string_t stats;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_stats_parsed(<span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">         <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">         <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_stats_result *res = parsed_result;</div>
<div class="line">    <span class="keywordflow">if</span> (!strcmp(res-&gt;show, <span class="stringliteral">&quot;clear&quot;</span>))</div>
<div class="line">        ntb_stats_clear();</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        ntb_stats_display();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">cmdline_parse_token_string_t cmd_stats_show =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_stats_result, show, <span class="stringliteral">&quot;show#clear&quot;</span>);</div>
<div class="line">cmdline_parse_token_string_t cmd_stats_port =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_stats_result, port, <span class="stringliteral">&quot;port&quot;</span>);</div>
<div class="line">cmdline_parse_token_string_t cmd_stats_stats =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_stats_result, stats, <span class="stringliteral">&quot;stats&quot;</span>);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">cmdline_parse_inst_t cmd_stats = {</div>
<div class="line">    .f = cmd_stats_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;show|clear port stats&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_stats_show,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_stats_port,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_stats_stats,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* *** SET FORWARDING MODE *** */</span></div>
<div class="line"><span class="keyword">struct </span>cmd_set_fwd_mode_result {</div>
<div class="line">    cmdline_fixed_string_t set;</div>
<div class="line">    cmdline_fixed_string_t fwd;</div>
<div class="line">    cmdline_fixed_string_t mode;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_set_fwd_mode_parsed(<a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_set_fwd_mode_result *res = parsed_result;</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (in_test) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Please stop traffic first.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_FWD_MODE; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (!strcmp(res-&gt;mode, fwd_mode_s[i])) {</div>
<div class="line">            fwd_mode = i;</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Invalid %s packet forwarding mode.\n&quot;</span>, res-&gt;mode);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">cmdline_parse_token_string_t cmd_setfwd_set =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_set_fwd_mode_result, set, <span class="stringliteral">&quot;set&quot;</span>);</div>
<div class="line">cmdline_parse_token_string_t cmd_setfwd_fwd =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_set_fwd_mode_result, fwd, <span class="stringliteral">&quot;fwd&quot;</span>);</div>
<div class="line">cmdline_parse_token_string_t cmd_setfwd_mode =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_set_fwd_mode_result, mode,</div>
<div class="line">                <span class="stringliteral">&quot;file-trans#iofwd#txonly#rxonly&quot;</span>);</div>
<div class="line"> </div>
<div class="line">cmdline_parse_inst_t cmd_set_fwd_mode = {</div>
<div class="line">    .f = cmd_set_fwd_mode_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;set forwarding mode as file-trans|rxonly|txonly|iofwd&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_setfwd_set,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_setfwd_fwd,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_setfwd_mode,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* list of instructions */</span></div>
<div class="line">cmdline_parse_ctx_t main_ctx[] = {</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_help,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_send_file,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_start,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_stop,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_stats,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_set_fwd_mode,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_quit,</div>
<div class="line">    NULL,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* prompt function, called from main on MAIN lcore */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">prompt(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmdline *cl;</div>
<div class="line"> </div>
<div class="line">    cl = cmdline_stdin_new(main_ctx, <span class="stringliteral">&quot;ntb&gt; &quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (cl == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    cmdline_interact(cl);</div>
<div class="line">    cmdline_stdin_exit(cl);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">signal_handler(<span class="keywordtype">int</span> signum)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (signum == SIGINT || signum == SIGTERM) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;\nSignal %d received, preparing to exit...\n&quot;</span>, signum);</div>
<div class="line">        signal(signum, SIG_DFL);</div>
<div class="line">        kill(getpid(), signum);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define OPT_BUF_SIZE         &quot;buf-size&quot;</span></div>
<div class="line"><span class="preprocessor">#define OPT_FWD_MODE         &quot;fwd-mode&quot;</span></div>
<div class="line"><span class="preprocessor">#define OPT_NB_DESC          &quot;nb-desc&quot;</span></div>
<div class="line"><span class="preprocessor">#define OPT_TXFREET          &quot;txfreet&quot;</span></div>
<div class="line"><span class="preprocessor">#define OPT_BURST            &quot;burst&quot;</span></div>
<div class="line"><span class="preprocessor">#define OPT_QP               &quot;qp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> {</div>
<div class="line">    <span class="comment">/* long options mapped to a short option */</span></div>
<div class="line">    OPT_NO_ZERO_COPY_NUM = 1,</div>
<div class="line">    OPT_BUF_SIZE_NUM,</div>
<div class="line">    OPT_FWD_MODE_NUM,</div>
<div class="line">    OPT_NB_DESC_NUM,</div>
<div class="line">    OPT_TXFREET_NUM,</div>
<div class="line">    OPT_BURST_NUM,</div>
<div class="line">    OPT_QP_NUM,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> short_options[] =</div>
<div class="line">    <span class="stringliteral">&quot;i&quot;</span> <span class="comment">/* interactive mode */</span></div>
<div class="line">    ;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>option lgopts[] = {</div>
<div class="line">    {OPT_BUF_SIZE,     1, NULL, OPT_BUF_SIZE_NUM     },</div>
<div class="line">    {OPT_FWD_MODE,     1, NULL, OPT_FWD_MODE_NUM     },</div>
<div class="line">    {OPT_NB_DESC,      1, NULL, OPT_NB_DESC_NUM      },</div>
<div class="line">    {OPT_TXFREET,      1, NULL, OPT_TXFREET_NUM      },</div>
<div class="line">    {OPT_BURST,        1, NULL, OPT_BURST_NUM        },</div>
<div class="line">    {OPT_QP,           1, NULL, OPT_QP_NUM           },</div>
<div class="line">    {0,                0, NULL, 0                    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">ntb_usage(<span class="keyword">const</span> <span class="keywordtype">char</span> *prgname)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s [EAL options] -- [options]\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;-i: run in interactive mode.\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;-qp=N: set number of queues as N (N &gt; 0, default: 1).\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;--fwd-mode=N: set fwd mode (N: file-trans | rxonly | &quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;txonly | iofwd, default: file-trans)\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;--buf-size=N: set mbuf dataroom size as N (0 &lt; N &lt; 65535,&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; default: 2048).\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;--nb-desc=N: set number of descriptors as N (%u &lt;= N &lt;= %u,&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; default: 1024).\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;--txfreet=N: set tx free thresh for NTB driver as N. (N &gt;= 0)\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;--burst=N: set pkt burst as N (0 &lt; N &lt;= %u default: 32).\n&quot;</span>,</div>
<div class="line">           prgname, NTB_MIN_DESC_SIZE, NTB_MAX_DESC_SIZE,</div>
<div class="line">           NTB_MAX_PKT_BURST);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">ntb_parse_args(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *prgname = argv[0], **argvopt = argv;</div>
<div class="line">    <span class="keywordtype">int</span> opt, opt_idx, n, i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> ((opt = getopt_long(argc, argvopt, short_options,</div>
<div class="line">                lgopts, &amp;opt_idx)) != EOF) {</div>
<div class="line">        <span class="keywordflow">switch</span> (opt) {</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:</div>
<div class="line">            printf(<span class="stringliteral">&quot;Interactive-mode selected.\n&quot;</span>);</div>
<div class="line">            interactive = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> OPT_QP_NUM:</div>
<div class="line">            n = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (n &gt; 0)</div>
<div class="line">                num_queues = n;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <a name="a46"></a><a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;q must be &gt; 0.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> OPT_BUF_SIZE_NUM:</div>
<div class="line">            n = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (n &gt; RTE_PKTMBUF_HEADROOM &amp;&amp; n &lt;= 0xFFFF)</div>
<div class="line">                ntb_buf_size = n;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;buf-size must be &gt; &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;%u and &lt; 65536.\n&quot;</span>,</div>
<div class="line">                    RTE_PKTMBUF_HEADROOM);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> OPT_FWD_MODE_NUM:</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; MAX_FWD_MODE; i++) {</div>
<div class="line">                <span class="keywordflow">if</span> (!strcmp(optarg, fwd_mode_s[i])) {</div>
<div class="line">                    fwd_mode = i;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (i == MAX_FWD_MODE)</div>
<div class="line">                <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Unsupported mode. &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;(Should be: file-trans | rxonly | txonly &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;| iofwd)\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> OPT_NB_DESC_NUM:</div>
<div class="line">            n = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (n &gt;= NTB_MIN_DESC_SIZE &amp;&amp; n &lt;= NTB_MAX_DESC_SIZE)</div>
<div class="line">                nb_desc = n;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;nb-desc must be within&quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot; [%u, %u].\n&quot;</span>, NTB_MIN_DESC_SIZE,</div>
<div class="line">                    NTB_MAX_DESC_SIZE);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> OPT_TXFREET_NUM:</div>
<div class="line">            n = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (n &gt;= 0)</div>
<div class="line">                tx_free_thresh = n;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;txfreet must be&quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot; &gt;= 0\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> OPT_BURST_NUM:</div>
<div class="line">            n = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (n &gt; 0 &amp;&amp; n &lt;= NTB_MAX_PKT_BURST)</div>
<div class="line">                pkt_burst = n;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;burst must be within &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;(0, %u].\n&quot;</span>, NTB_MAX_PKT_BURST);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            ntb_usage(prgname);</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                 <span class="stringliteral">&quot;Command line is incomplete or incorrect.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">ntb_mempool_mz_free(<a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> <a name="_a47"></a><a class="code" href="structrte__mempool__memhdr.html">rte_mempool_memhdr</a> *memhdr,</div>
<div class="line">        <span class="keywordtype">void</span> *opaque)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">struct </span><a name="_a48"></a><a class="code" href="structrte__memzone.html">rte_memzone</a> *mz = opaque;</div>
<div class="line">    <a name="a49"></a><a class="code" href="rte__memzone_8h.html#aaa4ec5a6d04c8cd4a55beae18f52aa31">rte_memzone_free</a>(mz);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structrte__mempool.html">rte_mempool</a> *</div>
<div class="line">ntb_mbuf_pool_create(uint16_t mbuf_seg_size, uint32_t nb_mbuf,</div>
<div class="line">             <span class="keyword">struct</span> ntb_dev_info ntb_info,</div>
<div class="line">             <span class="keyword">struct</span> ntb_dev_config *ntb_conf,</div>
<div class="line">             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a name="a50"></a><a class="code" href="structrte__mempool.html#a229cb0bd24215f0cb940e0724dbd4d55">socket_id</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">size_t</span> mz_len, total_elt_sz, max_mz_len, left_sz;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a51"></a><a class="code" href="structrte__pktmbuf__pool__private.html">rte_pktmbuf_pool_private</a> mbp_priv;</div>
<div class="line">    <span class="keywordtype">char</span> pool_name[RTE_MEMPOOL_NAMESIZE];</div>
<div class="line">    <span class="keywordtype">char</span> mz_name[<a name="a52"></a><a class="code" href="rte__memzone_8h.html#a5621a1253a3875b601cdc533b3180240">RTE_MEMZONE_NAMESIZE</a>];</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structrte__memzone.html">rte_memzone</a> *mz;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mempool.html">rte_mempool</a> *mp;</div>
<div class="line">    uint64_t align;</div>
<div class="line">    uint32_t mz_id;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    snprintf(pool_name, <span class="keyword">sizeof</span>(pool_name), <span class="stringliteral">&quot;ntb_mbuf_pool_%u&quot;</span>, <a class="code" href="structrte__mempool.html#a229cb0bd24215f0cb940e0724dbd4d55">socket_id</a>);</div>
<div class="line">    mp = <a name="a53"></a><a class="code" href="rte__mempool_8h.html#a542ec0f29072e7f1cfdb5c150f57b236">rte_mempool_create_empty</a>(pool_name, nb_mbuf,</div>
<div class="line">                      (mbuf_seg_size + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a>)),</div>
<div class="line">                      MEMPOOL_CACHE_SIZE,</div>
<div class="line">                      <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structrte__pktmbuf__pool__private.html">rte_pktmbuf_pool_private</a>),</div>
<div class="line">                      <a class="code" href="structrte__mempool.html#a229cb0bd24215f0cb940e0724dbd4d55">socket_id</a>, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (mp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a54"></a><a class="code" href="rte__mempool_8h.html#a04d43951645ad4c11a3d88e3d7664aa9">rte_mempool_set_ops_byname</a>(mp, <a name="a55"></a><a class="code" href="rte__mbuf__pool__ops_8h.html#a5421b2f89006563120feb8cece9de079">rte_mbuf_best_mempool_ops</a>(), NULL)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;error setting mempool handler\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> fail;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset(&amp;mbp_priv, 0, <span class="keyword">sizeof</span>(mbp_priv));</div>
<div class="line">    mbp_priv.mbuf_data_room_size = mbuf_seg_size;</div>
<div class="line">    mbp_priv.mbuf_priv_size = 0;</div>
<div class="line">    <a name="a56"></a><a class="code" href="rte__mbuf_8h.html#af714a7341cb37bc2530ac07c84c829b6">rte_pktmbuf_pool_init</a>(mp, &amp;mbp_priv);</div>
<div class="line"> </div>
<div class="line">    ntb_conf-&gt;mz_list = <a class="code" href="rte__malloc_8h.html#aaf0f048a5fd1672688c662cdfb4536b3">rte_zmalloc</a>(<span class="stringliteral">&quot;ntb_memzone_list&quot;</span>,</div>
<div class="line">                <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structrte__memzone.html">rte_memzone</a> *) *</div>
<div class="line">                ntb_info.mw_cnt, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (ntb_conf-&gt;mz_list == NULL)</div>
<div class="line">        <span class="keywordflow">goto</span> fail;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Put ntb header on mw0. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (ntb_info.mw_size[0] &lt; ntb_info.ntb_hdr_size) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;mw0 (size: %&quot;</span> PRIu64 <span class="stringliteral">&quot;) is not enough for ntb hdr&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot; (size: %u)\n&quot;</span>, ntb_info.mw_size[0],</div>
<div class="line">               ntb_info.ntb_hdr_size);</div>
<div class="line">        <span class="keywordflow">goto</span> fail;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    total_elt_sz = mp-&gt;<a name="a57"></a><a class="code" href="structrte__mempool.html#a841923a20e6dda97c59351c8e97c9be6">header_size</a> + mp-&gt;<a name="a58"></a><a class="code" href="structrte__mempool.html#ad61e210d2df01bf9c91230fee6a8cf21">elt_size</a> + mp-&gt;<a name="a59"></a><a class="code" href="structrte__mempool.html#aa328aea47b0ee3552e4628a4ed5dadac">trailer_size</a>;</div>
<div class="line">    left_sz = total_elt_sz * nb_mbuf;</div>
<div class="line">    <span class="keywordflow">for</span> (mz_id = 0; mz_id &lt; ntb_info.mw_cnt; mz_id++) {</div>
<div class="line">        <span class="comment">/* If populated mbuf is enough, no need to reserve extra mz. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!left_sz)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        snprintf(mz_name, <span class="keyword">sizeof</span>(mz_name), <span class="stringliteral">&quot;ntb_mw_%d&quot;</span>, mz_id);</div>
<div class="line">        align = ntb_info.mw_size_align ? ntb_info.mw_size[mz_id] :</div>
<div class="line">            RTE_CACHE_LINE_SIZE;</div>
<div class="line">        <span class="comment">/* Reserve ntb header space on memzone 0. */</span></div>
<div class="line">        max_mz_len = mz_id ? ntb_info.mw_size[mz_id] :</div>
<div class="line">                 ntb_info.mw_size[mz_id] - ntb_info.ntb_hdr_size;</div>
<div class="line">        mz_len = left_sz &lt;= max_mz_len ? left_sz :</div>
<div class="line">            (max_mz_len / total_elt_sz * total_elt_sz);</div>
<div class="line">        <span class="keywordflow">if</span> (!mz_len)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        <a name="a60"></a><a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a> = <a name="a61"></a><a class="code" href="rte__memzone_8h.html#a56736f23c55bc5814d29ccda97e32063">rte_memzone_reserve_aligned</a>(mz_name, mz_len, <a class="code" href="structrte__mempool.html#a229cb0bd24215f0cb940e0724dbd4d55">socket_id</a>,</div>
<div class="line">                    <a name="a62"></a><a class="code" href="rte__memzone_8h.html#ae118c6a214428a40c3e94a99c5db11b9">RTE_MEMZONE_IOVA_CONTIG</a>, align);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a> == NULL) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Cannot allocate %&quot;</span> PRIu64 <span class="stringliteral">&quot; aligned memzone&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot; %u\n&quot;</span>, align, mz_id);</div>
<div class="line">            <span class="keywordflow">goto</span> fail;</div>
<div class="line">        }</div>
<div class="line">        left_sz -= mz_len;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Reserve ntb header space on memzone 0. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (mz_id)</div>
<div class="line">            ret = <a name="a63"></a><a class="code" href="rte__mempool_8h.html#ac3522d5f027567081122f31e4d4cfe3b">rte_mempool_populate_iova</a>(mp, <a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a>-&gt;<a name="a64"></a><a class="code" href="structrte__memzone.html#ae5bd6c22dbf0f6b5b0ae0233f8eb3704">addr</a>, <a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a>-&gt;<a name="a65"></a><a class="code" href="structrte__memzone.html#acd74b7a44f2e96bb54cd6a1585e8790f">iova</a>,</div>
<div class="line">                    <a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a>-&gt;<a name="a66"></a><a class="code" href="structrte__memzone.html#a7360b55975153b822efc5217b7734e6a">len</a>, ntb_mempool_mz_free,</div>
<div class="line">                    (<span class="keywordtype">void</span> *)(uintptr_t)<a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a>);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            ret = <a class="code" href="rte__mempool_8h.html#ac3522d5f027567081122f31e4d4cfe3b">rte_mempool_populate_iova</a>(mp,</div>
<div class="line">                    (<span class="keywordtype">void</span> *)((<span class="keywordtype">size_t</span>)<a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a>-&gt;<a class="code" href="structrte__memzone.html#ae5bd6c22dbf0f6b5b0ae0233f8eb3704">addr</a> +</div>
<div class="line">                    ntb_info.ntb_hdr_size),</div>
<div class="line">                    <a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a>-&gt;<a class="code" href="structrte__memzone.html#acd74b7a44f2e96bb54cd6a1585e8790f">iova</a> + ntb_info.ntb_hdr_size,</div>
<div class="line">                    <a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a>-&gt;<a class="code" href="structrte__memzone.html#a7360b55975153b822efc5217b7734e6a">len</a> - ntb_info.ntb_hdr_size,</div>
<div class="line">                    ntb_mempool_mz_free,</div>
<div class="line">                    (<span class="keywordtype">void</span> *)(uintptr_t)<a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt;= 0) {</div>
<div class="line">            <a class="code" href="rte__memzone_8h.html#aaa4ec5a6d04c8cd4a55beae18f52aa31">rte_memzone_free</a>(<a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a>);</div>
<div class="line">            <a name="a67"></a><a class="code" href="rte__mempool_8h.html#a35271bce2d546e116074803fd69376e9">rte_mempool_free</a>(mp);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ntb_conf-&gt;mz_list[mz_id] = <a class="code" href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">mz</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (left_sz) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;mw space is not enough for mempool.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> fail;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ntb_conf-&gt;mz_num = mz_id;</div>
<div class="line">    <a name="a68"></a><a class="code" href="rte__mempool_8h.html#abd4bec335c01bac3d695beffb5a28690">rte_mempool_obj_iter</a>(mp, <a name="a69"></a><a class="code" href="rte__mbuf_8h.html#a7c0d0b427cb071856f2ff0805d608e35">rte_pktmbuf_init</a>, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> mp;</div>
<div class="line">fail:</div>
<div class="line">    <a class="code" href="rte__mempool_8h.html#a35271bce2d546e116074803fd69376e9">rte_mempool_free</a>(mp);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> eth_pconf = eth_port_conf;</div>
<div class="line">    <span class="keyword">struct </span>rte_rawdev_info ntb_rawdev_conf;</div>
<div class="line">    <span class="keyword">struct </span>rte_rawdev_info ntb_rawdev_info;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a70"></a><a class="code" href="structrte__eth__dev__info.html">rte_eth_dev_info</a> ethdev_info;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a71"></a><a class="code" href="structrte__eth__rxconf.html">rte_eth_rxconf</a> eth_rx_conf;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a72"></a><a class="code" href="structrte__eth__txconf.html">rte_eth_txconf</a> eth_tx_conf;</div>
<div class="line">    <span class="keyword">struct </span>ntb_queue_conf ntb_q_conf;</div>
<div class="line">    <span class="keyword">struct </span>ntb_dev_config ntb_conf;</div>
<div class="line">    <span class="keyword">struct </span>ntb_dev_info ntb_info;</div>
<div class="line">    uint64_t ntb_link_status;</div>
<div class="line">    uint32_t nb_mbuf;</div>
<div class="line">    <span class="keywordtype">int</span> ret, i;</div>
<div class="line"> </div>
<div class="line">    signal(SIGINT, signal_handler);</div>
<div class="line">    signal(SIGTERM, signal_handler);</div>
<div class="line"> </div>
<div class="line">    ret = <a name="a73"></a><a class="code" href="rte__eal_8h.html#a5c3f4dddc25e38c5a186ecd8a69260e3">rte_eal_init</a>(argc, argv);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Error with EAL initialization.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="rte__lcore_8h.html#a1728dc7f14571ba778d3b5b41aa09283">rte_lcore_count</a>() &lt; 2)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Need at least 2 cores\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Find 1st ntb rawdev. */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_RAWDEV_MAX_DEVS; i++)</div>
<div class="line">        <span class="keywordflow">if</span> (rte_rawdevs[i].driver_name &amp;&amp;</div>
<div class="line">            (strncmp(rte_rawdevs[i].driver_name, <span class="stringliteral">&quot;raw_ntb&quot;</span>,</div>
<div class="line">            NTB_DRV_NAME_LEN) == 0) &amp;&amp; (rte_rawdevs[i].attached == 1))</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (i == RTE_RAWDEV_MAX_DEVS)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot find any ntb device.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    dev_id = i;</div>
<div class="line"> </div>
<div class="line">    argc -= ret;</div>
<div class="line">    argv += ret;</div>
<div class="line"> </div>
<div class="line">    ntb_parse_args(argc, argv);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__rawdev_8h.html#a89055cb62b725345bfd536e608ab939f">rte_rawdev_set_attr</a>(dev_id, NTB_QUEUE_SZ_NAME, nb_desc);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Set queue size as %u.\n&quot;</span>, nb_desc);</div>
<div class="line">    <a class="code" href="rte__rawdev_8h.html#a89055cb62b725345bfd536e608ab939f">rte_rawdev_set_attr</a>(dev_id, NTB_QUEUE_NUM_NAME, num_queues);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Set queue number as %u.\n&quot;</span>, num_queues);</div>
<div class="line">    ntb_rawdev_info.dev_private = (rte_rawdev_obj_t)(&amp;ntb_info);</div>
<div class="line">    <a name="a74"></a><a class="code" href="rte__rawdev_8h.html#aef72677f798a8370a64a8aa8c46beba7">rte_rawdev_info_get</a>(dev_id, &amp;ntb_rawdev_info, <span class="keyword">sizeof</span>(ntb_info));</div>
<div class="line"> </div>
<div class="line">    nb_mbuf = nb_desc * num_queues * 2 * 2 + <a class="code" href="rte__lcore_8h.html#a1728dc7f14571ba778d3b5b41aa09283">rte_lcore_count</a>() *</div>
<div class="line">          MEMPOOL_CACHE_SIZE;</div>
<div class="line">    mbuf_pool = ntb_mbuf_pool_create(ntb_buf_size, nb_mbuf, ntb_info,</div>
<div class="line">                     &amp;ntb_conf, <a name="a75"></a><a class="code" href="rte__lcore_8h.html#a7c8da4664df26a64cf05dc508a4f26df">rte_socket_id</a>());</div>
<div class="line">    <span class="keywordflow">if</span> (mbuf_pool == NULL)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot create mbuf pool.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    ntb_conf.num_queues = num_queues;</div>
<div class="line">    ntb_conf.queue_size = nb_desc;</div>
<div class="line">    ntb_rawdev_conf.dev_private = (rte_rawdev_obj_t)(&amp;ntb_conf);</div>
<div class="line">    ret = <a name="a76"></a><a class="code" href="rte__rawdev_8h.html#abf894153e16c9403e11c487bcc41b248">rte_rawdev_configure</a>(dev_id, &amp;ntb_rawdev_conf, <span class="keyword">sizeof</span>(ntb_conf));</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Can&#39;t config ntb dev: err=%d, &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;port=%u\n&quot;</span>, ret, dev_id);</div>
<div class="line"> </div>
<div class="line">    ntb_q_conf.tx_free_thresh = tx_free_thresh;</div>
<div class="line">    ntb_q_conf.nb_desc = nb_desc;</div>
<div class="line">    ntb_q_conf.rx_mp = mbuf_pool;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; num_queues; i++) {</div>
<div class="line">        <span class="comment">/* Setup rawdev queue */</span></div>
<div class="line">        ret = <a name="a77"></a><a class="code" href="rte__rawdev_8h.html#ae9bda325a2bd66d8ebc5db3ede93acfa">rte_rawdev_queue_setup</a>(dev_id, i, &amp;ntb_q_conf,</div>
<div class="line">                <span class="keyword">sizeof</span>(ntb_q_conf));</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                <span class="stringliteral">&quot;Failed to setup ntb queue %u.\n&quot;</span>, i);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Waiting for peer dev up at most 100s.*/</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Checking ntb link status...\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 1000; i++) {</div>
<div class="line">        <a class="code" href="rte__rawdev_8h.html#a59bb29d3791a9866fab73ab97f44b568">rte_rawdev_get_attr</a>(dev_id, NTB_LINK_STATUS_NAME,</div>
<div class="line">                    &amp;ntb_link_status);</div>
<div class="line">        <span class="keywordflow">if</span> (ntb_link_status) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Peer dev ready, ntb link up.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <a name="a78"></a><a class="code" href="rte__cycles_8h.html#af73b844d50b98de74b1a0e1730262f85">rte_delay_ms</a>(100);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="rte__rawdev_8h.html#a59bb29d3791a9866fab73ab97f44b568">rte_rawdev_get_attr</a>(dev_id, NTB_LINK_STATUS_NAME, &amp;ntb_link_status);</div>
<div class="line">    <span class="keywordflow">if</span> (ntb_link_status == 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Expire 100s. Link is not up. Please restart app.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    ret = <a name="a79"></a><a class="code" href="rte__rawdev_8h.html#af2e470ce565295047c323fd2d8c449ad">rte_rawdev_start</a>(dev_id);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;rte_rawdev_start: err=%d, port=%u\n&quot;</span>,</div>
<div class="line">            ret, dev_id);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Find 1st ethdev */</span></div>
<div class="line">    eth_port_id = <a name="a80"></a><a class="code" href="rte__ethdev_8h.html#a572cbdd554578f35c4480f1397e7dea0">rte_eth_find_next</a>(0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (eth_port_id &lt; RTE_MAX_ETHPORTS) {</div>
<div class="line">        <a name="a81"></a><a class="code" href="rte__ethdev_8h.html#a7593f4fff04f4ae1b1d718db7ca7dc8c">rte_eth_dev_info_get</a>(eth_port_id, &amp;ethdev_info);</div>
<div class="line">        eth_pconf.<a name="a82"></a><a class="code" href="structrte__eth__conf.html#a084e132696e8d0f59f643d822c8cedb7">rx_adv_conf</a>.<a name="a83"></a><a class="code" href="structrte__eth__conf.html#addc9c7bb19ed12f1171c543493553806">rss_conf</a>.<a name="a84"></a><a class="code" href="structrte__eth__rss__conf.html#ad70f17882a835e5d4e38c64a9f872fdc">rss_hf</a> &amp;=</div>
<div class="line">                ethdev_info.flow_type_rss_offloads;</div>
<div class="line">        ret = <a name="a85"></a><a class="code" href="rte__ethdev_8h.html#a1a7d3a20b102fee222541fda50fd87bd">rte_eth_dev_configure</a>(eth_port_id, num_queues,</div>
<div class="line">                        num_queues, &amp;eth_pconf);</div>
<div class="line">        <span class="keywordflow">if</span> (ret)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Can&#39;t config ethdev: err=%d, &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;port=%u\n&quot;</span>, ret, eth_port_id);</div>
<div class="line">        eth_rx_conf = ethdev_info.default_rxconf;</div>
<div class="line">        eth_rx_conf.offloads = eth_pconf.<a class="code" href="structrte__eth__conf.html#a346eef99c24f617b74c440c1aa565d01">rxmode</a>.<a name="a86"></a><a class="code" href="structrte__eth__rxmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">offloads</a>;</div>
<div class="line">        eth_tx_conf = ethdev_info.default_txconf;</div>
<div class="line">        eth_tx_conf.offloads = eth_pconf.<a name="a87"></a><a class="code" href="structrte__eth__conf.html#a1c33c9d2e5cdb14b62ed386bf3159e07">txmode</a>.<a name="a88"></a><a class="code" href="structrte__eth__txmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">offloads</a>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Setup ethdev queue if ethdev exists */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; num_queues; i++) {</div>
<div class="line">            ret = <a name="a89"></a><a class="code" href="rte__ethdev_8h.html#a36ba70a5a6fce2c2c1f774828ba78f8d">rte_eth_rx_queue_setup</a>(eth_port_id, i, nb_desc,</div>
<div class="line">                    <a name="a90"></a><a class="code" href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a>(eth_port_id),</div>
<div class="line">                    &amp;eth_rx_conf, mbuf_pool);</div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">                <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                    <span class="stringliteral">&quot;Failed to setup eth rxq %u.\n&quot;</span>, i);</div>
<div class="line">            ret = <a name="a91"></a><a class="code" href="rte__ethdev_8h.html#a796c2f20778984c6f41b271e36bae50e">rte_eth_tx_queue_setup</a>(eth_port_id, i, nb_desc,</div>
<div class="line">                    <a class="code" href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a>(eth_port_id),</div>
<div class="line">                    &amp;eth_tx_conf);</div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">                <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                    <span class="stringliteral">&quot;Failed to setup eth txq %u.\n&quot;</span>, i);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a92"></a><a class="code" href="rte__ethdev_8h.html#afdc834c1c52e9fb512301990468ca7c2">rte_eth_dev_start</a>(eth_port_id);</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;rte_eth_dev_start: err=%d, &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;port=%u\n&quot;</span>, ret, eth_port_id);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* initialize port stats */</span></div>
<div class="line">    memset(&amp;ntb_port_stats, 0, <span class="keyword">sizeof</span>(ntb_port_stats));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set default fwd mode if user doesn&#39;t set it. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (fwd_mode == MAX_FWD_MODE &amp;&amp; eth_port_id &lt; RTE_MAX_ETHPORTS) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Set default fwd mode as iofwd.\n&quot;</span>);</div>
<div class="line">        fwd_mode = IOFWD;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (fwd_mode == MAX_FWD_MODE) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Set default fwd mode as file-trans.\n&quot;</span>);</div>
<div class="line">        fwd_mode = FILE_TRANS;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (interactive) {</div>
<div class="line">        sleep(1);</div>
<div class="line">        prompt();</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        start_pkt_fwd();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="arte__mbuf_8h_html_a008287388f5c32ebc812eaa166017a50"><div class="ttname"><a href="rte__mbuf_8h.html#a008287388f5c32ebc812eaa166017a50">rte_mbuf_raw_alloc</a></div><div class="ttdeci">static struct rte_mbuf * rte_mbuf_raw_alloc(struct rte_mempool *mp)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf_8h_source.html#l00586">rte_mbuf.h:586</a></div></div>
<div class="ttc" id="astructrte__pktmbuf__pool__private_html"><div class="ttname"><a href="structrte__pktmbuf__pool__private.html">rte_pktmbuf_pool_private</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf_8h_source.html#l00288">rte_mbuf.h:288</a></div></div>
<div class="ttc" id="arte__launch_8h_html_a7760d6e89a309af9b80767be641bfa18"><div class="ttname"><a href="rte__launch_8h.html#a7760d6e89a309af9b80767be641bfa18">rte_eal_mp_wait_lcore</a></div><div class="ttdeci">void rte_eal_mp_wait_lcore(void)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a5f51139368b8d1a2c22fdecd90bc4d98"><div class="ttname"><a href="rte__ethdev_8h.html#a5f51139368b8d1a2c22fdecd90bc4d98">rte_eth_link_to_str</a></div><div class="ttdeci">__rte_experimental int rte_eth_link_to_str(char *str, size_t len, const struct rte_eth_link *eth_link)</div></div>
<div class="ttc" id="arte__mempool_8h_html_a35271bce2d546e116074803fd69376e9"><div class="ttname"><a href="rte__mempool_8h.html#a35271bce2d546e116074803fd69376e9">rte_mempool_free</a></div><div class="ttdeci">void rte_mempool_free(struct rte_mempool *mp)</div></div>
<div class="ttc" id="arte__rawdev_8h_html_aef72677f798a8370a64a8aa8c46beba7"><div class="ttname"><a href="rte__rawdev_8h.html#aef72677f798a8370a64a8aa8c46beba7">rte_rawdev_info_get</a></div><div class="ttdeci">int rte_rawdev_info_get(uint16_t dev_id, struct rte_rawdev_info *dev_info, size_t dev_private_size)</div></div>
<div class="ttc" id="arte__malloc_8h_html_aaf0f048a5fd1672688c662cdfb4536b3"><div class="ttname"><a href="rte__malloc_8h.html#aaf0f048a5fd1672688c662cdfb4536b3">rte_zmalloc</a></div><div class="ttdeci">void * rte_zmalloc(const char *type, size_t size, unsigned align) __rte_alloc_size(2)</div></div>
<div class="ttc" id="arte__malloc_8h_html"><div class="ttname"><a href="rte__malloc_8h.html">rte_malloc.h</a></div></div>
<div class="ttc" id="astructrte__eth__rxconf_html"><div class="ttname"><a href="structrte__eth__rxconf.html">rte_eth_rxconf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01032">rte_ethdev.h:1032</a></div></div>
<div class="ttc" id="astructrte__mempool_html_aa328aea47b0ee3552e4628a4ed5dadac"><div class="ttname"><a href="structrte__mempool.html#aa328aea47b0ee3552e4628a4ed5dadac">rte_mempool::trailer_size</a></div><div class="ttdeci">uint32_t trailer_size</div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l00229">rte_mempool.h:229</a></div></div>
<div class="ttc" id="arte__mempool_8h_html_ac3522d5f027567081122f31e4d4cfe3b"><div class="ttname"><a href="rte__mempool_8h.html#ac3522d5f027567081122f31e4d4cfe3b">rte_mempool_populate_iova</a></div><div class="ttdeci">int rte_mempool_populate_iova(struct rte_mempool *mp, char *vaddr, rte_iova_t iova, size_t len, rte_mempool_memchunk_free_cb_t *free_cb, void *opaque)</div></div>
<div class="ttc" id="arte__branch__prediction_8h_html_ac6c45889010c1bd68631771b64f18101"><div class="ttname"><a href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a></div><div class="ttdeci">#define unlikely(x)</div><div class="ttdef"><b>Definition:</b> <a href="rte__branch__prediction_8h_source.html#l00038">rte_branch_prediction.h:38</a></div></div>
<div class="ttc" id="astructrte__memzone_html_a7360b55975153b822efc5217b7734e6a"><div class="ttname"><a href="structrte__memzone.html#a7360b55975153b822efc5217b7734e6a">rte_memzone::len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition:</b> <a href="rte__memzone_8h_source.html#l00060">rte_memzone.h:60</a></div></div>
<div class="ttc" id="arte__lcore_8h_html"><div class="ttname"><a href="rte__lcore_8h.html">rte_lcore.h</a></div></div>
<div class="ttc" id="arte__lcore_8h_html_a7c8da4664df26a64cf05dc508a4f26df"><div class="ttname"><a href="rte__lcore_8h.html#a7c8da4664df26a64cf05dc508a4f26df">rte_socket_id</a></div><div class="ttdeci">unsigned int rte_socket_id(void)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a4834f572f4dd4e46d81ad09b7d5fffd5aada568551470d5f419cd2f3d6b6bfedc"><div class="ttname"><a href="rte__ethdev_8h.html#a4834f572f4dd4e46d81ad09b7d5fffd5aada568551470d5f419cd2f3d6b6bfedc">ETH_MQ_TX_NONE</a></div><div class="ttdeci">@ ETH_MQ_TX_NONE</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00384">rte_ethdev.h:384</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_a850206928a35e126b04f206294369998"><div class="ttname"><a href="rte__rawdev_8h.html#a850206928a35e126b04f206294369998">rte_rawdev_dequeue_buffers</a></div><div class="ttdeci">int rte_rawdev_dequeue_buffers(uint16_t dev_id, struct rte_rawdev_buf **buffers, unsigned int count, rte_rawdev_obj_t context)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a796c2f20778984c6f41b271e36bae50e"><div class="ttname"><a href="rte__ethdev_8h.html#a796c2f20778984c6f41b271e36bae50e">rte_eth_tx_queue_setup</a></div><div class="ttdeci">int rte_eth_tx_queue_setup(uint16_t port_id, uint16_t tx_queue_id, uint16_t nb_tx_desc, unsigned int socket_id, const struct rte_eth_txconf *tx_conf)</div></div>
<div class="ttc" id="astructrte__eth__txconf_html"><div class="ttname"><a href="structrte__eth__txconf.html">rte_eth_txconf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01060">rte_ethdev.h:1060</a></div></div>
<div class="ttc" id="astructrte__mbuf_html_a9db3d388a1381e68e509017a6e7d0f12"><div class="ttname"><a href="structrte__mbuf.html#a9db3d388a1381e68e509017a6e7d0f12">rte_mbuf::buf_addr</a></div><div class="ttdeci">void * buf_addr</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00476">rte_mbuf_core.h:476</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a1a7d3a20b102fee222541fda50fd87bd"><div class="ttname"><a href="rte__ethdev_8h.html#a1a7d3a20b102fee222541fda50fd87bd">rte_eth_dev_configure</a></div><div class="ttdeci">int rte_eth_dev_configure(uint16_t port_id, uint16_t nb_rx_queue, uint16_t nb_tx_queue, const struct rte_eth_conf *eth_conf)</div></div>
<div class="ttc" id="arte__memzone_8h_html_a5621a1253a3875b601cdc533b3180240"><div class="ttname"><a href="rte__memzone_8h.html#a5621a1253a3875b601cdc533b3180240">RTE_MEMZONE_NAMESIZE</a></div><div class="ttdeci">#define RTE_MEMZONE_NAMESIZE</div><div class="ttdef"><b>Definition:</b> <a href="rte__memzone_8h_source.html#l00051">rte_memzone.h:51</a></div></div>
<div class="ttc" id="astructrte__eth__link_html"><div class="ttname"><a href="structrte__eth__link.html">rte_eth_link</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00313">rte_ethdev.h:313</a></div></div>
<div class="ttc" id="astructrte__eth__conf_html_a346eef99c24f617b74c440c1aa565d01"><div class="ttname"><a href="structrte__eth__conf.html#a346eef99c24f617b74c440c1aa565d01">rte_eth_conf::rxmode</a></div><div class="ttdeci">struct rte_eth_rxmode rxmode</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01294">rte_ethdev.h:1301</a></div></div>
<div class="ttc" id="arte__common_8h_html_a38e32f822bc941e90fdcbe5a9c69b178"><div class="ttname"><a href="rte__common_8h.html#a38e32f822bc941e90fdcbe5a9c69b178">__rte_cache_aligned</a></div><div class="ttdeci">#define __rte_cache_aligned</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00400">rte_common.h:400</a></div></div>
<div class="ttc" id="astructrte__mbuf_html_ad1a572736a10ff6b282c5f43c4ea1ccf"><div class="ttname"><a href="structrte__mbuf.html#ad1a572736a10ff6b282c5f43c4ea1ccf">rte_mbuf::data_len</a></div><div class="ttdeci">uint16_t data_len</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00546">rte_mbuf_core.h:546</a></div></div>
<div class="ttc" id="arte__cycles_8h_html_ab1c632a1dbe8e69c028fce82c055feb7"><div class="ttname"><a href="rte__cycles_8h.html#ab1c632a1dbe8e69c028fce82c055feb7">rte_delay_us</a></div><div class="ttdeci">void(* rte_delay_us)(unsigned int us)</div></div>
<div class="ttc" id="astructrte__eth__rxmode_html_aa0562513c4569f1aa53050f1beac6b5d"><div class="ttname"><a href="structrte__eth__rxmode.html#aa0562513c4569f1aa53050f1beac6b5d">rte_eth_rxmode::mq_mode</a></div><div class="ttdeci">enum rte_eth_rx_mq_mode mq_mode</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00336">rte_ethdev.h:402</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a3e7d76a451b46348686ea97d6367f102"><div class="ttname"><a href="rte__ethdev_8h.html#a3e7d76a451b46348686ea97d6367f102">rte_eth_rx_burst</a></div><div class="ttdeci">static uint16_t rte_eth_rx_burst(uint16_t port_id, uint16_t queue_id, struct rte_mbuf **rx_pkts, const uint16_t nb_pkts)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l04834">rte_ethdev.h:4834</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_a5395321daab8ff98447a296880cc4ae9"><div class="ttname"><a href="rte__rawdev_8h.html#a5395321daab8ff98447a296880cc4ae9">rte_rawdev_stop</a></div><div class="ttdeci">void rte_rawdev_stop(uint16_t dev_id)</div></div>
<div class="ttc" id="astructrte__mbuf_html"><div class="ttname"><a href="structrte__mbuf.html">rte_mbuf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00473">rte_mbuf_core.h:473</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a7593f4fff04f4ae1b1d718db7ca7dc8c"><div class="ttname"><a href="rte__ethdev_8h.html#a7593f4fff04f4ae1b1d718db7ca7dc8c">rte_eth_dev_info_get</a></div><div class="ttdeci">int rte_eth_dev_info_get(uint16_t port_id, struct rte_eth_dev_info *dev_info)</div></div>
<div class="ttc" id="arte__mempool_8h_html_a04d43951645ad4c11a3d88e3d7664aa9"><div class="ttname"><a href="rte__mempool_8h.html#a04d43951645ad4c11a3d88e3d7664aa9">rte_mempool_set_ops_byname</a></div><div class="ttdeci">int rte_mempool_set_ops_byname(struct rte_mempool *mp, const char *name, void *pool_config)</div></div>
<div class="ttc" id="astructrte__mempool_html_a4359749c27e64762743f7fccb12a6523"><div class="ttname"><a href="structrte__mempool.html#a4359749c27e64762743f7fccb12a6523">rte_mempool::mz</a></div><div class="ttdeci">const struct rte_memzone * mz</div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l00220">rte_mempool.h:220</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_ae293a5d25d141ee348012c140d48b450"><div class="ttname"><a href="rte__rawdev_8h.html#ae293a5d25d141ee348012c140d48b450">rte_rawdev_xstats_names_get</a></div><div class="ttdeci">int rte_rawdev_xstats_names_get(uint16_t dev_id, struct rte_rawdev_xstats_name *xstats_names, unsigned int size)</div></div>
<div class="ttc" id="arte__common_8h_html_ac5169870c983b3463cb226bdb8a94880"><div class="ttname"><a href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a></div><div class="ttdeci">__rte_noreturn void rte_exit(int exit_code, const char *format,...) __rte_format_printf(2</div></div>
<div class="ttc" id="arte__lcore_8h_html_a1728dc7f14571ba778d3b5b41aa09283"><div class="ttname"><a href="rte__lcore_8h.html#a1728dc7f14571ba778d3b5b41aa09283">rte_lcore_count</a></div><div class="ttdeci">unsigned int rte_lcore_count(void)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_adec226574c53ae413252c9b15f6f4bab"><div class="ttname"><a href="rte__ethdev_8h.html#adec226574c53ae413252c9b15f6f4bab">rte_eth_stats_get</a></div><div class="ttdeci">int rte_eth_stats_get(uint16_t port_id, struct rte_eth_stats *stats)</div></div>
<div class="ttc" id="astructrte__mempool__memhdr_html"><div class="ttname"><a href="structrte__mempool__memhdr.html">rte_mempool_memhdr</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l00183">rte_mempool.h:183</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a83e56cabbd31637efd648e3fc010392b"><div class="ttname"><a href="rte__ethdev_8h.html#a83e56cabbd31637efd648e3fc010392b">rte_eth_tx_burst</a></div><div class="ttdeci">static uint16_t rte_eth_tx_burst(uint16_t port_id, uint16_t queue_id, struct rte_mbuf **tx_pkts, uint16_t nb_pkts)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l05112">rte_ethdev.h:5112</a></div></div>
<div class="ttc" id="arte__cycles_8h_html_ae016e608f344823e677819d8f04264c5"><div class="ttname"><a href="rte__cycles_8h.html#ae016e608f344823e677819d8f04264c5">rte_get_tsc_hz</a></div><div class="ttdeci">uint64_t rte_get_tsc_hz(void)</div></div>
<div class="ttc" id="arte__cycles_8h_html"><div class="ttname"><a href="rte__cycles_8h.html">rte_cycles.h</a></div></div>
<div class="ttc" id="arte__common_8h_html_a4c7571cbcdbfe9b63431036af811bee9"><div class="ttname"><a href="rte__common_8h.html#a4c7571cbcdbfe9b63431036af811bee9">RTE_MIN</a></div><div class="ttdeci">#define RTE_MIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00573">rte_common.h:573</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_a89055cb62b725345bfd536e608ab939f"><div class="ttname"><a href="rte__rawdev_8h.html#a89055cb62b725345bfd536e608ab939f">rte_rawdev_set_attr</a></div><div class="ttdeci">int rte_rawdev_set_attr(uint16_t dev_id, const char *attr_name, const uint64_t attr_value)</div></div>
<div class="ttc" id="arte__mempool_8h_html_a542ec0f29072e7f1cfdb5c150f57b236"><div class="ttname"><a href="rte__mempool_8h.html#a542ec0f29072e7f1cfdb5c150f57b236">rte_mempool_create_empty</a></div><div class="ttdeci">struct rte_mempool * rte_mempool_create_empty(const char *name, unsigned n, unsigned elt_size, unsigned cache_size, unsigned private_data_size, int socket_id, unsigned flags)</div></div>
<div class="ttc" id="astructrte__eth__rss__conf_html_ad70f17882a835e5d4e38c64a9f872fdc"><div class="ttname"><a href="structrte__eth__rss__conf.html#ad70f17882a835e5d4e38c64a9f872fdc">rte_eth_rss_conf::rss_hf</a></div><div class="ttdeci">uint64_t rss_hf</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00457">rte_ethdev.h:457</a></div></div>
<div class="ttc" id="arte__mbuf__pool__ops_8h_html_a5421b2f89006563120feb8cece9de079"><div class="ttname"><a href="rte__mbuf__pool__ops_8h.html#a5421b2f89006563120feb8cece9de079">rte_mbuf_best_mempool_ops</a></div><div class="ttdeci">const char * rte_mbuf_best_mempool_ops(void)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_af3ff61eaf3b5bd61fe10923e406298ed"><div class="ttname"><a href="rte__ethdev_8h.html#af3ff61eaf3b5bd61fe10923e406298ed">rte_eth_stats_reset</a></div><div class="ttdeci">int rte_eth_stats_reset(uint16_t port_id)</div></div>
<div class="ttc" id="arte__mbuf__core_8h_html_a2a8b10263496c7b580e9d0c7f2a1f073"><div class="ttname"><a href="rte__mbuf__core_8h.html#a2a8b10263496c7b580e9d0c7f2a1f073">rte_pktmbuf_mtod</a></div><div class="ttdeci">#define rte_pktmbuf_mtod(m, t)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00726">rte_mbuf_core.h:726</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_afdc834c1c52e9fb512301990468ca7c2"><div class="ttname"><a href="rte__ethdev_8h.html#afdc834c1c52e9fb512301990468ca7c2">rte_eth_dev_start</a></div><div class="ttdeci">int rte_eth_dev_start(uint16_t port_id)</div></div>
<div class="ttc" id="arte__memzone_8h_html_aaa4ec5a6d04c8cd4a55beae18f52aa31"><div class="ttname"><a href="rte__memzone_8h.html#aaa4ec5a6d04c8cd4a55beae18f52aa31">rte_memzone_free</a></div><div class="ttdeci">int rte_memzone_free(const struct rte_memzone *mz)</div></div>
<div class="ttc" id="arte__common_8h_html"><div class="ttname"><a href="rte__common_8h.html">rte_common.h</a></div></div>
<div class="ttc" id="arte__mbuf_8h_html_af714a7341cb37bc2530ac07c84c829b6"><div class="ttname"><a href="rte__mbuf_8h.html#af714a7341cb37bc2530ac07c84c829b6">rte_pktmbuf_pool_init</a></div><div class="ttdeci">void rte_pktmbuf_pool_init(struct rte_mempool *mp, void *opaque_arg)</div></div>
<div class="ttc" id="astructrte__eth__txmode_html_a6cfe3b3ee46e9a8b8c62a64294b0b564"><div class="ttname"><a href="structrte__eth__txmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">rte_eth_txmode::offloads</a></div><div class="ttdeci">uint64_t offloads</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00959">rte_ethdev.h:959</a></div></div>
<div class="ttc" id="arte__mempool_8h_html_abd4bec335c01bac3d695beffb5a28690"><div class="ttname"><a href="rte__mempool_8h.html#abd4bec335c01bac3d695beffb5a28690">rte_mempool_obj_iter</a></div><div class="ttdeci">uint32_t rte_mempool_obj_iter(struct rte_mempool *mp, rte_mempool_obj_cb_t *obj_cb, void *obj_cb_arg)</div></div>
<div class="ttc" id="arte__launch_8h_html_a2bf98eda211728b3dc69aa7694758c6d"><div class="ttname"><a href="rte__launch_8h.html#a2bf98eda211728b3dc69aa7694758c6d">rte_eal_remote_launch</a></div><div class="ttdeci">int rte_eal_remote_launch(lcore_function_t *f, void *arg, unsigned worker_id)</div></div>
<div class="ttc" id="arte__common_8h_html_ae1a7c8799cb57669ae2ddf367b21533f"><div class="ttname"><a href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a></div><div class="ttdeci">#define __rte_unused</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00116">rte_common.h:116</a></div></div>
<div class="ttc" id="astructrte__eth__rxmode_html_a6cfe3b3ee46e9a8b8c62a64294b0b564"><div class="ttname"><a href="structrte__eth__rxmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">rte_eth_rxmode::offloads</a></div><div class="ttdeci">uint64_t offloads</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00412">rte_ethdev.h:412</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a572cbdd554578f35c4480f1397e7dea0"><div class="ttname"><a href="rte__ethdev_8h.html#a572cbdd554578f35c4480f1397e7dea0">rte_eth_find_next</a></div><div class="ttdeci">uint16_t rte_eth_find_next(uint16_t port_id)</div></div>
<div class="ttc" id="arte__mbuf__pool__ops_8h_html"><div class="ttname"><a href="rte__mbuf__pool__ops_8h.html">rte_mbuf_pool_ops.h</a></div></div>
<div class="ttc" id="arte__eal_8h_html_a5c3f4dddc25e38c5a186ecd8a69260e3"><div class="ttname"><a href="rte__eal_8h.html#a5c3f4dddc25e38c5a186ecd8a69260e3">rte_eal_init</a></div><div class="ttdeci">int rte_eal_init(int argc, char **argv)</div></div>
<div class="ttc" id="astructrte__mempool_html"><div class="ttname"><a href="structrte__mempool.html">rte_mempool</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l00207">rte_mempool.h:207</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_ae9bda325a2bd66d8ebc5db3ede93acfa"><div class="ttname"><a href="rte__rawdev_8h.html#ae9bda325a2bd66d8ebc5db3ede93acfa">rte_rawdev_queue_setup</a></div><div class="ttdeci">int rte_rawdev_queue_setup(uint16_t dev_id, uint16_t queue_id, rte_rawdev_obj_t queue_conf, size_t queue_conf_size)</div></div>
<div class="ttc" id="astructrte__mempool_html_a841923a20e6dda97c59351c8e97c9be6"><div class="ttname"><a href="structrte__mempool.html#a841923a20e6dda97c59351c8e97c9be6">rte_mempool::header_size</a></div><div class="ttdeci">uint32_t header_size</div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l00228">rte_mempool.h:228</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html"><div class="ttname"><a href="rte__rawdev_8h.html">rte_rawdev.h</a></div></div>
<div class="ttc" id="arte__mbuf_8h_html_a1215458932900b7cd5192326fa4a6902"><div class="ttname"><a href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a></div><div class="ttdeci">static void rte_pktmbuf_free(struct rte_mbuf *m)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf_8h_source.html#l01397">rte_mbuf.h:1397</a></div></div>
<div class="ttc" id="arte__lcore_8h_html_ac779e61584eb9d087c3e20bf2d1150c8"><div class="ttname"><a href="rte__lcore_8h.html#ac779e61584eb9d087c3e20bf2d1150c8">RTE_LCORE_FOREACH_WORKER</a></div><div class="ttdeci">#define RTE_LCORE_FOREACH_WORKER(i)</div><div class="ttdef"><b>Definition:</b> <a href="rte__lcore_8h_source.html#l00239">rte_lcore.h:239</a></div></div>
<div class="ttc" id="arte__mempool_8h_html_a0d326354d53ef5068d86a8b7d9ec2d61"><div class="ttname"><a href="rte__mempool_8h.html#a0d326354d53ef5068d86a8b7d9ec2d61">rte_mempool_get_bulk</a></div><div class="ttdeci">static __rte_always_inline int rte_mempool_get_bulk(struct rte_mempool *mp, void **obj_table, unsigned int n)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l01521">rte_mempool.h:1521</a></div></div>
<div class="ttc" id="astructrte__rawdev__xstats__name_html"><div class="ttname"><a href="structrte__rawdev__xstats__name.html">rte_rawdev_xstats_name</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__rawdev_8h_source.html#l00455">rte_rawdev.h:455</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a36ba70a5a6fce2c2c1f774828ba78f8d"><div class="ttname"><a href="rte__ethdev_8h.html#a36ba70a5a6fce2c2c1f774828ba78f8d">rte_eth_rx_queue_setup</a></div><div class="ttdeci">int rte_eth_rx_queue_setup(uint16_t port_id, uint16_t rx_queue_id, uint16_t nb_rx_desc, unsigned int socket_id, const struct rte_eth_rxconf *rx_conf, struct rte_mempool *mb_pool)</div></div>
<div class="ttc" id="astructrte__eth__conf_html_addc9c7bb19ed12f1171c543493553806"><div class="ttname"><a href="structrte__eth__conf.html#addc9c7bb19ed12f1171c543493553806">rte_eth_conf::rss_conf</a></div><div class="ttdeci">struct rte_eth_rss_conf rss_conf</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01327">rte_ethdev.h:1309</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a56200b0c25f3ecab5abe9bd2b647c215"><div class="ttname"><a href="rte__ethdev_8h.html#a56200b0c25f3ecab5abe9bd2b647c215">rte_eth_link_get</a></div><div class="ttdeci">int rte_eth_link_get(uint16_t port_id, struct rte_eth_link *link)</div></div>
<div class="ttc" id="astructrte__eth__conf_html_a084e132696e8d0f59f643d822c8cedb7"><div class="ttname"><a href="structrte__eth__conf.html#a084e132696e8d0f59f643d822c8cedb7">rte_eth_conf::rx_adv_conf</a></div><div class="ttdeci">struct rte_eth_conf::@153 rx_adv_conf</div></div>
<div class="ttc" id="arte__ethdev_8h_html"><div class="ttname"><a href="rte__ethdev_8h.html">rte_ethdev.h</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a6fc010cf6216331c50bc02d2fd4e614f"><div class="ttname"><a href="rte__ethdev_8h.html#a6fc010cf6216331c50bc02d2fd4e614f">rte_eth_dev_stop</a></div><div class="ttdeci">int rte_eth_dev_stop(uint16_t port_id)</div></div>
<div class="ttc" id="acmdline_8h_html"><div class="ttname"><a href="cmdline_8h.html">cmdline.h</a></div></div>
<div class="ttc" id="astructrte__memzone_html_ae5bd6c22dbf0f6b5b0ae0233f8eb3704"><div class="ttname"><a href="structrte__memzone.html#ae5bd6c22dbf0f6b5b0ae0233f8eb3704">rte_memzone::addr</a></div><div class="ttdeci">void * addr</div><div class="ttdef"><b>Definition:</b> <a href="rte__memzone_8h_source.html#l00057">rte_memzone.h:57</a></div></div>
<div class="ttc" id="astructrte__memzone_html_acd74b7a44f2e96bb54cd6a1585e8790f"><div class="ttname"><a href="structrte__memzone.html#acd74b7a44f2e96bb54cd6a1585e8790f">rte_memzone::iova</a></div><div class="ttdeci">rte_iova_t iova</div><div class="ttdef"><b>Definition:</b> <a href="rte__memzone_8h_source.html#l00054">rte_memzone.h:54</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_af2e470ce565295047c323fd2d8c449ad"><div class="ttname"><a href="rte__rawdev_8h.html#af2e470ce565295047c323fd2d8c449ad">rte_rawdev_start</a></div><div class="ttdeci">int rte_rawdev_start(uint16_t dev_id)</div></div>
<div class="ttc" id="astructrte__eth__conf_html_a1c33c9d2e5cdb14b62ed386bf3159e07"><div class="ttname"><a href="structrte__eth__conf.html#a1c33c9d2e5cdb14b62ed386bf3159e07">rte_eth_conf::txmode</a></div><div class="ttdeci">struct rte_eth_txmode txmode</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01294">rte_ethdev.h:1302</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a7a31d6736244603b6a1d7efdd32a8834"><div class="ttname"><a href="rte__ethdev_8h.html#a7a31d6736244603b6a1d7efdd32a8834">RTE_ETH_LINK_MAX_STR_LEN</a></div><div class="ttdeci">#define RTE_ETH_LINK_MAX_STR_LEN</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00327">rte_ethdev.h:327</a></div></div>
<div class="ttc" id="arte__mbuf_8h_html_a7c0d0b427cb071856f2ff0805d608e35"><div class="ttname"><a href="rte__mbuf_8h.html#a7c0d0b427cb071856f2ff0805d608e35">rte_pktmbuf_init</a></div><div class="ttdeci">void rte_pktmbuf_init(struct rte_mempool *mp, void *opaque_arg, void *m, unsigned i)</div></div>
<div class="ttc" id="arte__rawdev_8h_html_a59bb29d3791a9866fab73ab97f44b568"><div class="ttname"><a href="rte__rawdev_8h.html#a59bb29d3791a9866fab73ab97f44b568">rte_rawdev_get_attr</a></div><div class="ttdeci">int rte_rawdev_get_attr(uint16_t dev_id, const char *attr_name, uint64_t *attr_value)</div></div>
<div class="ttc" id="arte__memzone_8h_html_a56736f23c55bc5814d29ccda97e32063"><div class="ttname"><a href="rte__memzone_8h.html#a56736f23c55bc5814d29ccda97e32063">rte_memzone_reserve_aligned</a></div><div class="ttdeci">const struct rte_memzone * rte_memzone_reserve_aligned(const char *name, size_t len, int socket_id, unsigned flags, unsigned align)</div></div>
<div class="ttc" id="arte__rawdev_8h_html_adfa4a26f63848ac2e8162fd2c19b332d"><div class="ttname"><a href="rte__rawdev_8h.html#adfa4a26f63848ac2e8162fd2c19b332d">rte_rawdev_close</a></div><div class="ttdeci">int rte_rawdev_close(uint16_t dev_id)</div></div>
<div class="ttc" id="astructrte__eth__dev__info_html"><div class="ttname"><a href="structrte__eth__dev__info.html">rte_eth_dev_info</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01504">rte_ethdev.h:1504</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_a0bd0c1f93d46bd0de6766ce35438727b"><div class="ttname"><a href="rte__rawdev_8h.html#a0bd0c1f93d46bd0de6766ce35438727b">rte_rawdev_enqueue_buffers</a></div><div class="ttdeci">int rte_rawdev_enqueue_buffers(uint16_t dev_id, struct rte_rawdev_buf **buffers, unsigned int count, rte_rawdev_obj_t context)</div></div>
<div class="ttc" id="astructrte__eth__conf_html"><div class="ttname"><a href="structrte__eth__conf.html">rte_eth_conf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01293">rte_ethdev.h:1293</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ad032e25f712e6ffeb0c19eab1ec1fd2e"><div class="ttname"><a href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a></div><div class="ttdeci">int rte_eth_dev_socket_id(uint16_t port_id)</div></div>
<div class="ttc" id="arte__rawdev_8h_html_a30147de390b2761c57c33ea52b503983"><div class="ttname"><a href="rte__rawdev_8h.html#a30147de390b2761c57c33ea52b503983">rte_rawdev_xstats_reset</a></div><div class="ttdeci">int rte_rawdev_xstats_reset(uint16_t dev_id, const uint32_t ids[], uint32_t nb_ids)</div></div>
<div class="ttc" id="arte__rawdev_8h_html_a23a6cb31d4c8ff7d7f46d9e24aa71230"><div class="ttname"><a href="rte__rawdev_8h.html#a23a6cb31d4c8ff7d7f46d9e24aa71230">rte_rawdev_xstats_get</a></div><div class="ttdeci">int rte_rawdev_xstats_get(uint16_t dev_id, const unsigned int ids[], uint64_t values[], unsigned int n)</div></div>
<div class="ttc" id="astructrte__eth__stats_html"><div class="ttname"><a href="structrte__eth__stats.html">rte_eth_stats</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00244">rte_ethdev.h:244</a></div></div>
<div class="ttc" id="astructrte__memzone_html"><div class="ttname"><a href="structrte__memzone.html">rte_memzone</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__memzone_8h_source.html#l00049">rte_memzone.h:49</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a586b8e86131b4ec0ccaf464e847ccf3eaa06694239b7ecf1efa3c9243b9e7b4c0"><div class="ttname"><a href="rte__ethdev_8h.html#a586b8e86131b4ec0ccaf464e847ccf3eaa06694239b7ecf1efa3c9243b9e7b4c0">ETH_MQ_RX_RSS</a></div><div class="ttdeci">@ ETH_MQ_RX_RSS</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00355">rte_ethdev.h:355</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_abf894153e16c9403e11c487bcc41b248"><div class="ttname"><a href="rte__rawdev_8h.html#abf894153e16c9403e11c487bcc41b248">rte_rawdev_configure</a></div><div class="ttdeci">int rte_rawdev_configure(uint16_t dev_id, struct rte_rawdev_info *dev_conf, size_t dev_private_size)</div></div>
<div class="ttc" id="astructrte__mempool_html_a229cb0bd24215f0cb940e0724dbd4d55"><div class="ttname"><a href="structrte__mempool.html#a229cb0bd24215f0cb940e0724dbd4d55">rte_mempool::socket_id</a></div><div class="ttdeci">int socket_id</div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l00222">rte_mempool.h:222</a></div></div>
<div class="ttc" id="arte__cycles_8h_html_af73b844d50b98de74b1a0e1730262f85"><div class="ttname"><a href="rte__cycles_8h.html#af73b844d50b98de74b1a0e1730262f85">rte_delay_ms</a></div><div class="ttdeci">static void rte_delay_ms(unsigned ms)</div><div class="ttdef"><b>Definition:</b> <a href="rte__cycles_8h_source.html#l00148">rte_cycles.h:148</a></div></div>
<div class="ttc" id="astructrte__mempool_html_ad61e210d2df01bf9c91230fee6a8cf21"><div class="ttname"><a href="structrte__mempool.html#ad61e210d2df01bf9c91230fee6a8cf21">rte_mempool::elt_size</a></div><div class="ttdeci">uint32_t elt_size</div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l00227">rte_mempool.h:227</a></div></div>
<div class="ttc" id="arte__memzone_8h_html_ae118c6a214428a40c3e94a99c5db11b9"><div class="ttname"><a href="rte__memzone_8h.html#ae118c6a214428a40c3e94a99c5db11b9">RTE_MEMZONE_IOVA_CONTIG</a></div><div class="ttdeci">#define RTE_MEMZONE_IOVA_CONTIG</div><div class="ttdef"><b>Definition:</b> <a href="rte__memzone_8h_source.html#l00043">rte_memzone.h:43</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ac2c7507787a5520e8049fff94432169e"><div class="ttname"><a href="rte__ethdev_8h.html#ac2c7507787a5520e8049fff94432169e">rte_eth_dev_close</a></div><div class="ttdeci">int rte_eth_dev_close(uint16_t port_id)</div></div>
<div class="ttc" id="arte__mbuf_8h_html_ad4d1c289d8cffc831dfb77c64f52447b"><div class="ttname"><a href="rte__mbuf_8h.html#ad4d1c289d8cffc831dfb77c64f52447b">rte_pktmbuf_alloc</a></div><div class="ttdeci">static struct rte_mbuf * rte_pktmbuf_alloc(struct rte_mempool *mp)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf_8h_source.html#l00892">rte_mbuf.h:892</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
