<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DPDK: examples/vhost/virtio_net.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">20.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">examples/vhost/virtio_net.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/* SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><span class="comment"> * Copyright(c) 2010-2017 Intel Corporation</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;linux/virtio_net.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__mbuf_8h.html">rte_mbuf.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__memcpy_8h.html">rte_memcpy.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__vhost_8h.html">rte_vhost.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;main.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * A very simple vhost-user net driver implementation, without</span></div>
<div class="line"><span class="comment"> * any extra features being enabled, such as TSO and mrg-Rx.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">vs_vhost_net_setup(<span class="keyword">struct</span> vhost_dev *dev)</div>
<div class="line">{</div>
<div class="line">    uint16_t i;</div>
<div class="line">    <span class="keywordtype">int</span> vid = dev-&gt;vid;</div>
<div class="line">    <span class="keyword">struct </span>vhost_queue *queue;</div>
<div class="line"> </div>
<div class="line">    <a name="a0"></a><a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, VHOST_CONFIG,</div>
<div class="line">        <span class="stringliteral">&quot;setting builtin vhost-user net driver\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a name="a1"></a><a class="code" href="rte__vhost_8h.html#a1c1fbdab537b4021941bab15e26b21f9">rte_vhost_get_negotiated_features</a>(vid, &amp;dev-&gt;features);</div>
<div class="line">    <span class="keywordflow">if</span> (dev-&gt;features &amp; (1 &lt;&lt; VIRTIO_NET_F_MRG_RXBUF))</div>
<div class="line">        dev-&gt;hdr_len = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>virtio_net_hdr_mrg_rxbuf);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        dev-&gt;hdr_len = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>virtio_net_hdr);</div>
<div class="line"> </div>
<div class="line">    <a name="a2"></a><a class="code" href="rte__vhost_8h.html#a398c60c6b04e6eeaa72359b527661bc2">rte_vhost_get_mem_table</a>(vid, &amp;dev-&gt;mem);</div>
<div class="line"> </div>
<div class="line">    dev-&gt;nr_vrings = <a name="a3"></a><a class="code" href="rte__vhost_8h.html#a07fe188216c6544b0b62baf911622c99">rte_vhost_get_vring_num</a>(vid);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; dev-&gt;nr_vrings; i++) {</div>
<div class="line">        queue = &amp;dev-&gt;queues[i];</div>
<div class="line"> </div>
<div class="line">        queue-&gt;last_used_idx  = 0;</div>
<div class="line">        queue-&gt;last_avail_idx = 0;</div>
<div class="line">        <a name="a4"></a><a class="code" href="rte__vhost_8h.html#a5891bd49d76cbe72ecfe2c87fc1fe853">rte_vhost_get_vhost_vring</a>(vid, i, &amp;queue-&gt;vr);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">vs_vhost_net_remove(<span class="keyword">struct</span> vhost_dev *dev)</div>
<div class="line">{</div>
<div class="line">    free(dev-&gt;mem);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a name="a5"></a><a class="code" href="rte__common_8h.html#af1e21922385a6cbe051e3ab70bba9f11">__rte_always_inline</a> <span class="keywordtype">int</span></div>
<div class="line">enqueue_pkt(<span class="keyword">struct</span> vhost_dev *dev, <span class="keyword">struct</span> rte_vhost_vring *vr,</div>
<div class="line">        <span class="keyword">struct</span> <a name="_a6"></a><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *m, uint16_t desc_idx)</div>
<div class="line">{</div>
<div class="line">    uint32_t desc_avail, desc_offset;</div>
<div class="line">    uint64_t desc_chunck_len;</div>
<div class="line">    uint32_t mbuf_avail, mbuf_offset;</div>
<div class="line">    uint32_t cpy_len;</div>
<div class="line">    <span class="keyword">struct </span>vring_desc *desc;</div>
<div class="line">    uint64_t desc_addr, desc_gaddr;</div>
<div class="line">    <span class="keyword">struct </span>virtio_net_hdr virtio_hdr = {0, 0, 0, 0, 0, 0};</div>
<div class="line">    <span class="comment">/* A counter to avoid desc dead loop chain */</span></div>
<div class="line">    uint16_t nr_desc = 1;</div>
<div class="line"> </div>
<div class="line">    desc = &amp;vr-&gt;desc[desc_idx];</div>
<div class="line">    desc_chunck_len = desc-&gt;len;</div>
<div class="line">    desc_gaddr = desc-&gt;addr;</div>
<div class="line">    desc_addr = <a name="a7"></a><a class="code" href="rte__vhost_8h.html#a2deb7d5116b92a1cc150c11e306fad98">rte_vhost_va_from_guest_pa</a>(</div>
<div class="line">            dev-&gt;mem, desc_gaddr, &amp;desc_chunck_len);</div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Checking of &#39;desc_addr&#39; placed outside of &#39;unlikely&#39; macro to avoid</span></div>
<div class="line"><span class="comment">     * performance issue with some versions of gcc (4.8.4 and 5.3.0) which</span></div>
<div class="line"><span class="comment">     * otherwise stores offset on the stack instead of in a register.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a8"></a><a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(desc-&gt;len &lt; dev-&gt;hdr_len) || !desc_addr)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <a name="a9"></a><a class="code" href="rte__prefetch_8h.html#a7f89cf66766e6bfd63feb370a7280de9">rte_prefetch0</a>((<span class="keywordtype">void</span> *)(uintptr_t)desc_addr);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* write virtio-net header */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a10"></a><a class="code" href="rte__branch__prediction_8h.html#a217a0bd562b98ae8c2ffce44935351e1">likely</a>(desc_chunck_len &gt;= dev-&gt;hdr_len)) {</div>
<div class="line">        *(<span class="keyword">struct </span>virtio_net_hdr *)(uintptr_t)desc_addr = virtio_hdr;</div>
<div class="line">        desc_offset = dev-&gt;hdr_len;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        uint64_t len;</div>
<div class="line">        uint64_t remain = dev-&gt;hdr_len;</div>
<div class="line">        uint64_t src = (uint64_t)(uintptr_t)&amp;virtio_hdr, dst;</div>
<div class="line">        uint64_t guest_addr = desc_gaddr;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">while</span> (remain) {</div>
<div class="line">            len = remain;</div>
<div class="line">            dst = <a class="code" href="rte__vhost_8h.html#a2deb7d5116b92a1cc150c11e306fad98">rte_vhost_va_from_guest_pa</a>(dev-&gt;mem,</div>
<div class="line">                    guest_addr, &amp;len);</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(!dst || !len))</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">            <a name="a11"></a><a class="code" href="rte__memcpy_8h.html#a09f4d8cdb1a7c25398a363906e1db8cd">rte_memcpy</a>((<span class="keywordtype">void</span> *)(uintptr_t)dst,</div>
<div class="line">                    (<span class="keywordtype">void</span> *)(uintptr_t)src,</div>
<div class="line">                    len);</div>
<div class="line"> </div>
<div class="line">            remain -= len;</div>
<div class="line">            guest_addr += len;</div>
<div class="line">            src += len;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        desc_chunck_len = desc-&gt;len - dev-&gt;hdr_len;</div>
<div class="line">        desc_gaddr += dev-&gt;hdr_len;</div>
<div class="line">        desc_addr = <a class="code" href="rte__vhost_8h.html#a2deb7d5116b92a1cc150c11e306fad98">rte_vhost_va_from_guest_pa</a>(</div>
<div class="line">                dev-&gt;mem, desc_gaddr,</div>
<div class="line">                &amp;desc_chunck_len);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(!desc_addr))</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">        desc_offset = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    desc_avail  = desc-&gt;len - dev-&gt;hdr_len;</div>
<div class="line"> </div>
<div class="line">    mbuf_avail  = <a name="a12"></a><a class="code" href="rte__mbuf_8h.html#a2a1e1b30162161ed11d3ba2faf7bbf13">rte_pktmbuf_data_len</a>(m);</div>
<div class="line">    mbuf_offset = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (mbuf_avail != 0 || m-&gt;<a name="a13"></a><a class="code" href="structrte__mbuf.html#ac858fb3bb1a1d67a6efc9563d0c5a471">next</a> != NULL) {</div>
<div class="line">        <span class="comment">/* done with current mbuf, fetch next */</span></div>
<div class="line">        <span class="keywordflow">if</span> (mbuf_avail == 0) {</div>
<div class="line">            m = m-&gt;<a class="code" href="structrte__mbuf.html#ac858fb3bb1a1d67a6efc9563d0c5a471">next</a>;</div>
<div class="line"> </div>
<div class="line">            mbuf_offset = 0;</div>
<div class="line">            mbuf_avail  = <a class="code" href="rte__mbuf_8h.html#a2a1e1b30162161ed11d3ba2faf7bbf13">rte_pktmbuf_data_len</a>(m);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* done with current desc buf, fetch next */</span></div>
<div class="line">        <span class="keywordflow">if</span> (desc_avail == 0) {</div>
<div class="line">            <span class="keywordflow">if</span> ((desc-&gt;flags &amp; VRING_DESC_F_NEXT) == 0) {</div>
<div class="line">                <span class="comment">/* Room in vring buffer is not enough */</span></div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(desc-&gt;next &gt;= vr-&gt;size ||</div>
<div class="line">                     ++nr_desc &gt; vr-&gt;size))</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">            desc = &amp;vr-&gt;desc[desc-&gt;next];</div>
<div class="line">            desc_chunck_len = desc-&gt;len;</div>
<div class="line">            desc_gaddr = desc-&gt;addr;</div>
<div class="line">            desc_addr = <a class="code" href="rte__vhost_8h.html#a2deb7d5116b92a1cc150c11e306fad98">rte_vhost_va_from_guest_pa</a>(</div>
<div class="line">                    dev-&gt;mem, desc_gaddr, &amp;desc_chunck_len);</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(!desc_addr))</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">            desc_offset = 0;</div>
<div class="line">            desc_avail  = desc-&gt;len;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(desc_chunck_len == 0)) {</div>
<div class="line">            desc_chunck_len = desc_avail;</div>
<div class="line">            desc_gaddr += desc_offset;</div>
<div class="line">            desc_addr = <a class="code" href="rte__vhost_8h.html#a2deb7d5116b92a1cc150c11e306fad98">rte_vhost_va_from_guest_pa</a>(dev-&gt;mem,</div>
<div class="line">                    desc_gaddr,</div>
<div class="line">                    &amp;desc_chunck_len);</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(!desc_addr))</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">            desc_offset = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        cpy_len = <a name="a14"></a><a class="code" href="rte__common_8h.html#a4c7571cbcdbfe9b63431036af811bee9">RTE_MIN</a>(desc_chunck_len, mbuf_avail);</div>
<div class="line">        <a class="code" href="rte__memcpy_8h.html#a09f4d8cdb1a7c25398a363906e1db8cd">rte_memcpy</a>((<span class="keywordtype">void</span> *)((uintptr_t)(desc_addr + desc_offset)),</div>
<div class="line">            <a name="a15"></a><a class="code" href="rte__mbuf__core_8h.html#ad63e1de0ec54d7c7603ea984c76ca956">rte_pktmbuf_mtod_offset</a>(m, <span class="keywordtype">void</span> *, mbuf_offset),</div>
<div class="line">            cpy_len);</div>
<div class="line"> </div>
<div class="line">        mbuf_avail  -= cpy_len;</div>
<div class="line">        mbuf_offset += cpy_len;</div>
<div class="line">        desc_avail  -= cpy_len;</div>
<div class="line">        desc_offset += cpy_len;</div>
<div class="line">        desc_chunck_len -= cpy_len;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">uint16_t</div>
<div class="line">vs_enqueue_pkts(<span class="keyword">struct</span> vhost_dev *dev, uint16_t queue_id,</div>
<div class="line">        <span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a> **pkts, uint32_t count)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>vhost_queue *queue;</div>
<div class="line">    <span class="keyword">struct </span>rte_vhost_vring *vr;</div>
<div class="line">    uint16_t avail_idx, free_entries, start_idx;</div>
<div class="line">    uint16_t desc_indexes[MAX_PKT_BURST];</div>
<div class="line">    uint16_t used_idx;</div>
<div class="line">    uint32_t i;</div>
<div class="line"> </div>
<div class="line">    queue = &amp;dev-&gt;queues[queue_id];</div>
<div class="line">    vr    = &amp;queue-&gt;vr;</div>
<div class="line"> </div>
<div class="line">    avail_idx = *((<span class="keyword">volatile</span> uint16_t *)&amp;vr-&gt;avail-&gt;idx);</div>
<div class="line">    start_idx = queue-&gt;last_used_idx;</div>
<div class="line">    free_entries = avail_idx - start_idx;</div>
<div class="line">    count = <a class="code" href="rte__common_8h.html#a4c7571cbcdbfe9b63431036af811bee9">RTE_MIN</a>(count, free_entries);</div>
<div class="line">    count = <a class="code" href="rte__common_8h.html#a4c7571cbcdbfe9b63431036af811bee9">RTE_MIN</a>(count, (uint32_t)MAX_PKT_BURST);</div>
<div class="line">    <span class="keywordflow">if</span> (count == 0)</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Retrieve all of the desc indexes first to avoid caching issues. */</span></div>
<div class="line">    <a class="code" href="rte__prefetch_8h.html#a7f89cf66766e6bfd63feb370a7280de9">rte_prefetch0</a>(&amp;vr-&gt;avail-&gt;ring[start_idx &amp; (vr-&gt;size - 1)]);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; count; i++) {</div>
<div class="line">        used_idx = (start_idx + i) &amp; (vr-&gt;size - 1);</div>
<div class="line">        desc_indexes[i] = vr-&gt;avail-&gt;ring[used_idx];</div>
<div class="line">        vr-&gt;used-&gt;ring[used_idx].id = desc_indexes[i];</div>
<div class="line">        vr-&gt;used-&gt;ring[used_idx].len = pkts[i]-&gt;<a name="a16"></a><a class="code" href="structrte__mbuf.html#a5046af233a45d6d79ce1a5aae535b23c">pkt_len</a> +</div>
<div class="line">                           dev-&gt;hdr_len;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__prefetch_8h.html#a7f89cf66766e6bfd63feb370a7280de9">rte_prefetch0</a>(&amp;vr-&gt;desc[desc_indexes[0]]);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; count; i++) {</div>
<div class="line">        uint16_t desc_idx = desc_indexes[i];</div>
<div class="line">        <span class="keywordtype">int</span> err;</div>
<div class="line"> </div>
<div class="line">        err = enqueue_pkt(dev, vr, pkts[i], desc_idx);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(err)) {</div>
<div class="line">            used_idx = (start_idx + i) &amp; (vr-&gt;size - 1);</div>
<div class="line">            vr-&gt;used-&gt;ring[used_idx].len = dev-&gt;hdr_len;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (i + 1 &lt; count)</div>
<div class="line">            <a class="code" href="rte__prefetch_8h.html#a7f89cf66766e6bfd63feb370a7280de9">rte_prefetch0</a>(&amp;vr-&gt;desc[desc_indexes[i+1]]);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a name="a17"></a><a class="code" href="rte__atomic_8h.html#a7716c305b6c97f45a5d6c7239a7d30b4">rte_smp_wmb</a>();</div>
<div class="line"> </div>
<div class="line">    *(<span class="keyword">volatile</span> uint16_t *)&amp;vr-&gt;used-&gt;idx += count;</div>
<div class="line">    queue-&gt;last_used_idx += count;</div>
<div class="line"> </div>
<div class="line">    <a name="a18"></a><a class="code" href="rte__vhost_8h.html#aa2e00d8df9ee6d508aea6f807d0c09f3">rte_vhost_vring_call</a>(dev-&gt;vid, queue_id);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> count;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="rte__common_8h.html#af1e21922385a6cbe051e3ab70bba9f11">__rte_always_inline</a> <span class="keywordtype">int</span></div>
<div class="line">dequeue_pkt(<span class="keyword">struct</span> vhost_dev *dev, <span class="keyword">struct</span> rte_vhost_vring *vr,</div>
<div class="line">        <span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a> *m, uint16_t desc_idx,</div>
<div class="line">        <span class="keyword">struct</span> <a name="_a19"></a><a class="code" href="structrte__mempool.html">rte_mempool</a> *mbuf_pool)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>vring_desc *desc;</div>
<div class="line">    uint64_t desc_addr, desc_gaddr;</div>
<div class="line">    uint32_t desc_avail, desc_offset;</div>
<div class="line">    uint64_t desc_chunck_len;</div>
<div class="line">    uint32_t mbuf_avail, mbuf_offset;</div>
<div class="line">    uint32_t cpy_len;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *cur = m, *prev = m;</div>
<div class="line">    <span class="comment">/* A counter to avoid desc dead loop chain */</span></div>
<div class="line">    uint32_t nr_desc = 1;</div>
<div class="line"> </div>
<div class="line">    desc = &amp;vr-&gt;desc[desc_idx];</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>((desc-&gt;len &lt; dev-&gt;hdr_len)) ||</div>
<div class="line">            (desc-&gt;flags &amp; VRING_DESC_F_INDIRECT))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    desc_chunck_len = desc-&gt;len;</div>
<div class="line">    desc_gaddr = desc-&gt;addr;</div>
<div class="line">    desc_addr = <a class="code" href="rte__vhost_8h.html#a2deb7d5116b92a1cc150c11e306fad98">rte_vhost_va_from_guest_pa</a>(</div>
<div class="line">            dev-&gt;mem, desc_gaddr, &amp;desc_chunck_len);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(!desc_addr))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * We don&#39;t support ANY_LAYOUT, neither VERSION_1, meaning</span></div>
<div class="line"><span class="comment">     * a Tx packet from guest must have 2 desc buffers at least:</span></div>
<div class="line"><span class="comment">     * the first for storing the header and the others for</span></div>
<div class="line"><span class="comment">     * storing the data.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * And since we don&#39;t support TSO, we could simply skip the</span></div>
<div class="line"><span class="comment">     * header.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    desc = &amp;vr-&gt;desc[desc-&gt;next];</div>
<div class="line">    desc_chunck_len = desc-&gt;len;</div>
<div class="line">    desc_gaddr = desc-&gt;addr;</div>
<div class="line">    desc_addr = <a class="code" href="rte__vhost_8h.html#a2deb7d5116b92a1cc150c11e306fad98">rte_vhost_va_from_guest_pa</a>(</div>
<div class="line">            dev-&gt;mem, desc_gaddr, &amp;desc_chunck_len);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(!desc_addr))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    <a class="code" href="rte__prefetch_8h.html#a7f89cf66766e6bfd63feb370a7280de9">rte_prefetch0</a>((<span class="keywordtype">void</span> *)(uintptr_t)desc_addr);</div>
<div class="line"> </div>
<div class="line">    desc_offset = 0;</div>
<div class="line">    desc_avail  = desc-&gt;len;</div>
<div class="line">    nr_desc    += 1;</div>
<div class="line"> </div>
<div class="line">    mbuf_offset = 0;</div>
<div class="line">    mbuf_avail  = m-&gt;<a name="a20"></a><a class="code" href="structrte__mbuf.html#a7ae671bb1805f6f7313b9301aca17eb6">buf_len</a> - RTE_PKTMBUF_HEADROOM;</div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        cpy_len = <a class="code" href="rte__common_8h.html#a4c7571cbcdbfe9b63431036af811bee9">RTE_MIN</a>(desc_chunck_len, mbuf_avail);</div>
<div class="line">        <a class="code" href="rte__memcpy_8h.html#a09f4d8cdb1a7c25398a363906e1db8cd">rte_memcpy</a>(<a class="code" href="rte__mbuf__core_8h.html#ad63e1de0ec54d7c7603ea984c76ca956">rte_pktmbuf_mtod_offset</a>(cur, <span class="keywordtype">void</span> *,</div>
<div class="line">                           mbuf_offset),</div>
<div class="line">            (<span class="keywordtype">void</span> *)((uintptr_t)(desc_addr + desc_offset)),</div>
<div class="line">            cpy_len);</div>
<div class="line"> </div>
<div class="line">        mbuf_avail  -= cpy_len;</div>
<div class="line">        mbuf_offset += cpy_len;</div>
<div class="line">        desc_avail  -= cpy_len;</div>
<div class="line">        desc_offset += cpy_len;</div>
<div class="line">        desc_chunck_len -= cpy_len;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* This desc reaches to its end, get the next one */</span></div>
<div class="line">        <span class="keywordflow">if</span> (desc_avail == 0) {</div>
<div class="line">            <span class="keywordflow">if</span> ((desc-&gt;flags &amp; VRING_DESC_F_NEXT) == 0)</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(desc-&gt;next &gt;= vr-&gt;size ||</div>
<div class="line">                     ++nr_desc &gt; vr-&gt;size))</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            desc = &amp;vr-&gt;desc[desc-&gt;next];</div>
<div class="line"> </div>
<div class="line">            desc_chunck_len = desc-&gt;len;</div>
<div class="line">            desc_gaddr = desc-&gt;addr;</div>
<div class="line">            desc_addr = <a class="code" href="rte__vhost_8h.html#a2deb7d5116b92a1cc150c11e306fad98">rte_vhost_va_from_guest_pa</a>(</div>
<div class="line">                    dev-&gt;mem, desc_gaddr, &amp;desc_chunck_len);</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(!desc_addr))</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            <a class="code" href="rte__prefetch_8h.html#a7f89cf66766e6bfd63feb370a7280de9">rte_prefetch0</a>((<span class="keywordtype">void</span> *)(uintptr_t)desc_addr);</div>
<div class="line"> </div>
<div class="line">            desc_offset = 0;</div>
<div class="line">            desc_avail  = desc-&gt;len;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(desc_chunck_len == 0)) {</div>
<div class="line">            desc_chunck_len = desc_avail;</div>
<div class="line">            desc_gaddr += desc_offset;</div>
<div class="line">            desc_addr = <a class="code" href="rte__vhost_8h.html#a2deb7d5116b92a1cc150c11e306fad98">rte_vhost_va_from_guest_pa</a>(dev-&gt;mem,</div>
<div class="line">                    desc_gaddr,</div>
<div class="line">                    &amp;desc_chunck_len);</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(!desc_addr))</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">            desc_offset = 0;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * This mbuf reaches to its end, get a new one</span></div>
<div class="line"><span class="comment">         * to hold more data.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (mbuf_avail == 0) {</div>
<div class="line">            cur = <a name="a21"></a><a class="code" href="rte__mbuf_8h.html#ad4d1c289d8cffc831dfb77c64f52447b">rte_pktmbuf_alloc</a>(mbuf_pool);</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(cur == NULL)) {</div>
<div class="line">                <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, VHOST_DATA, <span class="stringliteral">&quot;Failed to &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;allocate memory for mbuf.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            prev-&gt;next = cur;</div>
<div class="line">            prev-&gt;<a name="a22"></a><a class="code" href="structrte__mbuf.html#ad1a572736a10ff6b282c5f43c4ea1ccf">data_len</a> = mbuf_offset;</div>
<div class="line">            m-&gt;<a name="a23"></a><a class="code" href="structrte__mbuf.html#a44fb29a9283000c42a77b76e9ef0b070">nb_segs</a> += 1;</div>
<div class="line">            m-&gt;<a class="code" href="structrte__mbuf.html#a5046af233a45d6d79ce1a5aae535b23c">pkt_len</a> += mbuf_offset;</div>
<div class="line">            prev = cur;</div>
<div class="line"> </div>
<div class="line">            mbuf_offset = 0;</div>
<div class="line">            mbuf_avail  = cur-&gt;<a class="code" href="structrte__mbuf.html#a7ae671bb1805f6f7313b9301aca17eb6">buf_len</a> - RTE_PKTMBUF_HEADROOM;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    prev-&gt;data_len = mbuf_offset;</div>
<div class="line">    m-&gt;<a class="code" href="structrte__mbuf.html#a5046af233a45d6d79ce1a5aae535b23c">pkt_len</a>    += mbuf_offset;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">uint16_t</div>
<div class="line">vs_dequeue_pkts(<span class="keyword">struct</span> vhost_dev *dev, uint16_t queue_id,</div>
<div class="line">    <span class="keyword">struct</span> <a class="code" href="structrte__mempool.html">rte_mempool</a> *mbuf_pool, <span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a> **pkts, uint16_t count)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>vhost_queue *queue;</div>
<div class="line">    <span class="keyword">struct </span>rte_vhost_vring *vr;</div>
<div class="line">    uint32_t desc_indexes[MAX_PKT_BURST];</div>
<div class="line">    uint32_t used_idx;</div>
<div class="line">    uint32_t i = 0;</div>
<div class="line">    uint16_t free_entries;</div>
<div class="line">    uint16_t avail_idx;</div>
<div class="line"> </div>
<div class="line">    queue = &amp;dev-&gt;queues[queue_id];</div>
<div class="line">    vr    = &amp;queue-&gt;vr;</div>
<div class="line"> </div>
<div class="line">    free_entries = *((<span class="keyword">volatile</span> uint16_t *)&amp;vr-&gt;avail-&gt;idx) -</div>
<div class="line">            queue-&gt;last_avail_idx;</div>
<div class="line">    <span class="keywordflow">if</span> (free_entries == 0)</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Prefetch available and used ring */</span></div>
<div class="line">    avail_idx = queue-&gt;last_avail_idx &amp; (vr-&gt;size - 1);</div>
<div class="line">    used_idx  = queue-&gt;last_used_idx  &amp; (vr-&gt;size - 1);</div>
<div class="line">    <a class="code" href="rte__prefetch_8h.html#a7f89cf66766e6bfd63feb370a7280de9">rte_prefetch0</a>(&amp;vr-&gt;avail-&gt;ring[avail_idx]);</div>
<div class="line">    <a class="code" href="rte__prefetch_8h.html#a7f89cf66766e6bfd63feb370a7280de9">rte_prefetch0</a>(&amp;vr-&gt;used-&gt;ring[used_idx]);</div>
<div class="line"> </div>
<div class="line">    count = <a class="code" href="rte__common_8h.html#a4c7571cbcdbfe9b63431036af811bee9">RTE_MIN</a>(count, MAX_PKT_BURST);</div>
<div class="line">    count = <a class="code" href="rte__common_8h.html#a4c7571cbcdbfe9b63431036af811bee9">RTE_MIN</a>(count, free_entries);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(count == 0))</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Retrieve all of the head indexes first and pre-update used entries</span></div>
<div class="line"><span class="comment">     * to avoid caching issues.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; count; i++) {</div>
<div class="line">        avail_idx = (queue-&gt;last_avail_idx + i) &amp; (vr-&gt;size - 1);</div>
<div class="line">        used_idx  = (queue-&gt;last_used_idx  + i) &amp; (vr-&gt;size - 1);</div>
<div class="line">        desc_indexes[i] = vr-&gt;avail-&gt;ring[avail_idx];</div>
<div class="line"> </div>
<div class="line">        vr-&gt;used-&gt;ring[used_idx].id  = desc_indexes[i];</div>
<div class="line">        vr-&gt;used-&gt;ring[used_idx].len = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Prefetch descriptor index. */</span></div>
<div class="line">    <a class="code" href="rte__prefetch_8h.html#a7f89cf66766e6bfd63feb370a7280de9">rte_prefetch0</a>(&amp;vr-&gt;desc[desc_indexes[0]]);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; count; i++) {</div>
<div class="line">        <span class="keywordtype">int</span> err;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#a217a0bd562b98ae8c2ffce44935351e1">likely</a>(i + 1 &lt; count))</div>
<div class="line">            <a class="code" href="rte__prefetch_8h.html#a7f89cf66766e6bfd63feb370a7280de9">rte_prefetch0</a>(&amp;vr-&gt;desc[desc_indexes[i + 1]]);</div>
<div class="line"> </div>
<div class="line">        pkts[i] = <a class="code" href="rte__mbuf_8h.html#ad4d1c289d8cffc831dfb77c64f52447b">rte_pktmbuf_alloc</a>(mbuf_pool);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(pkts[i] == NULL)) {</div>
<div class="line">            <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, VHOST_DATA,</div>
<div class="line">                <span class="stringliteral">&quot;Failed to allocate memory for mbuf.\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        err = dequeue_pkt(dev, vr, pkts[i], desc_indexes[i], mbuf_pool);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(err)) {</div>
<div class="line">            <a name="a24"></a><a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(pkts[i]);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    queue-&gt;last_avail_idx += i;</div>
<div class="line">    queue-&gt;last_used_idx += i;</div>
<div class="line">    <a class="code" href="rte__atomic_8h.html#a7716c305b6c97f45a5d6c7239a7d30b4">rte_smp_wmb</a>();</div>
<div class="line">    <a name="a25"></a><a class="code" href="rte__atomic_8h.html#a99f889c9df3742cef62cbfe56ce28afe">rte_smp_rmb</a>();</div>
<div class="line"> </div>
<div class="line">    vr-&gt;used-&gt;idx += i;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__vhost_8h.html#aa2e00d8df9ee6d508aea6f807d0c09f3">rte_vhost_vring_call</a>(dev-&gt;vid, queue_id);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> i;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="astructrte__mbuf_html_ac858fb3bb1a1d67a6efc9563d0c5a471"><div class="ttname"><a href="structrte__mbuf.html#ac858fb3bb1a1d67a6efc9563d0c5a471">rte_mbuf::next</a></div><div class="ttdeci">struct rte_mbuf * next</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00594">rte_mbuf_core.h:594</a></div></div>
<div class="ttc" id="arte__vhost_8h_html"><div class="ttname"><a href="rte__vhost_8h.html">rte_vhost.h</a></div></div>
<div class="ttc" id="arte__prefetch_8h_html_a7f89cf66766e6bfd63feb370a7280de9"><div class="ttname"><a href="rte__prefetch_8h.html#a7f89cf66766e6bfd63feb370a7280de9">rte_prefetch0</a></div><div class="ttdeci">static void rte_prefetch0(const volatile void *p)</div></div>
<div class="ttc" id="arte__branch__prediction_8h_html_ac6c45889010c1bd68631771b64f18101"><div class="ttname"><a href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a></div><div class="ttdeci">#define unlikely(x)</div><div class="ttdef"><b>Definition:</b> <a href="rte__branch__prediction_8h_source.html#l00038">rte_branch_prediction.h:38</a></div></div>
<div class="ttc" id="arte__common_8h_html_af1e21922385a6cbe051e3ab70bba9f11"><div class="ttname"><a href="rte__common_8h.html#af1e21922385a6cbe051e3ab70bba9f11">__rte_always_inline</a></div><div class="ttdeci">#define __rte_always_inline</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00226">rte_common.h:226</a></div></div>
<div class="ttc" id="astructrte__mbuf_html_ad1a572736a10ff6b282c5f43c4ea1ccf"><div class="ttname"><a href="structrte__mbuf.html#ad1a572736a10ff6b282c5f43c4ea1ccf">rte_mbuf::data_len</a></div><div class="ttdeci">uint16_t data_len</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00546">rte_mbuf_core.h:546</a></div></div>
<div class="ttc" id="arte__memcpy_8h_html_a09f4d8cdb1a7c25398a363906e1db8cd"><div class="ttname"><a href="rte__memcpy_8h.html#a09f4d8cdb1a7c25398a363906e1db8cd">rte_memcpy</a></div><div class="ttdeci">static void * rte_memcpy(void *dst, const void *src, size_t n)</div></div>
<div class="ttc" id="astructrte__mbuf_html"><div class="ttname"><a href="structrte__mbuf.html">rte_mbuf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00473">rte_mbuf_core.h:473</a></div></div>
<div class="ttc" id="astructrte__mbuf_html_a7ae671bb1805f6f7313b9301aca17eb6"><div class="ttname"><a href="structrte__mbuf.html#a7ae671bb1805f6f7313b9301aca17eb6">rte_mbuf::buf_len</a></div><div class="ttdeci">uint16_t buf_len</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00587">rte_mbuf_core.h:587</a></div></div>
<div class="ttc" id="arte__mbuf__core_8h_html_ad63e1de0ec54d7c7603ea984c76ca956"><div class="ttname"><a href="rte__mbuf__core_8h.html#ad63e1de0ec54d7c7603ea984c76ca956">rte_pktmbuf_mtod_offset</a></div><div class="ttdeci">#define rte_pktmbuf_mtod_offset(m, t, o)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00711">rte_mbuf_core.h:711</a></div></div>
<div class="ttc" id="astructrte__mbuf_html_a44fb29a9283000c42a77b76e9ef0b070"><div class="ttname"><a href="structrte__mbuf.html#a44fb29a9283000c42a77b76e9ef0b070">rte_mbuf::nb_segs</a></div><div class="ttdeci">uint16_t nb_segs</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00498">rte_mbuf_core.h:498</a></div></div>
<div class="ttc" id="arte__atomic_8h_html_a99f889c9df3742cef62cbfe56ce28afe"><div class="ttname"><a href="rte__atomic_8h.html#a99f889c9df3742cef62cbfe56ce28afe">rte_smp_rmb</a></div><div class="ttdeci">static void rte_smp_rmb(void)</div></div>
<div class="ttc" id="arte__common_8h_html_a4c7571cbcdbfe9b63431036af811bee9"><div class="ttname"><a href="rte__common_8h.html#a4c7571cbcdbfe9b63431036af811bee9">RTE_MIN</a></div><div class="ttdeci">#define RTE_MIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00573">rte_common.h:573</a></div></div>
<div class="ttc" id="arte__vhost_8h_html_a07fe188216c6544b0b62baf911622c99"><div class="ttname"><a href="rte__vhost_8h.html#a07fe188216c6544b0b62baf911622c99">rte_vhost_get_vring_num</a></div><div class="ttdeci">uint16_t rte_vhost_get_vring_num(int vid)</div></div>
<div class="ttc" id="arte__vhost_8h_html_aa2e00d8df9ee6d508aea6f807d0c09f3"><div class="ttname"><a href="rte__vhost_8h.html#aa2e00d8df9ee6d508aea6f807d0c09f3">rte_vhost_vring_call</a></div><div class="ttdeci">int rte_vhost_vring_call(int vid, uint16_t vring_idx)</div></div>
<div class="ttc" id="arte__memcpy_8h_html"><div class="ttname"><a href="rte__memcpy_8h.html">rte_memcpy.h</a></div></div>
<div class="ttc" id="astructrte__mempool_html"><div class="ttname"><a href="structrte__mempool.html">rte_mempool</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l00207">rte_mempool.h:207</a></div></div>
<div class="ttc" id="arte__vhost_8h_html_a398c60c6b04e6eeaa72359b527661bc2"><div class="ttname"><a href="rte__vhost_8h.html#a398c60c6b04e6eeaa72359b527661bc2">rte_vhost_get_mem_table</a></div><div class="ttdeci">int rte_vhost_get_mem_table(int vid, struct rte_vhost_memory **mem)</div></div>
<div class="ttc" id="astructrte__mbuf_html_a5046af233a45d6d79ce1a5aae535b23c"><div class="ttname"><a href="structrte__mbuf.html#a5046af233a45d6d79ce1a5aae535b23c">rte_mbuf::pkt_len</a></div><div class="ttdeci">uint32_t pkt_len</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00545">rte_mbuf_core.h:545</a></div></div>
<div class="ttc" id="arte__mbuf_8h_html_a1215458932900b7cd5192326fa4a6902"><div class="ttname"><a href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a></div><div class="ttdeci">static void rte_pktmbuf_free(struct rte_mbuf *m)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf_8h_source.html#l01397">rte_mbuf.h:1397</a></div></div>
<div class="ttc" id="arte__vhost_8h_html_a2deb7d5116b92a1cc150c11e306fad98"><div class="ttname"><a href="rte__vhost_8h.html#a2deb7d5116b92a1cc150c11e306fad98">rte_vhost_va_from_guest_pa</a></div><div class="ttdeci">static __rte_experimental __rte_always_inline uint64_t rte_vhost_va_from_guest_pa(struct rte_vhost_memory *mem, uint64_t gpa, uint64_t *len)</div><div class="ttdef"><b>Definition:</b> <a href="rte__vhost_8h_source.html#l00346">rte_vhost.h:346</a></div></div>
<div class="ttc" id="arte__branch__prediction_8h_html_a217a0bd562b98ae8c2ffce44935351e1"><div class="ttname"><a href="rte__branch__prediction_8h.html#a217a0bd562b98ae8c2ffce44935351e1">likely</a></div><div class="ttdeci">#define likely(x)</div><div class="ttdef"><b>Definition:</b> <a href="rte__branch__prediction_8h_source.html#l00024">rte_branch_prediction.h:24</a></div></div>
<div class="ttc" id="arte__log_8h_html_ac23caeb9833fd0fd0665c6c05ec806fe"><div class="ttname"><a href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a></div><div class="ttdeci">#define RTE_LOG(l, t,...)</div><div class="ttdef"><b>Definition:</b> <a href="rte__log_8h_source.html#l00331">rte_log.h:331</a></div></div>
<div class="ttc" id="arte__mbuf_8h_html"><div class="ttname"><a href="rte__mbuf_8h.html">rte_mbuf.h</a></div></div>
<div class="ttc" id="arte__mbuf_8h_html_a2a1e1b30162161ed11d3ba2faf7bbf13"><div class="ttname"><a href="rte__mbuf_8h.html#a2a1e1b30162161ed11d3ba2faf7bbf13">rte_pktmbuf_data_len</a></div><div class="ttdeci">#define rte_pktmbuf_data_len(m)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf_8h_source.html#l01555">rte_mbuf.h:1555</a></div></div>
<div class="ttc" id="arte__atomic_8h_html_a7716c305b6c97f45a5d6c7239a7d30b4"><div class="ttname"><a href="rte__atomic_8h.html#a7716c305b6c97f45a5d6c7239a7d30b4">rte_smp_wmb</a></div><div class="ttdeci">static void rte_smp_wmb(void)</div></div>
<div class="ttc" id="arte__vhost_8h_html_a1c1fbdab537b4021941bab15e26b21f9"><div class="ttname"><a href="rte__vhost_8h.html#a1c1fbdab537b4021941bab15e26b21f9">rte_vhost_get_negotiated_features</a></div><div class="ttdeci">int rte_vhost_get_negotiated_features(int vid, uint64_t *features)</div></div>
<div class="ttc" id="arte__vhost_8h_html_a5891bd49d76cbe72ecfe2c87fc1fe853"><div class="ttname"><a href="rte__vhost_8h.html#a5891bd49d76cbe72ecfe2c87fc1fe853">rte_vhost_get_vhost_vring</a></div><div class="ttdeci">int rte_vhost_get_vhost_vring(int vid, uint16_t vring_idx, struct rte_vhost_vring *vring)</div></div>
<div class="ttc" id="arte__mbuf_8h_html_ad4d1c289d8cffc831dfb77c64f52447b"><div class="ttname"><a href="rte__mbuf_8h.html#ad4d1c289d8cffc831dfb77c64f52447b">rte_pktmbuf_alloc</a></div><div class="ttdeci">static struct rte_mbuf * rte_pktmbuf_alloc(struct rte_mempool *mp)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf_8h_source.html#l00892">rte_mbuf.h:892</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
