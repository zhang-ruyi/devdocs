<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DPDK: examples/l3fwd/l3fwd_event.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">20.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">examples/l3fwd/l3fwd_event.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/* SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><span class="comment"> * Copyright(C) 2019 Marvell International Ltd.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;l3fwd.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;l3fwd_event.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_ethaddr(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keyword">struct</span> <a name="_a0"></a><a class="code" href="structrte__ether__addr.html">rte_ether_addr</a> *eth_addr)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> buf[RTE_ETHER_ADDR_FMT_SIZE];</div>
<div class="line">    <a name="a1"></a><a class="code" href="rte__ether_8h.html#af5cfe384bccf79d966ae861ccdf34923">rte_ether_format_addr</a>(buf, RTE_ETHER_ADDR_FMT_SIZE, eth_addr);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s%s&quot;</span>, name, buf);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>l3fwd_event_resources *</div>
<div class="line">l3fwd_get_eventdev_rsrc(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">struct </span>l3fwd_event_resources *rsrc;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (rsrc != NULL)</div>
<div class="line">        <span class="keywordflow">return</span> rsrc;</div>
<div class="line"> </div>
<div class="line">    rsrc = <a name="a2"></a><a class="code" href="rte__malloc_8h.html#aaf0f048a5fd1672688c662cdfb4536b3">rte_zmalloc</a>(<span class="stringliteral">&quot;l3fwd&quot;</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> l3fwd_event_resources), 0);</div>
<div class="line">    <span class="keywordflow">if</span> (rsrc != NULL) {</div>
<div class="line">        rsrc-&gt;sched_type = <a name="a3"></a><a class="code" href="rte__eventdev_8h.html#a3c199a28e97411266a069bd07c9757fa">RTE_SCHED_TYPE_ATOMIC</a>;</div>
<div class="line">        rsrc-&gt;eth_rx_queues = 1;</div>
<div class="line">        <span class="keywordflow">return</span> rsrc;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a name="a4"></a><a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Unable to allocate memory for eventdev cfg\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">l3fwd_eth_dev_port_setup(<span class="keyword">struct</span> <a name="_a5"></a><a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> *port_conf)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>l3fwd_event_resources *evt_rsrc = l3fwd_get_eventdev_rsrc();</div>
<div class="line">    uint16_t nb_ports = <a name="a6"></a><a class="code" href="rte__ethdev_8h.html#a9ab708089665bebcd65cefe5383b24f2">rte_eth_dev_count_avail</a>();</div>
<div class="line">    uint16_t nb_rxd = RTE_TEST_RX_DESC_DEFAULT;</div>
<div class="line">    uint16_t nb_txd = RTE_TEST_TX_DESC_DEFAULT;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nb_lcores = <a name="a7"></a><a class="code" href="rte__lcore_8h.html#a1728dc7f14571ba778d3b5b41aa09283">rte_lcore_count</a>();</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> local_port_conf;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a8"></a><a class="code" href="structrte__eth__dev__info.html">rte_eth_dev_info</a> dev_info;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a9"></a><a class="code" href="structrte__eth__txconf.html">rte_eth_txconf</a> txconf;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a10"></a><a class="code" href="structrte__eth__rxconf.html">rte_eth_rxconf</a> rxconf;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nb_mbuf;</div>
<div class="line">    uint16_t port_id;</div>
<div class="line">    uint8_t eth_qid;</div>
<div class="line">    int32_t ret;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* initialize all ports */</span></div>
<div class="line">    <a name="a11"></a><a class="code" href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a>(port_id) {</div>
<div class="line">        local_port_conf = *port_conf;</div>
<div class="line">        <span class="comment">/* skip ports that are not enabled */</span></div>
<div class="line">        <span class="keywordflow">if</span> ((evt_rsrc-&gt;port_mask &amp; (1 &lt;&lt; port_id)) == 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;\nSkipping disabled port %d\n&quot;</span>, port_id);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* init port */</span></div>
<div class="line">        printf(<span class="stringliteral">&quot;Initializing port %d ... &quot;</span>, port_id);</div>
<div class="line">        fflush(stdout);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Creating queues: nb_rxq=%d nb_txq=1...\n&quot;</span>,</div>
<div class="line">               evt_rsrc-&gt;eth_rx_queues);</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a12"></a><a class="code" href="rte__ethdev_8h.html#a7593f4fff04f4ae1b1d718db7ca7dc8c">rte_eth_dev_info_get</a>(port_id, &amp;dev_info);</div>
<div class="line">        <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">            <a name="a13"></a><a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Error during getting device (port %u) info:&quot;</span></div>
<div class="line">                  <span class="stringliteral">&quot;%s\n&quot;</span>, port_id, strerror(-ret));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (dev_info.tx_offload_capa &amp; <a name="a14"></a><a class="code" href="rte__ethdev_8h.html#ae7110b5d5dced8f42505bff5d9e3f0ea">DEV_TX_OFFLOAD_MBUF_FAST_FREE</a>)</div>
<div class="line">            local_port_conf.txmode.offloads |=</div>
<div class="line">                        <a class="code" href="rte__ethdev_8h.html#ae7110b5d5dced8f42505bff5d9e3f0ea">DEV_TX_OFFLOAD_MBUF_FAST_FREE</a>;</div>
<div class="line"> </div>
<div class="line">        local_port_conf.rx_adv_conf.rss_conf.rss_hf &amp;=</div>
<div class="line">                        dev_info.flow_type_rss_offloads;</div>
<div class="line">        <span class="keywordflow">if</span> (local_port_conf.rx_adv_conf.rss_conf.rss_hf !=</div>
<div class="line">                port_conf-&gt;<a name="a15"></a><a class="code" href="structrte__eth__conf.html#a084e132696e8d0f59f643d822c8cedb7">rx_adv_conf</a>.<a name="a16"></a><a class="code" href="structrte__eth__conf.html#addc9c7bb19ed12f1171c543493553806">rss_conf</a>.<a name="a17"></a><a class="code" href="structrte__eth__rss__conf.html#ad70f17882a835e5d4e38c64a9f872fdc">rss_hf</a>) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Port %u modified RSS hash function &quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;based on hardware support,&quot;</span></div>
<div class="line">                   <span class="stringliteral">&quot;requested:%#&quot;</span>PRIx64<span class="stringliteral">&quot; configured:%#&quot;</span>PRIx64<span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">                   port_id,</div>
<div class="line">                   port_conf-&gt;<a class="code" href="structrte__eth__conf.html#a084e132696e8d0f59f643d822c8cedb7">rx_adv_conf</a>.<a class="code" href="structrte__eth__conf.html#addc9c7bb19ed12f1171c543493553806">rss_conf</a>.<a class="code" href="structrte__eth__rss__conf.html#ad70f17882a835e5d4e38c64a9f872fdc">rss_hf</a>,</div>
<div class="line">                   local_port_conf.rx_adv_conf.rss_conf.rss_hf);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a18"></a><a class="code" href="rte__ethdev_8h.html#a1a7d3a20b102fee222541fda50fd87bd">rte_eth_dev_configure</a>(port_id, evt_rsrc-&gt;eth_rx_queues,</div>
<div class="line">                        1, &amp;local_port_conf);</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                 <span class="stringliteral">&quot;Cannot configure device: err=%d, port=%d\n&quot;</span>,</div>
<div class="line">                 ret, port_id);</div>
<div class="line"> </div>
<div class="line">        ret = <a name="a19"></a><a class="code" href="rte__ethdev_8h.html#ad31219b87a1733d5b367a7c04c7f7b48">rte_eth_dev_adjust_nb_rx_tx_desc</a>(port_id, &amp;nb_rxd,</div>
<div class="line">                               &amp;nb_txd);</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                 <span class="stringliteral">&quot;Cannot adjust number of descriptors: err=%d, &quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;port=%d\n&quot;</span>, ret, port_id);</div>
<div class="line"> </div>
<div class="line">        <a name="a20"></a><a class="code" href="rte__ethdev_8h.html#a8a28375b279ded9125c99a46bf3956ef">rte_eth_macaddr_get</a>(port_id, &amp;ports_eth_addr[port_id]);</div>
<div class="line">        print_ethaddr(<span class="stringliteral">&quot; Address:&quot;</span>, &amp;ports_eth_addr[port_id]);</div>
<div class="line">        printf(<span class="stringliteral">&quot;, &quot;</span>);</div>
<div class="line">        print_ethaddr(<span class="stringliteral">&quot;Destination:&quot;</span>,</div>
<div class="line">            (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structrte__ether__addr.html">rte_ether_addr</a> *)&amp;dest_eth_addr[port_id]);</div>
<div class="line">        printf(<span class="stringliteral">&quot;, &quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* prepare source MAC for each port. */</span></div>
<div class="line">        <a name="a21"></a><a class="code" href="rte__ether_8h.html#af5e7040b36584eacec1c5b9eee086eac">rte_ether_addr_copy</a>(&amp;ports_eth_addr[port_id],</div>
<div class="line">            (<span class="keyword">struct</span> <a class="code" href="structrte__ether__addr.html">rte_ether_addr</a> *)(val_eth + port_id) + 1);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* init memory */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!evt_rsrc-&gt;per_port_pool) {</div>
<div class="line">            <span class="comment">/* port_id = 0; this is *not* signifying the first port,</span></div>
<div class="line"><span class="comment">             * rather, it signifies that port_id is ignored.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">            nb_mbuf = <a name="a22"></a><a class="code" href="rte__common_8h.html#a8df8b303b8ea240cf6aebf937fd21eaf">RTE_MAX</a>(nb_ports * nb_rxd +</div>
<div class="line">                      nb_ports * nb_txd +</div>
<div class="line">                      nb_ports * nb_lcores *</div>
<div class="line">                            MAX_PKT_BURST +</div>
<div class="line">                      nb_lcores * MEMPOOL_CACHE_SIZE,</div>
<div class="line">                      8192u);</div>
<div class="line">            ret = init_mem(0, nb_mbuf);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            nb_mbuf = <a class="code" href="rte__common_8h.html#a8df8b303b8ea240cf6aebf937fd21eaf">RTE_MAX</a>(nb_rxd + nb_rxd +</div>
<div class="line">                      nb_lcores * MAX_PKT_BURST +</div>
<div class="line">                      nb_lcores * MEMPOOL_CACHE_SIZE,</div>
<div class="line">                      8192u);</div>
<div class="line">            ret = init_mem(port_id, nb_mbuf);</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* init Rx queues per port */</span></div>
<div class="line">        rxconf = dev_info.default_rxconf;</div>
<div class="line">        rxconf.offloads = local_port_conf.rxmode.offloads;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (eth_qid = 0; eth_qid &lt; evt_rsrc-&gt;eth_rx_queues;</div>
<div class="line">             eth_qid++) {</div>
<div class="line">            <span class="keywordflow">if</span> (!evt_rsrc-&gt;per_port_pool)</div>
<div class="line">                ret = <a name="a23"></a><a class="code" href="rte__ethdev_8h.html#a36ba70a5a6fce2c2c1f774828ba78f8d">rte_eth_rx_queue_setup</a>(port_id, eth_qid,</div>
<div class="line">                    nb_rxd, 0, &amp;rxconf,</div>
<div class="line">                    evt_rsrc-&gt;pkt_pool[0][0]);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                ret = <a class="code" href="rte__ethdev_8h.html#a36ba70a5a6fce2c2c1f774828ba78f8d">rte_eth_rx_queue_setup</a>(port_id, eth_qid,</div>
<div class="line">                    nb_rxd, 0, &amp;rxconf,</div>
<div class="line">                    evt_rsrc-&gt;pkt_pool[port_id][0]);</div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">                <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                     <span class="stringliteral">&quot;rte_eth_rx_queue_setup: err=%d, &quot;</span></div>
<div class="line">                     <span class="stringliteral">&quot;port=%d, eth_qid: %d\n&quot;</span>,</div>
<div class="line">                     ret, port_id, eth_qid);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* init one Tx queue per port */</span></div>
<div class="line">        txconf = dev_info.default_txconf;</div>
<div class="line">        txconf.offloads = local_port_conf.txmode.offloads;</div>
<div class="line">        ret = <a name="a24"></a><a class="code" href="rte__ethdev_8h.html#a796c2f20778984c6f41b271e36bae50e">rte_eth_tx_queue_setup</a>(port_id, 0, nb_txd, 0, &amp;txconf);</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                 <span class="stringliteral">&quot;rte_eth_tx_queue_setup: err=%d, &quot;</span></div>
<div class="line">                 <span class="stringliteral">&quot;port=%d\n&quot;</span>, ret, port_id);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">l3fwd_event_capability_setup(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>l3fwd_event_resources *evt_rsrc = l3fwd_get_eventdev_rsrc();</div>
<div class="line">    uint32_t caps = 0;</div>
<div class="line">    uint16_t i;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a>(i) {</div>
<div class="line">        ret = <a name="a25"></a><a class="code" href="rte__eventdev_8h.html#ad147297659da4017ff8a8cec1757548c">rte_event_eth_tx_adapter_caps_get</a>(0, i, &amp;caps);</div>
<div class="line">        <span class="keywordflow">if</span> (ret)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                 <span class="stringliteral">&quot;Invalid capability for Tx adptr port %d\n&quot;</span>,</div>
<div class="line">                 i);</div>
<div class="line"> </div>
<div class="line">        evt_rsrc-&gt;tx_mode_q |= !(caps &amp;</div>
<div class="line">                   <a name="a26"></a><a class="code" href="rte__eventdev_8h.html#a3b6c6cbdc5b9091cc561ab38983be324">RTE_EVENT_ETH_TX_ADAPTER_CAP_INTERNAL_PORT</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (evt_rsrc-&gt;tx_mode_q)</div>
<div class="line">        l3fwd_event_set_generic_ops(&amp;evt_rsrc-&gt;ops);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        l3fwd_event_set_internal_port_ops(&amp;evt_rsrc-&gt;ops);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">l3fwd_get_free_event_port(<span class="keyword">struct</span> l3fwd_event_resources *evt_rsrc)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">int</span> index;</div>
<div class="line">    <span class="keywordtype">int</span> port_id;</div>
<div class="line"> </div>
<div class="line">    <a name="a27"></a><a class="code" href="rte__spinlock_8h.html#a9f1f7a431c1012f0276fa5f7d859f9f2">rte_spinlock_lock</a>(&amp;evt_rsrc-&gt;evp.lock);</div>
<div class="line">    <span class="keywordflow">if</span> (index &gt;= evt_rsrc-&gt;evp.nb_ports) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;No free event port is available\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    port_id = evt_rsrc-&gt;evp.event_p_id[index];</div>
<div class="line">    index++;</div>
<div class="line">    <a name="a28"></a><a class="code" href="rte__spinlock_8h.html#a5fa3ccaf4263c07a99bea375384f21d8">rte_spinlock_unlock</a>(&amp;evt_rsrc-&gt;evp.lock);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> port_id;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">l3fwd_event_resource_setup(<span class="keyword">struct</span> <a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> *port_conf)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>l3fwd_event_resources *evt_rsrc = l3fwd_get_eventdev_rsrc();</div>
<div class="line">    <span class="keyword">const</span> event_loop_cb lpm_event_loop[2][2] = {</div>
<div class="line">        [0][0] = lpm_event_main_loop_tx_d,</div>
<div class="line">        [0][1] = lpm_event_main_loop_tx_d_burst,</div>
<div class="line">        [1][0] = lpm_event_main_loop_tx_q,</div>
<div class="line">        [1][1] = lpm_event_main_loop_tx_q_burst,</div>
<div class="line">    };</div>
<div class="line">    <span class="keyword">const</span> event_loop_cb em_event_loop[2][2] = {</div>
<div class="line">        [0][0] = em_event_main_loop_tx_d,</div>
<div class="line">        [0][1] = em_event_main_loop_tx_d_burst,</div>
<div class="line">        [1][0] = em_event_main_loop_tx_q,</div>
<div class="line">        [1][1] = em_event_main_loop_tx_q_burst,</div>
<div class="line">    };</div>
<div class="line">    uint32_t event_queue_cfg;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!evt_rsrc-&gt;enabled)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!<a name="a29"></a><a class="code" href="rte__eventdev_8h.html#a6541eb8822285c7b77455636201d5134">rte_event_dev_count</a>())</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;No Eventdev found&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Setup eventdev capability callbacks */</span></div>
<div class="line">    l3fwd_event_capability_setup();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Ethernet device configuration */</span></div>
<div class="line">    l3fwd_eth_dev_port_setup(port_conf);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Event device configuration */</span></div>
<div class="line">    event_queue_cfg = evt_rsrc-&gt;ops.event_device_setup();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Event queue configuration */</span></div>
<div class="line">    evt_rsrc-&gt;ops.event_queue_setup(event_queue_cfg);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Event port configuration */</span></div>
<div class="line">    evt_rsrc-&gt;ops.event_port_setup();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Rx/Tx adapters configuration */</span></div>
<div class="line">    evt_rsrc-&gt;ops.adapter_setup();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Start event device */</span></div>
<div class="line">    ret = <a name="a30"></a><a class="code" href="rte__eventdev_8h.html#ab6e99f06a45adaa095b257b93ebaf201">rte_event_dev_start</a>(evt_rsrc-&gt;event_d_id);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Error in starting eventdev&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    evt_rsrc-&gt;ops.lpm_event_loop = lpm_event_loop[evt_rsrc-&gt;tx_mode_q]</div>
<div class="line">                               [evt_rsrc-&gt;has_burst];</div>
<div class="line"> </div>
<div class="line">    evt_rsrc-&gt;ops.em_event_loop = em_event_loop[evt_rsrc-&gt;tx_mode_q]</div>
<div class="line">                               [evt_rsrc-&gt;has_burst];</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="arte__common_8h_html_a8df8b303b8ea240cf6aebf937fd21eaf"><div class="ttname"><a href="rte__common_8h.html#a8df8b303b8ea240cf6aebf937fd21eaf">RTE_MAX</a></div><div class="ttdeci">#define RTE_MAX(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00583">rte_common.h:583</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ad31219b87a1733d5b367a7c04c7f7b48"><div class="ttname"><a href="rte__ethdev_8h.html#ad31219b87a1733d5b367a7c04c7f7b48">rte_eth_dev_adjust_nb_rx_tx_desc</a></div><div class="ttdeci">int rte_eth_dev_adjust_nb_rx_tx_desc(uint16_t port_id, uint16_t *nb_rx_desc, uint16_t *nb_tx_desc)</div></div>
<div class="ttc" id="arte__eventdev_8h_html_ad147297659da4017ff8a8cec1757548c"><div class="ttname"><a href="rte__eventdev_8h.html#ad147297659da4017ff8a8cec1757548c">rte_event_eth_tx_adapter_caps_get</a></div><div class="ttdeci">int rte_event_eth_tx_adapter_caps_get(uint8_t dev_id, uint16_t eth_port_id, uint32_t *caps)</div></div>
<div class="ttc" id="arte__malloc_8h_html_aaf0f048a5fd1672688c662cdfb4536b3"><div class="ttname"><a href="rte__malloc_8h.html#aaf0f048a5fd1672688c662cdfb4536b3">rte_zmalloc</a></div><div class="ttdeci">void * rte_zmalloc(const char *type, size_t size, unsigned align) __rte_alloc_size(2)</div></div>
<div class="ttc" id="arte__spinlock_8h_html_a9f1f7a431c1012f0276fa5f7d859f9f2"><div class="ttname"><a href="rte__spinlock_8h.html#a9f1f7a431c1012f0276fa5f7d859f9f2">rte_spinlock_lock</a></div><div class="ttdeci">static void rte_spinlock_lock(rte_spinlock_t *sl)</div></div>
<div class="ttc" id="arte__malloc_8h_html"><div class="ttname"><a href="rte__malloc_8h.html">rte_malloc.h</a></div></div>
<div class="ttc" id="astructrte__eth__rxconf_html"><div class="ttname"><a href="structrte__eth__rxconf.html">rte_eth_rxconf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01032">rte_ethdev.h:1032</a></div></div>
<div class="ttc" id="arte__ether_8h_html_af5cfe384bccf79d966ae861ccdf34923"><div class="ttname"><a href="rte__ether_8h.html#af5cfe384bccf79d966ae861ccdf34923">rte_ether_format_addr</a></div><div class="ttdeci">void rte_ether_format_addr(char *buf, uint16_t size, const struct rte_ether_addr *eth_addr)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a796c2f20778984c6f41b271e36bae50e"><div class="ttname"><a href="rte__ethdev_8h.html#a796c2f20778984c6f41b271e36bae50e">rte_eth_tx_queue_setup</a></div><div class="ttdeci">int rte_eth_tx_queue_setup(uint16_t port_id, uint16_t tx_queue_id, uint16_t nb_tx_desc, unsigned int socket_id, const struct rte_eth_txconf *tx_conf)</div></div>
<div class="ttc" id="astructrte__eth__txconf_html"><div class="ttname"><a href="structrte__eth__txconf.html">rte_eth_txconf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01060">rte_ethdev.h:1060</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a1a7d3a20b102fee222541fda50fd87bd"><div class="ttname"><a href="rte__ethdev_8h.html#a1a7d3a20b102fee222541fda50fd87bd">rte_eth_dev_configure</a></div><div class="ttdeci">int rte_eth_dev_configure(uint16_t port_id, uint16_t nb_rx_queue, uint16_t nb_tx_queue, const struct rte_eth_conf *eth_conf)</div></div>
<div class="ttc" id="arte__spinlock_8h_html_a5fa3ccaf4263c07a99bea375384f21d8"><div class="ttname"><a href="rte__spinlock_8h.html#a5fa3ccaf4263c07a99bea375384f21d8">rte_spinlock_unlock</a></div><div class="ttdeci">static void rte_spinlock_unlock(rte_spinlock_t *sl)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a7593f4fff04f4ae1b1d718db7ca7dc8c"><div class="ttname"><a href="rte__ethdev_8h.html#a7593f4fff04f4ae1b1d718db7ca7dc8c">rte_eth_dev_info_get</a></div><div class="ttdeci">int rte_eth_dev_info_get(uint16_t port_id, struct rte_eth_dev_info *dev_info)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a8a28375b279ded9125c99a46bf3956ef"><div class="ttname"><a href="rte__ethdev_8h.html#a8a28375b279ded9125c99a46bf3956ef">rte_eth_macaddr_get</a></div><div class="ttdeci">int rte_eth_macaddr_get(uint16_t port_id, struct rte_ether_addr *mac_addr)</div></div>
<div class="ttc" id="arte__common_8h_html_ac5169870c983b3463cb226bdb8a94880"><div class="ttname"><a href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a></div><div class="ttdeci">__rte_noreturn void rte_exit(int exit_code, const char *format,...) __rte_format_printf(2</div></div>
<div class="ttc" id="arte__lcore_8h_html_a1728dc7f14571ba778d3b5b41aa09283"><div class="ttname"><a href="rte__lcore_8h.html#a1728dc7f14571ba778d3b5b41aa09283">rte_lcore_count</a></div><div class="ttdeci">unsigned int rte_lcore_count(void)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_ae7110b5d5dced8f42505bff5d9e3f0ea"><div class="ttname"><a href="rte__ethdev_8h.html#ae7110b5d5dced8f42505bff5d9e3f0ea">DEV_TX_OFFLOAD_MBUF_FAST_FREE</a></div><div class="ttdeci">#define DEV_TX_OFFLOAD_MBUF_FAST_FREE</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01401">rte_ethdev.h:1397</a></div></div>
<div class="ttc" id="astructrte__eth__rss__conf_html_ad70f17882a835e5d4e38c64a9f872fdc"><div class="ttname"><a href="structrte__eth__rss__conf.html#ad70f17882a835e5d4e38c64a9f872fdc">rte_eth_rss_conf::rss_hf</a></div><div class="ttdeci">uint64_t rss_hf</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00457">rte_ethdev.h:457</a></div></div>
<div class="ttc" id="arte__ether_8h_html_af5e7040b36584eacec1c5b9eee086eac"><div class="ttname"><a href="rte__ether_8h.html#af5e7040b36584eacec1c5b9eee086eac">rte_ether_addr_copy</a></div><div class="ttdeci">static void rte_ether_addr_copy(const struct rte_ether_addr *__restrict ea_from, struct rte_ether_addr *__restrict ea_to)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00222">rte_ether.h:222</a></div></div>
<div class="ttc" id="arte__eventdev_8h_html_a6541eb8822285c7b77455636201d5134"><div class="ttname"><a href="rte__eventdev_8h.html#a6541eb8822285c7b77455636201d5134">rte_event_dev_count</a></div><div class="ttdeci">uint8_t rte_event_dev_count(void)</div></div>
<div class="ttc" id="arte__eventdev_8h_html_a3b6c6cbdc5b9091cc561ab38983be324"><div class="ttname"><a href="rte__eventdev_8h.html#a3b6c6cbdc5b9091cc561ab38983be324">RTE_EVENT_ETH_TX_ADAPTER_CAP_INTERNAL_PORT</a></div><div class="ttdeci">#define RTE_EVENT_ETH_TX_ADAPTER_CAP_INTERNAL_PORT</div><div class="ttdef"><b>Definition:</b> <a href="rte__eventdev_8h_source.html#l01225">rte_eventdev.h:1223</a></div></div>
<div class="ttc" id="arte__debug_8h_html_a9fcab5683ce1c1164c52c17579cc2b5f"><div class="ttname"><a href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a></div><div class="ttdeci">#define rte_panic(...)</div><div class="ttdef"><b>Definition:</b> <a href="rte__debug_8h_source.html#l00043">rte_debug.h:43</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a9ab708089665bebcd65cefe5383b24f2"><div class="ttname"><a href="rte__ethdev_8h.html#a9ab708089665bebcd65cefe5383b24f2">rte_eth_dev_count_avail</a></div><div class="ttdeci">uint16_t rte_eth_dev_count_avail(void)</div></div>
<div class="ttc" id="arte__eventdev_8h_html_ab6e99f06a45adaa095b257b93ebaf201"><div class="ttname"><a href="rte__eventdev_8h.html#ab6e99f06a45adaa095b257b93ebaf201">rte_event_dev_start</a></div><div class="ttdeci">int rte_event_dev_start(uint8_t dev_id)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a36ba70a5a6fce2c2c1f774828ba78f8d"><div class="ttname"><a href="rte__ethdev_8h.html#a36ba70a5a6fce2c2c1f774828ba78f8d">rte_eth_rx_queue_setup</a></div><div class="ttdeci">int rte_eth_rx_queue_setup(uint16_t port_id, uint16_t rx_queue_id, uint16_t nb_rx_desc, unsigned int socket_id, const struct rte_eth_rxconf *rx_conf, struct rte_mempool *mb_pool)</div></div>
<div class="ttc" id="astructrte__eth__conf_html_addc9c7bb19ed12f1171c543493553806"><div class="ttname"><a href="structrte__eth__conf.html#addc9c7bb19ed12f1171c543493553806">rte_eth_conf::rss_conf</a></div><div class="ttdeci">struct rte_eth_rss_conf rss_conf</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01327">rte_ethdev.h:1309</a></div></div>
<div class="ttc" id="arte__eventdev_8h_html_a3c199a28e97411266a069bd07c9757fa"><div class="ttname"><a href="rte__eventdev_8h.html#a3c199a28e97411266a069bd07c9757fa">RTE_SCHED_TYPE_ATOMIC</a></div><div class="ttdeci">#define RTE_SCHED_TYPE_ATOMIC</div><div class="ttdef"><b>Definition:</b> <a href="rte__eventdev_8h_source.html#l00961">rte_eventdev.h:944</a></div></div>
<div class="ttc" id="astructrte__eth__conf_html_a084e132696e8d0f59f643d822c8cedb7"><div class="ttname"><a href="structrte__eth__conf.html#a084e132696e8d0f59f643d822c8cedb7">rte_eth_conf::rx_adv_conf</a></div><div class="ttdeci">struct rte_eth_conf::@153 rx_adv_conf</div></div>
<div class="ttc" id="astructrte__eth__dev__info_html"><div class="ttname"><a href="structrte__eth__dev__info.html">rte_eth_dev_info</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01504">rte_ethdev.h:1504</a></div></div>
<div class="ttc" id="astructrte__ether__addr_html"><div class="ttname"><a href="structrte__ether__addr.html">rte_ether_addr</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00064">rte_ether.h:64</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ad7b46c67203d37fe3a34f11076d970d6"><div class="ttname"><a href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a></div><div class="ttdeci">#define RTE_ETH_FOREACH_DEV(p)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01858">rte_ethdev.h:1858</a></div></div>
<div class="ttc" id="astructrte__eth__conf_html"><div class="ttname"><a href="structrte__eth__conf.html">rte_eth_conf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01293">rte_ethdev.h:1293</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
