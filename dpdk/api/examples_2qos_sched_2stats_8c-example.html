<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DPDK: examples/qos_sched/stats.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">20.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">examples/qos_sched/stats.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/* SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><span class="comment"> * Copyright(c) 2010-2014 Intel Corporation</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;main.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">qavg_q(uint16_t port_id, uint32_t subport_id, uint32_t pipe_id, uint8_t tc,</div>
<div class="line">        uint8_t q)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a0"></a><a class="code" href="structrte__sched__queue__stats.html">rte_sched_queue_stats</a> stats;</div>
<div class="line">    <span class="keyword">struct </span>rte_sched_port *port;</div>
<div class="line">    uint16_t qlen;</div>
<div class="line">    uint32_t count, i, queue_id = 0;</div>
<div class="line">    uint32_t average;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_pfc; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (qos_conf[i].tx_port == port_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (i == nb_pfc ||</div>
<div class="line">        subport_id &gt;= port_params.n_subports_per_port ||</div>
<div class="line">        pipe_id &gt;= subport_params[subport_id].n_pipes_per_subport_enabled  ||</div>
<div class="line">        tc &gt;= <a name="a1"></a><a class="code" href="rte__sched_8h.html#a987eaedb9cd05abdbdb1bf30ed446ac1">RTE_SCHED_TRAFFIC_CLASSES_PER_PIPE</a> ||</div>
<div class="line">        q &gt;= <a name="a2"></a><a class="code" href="rte__sched_8h.html#ad30bb3bc9bb7531556d7866882135642">RTE_SCHED_BE_QUEUES_PER_PIPE</a> ||</div>
<div class="line">        (tc &lt; RTE_SCHED_TRAFFIC_CLASS_BE &amp;&amp; q &gt; 0))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    port = qos_conf[i].sched_port;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; subport_id; i++)</div>
<div class="line">        queue_id += subport_params[i].n_pipes_per_subport_enabled *</div>
<div class="line">                <a name="a3"></a><a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (tc &lt; <a name="a4"></a><a class="code" href="rte__sched_8h.html#ac6dfaecb361763814043497dc152cc1d">RTE_SCHED_TRAFFIC_CLASS_BE</a>)</div>
<div class="line">        queue_id += pipe_id * <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a> + tc;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        queue_id += pipe_id * <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a> + tc + q;</div>
<div class="line"> </div>
<div class="line">    average = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (count = 0; count &lt; qavg_ntimes; count++) {</div>
<div class="line">        <a name="a5"></a><a class="code" href="rte__sched_8h.html#ac732e88980d2146219696389fb210c93">rte_sched_queue_read_stats</a>(port, queue_id, &amp;stats, &amp;qlen);</div>
<div class="line">        average += qlen;</div>
<div class="line">        usleep(qavg_period);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    average /= qavg_ntimes;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\nAverage queue size: %&quot;</span> PRIu32 <span class="stringliteral">&quot; bytes.\n\n&quot;</span>, average);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">qavg_tcpipe(uint16_t port_id, uint32_t subport_id, uint32_t pipe_id,</div>
<div class="line">        uint8_t tc)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__sched__queue__stats.html">rte_sched_queue_stats</a> stats;</div>
<div class="line">    <span class="keyword">struct </span>rte_sched_port *port;</div>
<div class="line">    uint16_t qlen;</div>
<div class="line">    uint32_t count, i, queue_id = 0;</div>
<div class="line">    uint32_t average, part_average;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_pfc; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (qos_conf[i].tx_port == port_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (i == nb_pfc || subport_id &gt;= port_params.n_subports_per_port ||</div>
<div class="line">        pipe_id &gt;= subport_params[subport_id].n_pipes_per_subport_enabled ||</div>
<div class="line">        tc &gt;= <a class="code" href="rte__sched_8h.html#a987eaedb9cd05abdbdb1bf30ed446ac1">RTE_SCHED_TRAFFIC_CLASSES_PER_PIPE</a>)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    port = qos_conf[i].sched_port;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; subport_id; i++)</div>
<div class="line">        queue_id +=</div>
<div class="line">            subport_params[i].n_pipes_per_subport_enabled *</div>
<div class="line">            <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>;</div>
<div class="line"> </div>
<div class="line">    queue_id += pipe_id * <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a> + tc;</div>
<div class="line"> </div>
<div class="line">    average = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (count = 0; count &lt; qavg_ntimes; count++) {</div>
<div class="line">        part_average = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (tc &lt; <a class="code" href="rte__sched_8h.html#ac6dfaecb361763814043497dc152cc1d">RTE_SCHED_TRAFFIC_CLASS_BE</a>) {</div>
<div class="line">            <a class="code" href="rte__sched_8h.html#ac732e88980d2146219696389fb210c93">rte_sched_queue_read_stats</a>(port, queue_id,</div>
<div class="line">                &amp;stats, &amp;qlen);</div>
<div class="line">            part_average += qlen;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="rte__sched_8h.html#ad30bb3bc9bb7531556d7866882135642">RTE_SCHED_BE_QUEUES_PER_PIPE</a>; i++) {</div>
<div class="line">                <a class="code" href="rte__sched_8h.html#ac732e88980d2146219696389fb210c93">rte_sched_queue_read_stats</a>(port, queue_id + i,</div>
<div class="line">                    &amp;stats, &amp;qlen);</div>
<div class="line">                part_average += qlen;</div>
<div class="line">            }</div>
<div class="line">            average += part_average / <a class="code" href="rte__sched_8h.html#ad30bb3bc9bb7531556d7866882135642">RTE_SCHED_BE_QUEUES_PER_PIPE</a>;</div>
<div class="line">        }</div>
<div class="line">        usleep(qavg_period);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    average /= qavg_ntimes;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\nAverage queue size: %&quot;</span> PRIu32 <span class="stringliteral">&quot; bytes.\n\n&quot;</span>, average);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">qavg_pipe(uint16_t port_id, uint32_t subport_id, uint32_t pipe_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__sched__queue__stats.html">rte_sched_queue_stats</a> stats;</div>
<div class="line">    <span class="keyword">struct </span>rte_sched_port *port;</div>
<div class="line">    uint16_t qlen;</div>
<div class="line">    uint32_t count, i, queue_id = 0;</div>
<div class="line">    uint32_t average, part_average;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_pfc; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (qos_conf[i].tx_port == port_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (i == nb_pfc ||</div>
<div class="line">        subport_id &gt;= port_params.n_subports_per_port ||</div>
<div class="line">        pipe_id &gt;= subport_params[subport_id].n_pipes_per_subport_enabled)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    port = qos_conf[i].sched_port;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; subport_id; i++)</div>
<div class="line">        queue_id += subport_params[i].n_pipes_per_subport_enabled *</div>
<div class="line">                <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>;</div>
<div class="line"> </div>
<div class="line">    queue_id += pipe_id * <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>;</div>
<div class="line"> </div>
<div class="line">    average = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (count = 0; count &lt; qavg_ntimes; count++) {</div>
<div class="line">        part_average = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>; i++) {</div>
<div class="line">            <a class="code" href="rte__sched_8h.html#ac732e88980d2146219696389fb210c93">rte_sched_queue_read_stats</a>(port, queue_id + i,</div>
<div class="line">                &amp;stats, &amp;qlen);</div>
<div class="line">            part_average += qlen;</div>
<div class="line">        }</div>
<div class="line">        average += part_average / <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>;</div>
<div class="line">        usleep(qavg_period);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    average /= qavg_ntimes;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\nAverage queue size: %&quot;</span> PRIu32 <span class="stringliteral">&quot; bytes.\n\n&quot;</span>, average);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">qavg_tcsubport(uint16_t port_id, uint32_t subport_id, uint8_t tc)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__sched__queue__stats.html">rte_sched_queue_stats</a> stats;</div>
<div class="line">    <span class="keyword">struct </span>rte_sched_port *port;</div>
<div class="line">    uint16_t qlen;</div>
<div class="line">    uint32_t queue_id, count, i, j, subport_queue_id = 0;</div>
<div class="line">    uint32_t average, part_average;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_pfc; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (qos_conf[i].tx_port == port_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (i == nb_pfc ||</div>
<div class="line">        subport_id &gt;= port_params.n_subports_per_port ||</div>
<div class="line">        tc &gt;= <a class="code" href="rte__sched_8h.html#a987eaedb9cd05abdbdb1bf30ed446ac1">RTE_SCHED_TRAFFIC_CLASSES_PER_PIPE</a>)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    port = qos_conf[i].sched_port;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; subport_id; i++)</div>
<div class="line">        subport_queue_id +=</div>
<div class="line">            subport_params[i].n_pipes_per_subport_enabled *</div>
<div class="line">            <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>;</div>
<div class="line"> </div>
<div class="line">    average = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (count = 0; count &lt; qavg_ntimes; count++) {</div>
<div class="line">        uint32_t n_pipes_per_subport =</div>
<div class="line">            subport_params[subport_id].n_pipes_per_subport_enabled;</div>
<div class="line"> </div>
<div class="line">        part_average = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; n_pipes_per_subport; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (tc &lt; <a class="code" href="rte__sched_8h.html#ac6dfaecb361763814043497dc152cc1d">RTE_SCHED_TRAFFIC_CLASS_BE</a>) {</div>
<div class="line">                queue_id = subport_queue_id +</div>
<div class="line">                    i * <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a> + tc;</div>
<div class="line">                <a class="code" href="rte__sched_8h.html#ac732e88980d2146219696389fb210c93">rte_sched_queue_read_stats</a>(port, queue_id,</div>
<div class="line">                    &amp;stats, &amp;qlen);</div>
<div class="line">                part_average += qlen;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="rte__sched_8h.html#ad30bb3bc9bb7531556d7866882135642">RTE_SCHED_BE_QUEUES_PER_PIPE</a>; j++) {</div>
<div class="line">                    queue_id = subport_queue_id +</div>
<div class="line">                            i * <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a> +</div>
<div class="line">                            tc + j;</div>
<div class="line">                    <a class="code" href="rte__sched_8h.html#ac732e88980d2146219696389fb210c93">rte_sched_queue_read_stats</a>(port, queue_id,</div>
<div class="line">                        &amp;stats, &amp;qlen);</div>
<div class="line">                    part_average += qlen;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (tc &lt; <a class="code" href="rte__sched_8h.html#ac6dfaecb361763814043497dc152cc1d">RTE_SCHED_TRAFFIC_CLASS_BE</a>)</div>
<div class="line">            average += part_average /</div>
<div class="line">                (subport_params[subport_id].n_pipes_per_subport_enabled);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            average += part_average /</div>
<div class="line">                (subport_params[subport_id].n_pipes_per_subport_enabled) *</div>
<div class="line">                <a class="code" href="rte__sched_8h.html#ad30bb3bc9bb7531556d7866882135642">RTE_SCHED_BE_QUEUES_PER_PIPE</a>;</div>
<div class="line"> </div>
<div class="line">        usleep(qavg_period);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    average /= qavg_ntimes;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\nAverage queue size: %&quot;</span> PRIu32 <span class="stringliteral">&quot; bytes.\n\n&quot;</span>, average);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">qavg_subport(uint16_t port_id, uint32_t subport_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__sched__queue__stats.html">rte_sched_queue_stats</a> stats;</div>
<div class="line">    <span class="keyword">struct </span>rte_sched_port *port;</div>
<div class="line">    uint16_t qlen;</div>
<div class="line">    uint32_t queue_id, count, i, j, subport_queue_id = 0;</div>
<div class="line">    uint32_t average, part_average;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_pfc; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (qos_conf[i].tx_port == port_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (i == nb_pfc ||</div>
<div class="line">        subport_id &gt;= port_params.n_subports_per_port)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    port = qos_conf[i].sched_port;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; subport_id; i++)</div>
<div class="line">        subport_queue_id += subport_params[i].n_pipes_per_subport_enabled *</div>
<div class="line">            <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>;</div>
<div class="line"> </div>
<div class="line">    average = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (count = 0; count &lt; qavg_ntimes; count++) {</div>
<div class="line">        uint32_t n_pipes_per_subport =</div>
<div class="line">            subport_params[subport_id].n_pipes_per_subport_enabled;</div>
<div class="line"> </div>
<div class="line">        part_average = 0;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; n_pipes_per_subport; i++) {</div>
<div class="line">            queue_id = subport_queue_id + i * <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>; j++) {</div>
<div class="line">                <a class="code" href="rte__sched_8h.html#ac732e88980d2146219696389fb210c93">rte_sched_queue_read_stats</a>(port, queue_id + j,</div>
<div class="line">                    &amp;stats, &amp;qlen);</div>
<div class="line">                part_average += qlen;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        average += part_average /</div>
<div class="line">            (subport_params[subport_id].n_pipes_per_subport_enabled *</div>
<div class="line">            <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>);</div>
<div class="line">        usleep(qavg_period);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    average /= qavg_ntimes;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\nAverage queue size: %&quot;</span> PRIu32 <span class="stringliteral">&quot; bytes.\n\n&quot;</span>, average);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">subport_stat(uint16_t port_id, uint32_t subport_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a6"></a><a class="code" href="structrte__sched__subport__stats.html">rte_sched_subport_stats</a> stats;</div>
<div class="line">    <span class="keyword">struct </span>rte_sched_port *port;</div>
<div class="line">    uint32_t tc_ov[<a class="code" href="rte__sched_8h.html#a987eaedb9cd05abdbdb1bf30ed446ac1">RTE_SCHED_TRAFFIC_CLASSES_PER_PIPE</a>];</div>
<div class="line">    uint8_t i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_pfc; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (qos_conf[i].tx_port == port_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (i == nb_pfc || subport_id &gt;= port_params.n_subports_per_port)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    port = qos_conf[i].sched_port;</div>
<div class="line">    memset(tc_ov, 0, <span class="keyword">sizeof</span>(tc_ov));</div>
<div class="line"> </div>
<div class="line">    <a name="a7"></a><a class="code" href="rte__sched_8h.html#a9df7d9f13f9945d315733ed0939508ea">rte_sched_subport_read_stats</a>(port, subport_id, &amp;stats, tc_ov);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;+----+-------------+-------------+-------------+-------------+-------------+\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;| TC |   Pkts OK   |Pkts Dropped |  Bytes OK   |Bytes Dropped|  OV Status  |\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;+----+-------------+-------------+-------------+-------------+-------------+\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="rte__sched_8h.html#a987eaedb9cd05abdbdb1bf30ed446ac1">RTE_SCHED_TRAFFIC_CLASSES_PER_PIPE</a>; i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;|  %d | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11&quot;</span> PRIu32 <span class="stringliteral">&quot; |\n&quot;</span>,</div>
<div class="line">            i, stats.n_pkts_tc[i], stats.n_pkts_tc_dropped[i],</div>
<div class="line">        stats.n_bytes_tc[i], stats.n_bytes_tc_dropped[i], tc_ov[i]);</div>
<div class="line">        printf(<span class="stringliteral">&quot;+----+-------------+-------------+-------------+-------------+-------------+\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">pipe_stat(uint16_t port_id, uint32_t subport_id, uint32_t pipe_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__sched__queue__stats.html">rte_sched_queue_stats</a> stats;</div>
<div class="line">    <span class="keyword">struct </span>rte_sched_port *port;</div>
<div class="line">    uint16_t qlen;</div>
<div class="line">    uint8_t i, j;</div>
<div class="line">    uint32_t queue_id = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_pfc; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (qos_conf[i].tx_port == port_id)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (i == nb_pfc ||</div>
<div class="line">        subport_id &gt;= port_params.n_subports_per_port ||</div>
<div class="line">        pipe_id &gt;= subport_params[subport_id].n_pipes_per_subport_enabled)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    port = qos_conf[i].sched_port;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; subport_id; i++)</div>
<div class="line">        queue_id += subport_params[i].n_pipes_per_subport_enabled *</div>
<div class="line">            <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>;</div>
<div class="line"> </div>
<div class="line">    queue_id += pipe_id * <a class="code" href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a>;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;+----+-------+-------------+-------------+-------------+-------------+-------------+\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;| TC | Queue |   Pkts OK   |Pkts Dropped |  Bytes OK   |Bytes Dropped|    Length   |\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;+----+-------+-------------+-------------+-------------+-------------+-------------+\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="rte__sched_8h.html#a987eaedb9cd05abdbdb1bf30ed446ac1">RTE_SCHED_TRAFFIC_CLASSES_PER_PIPE</a>; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (i &lt; <a class="code" href="rte__sched_8h.html#ac6dfaecb361763814043497dc152cc1d">RTE_SCHED_TRAFFIC_CLASS_BE</a>) {</div>
<div class="line">            <a class="code" href="rte__sched_8h.html#ac732e88980d2146219696389fb210c93">rte_sched_queue_read_stats</a>(port, queue_id + i, &amp;stats, &amp;qlen);</div>
<div class="line">            printf(<span class="stringliteral">&quot;|  %d |   %d   | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11i |\n&quot;</span>,</div>
<div class="line">                i, 0, stats.n_pkts, stats.n_pkts_dropped, stats.n_bytes,</div>
<div class="line">                stats.n_bytes_dropped, qlen);</div>
<div class="line">            printf(<span class="stringliteral">&quot;+----+-------+-------------+-------------+-------------+-------------+-------------+\n&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="rte__sched_8h.html#ad30bb3bc9bb7531556d7866882135642">RTE_SCHED_BE_QUEUES_PER_PIPE</a>; j++) {</div>
<div class="line">                <a class="code" href="rte__sched_8h.html#ac732e88980d2146219696389fb210c93">rte_sched_queue_read_stats</a>(port, queue_id + i + j,</div>
<div class="line">                    &amp;stats, &amp;qlen);</div>
<div class="line">                printf(<span class="stringliteral">&quot;|  %d |   %d   | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11&quot;</span> PRIu64 <span class="stringliteral">&quot; | %11i |\n&quot;</span>,</div>
<div class="line">                    i, j, stats.n_pkts, stats.n_pkts_dropped, stats.n_bytes,</div>
<div class="line">                    stats.n_bytes_dropped, qlen);</div>
<div class="line">                printf(<span class="stringliteral">&quot;+----+-------+-------------+-------------+-------------+-------------+-------------+\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="arte__sched_8h_html_ad30bb3bc9bb7531556d7866882135642"><div class="ttname"><a href="rte__sched_8h.html#ad30bb3bc9bb7531556d7866882135642">RTE_SCHED_BE_QUEUES_PER_PIPE</a></div><div class="ttdeci">#define RTE_SCHED_BE_QUEUES_PER_PIPE</div><div class="ttdef"><b>Definition:</b> <a href="rte__sched_8h_source.html#l00083">rte_sched.h:83</a></div></div>
<div class="ttc" id="arte__sched_8h_html_a21bfcaf525e24b9b562a80a894e33245"><div class="ttname"><a href="rte__sched_8h.html#a21bfcaf525e24b9b562a80a894e33245">RTE_SCHED_QUEUES_PER_PIPE</a></div><div class="ttdeci">#define RTE_SCHED_QUEUES_PER_PIPE</div><div class="ttdef"><b>Definition:</b> <a href="rte__sched_8h_source.html#l00077">rte_sched.h:77</a></div></div>
<div class="ttc" id="astructrte__sched__subport__stats_html"><div class="ttname"><a href="structrte__sched__subport__stats.html">rte_sched_subport_stats</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__sched_8h_source.html#l00198">rte_sched.h:198</a></div></div>
<div class="ttc" id="astructrte__sched__queue__stats_html"><div class="ttname"><a href="structrte__sched__queue__stats.html">rte_sched_queue_stats</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__sched_8h_source.html#l00218">rte_sched.h:218</a></div></div>
<div class="ttc" id="arte__sched_8h_html_ac6dfaecb361763814043497dc152cc1d"><div class="ttname"><a href="rte__sched_8h.html#ac6dfaecb361763814043497dc152cc1d">RTE_SCHED_TRAFFIC_CLASS_BE</a></div><div class="ttdeci">#define RTE_SCHED_TRAFFIC_CLASS_BE</div><div class="ttdef"><b>Definition:</b> <a href="rte__sched_8h_source.html#l00095">rte_sched.h:95</a></div></div>
<div class="ttc" id="arte__sched_8h_html_ac732e88980d2146219696389fb210c93"><div class="ttname"><a href="rte__sched_8h.html#ac732e88980d2146219696389fb210c93">rte_sched_queue_read_stats</a></div><div class="ttdeci">int rte_sched_queue_read_stats(struct rte_sched_port *port, uint32_t queue_id, struct rte_sched_queue_stats *stats, uint16_t *qlen)</div></div>
<div class="ttc" id="arte__sched_8h_html_a987eaedb9cd05abdbdb1bf30ed446ac1"><div class="ttname"><a href="rte__sched_8h.html#a987eaedb9cd05abdbdb1bf30ed446ac1">RTE_SCHED_TRAFFIC_CLASSES_PER_PIPE</a></div><div class="ttdeci">#define RTE_SCHED_TRAFFIC_CLASSES_PER_PIPE</div><div class="ttdef"><b>Definition:</b> <a href="rte__sched_8h_source.html#l00089">rte_sched.h:89</a></div></div>
<div class="ttc" id="arte__sched_8h_html_a9df7d9f13f9945d315733ed0939508ea"><div class="ttname"><a href="rte__sched_8h.html#a9df7d9f13f9945d315733ed0939508ea">rte_sched_subport_read_stats</a></div><div class="ttdeci">int rte_sched_subport_read_stats(struct rte_sched_port *port, uint32_t subport_id, struct rte_sched_subport_stats *stats, uint32_t *tc_ov)</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
