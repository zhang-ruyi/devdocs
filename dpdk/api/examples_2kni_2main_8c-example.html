<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DPDK: examples/kni/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">20.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">examples/kni/main.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/* SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><span class="comment"> * Copyright(c) 2010-2014 Intel Corporation</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/queue.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdarg.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;linux/if.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;linux/if_tun.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__common_8h.html">rte_common.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__log_8h.html">rte_log.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__memory_8h.html">rte_memory.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__memcpy_8h.html">rte_memcpy.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__eal_8h.html">rte_eal.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__per__lcore_8h.html">rte_per_lcore.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__launch_8h.html">rte_launch.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__atomic_8h.html">rte_atomic.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__lcore_8h.html">rte_lcore.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__branch__prediction_8h.html">rte_branch_prediction.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__interrupts_8h.html">rte_interrupts.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;rte_bus_pci.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__debug_8h.html">rte_debug.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ether_8h.html">rte_ether.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ethdev_8h.html">rte_ethdev.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__mempool_8h.html">rte_mempool.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__mbuf_8h.html">rte_mbuf.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__string__fns_8h.html">rte_string_fns.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__cycles_8h.html">rte_cycles.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__kni_8h.html">rte_kni.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Macros for printing using RTE_LOG */</span></div>
<div class="line"><span class="preprocessor">#define RTE_LOGTYPE_APP RTE_LOGTYPE_USER1</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Max size of a single packet */</span></div>
<div class="line"><span class="preprocessor">#define MAX_PACKET_SZ           2048</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Size of the data buffer in each mbuf */</span></div>
<div class="line"><span class="preprocessor">#define MBUF_DATA_SZ (MAX_PACKET_SZ + RTE_PKTMBUF_HEADROOM)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Number of mbufs in mempool that is created */</span></div>
<div class="line"><span class="preprocessor">#define NB_MBUF                 (8192 * 16)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* How many packets to attempt to read from NIC in one go */</span></div>
<div class="line"><span class="preprocessor">#define PKT_BURST_SZ            32</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* How many objects (mbufs) to keep in per-lcore mempool cache */</span></div>
<div class="line"><span class="preprocessor">#define MEMPOOL_CACHE_SZ        PKT_BURST_SZ</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Number of RX ring descriptors */</span></div>
<div class="line"><span class="preprocessor">#define NB_RXD                  1024</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Number of TX ring descriptors */</span></div>
<div class="line"><span class="preprocessor">#define NB_TXD                  1024</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Total octets in ethernet header */</span></div>
<div class="line"><span class="preprocessor">#define KNI_ENET_HEADER_SIZE    14</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Total octets in the FCS */</span></div>
<div class="line"><span class="preprocessor">#define KNI_ENET_FCS_SIZE       4</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define KNI_US_PER_SECOND       1000000</span></div>
<div class="line"><span class="preprocessor">#define KNI_SECOND_PER_DAY      86400</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define KNI_MAX_KTHREAD 32</span></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Structure of port parameters</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">struct </span>kni_port_params {</div>
<div class="line">    uint16_t port_id;<span class="comment">/* Port ID */</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> lcore_rx; <span class="comment">/* lcore ID for RX */</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> lcore_tx; <span class="comment">/* lcore ID for TX */</span></div>
<div class="line">    uint32_t nb_lcore_k; <span class="comment">/* Number of lcores for KNI multi kernel threads */</span></div>
<div class="line">    uint32_t nb_kni; <span class="comment">/* Number of KNI devices to be created */</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> lcore_k[KNI_MAX_KTHREAD]; <span class="comment">/* lcore ID list for kthreads */</span></div>
<div class="line">    <span class="keyword">struct </span>rte_kni *kni[KNI_MAX_KTHREAD]; <span class="comment">/* KNI context pointers */</span></div>
<div class="line">} <a name="a0"></a><a class="code" href="rte__common_8h.html#a38e32f822bc941e90fdcbe5a9c69b178">__rte_cache_aligned</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>kni_port_params *kni_port_params_array[RTE_MAX_ETHPORTS];</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Options for configuring ethernet port */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a name="_a1"></a><a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> port_conf = {</div>
<div class="line">    .<a name="a2"></a><a class="code" href="structrte__eth__conf.html#a1c33c9d2e5cdb14b62ed386bf3159e07">txmode</a> = {</div>
<div class="line">        .<a name="a3"></a><a class="code" href="structrte__eth__txmode.html#aac4d1eaef063383b937a1d568412b4ce">mq_mode</a> = <a name="a4"></a><a class="code" href="rte__ethdev_8h.html#a4834f572f4dd4e46d81ad09b7d5fffd5aada568551470d5f419cd2f3d6b6bfedc">ETH_MQ_TX_NONE</a>,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Mempool for mbufs */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a name="_a5"></a><a class="code" href="structrte__mempool.html">rte_mempool</a> * pktmbuf_pool = NULL;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Mask of enabled ports */</span></div>
<div class="line"><span class="keyword">static</span> uint32_t ports_mask = 0;</div>
<div class="line"><span class="comment">/* Ports set in promiscuous mode off by default. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> promiscuous_on = 0;</div>
<div class="line"><span class="comment">/* Monitor link status continually. off by default. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> monitor_links;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Structure type for recording kni interface specific stats */</span></div>
<div class="line"><span class="keyword">struct </span>kni_interface_stats {</div>
<div class="line">    <span class="comment">/* number of pkts received from NIC, and sent to KNI */</span></div>
<div class="line">    uint64_t rx_packets;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* number of pkts received from NIC, but failed to send to KNI */</span></div>
<div class="line">    uint64_t rx_dropped;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* number of pkts received from KNI, and sent to NIC */</span></div>
<div class="line">    uint64_t tx_packets;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* number of pkts received from KNI, but failed to send to NIC */</span></div>
<div class="line">    uint64_t tx_dropped;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* kni device statistics array */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>kni_interface_stats kni_stats[RTE_MAX_ETHPORTS];</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> kni_change_mtu(uint16_t port_id, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_mtu);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> kni_config_network_interface(uint16_t port_id, uint8_t if_up);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> kni_config_mac_address(uint16_t port_id, uint8_t mac_addr[]);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a name="_a6"></a><a class="code" href="structrte__atomic32__t.html">rte_atomic32_t</a> kni_stop = <a name="a7"></a><a class="code" href="rte__atomic_8h.html#ad314fd28492e349e70ddf9b270234a63">RTE_ATOMIC32_INIT</a>(0);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structrte__atomic32__t.html">rte_atomic32_t</a> kni_pause = <a class="code" href="rte__atomic_8h.html#ad314fd28492e349e70ddf9b270234a63">RTE_ATOMIC32_INIT</a>(0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Print out statistics on packets handled */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_stats(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint16_t i;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\n**KNI example application statistics**\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;======  ==============  ============  ============  ============  ============\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot; Port    Lcore(RX/TX)    rx_packets    rx_dropped    tx_packets    tx_dropped\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;------  --------------  ------------  ------------  ------------  ------------\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_MAX_ETHPORTS; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (!kni_port_params_array[i])</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;%7d %10u/%2u %13&quot;</span>PRIu64<span class="stringliteral">&quot; %13&quot;</span>PRIu64<span class="stringliteral">&quot; %13&quot;</span>PRIu64<span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                            <span class="stringliteral">&quot;%13&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>, i,</div>
<div class="line">                    kni_port_params_array[i]-&gt;lcore_rx,</div>
<div class="line">                    kni_port_params_array[i]-&gt;lcore_tx,</div>
<div class="line">                        kni_stats[i].rx_packets,</div>
<div class="line">                        kni_stats[i].rx_dropped,</div>
<div class="line">                        kni_stats[i].tx_packets,</div>
<div class="line">                        kni_stats[i].tx_dropped);</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;======  ==============  ============  ============  ============  ============\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    fflush(stdout);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Custom handling of signals to handle stats and kni processing */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">signal_handler(<span class="keywordtype">int</span> signum)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* When we receive a USR1 signal, print stats */</span></div>
<div class="line">    <span class="keywordflow">if</span> (signum == SIGUSR1) {</div>
<div class="line">        print_stats();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* When we receive a USR2 signal, reset stats */</span></div>
<div class="line">    <span class="keywordflow">if</span> (signum == SIGUSR2) {</div>
<div class="line">        memset(&amp;kni_stats, 0, <span class="keyword">sizeof</span>(kni_stats));</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n** Statistics have been reset **\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * When we receive a RTMIN or SIGINT or SIGTERM signal,</span></div>
<div class="line"><span class="comment">     * stop kni processing</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keywordflow">if</span> (signum == SIGRTMIN || signum == SIGINT || signum == SIGTERM) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;\nSIGRTMIN/SIGINT/SIGTERM received. &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;KNI processing stopping.\n&quot;</span>);</div>
<div class="line">        <a name="a8"></a><a class="code" href="rte__atomic_8h.html#a76fa947d23bc1aac76f70641cad255a7">rte_atomic32_inc</a>(&amp;kni_stop);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">kni_burst_free_mbufs(<span class="keyword">struct</span> <a name="_a9"></a><a class="code" href="structrte__mbuf.html">rte_mbuf</a> **pkts, <span class="keywordtype">unsigned</span> num)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (pkts == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; num; i++) {</div>
<div class="line">        <a name="a10"></a><a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(pkts[i]);</div>
<div class="line">        pkts[i] = NULL;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">kni_ingress(<span class="keyword">struct</span> kni_port_params *p)</div>
<div class="line">{</div>
<div class="line">    uint8_t i;</div>
<div class="line">    uint16_t port_id;</div>
<div class="line">    <span class="keywordtype">unsigned</span> nb_rx, num;</div>
<div class="line">    uint32_t nb_kni;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *pkts_burst[PKT_BURST_SZ];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    nb_kni = p-&gt;nb_kni;</div>
<div class="line">    port_id = p-&gt;port_id;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_kni; i++) {</div>
<div class="line">        <span class="comment">/* Burst rx from eth */</span></div>
<div class="line">        nb_rx = <a name="a11"></a><a class="code" href="rte__ethdev_8h.html#a3e7d76a451b46348686ea97d6367f102">rte_eth_rx_burst</a>(port_id, 0, pkts_burst, PKT_BURST_SZ);</div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a12"></a><a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(nb_rx &gt; PKT_BURST_SZ)) {</div>
<div class="line">            <a name="a13"></a><a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Error receiving from eth\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* Burst tx to kni */</span></div>
<div class="line">        num = <a name="a14"></a><a class="code" href="rte__kni_8h.html#ae470743959cbf73648b242d9f7270b02">rte_kni_tx_burst</a>(p-&gt;kni[i], pkts_burst, nb_rx);</div>
<div class="line">        <span class="keywordflow">if</span> (num)</div>
<div class="line">            kni_stats[port_id].rx_packets += num;</div>
<div class="line"> </div>
<div class="line">        <a name="a15"></a><a class="code" href="rte__kni_8h.html#acd52d6e1e302e3bb87de6d786b3c5cc1">rte_kni_handle_request</a>(p-&gt;kni[i]);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(num &lt; nb_rx)) {</div>
<div class="line">            <span class="comment">/* Free mbufs not tx to kni interface */</span></div>
<div class="line">            kni_burst_free_mbufs(&amp;pkts_burst[num], nb_rx - num);</div>
<div class="line">            kni_stats[port_id].rx_dropped += nb_rx - num;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">kni_egress(<span class="keyword">struct</span> kni_port_params *p)</div>
<div class="line">{</div>
<div class="line">    uint8_t i;</div>
<div class="line">    uint16_t port_id;</div>
<div class="line">    <span class="keywordtype">unsigned</span> nb_tx, num;</div>
<div class="line">    uint32_t nb_kni;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *pkts_burst[PKT_BURST_SZ];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    nb_kni = p-&gt;nb_kni;</div>
<div class="line">    port_id = p-&gt;port_id;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_kni; i++) {</div>
<div class="line">        <span class="comment">/* Burst rx from kni */</span></div>
<div class="line">        num = <a name="a16"></a><a class="code" href="rte__kni_8h.html#a0cdd727cdc227d005fef22c0189f3dfe">rte_kni_rx_burst</a>(p-&gt;kni[i], pkts_burst, PKT_BURST_SZ);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(num &gt; PKT_BURST_SZ)) {</div>
<div class="line">            <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Error receiving from KNI\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* Burst tx to eth */</span></div>
<div class="line">        nb_tx = <a name="a17"></a><a class="code" href="rte__ethdev_8h.html#a83e56cabbd31637efd648e3fc010392b">rte_eth_tx_burst</a>(port_id, 0, pkts_burst, (uint16_t)num);</div>
<div class="line">        <span class="keywordflow">if</span> (nb_tx)</div>
<div class="line">            kni_stats[port_id].tx_packets += nb_tx;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(nb_tx &lt; num)) {</div>
<div class="line">            <span class="comment">/* Free mbufs not tx to NIC */</span></div>
<div class="line">            kni_burst_free_mbufs(&amp;pkts_burst[nb_tx], num - nb_tx);</div>
<div class="line">            kni_stats[port_id].tx_dropped += num - nb_tx;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">main_loop(<a name="a18"></a><a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    uint16_t i;</div>
<div class="line">    int32_t f_stop;</div>
<div class="line">    int32_t f_pause;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> lcore_id = <a name="a19"></a><a class="code" href="rte__lcore_8h.html#adfb2b334e7e73f534f25e8888a8a775f">rte_lcore_id</a>();</div>
<div class="line">    <span class="keyword">enum</span> lcore_rxtx {</div>
<div class="line">        LCORE_NONE,</div>
<div class="line">        LCORE_RX,</div>
<div class="line">        LCORE_TX,</div>
<div class="line">        LCORE_MAX</div>
<div class="line">    };</div>
<div class="line">    <span class="keyword">enum</span> lcore_rxtx flag = LCORE_NONE;</div>
<div class="line"> </div>
<div class="line">    <a name="a20"></a><a class="code" href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a>(i) {</div>
<div class="line">        <span class="keywordflow">if</span> (!kni_port_params_array[i])</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (kni_port_params_array[i]-&gt;lcore_rx == (uint8_t)lcore_id) {</div>
<div class="line">            flag = LCORE_RX;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (kni_port_params_array[i]-&gt;lcore_tx ==</div>
<div class="line">                        (uint8_t)lcore_id) {</div>
<div class="line">            flag = LCORE_TX;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (flag == LCORE_RX) {</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;Lcore %u is reading from port %d\n&quot;</span>,</div>
<div class="line">                    kni_port_params_array[i]-&gt;lcore_rx,</div>
<div class="line">                    kni_port_params_array[i]-&gt;port_id);</div>
<div class="line">        <span class="keywordflow">while</span> (1) {</div>
<div class="line">            f_stop = <a name="a21"></a><a class="code" href="rte__atomic_8h.html#ab3041cc6a6a379e14e76dfcb61bec152">rte_atomic32_read</a>(&amp;kni_stop);</div>
<div class="line">            f_pause = <a class="code" href="rte__atomic_8h.html#ab3041cc6a6a379e14e76dfcb61bec152">rte_atomic32_read</a>(&amp;kni_pause);</div>
<div class="line">            <span class="keywordflow">if</span> (f_stop)</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">if</span> (f_pause)</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            kni_ingress(kni_port_params_array[i]);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flag == LCORE_TX) {</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;Lcore %u is writing to port %d\n&quot;</span>,</div>
<div class="line">                    kni_port_params_array[i]-&gt;lcore_tx,</div>
<div class="line">                    kni_port_params_array[i]-&gt;port_id);</div>
<div class="line">        <span class="keywordflow">while</span> (1) {</div>
<div class="line">            f_stop = <a class="code" href="rte__atomic_8h.html#ab3041cc6a6a379e14e76dfcb61bec152">rte_atomic32_read</a>(&amp;kni_stop);</div>
<div class="line">            f_pause = <a class="code" href="rte__atomic_8h.html#ab3041cc6a6a379e14e76dfcb61bec152">rte_atomic32_read</a>(&amp;kni_pause);</div>
<div class="line">            <span class="keywordflow">if</span> (f_stop)</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">if</span> (f_pause)</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            kni_egress(kni_port_params_array[i]);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span></div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;Lcore %u has nothing to do\n&quot;</span>, lcore_id);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Display usage instructions */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_usage(<span class="keyword">const</span> <span class="keywordtype">char</span> *prgname)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;\nUsage: %s [EAL options] -- -p PORTMASK -P -m &quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;[--config (port,lcore_rx,lcore_tx,lcore_kthread...)&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;[,(port,lcore_rx,lcore_tx,lcore_kthread...)]]\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;    -p PORTMASK: hex bitmask of ports to use\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;    -P : enable promiscuous mode\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;    -m : enable monitoring of port carrier state\n&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;    --config (port,lcore_rx,lcore_tx,lcore_kthread...): &quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;port and lcore configurations\n&quot;</span>,</div>
<div class="line">               prgname);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Convert string to unsigned number. 0 is returned if error occurs */</span></div>
<div class="line"><span class="keyword">static</span> uint32_t</div>
<div class="line">parse_unsigned(<span class="keyword">const</span> <span class="keywordtype">char</span> *portmask)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> num;</div>
<div class="line"> </div>
<div class="line">    num = strtoul(portmask, &amp;end, 16);</div>
<div class="line">    <span class="keywordflow">if</span> ((portmask[0] == <span class="charliteral">&#39;\0&#39;</span>) || (end == NULL) || (*end != <span class="charliteral">&#39;\0&#39;</span>))</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (uint32_t)num;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_config(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint32_t i, j;</div>
<div class="line">    <span class="keyword">struct </span>kni_port_params **p = kni_port_params_array;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_MAX_ETHPORTS; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (!p[i])</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(DEBUG, APP, <span class="stringliteral">&quot;Port ID: %d\n&quot;</span>, p[i]-&gt;port_id);</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(DEBUG, APP, <span class="stringliteral">&quot;Rx lcore ID: %u, Tx lcore ID: %u\n&quot;</span>,</div>
<div class="line">                    p[i]-&gt;lcore_rx, p[i]-&gt;lcore_tx);</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; p[i]-&gt;nb_lcore_k; j++)</div>
<div class="line">            <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(DEBUG, APP, <span class="stringliteral">&quot;Kernel thread lcore ID: %u\n&quot;</span>,</div>
<div class="line">                            p[i]-&gt;lcore_k[j]);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parse_config(<span class="keyword">const</span> <span class="keywordtype">char</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *p, *p0 = arg;</div>
<div class="line">    <span class="keywordtype">char</span> s[256], *end;</div>
<div class="line">    <span class="keywordtype">unsigned</span> size;</div>
<div class="line">    <span class="keyword">enum</span> fieldnames {</div>
<div class="line">        FLD_PORT = 0,</div>
<div class="line">        FLD_LCORE_RX,</div>
<div class="line">        FLD_LCORE_TX,</div>
<div class="line">        _NUM_FLD = KNI_MAX_KTHREAD + 3,</div>
<div class="line">    };</div>
<div class="line">    <span class="keywordtype">int</span> i, j, nb_token;</div>
<div class="line">    <span class="keywordtype">char</span> *str_fld[_NUM_FLD];</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> int_fld[_NUM_FLD];</div>
<div class="line">    uint16_t port_id, nb_kni_port_params = 0;</div>
<div class="line"> </div>
<div class="line">    memset(&amp;kni_port_params_array, 0, <span class="keyword">sizeof</span>(kni_port_params_array));</div>
<div class="line">    <span class="keywordflow">while</span> (((p = strchr(p0, <span class="charliteral">&#39;(&#39;</span>)) != NULL) &amp;&amp;</div>
<div class="line">        nb_kni_port_params &lt; RTE_MAX_ETHPORTS) {</div>
<div class="line">        p++;</div>
<div class="line">        <span class="keywordflow">if</span> ((p0 = strchr(p, <span class="charliteral">&#39;)&#39;</span>)) == NULL)</div>
<div class="line">            <span class="keywordflow">goto</span> fail;</div>
<div class="line">        size = p0 - p;</div>
<div class="line">        <span class="keywordflow">if</span> (size &gt;= <span class="keyword">sizeof</span>(s)) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Invalid config parameters\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">goto</span> fail;</div>
<div class="line">        }</div>
<div class="line">        snprintf(s, <span class="keyword">sizeof</span>(s), <span class="stringliteral">&quot;%.*s&quot;</span>, size, p);</div>
<div class="line">        nb_token = <a name="a22"></a><a class="code" href="rte__string__fns_8h.html#af3ffc4e2ca821bc44f7fd08afbfe3638">rte_strsplit</a>(s, <span class="keyword">sizeof</span>(s), str_fld, _NUM_FLD, <span class="charliteral">&#39;,&#39;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (nb_token &lt;= FLD_LCORE_TX) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Invalid config parameters\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">goto</span> fail;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; nb_token; i++) {</div>
<div class="line">            errno = 0;</div>
<div class="line">            int_fld[i] = strtoul(str_fld[i], &amp;end, 0);</div>
<div class="line">            <span class="keywordflow">if</span> (errno != 0 || end == str_fld[i]) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid config parameters\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> fail;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        i = 0;</div>
<div class="line">        port_id = int_fld[i++];</div>
<div class="line">        <span class="keywordflow">if</span> (port_id &gt;= RTE_MAX_ETHPORTS) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Port ID %d could not exceed the maximum %d\n&quot;</span>,</div>
<div class="line">                        port_id, RTE_MAX_ETHPORTS);</div>
<div class="line">            <span class="keywordflow">goto</span> fail;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (kni_port_params_array[port_id]) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Port %d has been configured\n&quot;</span>, port_id);</div>
<div class="line">            <span class="keywordflow">goto</span> fail;</div>
<div class="line">        }</div>
<div class="line">        kni_port_params_array[port_id] =</div>
<div class="line">            <a name="a23"></a><a class="code" href="rte__malloc_8h.html#aaf0f048a5fd1672688c662cdfb4536b3">rte_zmalloc</a>(<span class="stringliteral">&quot;KNI_port_params&quot;</span>,</div>
<div class="line">                    <span class="keyword">sizeof</span>(<span class="keyword">struct</span> kni_port_params), RTE_CACHE_LINE_SIZE);</div>
<div class="line">        kni_port_params_array[port_id]-&gt;port_id = port_id;</div>
<div class="line">        kni_port_params_array[port_id]-&gt;lcore_rx =</div>
<div class="line">                    (uint8_t)int_fld[i++];</div>
<div class="line">        kni_port_params_array[port_id]-&gt;lcore_tx =</div>
<div class="line">                    (uint8_t)int_fld[i++];</div>
<div class="line">        <span class="keywordflow">if</span> (kni_port_params_array[port_id]-&gt;lcore_rx &gt;= RTE_MAX_LCORE ||</div>
<div class="line">        kni_port_params_array[port_id]-&gt;lcore_tx &gt;= RTE_MAX_LCORE) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;lcore_rx %u or lcore_tx %u ID could not &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;exceed the maximum %u\n&quot;</span>,</div>
<div class="line">                kni_port_params_array[port_id]-&gt;lcore_rx,</div>
<div class="line">                kni_port_params_array[port_id]-&gt;lcore_tx,</div>
<div class="line">                        (<span class="keywordtype">unsigned</span>)RTE_MAX_LCORE);</div>
<div class="line">            <span class="keywordflow">goto</span> fail;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; i &lt; nb_token &amp;&amp; j &lt; KNI_MAX_KTHREAD; i++, j++)</div>
<div class="line">            kni_port_params_array[port_id]-&gt;lcore_k[j] =</div>
<div class="line">                        (uint8_t)int_fld[i];</div>
<div class="line">        kni_port_params_array[port_id]-&gt;nb_lcore_k = j;</div>
<div class="line">    }</div>
<div class="line">    print_config();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">fail:</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_MAX_ETHPORTS; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (kni_port_params_array[i]) {</div>
<div class="line">            <a name="a24"></a><a class="code" href="rte__malloc_8h.html#a1fc82f67711b13aca7e05dc9d58f9dbd">rte_free</a>(kni_port_params_array[i]);</div>
<div class="line">            kni_port_params_array[i] = NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">validate_parameters(uint32_t portmask)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!portmask) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;No port configured in port mask\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_MAX_ETHPORTS; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (((portmask &amp; (1 &lt;&lt; i)) &amp;&amp; !kni_port_params_array[i]) ||</div>
<div class="line">            (!(portmask &amp; (1 &lt;&lt; i)) &amp;&amp; kni_port_params_array[i]))</div>
<div class="line">            <a name="a25"></a><a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;portmask is not consistent &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;to port ids specified in --config\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (kni_port_params_array[i] &amp;&amp; !<a name="a26"></a><a class="code" href="rte__lcore_8h.html#a5404ee6ac26cbe5a4f4ddef44d690b76">rte_lcore_is_enabled</a>(\</div>
<div class="line">            (<span class="keywordtype">unsigned</span>)(kni_port_params_array[i]-&gt;lcore_rx)))</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;lcore id %u for &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;port %d receiving not enabled\n&quot;</span>,</div>
<div class="line">                    kni_port_params_array[i]-&gt;lcore_rx,</div>
<div class="line">                    kni_port_params_array[i]-&gt;port_id);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (kni_port_params_array[i] &amp;&amp; !<a class="code" href="rte__lcore_8h.html#a5404ee6ac26cbe5a4f4ddef44d690b76">rte_lcore_is_enabled</a>(\</div>
<div class="line">            (<span class="keywordtype">unsigned</span>)(kni_port_params_array[i]-&gt;lcore_tx)))</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;lcore id %u for &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;port %d transmitting not enabled\n&quot;</span>,</div>
<div class="line">                    kni_port_params_array[i]-&gt;lcore_tx,</div>
<div class="line">                    kni_port_params_array[i]-&gt;port_id);</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define CMDLINE_OPT_CONFIG  &quot;config&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Parse the arguments given in the command line of the application */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parse_args(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> opt, longindex, ret = 0;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *prgname = argv[0];</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">struct </span>option longopts[] = {</div>
<div class="line">        {CMDLINE_OPT_CONFIG, required_argument, NULL, 0},</div>
<div class="line">        {NULL, 0, NULL, 0}</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Disable printing messages within getopt() */</span></div>
<div class="line">    opterr = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Parse command line */</span></div>
<div class="line">    <span class="keywordflow">while</span> ((opt = getopt_long(argc, argv, <span class="stringliteral">&quot;p:Pm&quot;</span>, longopts,</div>
<div class="line">                        &amp;longindex)) != EOF) {</div>
<div class="line">        <span class="keywordflow">switch</span> (opt) {</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div>
<div class="line">            ports_mask = parse_unsigned(optarg);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;P&#39;</span>:</div>
<div class="line">            promiscuous_on = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div>
<div class="line">            monitor_links = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">            <span class="keywordflow">if</span> (!strncmp(longopts[longindex].name,</div>
<div class="line">                     CMDLINE_OPT_CONFIG,</div>
<div class="line">                     <span class="keyword">sizeof</span>(CMDLINE_OPT_CONFIG))) {</div>
<div class="line">                ret = parse_config(optarg);</div>
<div class="line">                <span class="keywordflow">if</span> (ret) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Invalid config\n&quot;</span>);</div>
<div class="line">                    print_usage(prgname);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            print_usage(prgname);</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Invalid option specified\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Check that options were parsed ok */</span></div>
<div class="line">    <span class="keywordflow">if</span> (validate_parameters(ports_mask) &lt; 0) {</div>
<div class="line">        print_usage(prgname);</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Invalid parameters\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Initialize KNI subsystem */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">init_kni(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_of_kni_ports = 0, i;</div>
<div class="line">    <span class="keyword">struct </span>kni_port_params **params = kni_port_params_array;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Calculate the maximum number of KNI interfaces that will be used */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_MAX_ETHPORTS; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (kni_port_params_array[i]) {</div>
<div class="line">            num_of_kni_ports += (params[i]-&gt;nb_lcore_k ?</div>
<div class="line">                params[i]-&gt;nb_lcore_k : 1);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Invoke rte KNI init to preallocate the ports */</span></div>
<div class="line">    <a name="a27"></a><a class="code" href="rte__kni_8h.html#a2553989d30dbaf1b2681e1b145ae7af5">rte_kni_init</a>(num_of_kni_ports);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Initialise a single port on an Ethernet device */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">init_port(uint16_t port)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line">    uint16_t nb_rxd = NB_RXD;</div>
<div class="line">    uint16_t nb_txd = NB_TXD;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a28"></a><a class="code" href="structrte__eth__dev__info.html">rte_eth_dev_info</a> dev_info;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a29"></a><a class="code" href="structrte__eth__rxconf.html">rte_eth_rxconf</a> rxq_conf;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a30"></a><a class="code" href="structrte__eth__txconf.html">rte_eth_txconf</a> txq_conf;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> local_port_conf = port_conf;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialise device and RX/TX queues */</span></div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;Initialising port %u ...\n&quot;</span>, (<span class="keywordtype">unsigned</span>)port);</div>
<div class="line">    fflush(stdout);</div>
<div class="line"> </div>
<div class="line">    ret = <a name="a31"></a><a class="code" href="rte__ethdev_8h.html#a7593f4fff04f4ae1b1d718db7ca7dc8c">rte_eth_dev_info_get</a>(port, &amp;dev_info);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Error during getting device (port %u) info: %s\n&quot;</span>,</div>
<div class="line">            port, strerror(-ret));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (dev_info.tx_offload_capa &amp; <a name="a32"></a><a class="code" href="rte__ethdev_8h.html#ae7110b5d5dced8f42505bff5d9e3f0ea">DEV_TX_OFFLOAD_MBUF_FAST_FREE</a>)</div>
<div class="line">        local_port_conf.<a class="code" href="structrte__eth__conf.html#a1c33c9d2e5cdb14b62ed386bf3159e07">txmode</a>.<a name="a33"></a><a class="code" href="structrte__eth__txmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">offloads</a> |=</div>
<div class="line">            <a class="code" href="rte__ethdev_8h.html#ae7110b5d5dced8f42505bff5d9e3f0ea">DEV_TX_OFFLOAD_MBUF_FAST_FREE</a>;</div>
<div class="line">    ret = <a name="a34"></a><a class="code" href="rte__ethdev_8h.html#a1a7d3a20b102fee222541fda50fd87bd">rte_eth_dev_configure</a>(port, 1, 1, &amp;local_port_conf);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Could not configure port%u (%d)\n&quot;</span>,</div>
<div class="line">                    (<span class="keywordtype">unsigned</span>)port, ret);</div>
<div class="line"> </div>
<div class="line">    ret = <a name="a35"></a><a class="code" href="rte__ethdev_8h.html#ad31219b87a1733d5b367a7c04c7f7b48">rte_eth_dev_adjust_nb_rx_tx_desc</a>(port, &amp;nb_rxd, &amp;nb_txd);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Could not adjust number of descriptors &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;for port%u (%d)\n&quot;</span>, (<span class="keywordtype">unsigned</span>)port, ret);</div>
<div class="line"> </div>
<div class="line">    rxq_conf = dev_info.default_rxconf;</div>
<div class="line">    rxq_conf.offloads = local_port_conf.<a name="a36"></a><a class="code" href="structrte__eth__conf.html#a346eef99c24f617b74c440c1aa565d01">rxmode</a>.<a name="a37"></a><a class="code" href="structrte__eth__rxmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">offloads</a>;</div>
<div class="line">    ret = <a name="a38"></a><a class="code" href="rte__ethdev_8h.html#a36ba70a5a6fce2c2c1f774828ba78f8d">rte_eth_rx_queue_setup</a>(port, 0, nb_rxd,</div>
<div class="line">        <a name="a39"></a><a class="code" href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a>(port), &amp;rxq_conf, pktmbuf_pool);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Could not setup up RX queue for &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;port%u (%d)\n&quot;</span>, (<span class="keywordtype">unsigned</span>)port, ret);</div>
<div class="line"> </div>
<div class="line">    txq_conf = dev_info.default_txconf;</div>
<div class="line">    txq_conf.offloads = local_port_conf.<a class="code" href="structrte__eth__conf.html#a1c33c9d2e5cdb14b62ed386bf3159e07">txmode</a>.<a class="code" href="structrte__eth__txmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">offloads</a>;</div>
<div class="line">    ret = <a name="a40"></a><a class="code" href="rte__ethdev_8h.html#a796c2f20778984c6f41b271e36bae50e">rte_eth_tx_queue_setup</a>(port, 0, nb_txd,</div>
<div class="line">        <a class="code" href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a>(port), &amp;txq_conf);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Could not setup up TX queue for &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;port%u (%d)\n&quot;</span>, (<span class="keywordtype">unsigned</span>)port, ret);</div>
<div class="line"> </div>
<div class="line">    ret = <a name="a41"></a><a class="code" href="rte__ethdev_8h.html#afdc834c1c52e9fb512301990468ca7c2">rte_eth_dev_start</a>(port);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Could not start port%u (%d)\n&quot;</span>,</div>
<div class="line">                        (<span class="keywordtype">unsigned</span>)port, ret);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (promiscuous_on) {</div>
<div class="line">        ret = <a name="a42"></a><a class="code" href="rte__ethdev_8h.html#a5dd1dedaa45f05c72bcc35495e441e91">rte_eth_promiscuous_enable</a>(port);</div>
<div class="line">        <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                <span class="stringliteral">&quot;Could not enable promiscuous mode for port%u: %s\n&quot;</span>,</div>
<div class="line">                port, <a name="a43"></a><a class="code" href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a>(-ret));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Check the link status of all ports in up to 9s, and print them finally */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">check_all_ports_link_status(uint32_t port_mask)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define CHECK_INTERVAL 100 </span><span class="comment">/* 100ms */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define MAX_CHECK_TIME 90 </span><span class="comment">/* 9s (90 * 100ms) in total */</span><span class="preprocessor"></span></div>
<div class="line">    uint16_t portid;</div>
<div class="line">    uint8_t count, all_ports_up, print_flag = 0;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a44"></a><a class="code" href="structrte__eth__link.html">rte_eth_link</a> link;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line">    <span class="keywordtype">char</span> link_status_text[<a name="a45"></a><a class="code" href="rte__ethdev_8h.html#a7a31d6736244603b6a1d7efdd32a8834">RTE_ETH_LINK_MAX_STR_LEN</a>];</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\nChecking link status\n&quot;</span>);</div>
<div class="line">    fflush(stdout);</div>
<div class="line">    <span class="keywordflow">for</span> (count = 0; count &lt;= MAX_CHECK_TIME; count++) {</div>
<div class="line">        all_ports_up = 1;</div>
<div class="line">        <a class="code" href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a>(portid) {</div>
<div class="line">            <span class="keywordflow">if</span> ((port_mask &amp; (1 &lt;&lt; portid)) == 0)</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            memset(&amp;link, 0, <span class="keyword">sizeof</span>(link));</div>
<div class="line">            ret = <a name="a46"></a><a class="code" href="rte__ethdev_8h.html#ad1263899f41301923c483c3b4ce0486f">rte_eth_link_get_nowait</a>(portid, &amp;link);</div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                all_ports_up = 0;</div>
<div class="line">                <span class="keywordflow">if</span> (print_flag == 1)</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Port %u link get failed: %s\n&quot;</span>,</div>
<div class="line">                        portid, <a class="code" href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a>(-ret));</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">/* print link status if flag set */</span></div>
<div class="line">            <span class="keywordflow">if</span> (print_flag == 1) {</div>
<div class="line">                <a name="a47"></a><a class="code" href="rte__ethdev_8h.html#a5f51139368b8d1a2c22fdecd90bc4d98">rte_eth_link_to_str</a>(link_status_text,</div>
<div class="line">                    <span class="keyword">sizeof</span>(link_status_text), &amp;link);</div>
<div class="line">                printf(<span class="stringliteral">&quot;Port %d %s\n&quot;</span>, portid,</div>
<div class="line">                    link_status_text);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">/* clear all_ports_up flag if any link down */</span></div>
<div class="line">            <span class="keywordflow">if</span> (link.link_status == <a name="a48"></a><a class="code" href="rte__ethdev_8h.html#a08c012f37e07726170ff67daf667d850">ETH_LINK_DOWN</a>) {</div>
<div class="line">                all_ports_up = 0;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* after finally printing all link status, get out */</span></div>
<div class="line">        <span class="keywordflow">if</span> (print_flag == 1)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (all_ports_up == 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line">            fflush(stdout);</div>
<div class="line">            <a name="a49"></a><a class="code" href="rte__cycles_8h.html#af73b844d50b98de74b1a0e1730262f85">rte_delay_ms</a>(CHECK_INTERVAL);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* set the print_flag if all ports up or timeout */</span></div>
<div class="line">        <span class="keywordflow">if</span> (all_ports_up == 1 || count == (MAX_CHECK_TIME - 1)) {</div>
<div class="line">            print_flag = 1;</div>
<div class="line">            printf(<span class="stringliteral">&quot;done\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">log_link_state(<span class="keyword">struct</span> rte_kni *kni, <span class="keywordtype">int</span> prev, <span class="keyword">struct</span> <a class="code" href="structrte__eth__link.html">rte_eth_link</a> *link)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> link_status_text[<a class="code" href="rte__ethdev_8h.html#a7a31d6736244603b6a1d7efdd32a8834">RTE_ETH_LINK_MAX_STR_LEN</a>];</div>
<div class="line">    <span class="keywordflow">if</span> (kni == NULL || link == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__ethdev_8h.html#a5f51139368b8d1a2c22fdecd90bc4d98">rte_eth_link_to_str</a>(link_status_text, <span class="keyword">sizeof</span>(link_status_text), link);</div>
<div class="line">    <span class="keywordflow">if</span> (prev != link-&gt;<a name="a50"></a><a class="code" href="structrte__eth__link.html#a226d9406cdd84b64b3c3701e5ab8be88">link_status</a>)</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;%s NIC %s&quot;</span>,</div>
<div class="line">            <a name="a51"></a><a class="code" href="rte__kni_8h.html#aecae7b93ec018dde146c91a90644a49c">rte_kni_get_name</a>(kni),</div>
<div class="line">            link_status_text);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Monitor the link status of all ports and update the</span></div>
<div class="line"><span class="comment"> * corresponding KNI interface(s)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">monitor_all_ports_link_status(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    uint16_t portid;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__link.html">rte_eth_link</a> link;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line">    <span class="keyword">struct </span>kni_port_params **p = kni_port_params_array;</div>
<div class="line">    <span class="keywordtype">int</span> prev;</div>
<div class="line">    (void) arg;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (monitor_links) {</div>
<div class="line">        <a class="code" href="rte__cycles_8h.html#af73b844d50b98de74b1a0e1730262f85">rte_delay_ms</a>(500);</div>
<div class="line">        <a class="code" href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a>(portid) {</div>
<div class="line">            <span class="keywordflow">if</span> ((ports_mask &amp; (1 &lt;&lt; portid)) == 0)</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            memset(&amp;link, 0, <span class="keyword">sizeof</span>(link));</div>
<div class="line">            ret = <a class="code" href="rte__ethdev_8h.html#ad1263899f41301923c483c3b4ce0486f">rte_eth_link_get_nowait</a>(portid, &amp;link);</div>
<div class="line">            <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">                <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP,</div>
<div class="line">                    <span class="stringliteral">&quot;Get link failed (port %u): %s\n&quot;</span>,</div>
<div class="line">                    portid, <a class="code" href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a>(-ret));</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; p[portid]-&gt;nb_kni; i++) {</div>
<div class="line">                prev = <a name="a52"></a><a class="code" href="rte__kni_8h.html#aa0de3e5e9b4716570ec8238516643faf">rte_kni_update_link</a>(p[portid]-&gt;kni[i],</div>
<div class="line">                        link.<a class="code" href="structrte__eth__link.html#a226d9406cdd84b64b3c3701e5ab8be88">link_status</a>);</div>
<div class="line">                log_link_state(p[portid]-&gt;kni[i], prev, &amp;link);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">kni_change_mtu_(uint16_t port_id, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_mtu)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line">    uint16_t nb_rxd = NB_RXD;</div>
<div class="line">    uint16_t nb_txd = NB_TXD;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> conf;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__dev__info.html">rte_eth_dev_info</a> dev_info;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__rxconf.html">rte_eth_rxconf</a> rxq_conf;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__txconf.html">rte_eth_txconf</a> txq_conf;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!<a name="a53"></a><a class="code" href="rte__ethdev_8h.html#a22dcfd3f5f2b34f657131d66132e23a7">rte_eth_dev_is_valid_port</a>(port_id)) {</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Invalid port id %d\n&quot;</span>, port_id);</div>
<div class="line">        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;Change MTU of port %d to %u\n&quot;</span>, port_id, new_mtu);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Stop specific port */</span></div>
<div class="line">    ret = <a name="a54"></a><a class="code" href="rte__ethdev_8h.html#a6fc010cf6216331c50bc02d2fd4e614f">rte_eth_dev_stop</a>(port_id);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != 0) {</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Failed to stop port %d: %s\n&quot;</span>,</div>
<div class="line">            port_id, <a class="code" href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a>(-ret));</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memcpy(&amp;conf, &amp;port_conf, <span class="keyword">sizeof</span>(conf));</div>
<div class="line">    <span class="comment">/* Set new MTU */</span></div>
<div class="line">    <span class="keywordflow">if</span> (new_mtu &gt; <a name="a55"></a><a class="code" href="rte__ether_8h.html#af1fb088707ce5b2ebb7825cb69b5cb58">RTE_ETHER_MAX_LEN</a>)</div>
<div class="line">        conf.rxmode.offloads |= DEV_RX_OFFLOAD_JUMBO_FRAME;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        conf.rxmode.offloads &amp;= ~DEV_RX_OFFLOAD_JUMBO_FRAME;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* mtu + length of header + length of FCS = max pkt length */</span></div>
<div class="line">    conf.rxmode.max_rx_pkt_len = new_mtu + KNI_ENET_HEADER_SIZE +</div>
<div class="line">                            KNI_ENET_FCS_SIZE;</div>
<div class="line">    ret = <a class="code" href="rte__ethdev_8h.html#a1a7d3a20b102fee222541fda50fd87bd">rte_eth_dev_configure</a>(port_id, 1, 1, &amp;conf);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Fail to reconfigure port %d\n&quot;</span>, port_id);</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ret = <a class="code" href="rte__ethdev_8h.html#ad31219b87a1733d5b367a7c04c7f7b48">rte_eth_dev_adjust_nb_rx_tx_desc</a>(port_id, &amp;nb_rxd, &amp;nb_txd);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Could not adjust number of descriptors &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;for port%u (%d)\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)port_id,</div>
<div class="line">                ret);</div>
<div class="line"> </div>
<div class="line">    ret = <a class="code" href="rte__ethdev_8h.html#a7593f4fff04f4ae1b1d718db7ca7dc8c">rte_eth_dev_info_get</a>(port_id, &amp;dev_info);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != 0) {</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP,</div>
<div class="line">            <span class="stringliteral">&quot;Error during getting device (port %u) info: %s\n&quot;</span>,</div>
<div class="line">            port_id, strerror(-ret));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    rxq_conf = dev_info.default_rxconf;</div>
<div class="line">    rxq_conf.offloads = conf.rxmode.offloads;</div>
<div class="line">    ret = <a class="code" href="rte__ethdev_8h.html#a36ba70a5a6fce2c2c1f774828ba78f8d">rte_eth_rx_queue_setup</a>(port_id, 0, nb_rxd,</div>
<div class="line">        <a class="code" href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a>(port_id), &amp;rxq_conf, pktmbuf_pool);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Fail to setup Rx queue of port %d\n&quot;</span>,</div>
<div class="line">                port_id);</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    txq_conf = dev_info.default_txconf;</div>
<div class="line">    txq_conf.offloads = conf.txmode.offloads;</div>
<div class="line">    ret = <a class="code" href="rte__ethdev_8h.html#a796c2f20778984c6f41b271e36bae50e">rte_eth_tx_queue_setup</a>(port_id, 0, nb_txd,</div>
<div class="line">        <a class="code" href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a>(port_id), &amp;txq_conf);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Fail to setup Tx queue of port %d\n&quot;</span>,</div>
<div class="line">                port_id);</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Restart specific port */</span></div>
<div class="line">    ret = <a class="code" href="rte__ethdev_8h.html#afdc834c1c52e9fb512301990468ca7c2">rte_eth_dev_start</a>(port_id);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Fail to restart port %d\n&quot;</span>, port_id);</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback for request of changing MTU */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">kni_change_mtu(uint16_t port_id, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_mtu)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__atomic_8h.html#a76fa947d23bc1aac76f70641cad255a7">rte_atomic32_inc</a>(&amp;kni_pause);</div>
<div class="line">    ret =  kni_change_mtu_(port_id, new_mtu);</div>
<div class="line">    <a name="a56"></a><a class="code" href="rte__atomic_8h.html#a85650cc56e09751647d2a33fae4be4a3">rte_atomic32_dec</a>(&amp;kni_pause);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback for request of configuring network interface up/down */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">kni_config_network_interface(uint16_t port_id, uint8_t if_up)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="rte__ethdev_8h.html#a22dcfd3f5f2b34f657131d66132e23a7">rte_eth_dev_is_valid_port</a>(port_id)) {</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Invalid port id %d\n&quot;</span>, port_id);</div>
<div class="line">        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;Configure network interface of %d %s\n&quot;</span>,</div>
<div class="line">                    port_id, if_up ? <span class="stringliteral">&quot;up&quot;</span> : <span class="stringliteral">&quot;down&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__atomic_8h.html#a76fa947d23bc1aac76f70641cad255a7">rte_atomic32_inc</a>(&amp;kni_pause);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (if_up != 0) { <span class="comment">/* Configure network interface up */</span></div>
<div class="line">        ret = <a class="code" href="rte__ethdev_8h.html#a6fc010cf6216331c50bc02d2fd4e614f">rte_eth_dev_stop</a>(port_id);</div>
<div class="line">        <span class="keywordflow">if</span> (ret != 0) {</div>
<div class="line">            <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Failed to stop port %d: %s\n&quot;</span>,</div>
<div class="line">                port_id, <a class="code" href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a>(-ret));</div>
<div class="line">            <a class="code" href="rte__atomic_8h.html#a85650cc56e09751647d2a33fae4be4a3">rte_atomic32_dec</a>(&amp;kni_pause);</div>
<div class="line">            <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
<div class="line">        ret = <a class="code" href="rte__ethdev_8h.html#afdc834c1c52e9fb512301990468ca7c2">rte_eth_dev_start</a>(port_id);</div>
<div class="line">    } <span class="keywordflow">else</span> { <span class="comment">/* Configure network interface down */</span></div>
<div class="line">        ret = <a class="code" href="rte__ethdev_8h.html#a6fc010cf6216331c50bc02d2fd4e614f">rte_eth_dev_stop</a>(port_id);</div>
<div class="line">        <span class="keywordflow">if</span> (ret != 0) {</div>
<div class="line">            <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Failed to stop port %d: %s\n&quot;</span>,</div>
<div class="line">                port_id, <a class="code" href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a>(-ret));</div>
<div class="line">            <a class="code" href="rte__atomic_8h.html#a85650cc56e09751647d2a33fae4be4a3">rte_atomic32_dec</a>(&amp;kni_pause);</div>
<div class="line">            <span class="keywordflow">return</span> ret;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__atomic_8h.html#a85650cc56e09751647d2a33fae4be4a3">rte_atomic32_dec</a>(&amp;kni_pause);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Failed to start port %d\n&quot;</span>, port_id);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_ethaddr(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">struct</span> <a name="_a57"></a><a class="code" href="structrte__ether__addr.html">rte_ether_addr</a> *mac_addr)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> buf[RTE_ETHER_ADDR_FMT_SIZE];</div>
<div class="line">    <a name="a58"></a><a class="code" href="rte__ether_8h.html#af5cfe384bccf79d966ae861ccdf34923">rte_ether_format_addr</a>(buf, RTE_ETHER_ADDR_FMT_SIZE, mac_addr);</div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;\t%s%s\n&quot;</span>, name, buf);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback for request of configuring mac address */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">kni_config_mac_address(uint16_t port_id, uint8_t mac_addr[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="rte__ethdev_8h.html#a22dcfd3f5f2b34f657131d66132e23a7">rte_eth_dev_is_valid_port</a>(port_id)) {</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Invalid port id %d\n&quot;</span>, port_id);</div>
<div class="line">        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;Configure mac address of %d\n&quot;</span>, port_id);</div>
<div class="line">    print_ethaddr(<span class="stringliteral">&quot;Address:&quot;</span>, (<span class="keyword">struct</span> <a class="code" href="structrte__ether__addr.html">rte_ether_addr</a> *)mac_addr);</div>
<div class="line"> </div>
<div class="line">    ret = <a name="a59"></a><a class="code" href="rte__ethdev_8h.html#a8d1b91521b0308b3b462095e25ba521a">rte_eth_dev_default_mac_addr_set</a>(port_id,</div>
<div class="line">                    (<span class="keyword">struct</span> <a class="code" href="structrte__ether__addr.html">rte_ether_addr</a> *)mac_addr);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Failed to config mac_addr for port %d\n&quot;</span>,</div>
<div class="line">            port_id);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">kni_alloc(uint16_t port_id)</div>
<div class="line">{</div>
<div class="line">    uint8_t i;</div>
<div class="line">    <span class="keyword">struct </span>rte_kni *kni;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a60"></a><a class="code" href="structrte__kni__conf.html">rte_kni_conf</a> conf;</div>
<div class="line">    <span class="keyword">struct </span>kni_port_params **params = kni_port_params_array;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (port_id &gt;= RTE_MAX_ETHPORTS || !params[port_id])</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    params[port_id]-&gt;nb_kni = params[port_id]-&gt;nb_lcore_k ?</div>
<div class="line">                params[port_id]-&gt;nb_lcore_k : 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; params[port_id]-&gt;nb_kni; i++) {</div>
<div class="line">        <span class="comment">/* Clear conf at first */</span></div>
<div class="line">        memset(&amp;conf, 0, <span class="keyword">sizeof</span>(conf));</div>
<div class="line">        <span class="keywordflow">if</span> (params[port_id]-&gt;nb_lcore_k) {</div>
<div class="line">            snprintf(conf.name, RTE_KNI_NAMESIZE,</div>
<div class="line">                    <span class="stringliteral">&quot;vEth%u_%u&quot;</span>, port_id, i);</div>
<div class="line">            conf.core_id = params[port_id]-&gt;lcore_k[i];</div>
<div class="line">            conf.force_bind = 1;</div>
<div class="line">        } <span class="keywordflow">else</span></div>
<div class="line">            snprintf(conf.name, RTE_KNI_NAMESIZE,</div>
<div class="line">                        <span class="stringliteral">&quot;vEth%u&quot;</span>, port_id);</div>
<div class="line">        conf.group_id = port_id;</div>
<div class="line">        conf.mbuf_size = MAX_PACKET_SZ;</div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * The first KNI device associated to a port</span></div>
<div class="line"><span class="comment">         * is the main, for multiple kernel thread</span></div>
<div class="line"><span class="comment">         * environment.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line">            <span class="keyword">struct </span><a name="_a61"></a><a class="code" href="structrte__kni__ops.html">rte_kni_ops</a> ops;</div>
<div class="line">            <span class="keyword">struct </span><a class="code" href="structrte__eth__dev__info.html">rte_eth_dev_info</a> dev_info;</div>
<div class="line"> </div>
<div class="line">            ret = <a class="code" href="rte__ethdev_8h.html#a7593f4fff04f4ae1b1d718db7ca7dc8c">rte_eth_dev_info_get</a>(port_id, &amp;dev_info);</div>
<div class="line">            <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">                <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                    <span class="stringliteral">&quot;Error during getting device (port %u) info: %s\n&quot;</span>,</div>
<div class="line">                    port_id, strerror(-ret));</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* Get the interface default mac address */</span></div>
<div class="line">            ret = <a name="a62"></a><a class="code" href="rte__ethdev_8h.html#a8a28375b279ded9125c99a46bf3956ef">rte_eth_macaddr_get</a>(port_id,</div>
<div class="line">                (<span class="keyword">struct</span> <a class="code" href="structrte__ether__addr.html">rte_ether_addr</a> *)&amp;conf.mac_addr);</div>
<div class="line">            <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">                <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                    <span class="stringliteral">&quot;Failed to get MAC address (port %u): %s\n&quot;</span>,</div>
<div class="line">                    port_id, <a class="code" href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a>(-ret));</div>
<div class="line"> </div>
<div class="line">            <a name="a63"></a><a class="code" href="rte__ethdev_8h.html#a386c83c7cc16ec9886ecf2925e7be4a3">rte_eth_dev_get_mtu</a>(port_id, &amp;conf.mtu);</div>
<div class="line"> </div>
<div class="line">            conf.min_mtu = dev_info.min_mtu;</div>
<div class="line">            conf.max_mtu = dev_info.max_mtu;</div>
<div class="line"> </div>
<div class="line">            memset(&amp;ops, 0, <span class="keyword">sizeof</span>(ops));</div>
<div class="line">            ops.port_id = port_id;</div>
<div class="line">            ops.change_mtu = kni_change_mtu;</div>
<div class="line">            ops.config_network_if = kni_config_network_interface;</div>
<div class="line">            ops.config_mac_address = kni_config_mac_address;</div>
<div class="line"> </div>
<div class="line">            kni = <a name="a64"></a><a class="code" href="rte__kni_8h.html#a6f0e3bfe35ac99edbf07dd709d294176">rte_kni_alloc</a>(pktmbuf_pool, &amp;conf, &amp;ops);</div>
<div class="line">        } <span class="keywordflow">else</span></div>
<div class="line">            kni = <a class="code" href="rte__kni_8h.html#a6f0e3bfe35ac99edbf07dd709d294176">rte_kni_alloc</a>(pktmbuf_pool, &amp;conf, NULL);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!kni)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Fail to create kni for &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;port: %d\n&quot;</span>, port_id);</div>
<div class="line">        params[port_id]-&gt;kni[i] = kni;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">kni_free_kni(uint16_t port_id)</div>
<div class="line">{</div>
<div class="line">    uint8_t i;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line">    <span class="keyword">struct </span>kni_port_params **p = kni_port_params_array;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (port_id &gt;= RTE_MAX_ETHPORTS || !p[port_id])</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p[port_id]-&gt;nb_kni; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a65"></a><a class="code" href="rte__kni_8h.html#abbfabc840e0630bf581eb5583a7d88fe">rte_kni_release</a>(p[port_id]-&gt;kni[i]))</div>
<div class="line">            printf(<span class="stringliteral">&quot;Fail to release kni\n&quot;</span>);</div>
<div class="line">        p[port_id]-&gt;kni[i] = NULL;</div>
<div class="line">    }</div>
<div class="line">    ret = <a class="code" href="rte__ethdev_8h.html#a6fc010cf6216331c50bc02d2fd4e614f">rte_eth_dev_stop</a>(port_id);</div>
<div class="line">    <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, APP, <span class="stringliteral">&quot;Failed to stop port %d: %s\n&quot;</span>,</div>
<div class="line">            port_id, <a class="code" href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a>(-ret));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Initialise ports/queues etc. and start main loop on each core */</span></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line">    uint16_t nb_sys_ports, port;</div>
<div class="line">    <span class="keywordtype">unsigned</span> i;</div>
<div class="line">    <span class="keywordtype">void</span> *retval;</div>
<div class="line">    pthread_t kni_link_tid;</div>
<div class="line">    <span class="keywordtype">int</span> pid;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Associate signal_hanlder function with USR signals */</span></div>
<div class="line">    signal(SIGUSR1, signal_handler);</div>
<div class="line">    signal(SIGUSR2, signal_handler);</div>
<div class="line">    signal(SIGRTMIN, signal_handler);</div>
<div class="line">    signal(SIGINT, signal_handler);</div>
<div class="line">    signal(SIGTERM, signal_handler);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialise EAL */</span></div>
<div class="line">    ret = <a name="a66"></a><a class="code" href="rte__eal_8h.html#a5c3f4dddc25e38c5a186ecd8a69260e3">rte_eal_init</a>(argc, argv);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Could not initialise EAL (%d)\n&quot;</span>, ret);</div>
<div class="line">    argc -= ret;</div>
<div class="line">    argv += ret;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Parse application arguments (after the EAL ones) */</span></div>
<div class="line">    ret = parse_args(argc, argv);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Could not parse input parameters\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create the mbuf pool */</span></div>
<div class="line">    pktmbuf_pool = <a name="a67"></a><a class="code" href="rte__mbuf_8h.html#a593921f13307803b94bbb4e0932db962">rte_pktmbuf_pool_create</a>(<span class="stringliteral">&quot;mbuf_pool&quot;</span>, NB_MBUF,</div>
<div class="line">        MEMPOOL_CACHE_SZ, 0, MBUF_DATA_SZ, <a name="a68"></a><a class="code" href="rte__lcore_8h.html#a7c8da4664df26a64cf05dc508a4f26df">rte_socket_id</a>());</div>
<div class="line">    <span class="keywordflow">if</span> (pktmbuf_pool == NULL) {</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Could not initialise mbuf pool\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Get number of ports found in scan */</span></div>
<div class="line">    nb_sys_ports = <a name="a69"></a><a class="code" href="rte__ethdev_8h.html#a9ab708089665bebcd65cefe5383b24f2">rte_eth_dev_count_avail</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (nb_sys_ports == 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;No supported Ethernet device found\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Check if the configured port ID is valid */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_MAX_ETHPORTS; i++)</div>
<div class="line">        <span class="keywordflow">if</span> (kni_port_params_array[i] &amp;&amp; !<a class="code" href="rte__ethdev_8h.html#a22dcfd3f5f2b34f657131d66132e23a7">rte_eth_dev_is_valid_port</a>(i))</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Configured invalid &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;port ID %u\n&quot;</span>, i);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize KNI subsystem */</span></div>
<div class="line">    init_kni();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialise each port */</span></div>
<div class="line">    <a class="code" href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a>(port) {</div>
<div class="line">        <span class="comment">/* Skip ports that are not enabled */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(ports_mask &amp; (1 &lt;&lt; port)))</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        init_port(port);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (port &gt;= RTE_MAX_ETHPORTS)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Can not use more than &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;%d ports for kni\n&quot;</span>, RTE_MAX_ETHPORTS);</div>
<div class="line"> </div>
<div class="line">        kni_alloc(port);</div>
<div class="line">    }</div>
<div class="line">    check_all_ports_link_status(ports_mask);</div>
<div class="line"> </div>
<div class="line">    pid = getpid();</div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;========================\n&quot;</span>);</div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;KNI Running\n&quot;</span>);</div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;kill -SIGUSR1 %d\n&quot;</span>, pid);</div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;    Show KNI Statistics.\n&quot;</span>);</div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;kill -SIGUSR2 %d\n&quot;</span>, pid);</div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;    Zero KNI Statistics.\n&quot;</span>);</div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, APP, <span class="stringliteral">&quot;========================\n&quot;</span>);</div>
<div class="line">    fflush(stdout);</div>
<div class="line"> </div>
<div class="line">    ret = <a name="a70"></a><a class="code" href="rte__lcore_8h.html#aa0bd7a4983e66d9ea893a98d25262914">rte_ctrl_thread_create</a>(&amp;kni_link_tid,</div>
<div class="line">                     <span class="stringliteral">&quot;KNI link status check&quot;</span>, NULL,</div>
<div class="line">                     monitor_all_ports_link_status, NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Could not create link status thread!\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Launch per-lcore function on every lcore */</span></div>
<div class="line">    <a name="a71"></a><a class="code" href="rte__launch_8h.html#acc0b1cfdc31fa73329acd51dcea31210">rte_eal_mp_remote_launch</a>(main_loop, NULL, <a name="a72"></a><a class="code" href="rte__launch_8h.html#a7fe96b0e5d3a6a8cf9b8d1a27cf3f159ad00c59bb386320b2ba3198d3149a0c35">CALL_MAIN</a>);</div>
<div class="line">    <a name="a73"></a><a class="code" href="rte__lcore_8h.html#ac779e61584eb9d087c3e20bf2d1150c8">RTE_LCORE_FOREACH_WORKER</a>(i) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a74"></a><a class="code" href="rte__launch_8h.html#ae9500e1d35bd4cfb95d18c0be863cb1e">rte_eal_wait_lcore</a>(i) &lt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    monitor_links = 0;</div>
<div class="line">    pthread_join(kni_link_tid, &amp;retval);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Release resources */</span></div>
<div class="line">    <a class="code" href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a>(port) {</div>
<div class="line">        <span class="keywordflow">if</span> (!(ports_mask &amp; (1 &lt;&lt; port)))</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        kni_free_kni(port);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_MAX_ETHPORTS; i++)</div>
<div class="line">        <span class="keywordflow">if</span> (kni_port_params_array[i]) {</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a1fc82f67711b13aca7e05dc9d58f9dbd">rte_free</a>(kni_port_params_array[i]);</div>
<div class="line">            kni_port_params_array[i] = NULL;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="arte__ethdev_8h_html_a5f51139368b8d1a2c22fdecd90bc4d98"><div class="ttname"><a href="rte__ethdev_8h.html#a5f51139368b8d1a2c22fdecd90bc4d98">rte_eth_link_to_str</a></div><div class="ttdeci">__rte_experimental int rte_eth_link_to_str(char *str, size_t len, const struct rte_eth_link *eth_link)</div></div>
<div class="ttc" id="astructrte__eth__txmode_html_aac4d1eaef063383b937a1d568412b4ce"><div class="ttname"><a href="structrte__eth__txmode.html#aac4d1eaef063383b937a1d568412b4ce">rte_eth_txmode::mq_mode</a></div><div class="ttdeci">enum rte_eth_tx_mq_mode mq_mode</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00945">rte_ethdev.h:953</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ad31219b87a1733d5b367a7c04c7f7b48"><div class="ttname"><a href="rte__ethdev_8h.html#ad31219b87a1733d5b367a7c04c7f7b48">rte_eth_dev_adjust_nb_rx_tx_desc</a></div><div class="ttdeci">int rte_eth_dev_adjust_nb_rx_tx_desc(uint16_t port_id, uint16_t *nb_rx_desc, uint16_t *nb_tx_desc)</div></div>
<div class="ttc" id="arte__malloc_8h_html_aaf0f048a5fd1672688c662cdfb4536b3"><div class="ttname"><a href="rte__malloc_8h.html#aaf0f048a5fd1672688c662cdfb4536b3">rte_zmalloc</a></div><div class="ttdeci">void * rte_zmalloc(const char *type, size_t size, unsigned align) __rte_alloc_size(2)</div></div>
<div class="ttc" id="arte__malloc_8h_html"><div class="ttname"><a href="rte__malloc_8h.html">rte_malloc.h</a></div></div>
<div class="ttc" id="astructrte__eth__rxconf_html"><div class="ttname"><a href="structrte__eth__rxconf.html">rte_eth_rxconf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01032">rte_ethdev.h:1032</a></div></div>
<div class="ttc" id="arte__lcore_8h_html_a5404ee6ac26cbe5a4f4ddef44d690b76"><div class="ttname"><a href="rte__lcore_8h.html#a5404ee6ac26cbe5a4f4ddef44d690b76">rte_lcore_is_enabled</a></div><div class="ttdeci">int rte_lcore_is_enabled(unsigned int lcore_id)</div></div>
<div class="ttc" id="arte__memory_8h_html"><div class="ttname"><a href="rte__memory_8h.html">rte_memory.h</a></div></div>
<div class="ttc" id="arte__branch__prediction_8h_html_ac6c45889010c1bd68631771b64f18101"><div class="ttname"><a href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a></div><div class="ttdeci">#define unlikely(x)</div><div class="ttdef"><b>Definition:</b> <a href="rte__branch__prediction_8h_source.html#l00038">rte_branch_prediction.h:38</a></div></div>
<div class="ttc" id="arte__ether_8h_html_af5cfe384bccf79d966ae861ccdf34923"><div class="ttname"><a href="rte__ether_8h.html#af5cfe384bccf79d966ae861ccdf34923">rte_ether_format_addr</a></div><div class="ttdeci">void rte_ether_format_addr(char *buf, uint16_t size, const struct rte_ether_addr *eth_addr)</div></div>
<div class="ttc" id="arte__launch_8h_html_acc0b1cfdc31fa73329acd51dcea31210"><div class="ttname"><a href="rte__launch_8h.html#acc0b1cfdc31fa73329acd51dcea31210">rte_eal_mp_remote_launch</a></div><div class="ttdeci">int rte_eal_mp_remote_launch(lcore_function_t *f, void *arg, enum rte_rmt_call_main_t call_main)</div></div>
<div class="ttc" id="arte__lcore_8h_html"><div class="ttname"><a href="rte__lcore_8h.html">rte_lcore.h</a></div></div>
<div class="ttc" id="arte__lcore_8h_html_a7c8da4664df26a64cf05dc508a4f26df"><div class="ttname"><a href="rte__lcore_8h.html#a7c8da4664df26a64cf05dc508a4f26df">rte_socket_id</a></div><div class="ttdeci">unsigned int rte_socket_id(void)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a4834f572f4dd4e46d81ad09b7d5fffd5aada568551470d5f419cd2f3d6b6bfedc"><div class="ttname"><a href="rte__ethdev_8h.html#a4834f572f4dd4e46d81ad09b7d5fffd5aada568551470d5f419cd2f3d6b6bfedc">ETH_MQ_TX_NONE</a></div><div class="ttdeci">@ ETH_MQ_TX_NONE</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00384">rte_ethdev.h:384</a></div></div>
<div class="ttc" id="arte__log_8h_html"><div class="ttname"><a href="rte__log_8h.html">rte_log.h</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a796c2f20778984c6f41b271e36bae50e"><div class="ttname"><a href="rte__ethdev_8h.html#a796c2f20778984c6f41b271e36bae50e">rte_eth_tx_queue_setup</a></div><div class="ttdeci">int rte_eth_tx_queue_setup(uint16_t port_id, uint16_t tx_queue_id, uint16_t nb_tx_desc, unsigned int socket_id, const struct rte_eth_txconf *tx_conf)</div></div>
<div class="ttc" id="astructrte__eth__txconf_html"><div class="ttname"><a href="structrte__eth__txconf.html">rte_eth_txconf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01060">rte_ethdev.h:1060</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a1a7d3a20b102fee222541fda50fd87bd"><div class="ttname"><a href="rte__ethdev_8h.html#a1a7d3a20b102fee222541fda50fd87bd">rte_eth_dev_configure</a></div><div class="ttdeci">int rte_eth_dev_configure(uint16_t port_id, uint16_t nb_rx_queue, uint16_t nb_tx_queue, const struct rte_eth_conf *eth_conf)</div></div>
<div class="ttc" id="arte__errno_8h_html_a129a7eb4cfa1f5bdac5783bf49137d06"><div class="ttname"><a href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a></div><div class="ttdeci">const char * rte_strerror(int errnum)</div></div>
<div class="ttc" id="arte__string__fns_8h_html_af3ffc4e2ca821bc44f7fd08afbfe3638"><div class="ttname"><a href="rte__string__fns_8h.html#af3ffc4e2ca821bc44f7fd08afbfe3638">rte_strsplit</a></div><div class="ttdeci">int rte_strsplit(char *string, int stringlen, char **tokens, int maxtokens, char delim)</div></div>
<div class="ttc" id="astructrte__eth__link_html"><div class="ttname"><a href="structrte__eth__link.html">rte_eth_link</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00313">rte_ethdev.h:313</a></div></div>
<div class="ttc" id="arte__string__fns_8h_html"><div class="ttname"><a href="rte__string__fns_8h.html">rte_string_fns.h</a></div></div>
<div class="ttc" id="arte__interrupts_8h_html"><div class="ttname"><a href="rte__interrupts_8h.html">rte_interrupts.h</a></div></div>
<div class="ttc" id="astructrte__eth__conf_html_a346eef99c24f617b74c440c1aa565d01"><div class="ttname"><a href="structrte__eth__conf.html#a346eef99c24f617b74c440c1aa565d01">rte_eth_conf::rxmode</a></div><div class="ttdeci">struct rte_eth_rxmode rxmode</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01294">rte_ethdev.h:1301</a></div></div>
<div class="ttc" id="arte__common_8h_html_a38e32f822bc941e90fdcbe5a9c69b178"><div class="ttname"><a href="rte__common_8h.html#a38e32f822bc941e90fdcbe5a9c69b178">__rte_cache_aligned</a></div><div class="ttdeci">#define __rte_cache_aligned</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00400">rte_common.h:400</a></div></div>
<div class="ttc" id="arte__branch__prediction_8h_html"><div class="ttname"><a href="rte__branch__prediction_8h.html">rte_branch_prediction.h</a></div></div>
<div class="ttc" id="arte__eal_8h_html"><div class="ttname"><a href="rte__eal_8h.html">rte_eal.h</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a3e7d76a451b46348686ea97d6367f102"><div class="ttname"><a href="rte__ethdev_8h.html#a3e7d76a451b46348686ea97d6367f102">rte_eth_rx_burst</a></div><div class="ttdeci">static uint16_t rte_eth_rx_burst(uint16_t port_id, uint16_t queue_id, struct rte_mbuf **rx_pkts, const uint16_t nb_pkts)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l04834">rte_ethdev.h:4834</a></div></div>
<div class="ttc" id="astructrte__kni__conf_html"><div class="ttname"><a href="structrte__kni__conf.html">rte_kni_conf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__kni_8h_source.html#l00059">rte_kni.h:59</a></div></div>
<div class="ttc" id="arte__ether_8h_html"><div class="ttname"><a href="rte__ether_8h.html">rte_ether.h</a></div></div>
<div class="ttc" id="astructrte__mbuf_html"><div class="ttname"><a href="structrte__mbuf.html">rte_mbuf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00473">rte_mbuf_core.h:473</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ad1263899f41301923c483c3b4ce0486f"><div class="ttname"><a href="rte__ethdev_8h.html#ad1263899f41301923c483c3b4ce0486f">rte_eth_link_get_nowait</a></div><div class="ttdeci">int rte_eth_link_get_nowait(uint16_t port_id, struct rte_eth_link *link)</div></div>
<div class="ttc" id="arte__kni_8h_html"><div class="ttname"><a href="rte__kni_8h.html">rte_kni.h</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a7593f4fff04f4ae1b1d718db7ca7dc8c"><div class="ttname"><a href="rte__ethdev_8h.html#a7593f4fff04f4ae1b1d718db7ca7dc8c">rte_eth_dev_info_get</a></div><div class="ttdeci">int rte_eth_dev_info_get(uint16_t port_id, struct rte_eth_dev_info *dev_info)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a5dd1dedaa45f05c72bcc35495e441e91"><div class="ttname"><a href="rte__ethdev_8h.html#a5dd1dedaa45f05c72bcc35495e441e91">rte_eth_promiscuous_enable</a></div><div class="ttdeci">int rte_eth_promiscuous_enable(uint16_t port_id)</div></div>
<div class="ttc" id="arte__atomic_8h_html"><div class="ttname"><a href="rte__atomic_8h.html">rte_atomic.h</a></div></div>
<div class="ttc" id="astructrte__kni__ops_html"><div class="ttname"><a href="structrte__kni__ops.html">rte_kni_ops</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__kni_8h_source.html#l00037">rte_kni.h:37</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a22dcfd3f5f2b34f657131d66132e23a7"><div class="ttname"><a href="rte__ethdev_8h.html#a22dcfd3f5f2b34f657131d66132e23a7">rte_eth_dev_is_valid_port</a></div><div class="ttdeci">int rte_eth_dev_is_valid_port(uint16_t port_id)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a8a28375b279ded9125c99a46bf3956ef"><div class="ttname"><a href="rte__ethdev_8h.html#a8a28375b279ded9125c99a46bf3956ef">rte_eth_macaddr_get</a></div><div class="ttdeci">int rte_eth_macaddr_get(uint16_t port_id, struct rte_ether_addr *mac_addr)</div></div>
<div class="ttc" id="arte__common_8h_html_ac5169870c983b3463cb226bdb8a94880"><div class="ttname"><a href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a></div><div class="ttdeci">__rte_noreturn void rte_exit(int exit_code, const char *format,...) __rte_format_printf(2</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a83e56cabbd31637efd648e3fc010392b"><div class="ttname"><a href="rte__ethdev_8h.html#a83e56cabbd31637efd648e3fc010392b">rte_eth_tx_burst</a></div><div class="ttdeci">static uint16_t rte_eth_tx_burst(uint16_t port_id, uint16_t queue_id, struct rte_mbuf **tx_pkts, uint16_t nb_pkts)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l05112">rte_ethdev.h:5112</a></div></div>
<div class="ttc" id="arte__lcore_8h_html_adfb2b334e7e73f534f25e8888a8a775f"><div class="ttname"><a href="rte__lcore_8h.html#adfb2b334e7e73f534f25e8888a8a775f">rte_lcore_id</a></div><div class="ttdeci">static unsigned rte_lcore_id(void)</div><div class="ttdef"><b>Definition:</b> <a href="rte__lcore_8h_source.html#l00075">rte_lcore.h:75</a></div></div>
<div class="ttc" id="arte__atomic_8h_html_a76fa947d23bc1aac76f70641cad255a7"><div class="ttname"><a href="rte__atomic_8h.html#a76fa947d23bc1aac76f70641cad255a7">rte_atomic32_inc</a></div><div class="ttdeci">static void rte_atomic32_inc(rte_atomic32_t *v)</div></div>
<div class="ttc" id="astructrte__eth__link_html_a226d9406cdd84b64b3c3701e5ab8be88"><div class="ttname"><a href="structrte__eth__link.html#a226d9406cdd84b64b3c3701e5ab8be88">rte_eth_link::link_status</a></div><div class="ttdeci">uint16_t link_status</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00317">rte_ethdev.h:317</a></div></div>
<div class="ttc" id="arte__cycles_8h_html"><div class="ttname"><a href="rte__cycles_8h.html">rte_cycles.h</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ae7110b5d5dced8f42505bff5d9e3f0ea"><div class="ttname"><a href="rte__ethdev_8h.html#ae7110b5d5dced8f42505bff5d9e3f0ea">DEV_TX_OFFLOAD_MBUF_FAST_FREE</a></div><div class="ttdeci">#define DEV_TX_OFFLOAD_MBUF_FAST_FREE</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01401">rte_ethdev.h:1397</a></div></div>
<div class="ttc" id="arte__atomic_8h_html_a85650cc56e09751647d2a33fae4be4a3"><div class="ttname"><a href="rte__atomic_8h.html#a85650cc56e09751647d2a33fae4be4a3">rte_atomic32_dec</a></div><div class="ttdeci">static void rte_atomic32_dec(rte_atomic32_t *v)</div></div>
<div class="ttc" id="arte__atomic_8h_html_ad314fd28492e349e70ddf9b270234a63"><div class="ttname"><a href="rte__atomic_8h.html#ad314fd28492e349e70ddf9b270234a63">RTE_ATOMIC32_INIT</a></div><div class="ttdeci">#define RTE_ATOMIC32_INIT(val)</div><div class="ttdef"><b>Definition:</b> <a href="rte__atomic_8h_source.html#l00479">rte_atomic.h:479</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_afdc834c1c52e9fb512301990468ca7c2"><div class="ttname"><a href="rte__ethdev_8h.html#afdc834c1c52e9fb512301990468ca7c2">rte_eth_dev_start</a></div><div class="ttdeci">int rte_eth_dev_start(uint16_t port_id)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a08c012f37e07726170ff67daf667d850"><div class="ttname"><a href="rte__ethdev_8h.html#a08c012f37e07726170ff67daf667d850">ETH_LINK_DOWN</a></div><div class="ttdeci">#define ETH_LINK_DOWN</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00323">rte_ethdev.h:323</a></div></div>
<div class="ttc" id="arte__kni_8h_html_abbfabc840e0630bf581eb5583a7d88fe"><div class="ttname"><a href="rte__kni_8h.html#abbfabc840e0630bf581eb5583a7d88fe">rte_kni_release</a></div><div class="ttdeci">int rte_kni_release(struct rte_kni *kni)</div></div>
<div class="ttc" id="arte__common_8h_html"><div class="ttname"><a href="rte__common_8h.html">rte_common.h</a></div></div>
<div class="ttc" id="astructrte__eth__txmode_html_a6cfe3b3ee46e9a8b8c62a64294b0b564"><div class="ttname"><a href="structrte__eth__txmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">rte_eth_txmode::offloads</a></div><div class="ttdeci">uint64_t offloads</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00959">rte_ethdev.h:959</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a9ab708089665bebcd65cefe5383b24f2"><div class="ttname"><a href="rte__ethdev_8h.html#a9ab708089665bebcd65cefe5383b24f2">rte_eth_dev_count_avail</a></div><div class="ttdeci">uint16_t rte_eth_dev_count_avail(void)</div></div>
<div class="ttc" id="arte__debug_8h_html"><div class="ttname"><a href="rte__debug_8h.html">rte_debug.h</a></div></div>
<div class="ttc" id="arte__common_8h_html_ae1a7c8799cb57669ae2ddf367b21533f"><div class="ttname"><a href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a></div><div class="ttdeci">#define __rte_unused</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00116">rte_common.h:116</a></div></div>
<div class="ttc" id="astructrte__eth__rxmode_html_a6cfe3b3ee46e9a8b8c62a64294b0b564"><div class="ttname"><a href="structrte__eth__rxmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">rte_eth_rxmode::offloads</a></div><div class="ttdeci">uint64_t offloads</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00412">rte_ethdev.h:412</a></div></div>
<div class="ttc" id="arte__memcpy_8h_html"><div class="ttname"><a href="rte__memcpy_8h.html">rte_memcpy.h</a></div></div>
<div class="ttc" id="arte__kni_8h_html_aecae7b93ec018dde146c91a90644a49c"><div class="ttname"><a href="rte__kni_8h.html#aecae7b93ec018dde146c91a90644a49c">rte_kni_get_name</a></div><div class="ttdeci">const char * rte_kni_get_name(const struct rte_kni *kni)</div></div>
<div class="ttc" id="arte__eal_8h_html_a5c3f4dddc25e38c5a186ecd8a69260e3"><div class="ttname"><a href="rte__eal_8h.html#a5c3f4dddc25e38c5a186ecd8a69260e3">rte_eal_init</a></div><div class="ttdeci">int rte_eal_init(int argc, char **argv)</div></div>
<div class="ttc" id="astructrte__mempool_html"><div class="ttname"><a href="structrte__mempool.html">rte_mempool</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l00207">rte_mempool.h:207</a></div></div>
<div class="ttc" id="arte__kni_8h_html_ae470743959cbf73648b242d9f7270b02"><div class="ttname"><a href="rte__kni_8h.html#ae470743959cbf73648b242d9f7270b02">rte_kni_tx_burst</a></div><div class="ttdeci">unsigned rte_kni_tx_burst(struct rte_kni *kni, struct rte_mbuf **mbufs, unsigned num)</div></div>
<div class="ttc" id="arte__mbuf_8h_html_a593921f13307803b94bbb4e0932db962"><div class="ttname"><a href="rte__mbuf_8h.html#a593921f13307803b94bbb4e0932db962">rte_pktmbuf_pool_create</a></div><div class="ttdeci">struct rte_mempool * rte_pktmbuf_pool_create(const char *name, unsigned n, unsigned cache_size, uint16_t priv_size, uint16_t data_room_size, int socket_id)</div></div>
<div class="ttc" id="arte__lcore_8h_html_aa0bd7a4983e66d9ea893a98d25262914"><div class="ttname"><a href="rte__lcore_8h.html#aa0bd7a4983e66d9ea893a98d25262914">rte_ctrl_thread_create</a></div><div class="ttdeci">int rte_ctrl_thread_create(pthread_t *thread, const char *name, const pthread_attr_t *attr, void *(*start_routine)(void *), void *arg)</div></div>
<div class="ttc" id="arte__mbuf_8h_html_a1215458932900b7cd5192326fa4a6902"><div class="ttname"><a href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a></div><div class="ttdeci">static void rte_pktmbuf_free(struct rte_mbuf *m)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf_8h_source.html#l01397">rte_mbuf.h:1397</a></div></div>
<div class="ttc" id="arte__lcore_8h_html_ac779e61584eb9d087c3e20bf2d1150c8"><div class="ttname"><a href="rte__lcore_8h.html#ac779e61584eb9d087c3e20bf2d1150c8">RTE_LCORE_FOREACH_WORKER</a></div><div class="ttdeci">#define RTE_LCORE_FOREACH_WORKER(i)</div><div class="ttdef"><b>Definition:</b> <a href="rte__lcore_8h_source.html#l00239">rte_lcore.h:239</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a36ba70a5a6fce2c2c1f774828ba78f8d"><div class="ttname"><a href="rte__ethdev_8h.html#a36ba70a5a6fce2c2c1f774828ba78f8d">rte_eth_rx_queue_setup</a></div><div class="ttdeci">int rte_eth_rx_queue_setup(uint16_t port_id, uint16_t rx_queue_id, uint16_t nb_rx_desc, unsigned int socket_id, const struct rte_eth_rxconf *rx_conf, struct rte_mempool *mb_pool)</div></div>
<div class="ttc" id="arte__kni_8h_html_a0cdd727cdc227d005fef22c0189f3dfe"><div class="ttname"><a href="rte__kni_8h.html#a0cdd727cdc227d005fef22c0189f3dfe">rte_kni_rx_burst</a></div><div class="ttdeci">unsigned rte_kni_rx_burst(struct rte_kni *kni, struct rte_mbuf **mbufs, unsigned num)</div></div>
<div class="ttc" id="arte__mempool_8h_html"><div class="ttname"><a href="rte__mempool_8h.html">rte_mempool.h</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a386c83c7cc16ec9886ecf2925e7be4a3"><div class="ttname"><a href="rte__ethdev_8h.html#a386c83c7cc16ec9886ecf2925e7be4a3">rte_eth_dev_get_mtu</a></div><div class="ttdeci">int rte_eth_dev_get_mtu(uint16_t port_id, uint16_t *mtu)</div></div>
<div class="ttc" id="arte__ethdev_8h_html"><div class="ttname"><a href="rte__ethdev_8h.html">rte_ethdev.h</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a6fc010cf6216331c50bc02d2fd4e614f"><div class="ttname"><a href="rte__ethdev_8h.html#a6fc010cf6216331c50bc02d2fd4e614f">rte_eth_dev_stop</a></div><div class="ttdeci">int rte_eth_dev_stop(uint16_t port_id)</div></div>
<div class="ttc" id="arte__log_8h_html_ac23caeb9833fd0fd0665c6c05ec806fe"><div class="ttname"><a href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a></div><div class="ttdeci">#define RTE_LOG(l, t,...)</div><div class="ttdef"><b>Definition:</b> <a href="rte__log_8h_source.html#l00331">rte_log.h:331</a></div></div>
<div class="ttc" id="arte__mbuf_8h_html"><div class="ttname"><a href="rte__mbuf_8h.html">rte_mbuf.h</a></div></div>
<div class="ttc" id="arte__launch_8h_html"><div class="ttname"><a href="rte__launch_8h.html">rte_launch.h</a></div></div>
<div class="ttc" id="astructrte__eth__conf_html_a1c33c9d2e5cdb14b62ed386bf3159e07"><div class="ttname"><a href="structrte__eth__conf.html#a1c33c9d2e5cdb14b62ed386bf3159e07">rte_eth_conf::txmode</a></div><div class="ttdeci">struct rte_eth_txmode txmode</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01294">rte_ethdev.h:1302</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a7a31d6736244603b6a1d7efdd32a8834"><div class="ttname"><a href="rte__ethdev_8h.html#a7a31d6736244603b6a1d7efdd32a8834">RTE_ETH_LINK_MAX_STR_LEN</a></div><div class="ttdeci">#define RTE_ETH_LINK_MAX_STR_LEN</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00327">rte_ethdev.h:327</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a8d1b91521b0308b3b462095e25ba521a"><div class="ttname"><a href="rte__ethdev_8h.html#a8d1b91521b0308b3b462095e25ba521a">rte_eth_dev_default_mac_addr_set</a></div><div class="ttdeci">int rte_eth_dev_default_mac_addr_set(uint16_t port_id, struct rte_ether_addr *mac_addr)</div></div>
<div class="ttc" id="arte__launch_8h_html_a7fe96b0e5d3a6a8cf9b8d1a27cf3f159ad00c59bb386320b2ba3198d3149a0c35"><div class="ttname"><a href="rte__launch_8h.html#a7fe96b0e5d3a6a8cf9b8d1a27cf3f159ad00c59bb386320b2ba3198d3149a0c35">CALL_MAIN</a></div><div class="ttdeci">@ CALL_MAIN</div><div class="ttdef"><b>Definition:</b> <a href="rte__launch_8h_source.html#l00073">rte_launch.h:73</a></div></div>
<div class="ttc" id="arte__kni_8h_html_a6f0e3bfe35ac99edbf07dd709d294176"><div class="ttname"><a href="rte__kni_8h.html#a6f0e3bfe35ac99edbf07dd709d294176">rte_kni_alloc</a></div><div class="ttdeci">struct rte_kni * rte_kni_alloc(struct rte_mempool *pktmbuf_pool, const struct rte_kni_conf *conf, struct rte_kni_ops *ops)</div></div>
<div class="ttc" id="astructrte__eth__dev__info_html"><div class="ttname"><a href="structrte__eth__dev__info.html">rte_eth_dev_info</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01504">rte_ethdev.h:1504</a></div></div>
<div class="ttc" id="astructrte__ether__addr_html"><div class="ttname"><a href="structrte__ether__addr.html">rte_ether_addr</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00064">rte_ether.h:64</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ad7b46c67203d37fe3a34f11076d970d6"><div class="ttname"><a href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a></div><div class="ttdeci">#define RTE_ETH_FOREACH_DEV(p)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01858">rte_ethdev.h:1858</a></div></div>
<div class="ttc" id="astructrte__eth__conf_html"><div class="ttname"><a href="structrte__eth__conf.html">rte_eth_conf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01293">rte_ethdev.h:1293</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ad032e25f712e6ffeb0c19eab1ec1fd2e"><div class="ttname"><a href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a></div><div class="ttdeci">int rte_eth_dev_socket_id(uint16_t port_id)</div></div>
<div class="ttc" id="arte__malloc_8h_html_a1fc82f67711b13aca7e05dc9d58f9dbd"><div class="ttname"><a href="rte__malloc_8h.html#a1fc82f67711b13aca7e05dc9d58f9dbd">rte_free</a></div><div class="ttdeci">void void rte_free(void *ptr)</div></div>
<div class="ttc" id="arte__per__lcore_8h_html"><div class="ttname"><a href="rte__per__lcore_8h.html">rte_per_lcore.h</a></div></div>
<div class="ttc" id="arte__kni_8h_html_aa0de3e5e9b4716570ec8238516643faf"><div class="ttname"><a href="rte__kni_8h.html#aa0de3e5e9b4716570ec8238516643faf">rte_kni_update_link</a></div><div class="ttdeci">__rte_experimental int rte_kni_update_link(struct rte_kni *kni, unsigned int linkup)</div></div>
<div class="ttc" id="astructrte__atomic32__t_html"><div class="ttname"><a href="structrte__atomic32__t.html">rte_atomic32_t</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__atomic_8h_source.html#l00472">rte_atomic.h:472</a></div></div>
<div class="ttc" id="arte__kni_8h_html_a2553989d30dbaf1b2681e1b145ae7af5"><div class="ttname"><a href="rte__kni_8h.html#a2553989d30dbaf1b2681e1b145ae7af5">rte_kni_init</a></div><div class="ttdeci">int rte_kni_init(unsigned int max_kni_ifaces)</div></div>
<div class="ttc" id="arte__cycles_8h_html_af73b844d50b98de74b1a0e1730262f85"><div class="ttname"><a href="rte__cycles_8h.html#af73b844d50b98de74b1a0e1730262f85">rte_delay_ms</a></div><div class="ttdeci">static void rte_delay_ms(unsigned ms)</div><div class="ttdef"><b>Definition:</b> <a href="rte__cycles_8h_source.html#l00148">rte_cycles.h:148</a></div></div>
<div class="ttc" id="arte__kni_8h_html_acd52d6e1e302e3bb87de6d786b3c5cc1"><div class="ttname"><a href="rte__kni_8h.html#acd52d6e1e302e3bb87de6d786b3c5cc1">rte_kni_handle_request</a></div><div class="ttdeci">int rte_kni_handle_request(struct rte_kni *kni)</div></div>
<div class="ttc" id="arte__ether_8h_html_af1fb088707ce5b2ebb7825cb69b5cb58"><div class="ttname"><a href="rte__ether_8h.html#af1fb088707ce5b2ebb7825cb69b5cb58">RTE_ETHER_MAX_LEN</a></div><div class="ttdeci">#define RTE_ETHER_MAX_LEN</div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00037">rte_ether.h:37</a></div></div>
<div class="ttc" id="arte__launch_8h_html_ae9500e1d35bd4cfb95d18c0be863cb1e"><div class="ttname"><a href="rte__launch_8h.html#ae9500e1d35bd4cfb95d18c0be863cb1e">rte_eal_wait_lcore</a></div><div class="ttdeci">int rte_eal_wait_lcore(unsigned worker_id)</div></div>
<div class="ttc" id="arte__atomic_8h_html_ab3041cc6a6a379e14e76dfcb61bec152"><div class="ttname"><a href="rte__atomic_8h.html#ab3041cc6a6a379e14e76dfcb61bec152">rte_atomic32_read</a></div><div class="ttdeci">static int32_t rte_atomic32_read(const rte_atomic32_t *v)</div><div class="ttdef"><b>Definition:</b> <a href="rte__atomic_8h_source.html#l00502">rte_atomic.h:502</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
