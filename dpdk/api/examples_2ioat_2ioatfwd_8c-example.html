<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DPDK: examples/ioat/ioatfwd.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">20.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">examples/ioat/ioatfwd.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/* SPDX-License-Identifier: BSD-3-Clause</span></div>
<div class="line"><span class="comment"> * Copyright(c) 2019 Intel Corporation</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ethdev_8h.html">rte_ethdev.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__rawdev_8h.html">rte_rawdev.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ioat__rawdev_8h.html">rte_ioat_rawdev.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* size of ring used for software copying between rx and tx. */</span></div>
<div class="line"><span class="preprocessor">#define RTE_LOGTYPE_IOAT RTE_LOGTYPE_USER1</span></div>
<div class="line"><span class="preprocessor">#define MAX_PKT_BURST 32</span></div>
<div class="line"><span class="preprocessor">#define MEMPOOL_CACHE_SIZE 512</span></div>
<div class="line"><span class="preprocessor">#define MIN_POOL_SIZE 65536U</span></div>
<div class="line"><span class="preprocessor">#define CMD_LINE_OPT_MAC_UPDATING &quot;mac-updating&quot;</span></div>
<div class="line"><span class="preprocessor">#define CMD_LINE_OPT_NO_MAC_UPDATING &quot;no-mac-updating&quot;</span></div>
<div class="line"><span class="preprocessor">#define CMD_LINE_OPT_PORTMASK &quot;portmask&quot;</span></div>
<div class="line"><span class="preprocessor">#define CMD_LINE_OPT_NB_QUEUE &quot;nb-queue&quot;</span></div>
<div class="line"><span class="preprocessor">#define CMD_LINE_OPT_COPY_TYPE &quot;copy-type&quot;</span></div>
<div class="line"><span class="preprocessor">#define CMD_LINE_OPT_RING_SIZE &quot;ring-size&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* configurable number of RX/TX ring descriptors */</span></div>
<div class="line"><span class="preprocessor">#define RX_DEFAULT_RINGSIZE 1024</span></div>
<div class="line"><span class="preprocessor">#define TX_DEFAULT_RINGSIZE 1024</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* max number of RX queues per port */</span></div>
<div class="line"><span class="preprocessor">#define MAX_RX_QUEUES_COUNT 8</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>rxtx_port_config {</div>
<div class="line">    <span class="comment">/* common config */</span></div>
<div class="line">    uint16_t rxtx_port;</div>
<div class="line">    uint16_t nb_queues;</div>
<div class="line">    <span class="comment">/* for software copy mode */</span></div>
<div class="line">    <span class="keyword">struct </span><a name="_a0"></a><a class="code" href="structrte__ring.html">rte_ring</a> *rx_to_tx_ring;</div>
<div class="line">    <span class="comment">/* for IOAT rawdev copy mode */</span></div>
<div class="line">    uint16_t ioat_ids[MAX_RX_QUEUES_COUNT];</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>rxtx_transmission_config {</div>
<div class="line">    <span class="keyword">struct </span>rxtx_port_config ports[RTE_MAX_ETHPORTS];</div>
<div class="line">    uint16_t nb_ports;</div>
<div class="line">    uint16_t nb_lcores;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* per-port statistics struct */</span></div>
<div class="line"><span class="keyword">struct </span>ioat_port_statistics {</div>
<div class="line">    uint64_t rx[RTE_MAX_ETHPORTS];</div>
<div class="line">    uint64_t tx[RTE_MAX_ETHPORTS];</div>
<div class="line">    uint64_t tx_dropped[RTE_MAX_ETHPORTS];</div>
<div class="line">    uint64_t copy_dropped[RTE_MAX_ETHPORTS];</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>ioat_port_statistics port_statistics;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>total_statistics {</div>
<div class="line">    uint64_t total_packets_dropped;</div>
<div class="line">    uint64_t total_packets_tx;</div>
<div class="line">    uint64_t total_packets_rx;</div>
<div class="line">    uint64_t total_successful_enqueues;</div>
<div class="line">    uint64_t total_failed_enqueues;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> copy_mode_t {</div>
<div class="line"><span class="preprocessor">#define COPY_MODE_SW &quot;sw&quot;</span></div>
<div class="line">    COPY_MODE_SW_NUM,</div>
<div class="line"><span class="preprocessor">#define COPY_MODE_IOAT &quot;hw&quot;</span></div>
<div class="line">    COPY_MODE_IOAT_NUM,</div>
<div class="line">    COPY_MODE_INVALID_NUM,</div>
<div class="line">    COPY_MODE_SIZE_NUM = COPY_MODE_INVALID_NUM</div>
<div class="line">} copy_mode_t;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* mask of enabled ports */</span></div>
<div class="line"><span class="keyword">static</span> uint32_t ioat_enabled_port_mask;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* number of RX queues per port */</span></div>
<div class="line"><span class="keyword">static</span> uint16_t nb_queues = 1;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* MAC updating enabled by default. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> mac_updating = 1;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* hardare copy mode enabled by default. */</span></div>
<div class="line"><span class="keyword">static</span> copy_mode_t copy_mode = COPY_MODE_IOAT_NUM;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* size of IOAT rawdev ring for hardware copy mode or</span></div>
<div class="line"><span class="comment"> * rte_ring for software copy mode</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> ring_size = 2048;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* global transmission config */</span></div>
<div class="line"><span class="keyword">struct </span>rxtx_transmission_config cfg;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* configurable number of RX/TX ring descriptors */</span></div>
<div class="line"><span class="keyword">static</span> uint16_t nb_rxd = RX_DEFAULT_RINGSIZE;</div>
<div class="line"><span class="keyword">static</span> uint16_t nb_txd = TX_DEFAULT_RINGSIZE;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span> force_quit;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ethernet addresses of ports */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a name="_a1"></a><a class="code" href="structrte__ether__addr.html">rte_ether_addr</a> ioat_ports_eth_addr[RTE_MAX_ETHPORTS];</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a name="_a2"></a><a class="code" href="structrte__eth__dev__tx__buffer.html">rte_eth_dev_tx_buffer</a> *tx_buffer[RTE_MAX_ETHPORTS];</div>
<div class="line"><span class="keyword">struct </span><a name="_a3"></a><a class="code" href="structrte__mempool.html">rte_mempool</a> *ioat_pktmbuf_pool;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Print out statistics for one port. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_port_stats(uint16_t port_id)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nStatistics for port %u ------------------------------&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\nPackets sent: %34&quot;</span>PRIu64</div>
<div class="line">        <span class="stringliteral">&quot;\nPackets received: %30&quot;</span>PRIu64</div>
<div class="line">        <span class="stringliteral">&quot;\nPackets dropped on tx: %25&quot;</span>PRIu64</div>
<div class="line">        <span class="stringliteral">&quot;\nPackets dropped on copy: %23&quot;</span>PRIu64,</div>
<div class="line">        port_id,</div>
<div class="line">        port_statistics.tx[port_id],</div>
<div class="line">        port_statistics.rx[port_id],</div>
<div class="line">        port_statistics.tx_dropped[port_id],</div>
<div class="line">        port_statistics.copy_dropped[port_id]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Print out statistics for one IOAT rawdev device. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_rawdev_stats(uint32_t dev_id, uint64_t *xstats,</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *ids_xstats, uint16_t nb_xstats,</div>
<div class="line">    <span class="keyword">struct</span> <a name="_a4"></a><a class="code" href="structrte__rawdev__xstats__name.html">rte_rawdev_xstats_name</a> *names_xstats)</div>
<div class="line">{</div>
<div class="line">    uint16_t i;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\nIOAT channel %u&quot;</span>, dev_id);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_xstats; i++)</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n\t %s: %*&quot;</span>PRIu64,</div>
<div class="line">            names_xstats[ids_xstats[i]].<a name="a5"></a><a class="code" href="structrte__mempool.html#a1a1c0270e433d8ce66b34d3bd7c713fd">name</a>,</div>
<div class="line">            (<span class="keywordtype">int</span>)(37 - strlen(names_xstats[ids_xstats[i]].<a class="code" href="structrte__mempool.html#a1a1c0270e433d8ce66b34d3bd7c713fd">name</a>)),</div>
<div class="line">            xstats[i]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_total_stats(<span class="keyword">struct</span> total_statistics *ts)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nAggregate statistics ===============================&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\nTotal packets Tx: %24&quot;</span>PRIu64<span class="stringliteral">&quot; [pps]&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\nTotal packets Rx: %24&quot;</span>PRIu64<span class="stringliteral">&quot; [pps]&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\nTotal packets dropped: %19&quot;</span>PRIu64<span class="stringliteral">&quot; [pps]&quot;</span>,</div>
<div class="line">        ts-&gt;total_packets_tx,</div>
<div class="line">        ts-&gt;total_packets_rx,</div>
<div class="line">        ts-&gt;total_packets_dropped);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (copy_mode == COPY_MODE_IOAT_NUM) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;\nTotal IOAT successful enqueues: %8&quot;</span>PRIu64<span class="stringliteral">&quot; [enq/s]&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;\nTotal IOAT failed enqueues: %12&quot;</span>PRIu64<span class="stringliteral">&quot; [enq/s]&quot;</span>,</div>
<div class="line">            ts-&gt;total_successful_enqueues,</div>
<div class="line">            ts-&gt;total_failed_enqueues);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\n====================================================\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Print out statistics on packets dropped. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_stats(<span class="keywordtype">char</span> *prgname)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>total_statistics ts, delta_ts;</div>
<div class="line">    uint32_t i, port_id, dev_id;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__rawdev__xstats__name.html">rte_rawdev_xstats_name</a> *names_xstats;</div>
<div class="line">    uint64_t *xstats;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *ids_xstats, nb_xstats;</div>
<div class="line">    <span class="keywordtype">char</span> status_string[255]; <span class="comment">/* to print at the top of the output */</span></div>
<div class="line">    <span class="keywordtype">int</span> status_strlen;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> clr[] = { 27, <span class="charliteral">&#39;[&#39;</span>, <span class="charliteral">&#39;2&#39;</span>, <span class="charliteral">&#39;J&#39;</span>, <span class="charliteral">&#39;\0&#39;</span> };</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> topLeft[] = { 27, <span class="charliteral">&#39;[&#39;</span>, <span class="charliteral">&#39;1&#39;</span>, <span class="charliteral">&#39;;&#39;</span>, <span class="charliteral">&#39;1&#39;</span>, <span class="charliteral">&#39;H&#39;</span>, <span class="charliteral">&#39;\0&#39;</span> };</div>
<div class="line"> </div>
<div class="line">    status_strlen = snprintf(status_string, <span class="keyword">sizeof</span>(status_string),</div>
<div class="line">        <span class="stringliteral">&quot;%s, &quot;</span>, prgname);</div>
<div class="line">    status_strlen += snprintf(status_string + status_strlen,</div>
<div class="line">        <span class="keyword">sizeof</span>(status_string) - status_strlen,</div>
<div class="line">        <span class="stringliteral">&quot;Worker Threads = %d, &quot;</span>,</div>
<div class="line">        <a name="a6"></a><a class="code" href="rte__lcore_8h.html#a1728dc7f14571ba778d3b5b41aa09283">rte_lcore_count</a>() &gt; 2 ? 2 : 1);</div>
<div class="line">    status_strlen += snprintf(status_string + status_strlen,</div>
<div class="line">        <span class="keyword">sizeof</span>(status_string) - status_strlen,</div>
<div class="line">        <span class="stringliteral">&quot;Copy Mode = %s,\n&quot;</span>, copy_mode == COPY_MODE_SW_NUM ?</div>
<div class="line">        COPY_MODE_SW : COPY_MODE_IOAT);</div>
<div class="line">    status_strlen += snprintf(status_string + status_strlen,</div>
<div class="line">        <span class="keyword">sizeof</span>(status_string) - status_strlen,</div>
<div class="line">        <span class="stringliteral">&quot;Updating MAC = %s, &quot;</span>, mac_updating ?</div>
<div class="line">        <span class="stringliteral">&quot;enabled&quot;</span> : <span class="stringliteral">&quot;disabled&quot;</span>);</div>
<div class="line">    status_strlen += snprintf(status_string + status_strlen,</div>
<div class="line">        <span class="keyword">sizeof</span>(status_string) - status_strlen,</div>
<div class="line">        <span class="stringliteral">&quot;Rx Queues = %d, &quot;</span>, nb_queues);</div>
<div class="line">    status_strlen += snprintf(status_string + status_strlen,</div>
<div class="line">        <span class="keyword">sizeof</span>(status_string) - status_strlen,</div>
<div class="line">        <span class="stringliteral">&quot;Ring Size = %d&quot;</span>, ring_size);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Allocate memory for xstats names and values */</span></div>
<div class="line">    ret = <a name="a7"></a><a class="code" href="rte__rawdev_8h.html#ae293a5d25d141ee348012c140d48b450">rte_rawdev_xstats_names_get</a>(</div>
<div class="line">        cfg.ports[0].ioat_ids[0], NULL, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    nb_xstats = (<span class="keywordtype">unsigned</span> int)ret;</div>
<div class="line"> </div>
<div class="line">    names_xstats = malloc(<span class="keyword">sizeof</span>(*names_xstats) * nb_xstats);</div>
<div class="line">    <span class="keywordflow">if</span> (names_xstats == NULL) {</div>
<div class="line">        <a name="a8"></a><a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Error allocating xstat names memory\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="rte__rawdev_8h.html#ae293a5d25d141ee348012c140d48b450">rte_rawdev_xstats_names_get</a>(cfg.ports[0].ioat_ids[0],</div>
<div class="line">        names_xstats, nb_xstats);</div>
<div class="line"> </div>
<div class="line">    ids_xstats = malloc(<span class="keyword">sizeof</span>(*ids_xstats) * 2);</div>
<div class="line">    <span class="keywordflow">if</span> (ids_xstats == NULL) {</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Error allocating xstat ids_xstats memory\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    xstats = malloc(<span class="keyword">sizeof</span>(*xstats) * 2);</div>
<div class="line">    <span class="keywordflow">if</span> (xstats == NULL) {</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Error allocating xstat memory\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Get failed/successful enqueues stats index */</span></div>
<div class="line">    ids_xstats[0] = ids_xstats[1] = nb_xstats;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_xstats; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (!strcmp(names_xstats[i].name, <span class="stringliteral">&quot;failed_enqueues&quot;</span>))</div>
<div class="line">            ids_xstats[0] = i;</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(names_xstats[i].name, <span class="stringliteral">&quot;successful_enqueues&quot;</span>))</div>
<div class="line">            ids_xstats[1] = i;</div>
<div class="line">        <span class="keywordflow">if</span> (ids_xstats[0] &lt; nb_xstats &amp;&amp; ids_xstats[1] &lt; nb_xstats)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (ids_xstats[0] == nb_xstats || ids_xstats[1] == nb_xstats) {</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Error getting failed/successful enqueues stats index\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    memset(&amp;ts, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> total_statistics));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (!force_quit) {</div>
<div class="line">        <span class="comment">/* Sleep for 1 second each round - init sleep allows reading</span></div>
<div class="line"><span class="comment">         * messages from app startup.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        sleep(1);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Clear screen and move to top left */</span></div>
<div class="line">        printf(<span class="stringliteral">&quot;%s%s&quot;</span>, clr, topLeft);</div>
<div class="line"> </div>
<div class="line">        memset(&amp;delta_ts, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> total_statistics));</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;%s\n&quot;</span>, status_string);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; cfg.nb_ports; i++) {</div>
<div class="line">            port_id = cfg.ports[i].rxtx_port;</div>
<div class="line">            print_port_stats(port_id);</div>
<div class="line"> </div>
<div class="line">            delta_ts.total_packets_dropped +=</div>
<div class="line">                port_statistics.tx_dropped[port_id]</div>
<div class="line">                + port_statistics.copy_dropped[port_id];</div>
<div class="line">            delta_ts.total_packets_tx +=</div>
<div class="line">                port_statistics.tx[port_id];</div>
<div class="line">            delta_ts.total_packets_rx +=</div>
<div class="line">                port_statistics.rx[port_id];</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (copy_mode == COPY_MODE_IOAT_NUM) {</div>
<div class="line">                uint32_t j;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; cfg.ports[i].nb_queues; j++) {</div>
<div class="line">                    dev_id = cfg.ports[i].ioat_ids[j];</div>
<div class="line">                    <a name="a9"></a><a class="code" href="rte__rawdev_8h.html#a23a6cb31d4c8ff7d7f46d9e24aa71230">rte_rawdev_xstats_get</a>(dev_id,</div>
<div class="line">                        ids_xstats, xstats, 2);</div>
<div class="line"> </div>
<div class="line">                    print_rawdev_stats(dev_id, xstats,</div>
<div class="line">                        ids_xstats, 2, names_xstats);</div>
<div class="line"> </div>
<div class="line">                    delta_ts.total_failed_enqueues +=</div>
<div class="line">                        xstats[ids_xstats[0]];</div>
<div class="line">                    delta_ts.total_successful_enqueues +=</div>
<div class="line">                        xstats[ids_xstats[1]];</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        delta_ts.total_packets_tx -= ts.total_packets_tx;</div>
<div class="line">        delta_ts.total_packets_rx -= ts.total_packets_rx;</div>
<div class="line">        delta_ts.total_packets_dropped -= ts.total_packets_dropped;</div>
<div class="line">        delta_ts.total_failed_enqueues -= ts.total_failed_enqueues;</div>
<div class="line">        delta_ts.total_successful_enqueues -=</div>
<div class="line">            ts.total_successful_enqueues;</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">        print_total_stats(&amp;delta_ts);</div>
<div class="line"> </div>
<div class="line">        fflush(stdout);</div>
<div class="line"> </div>
<div class="line">        ts.total_packets_tx += delta_ts.total_packets_tx;</div>
<div class="line">        ts.total_packets_rx += delta_ts.total_packets_rx;</div>
<div class="line">        ts.total_packets_dropped += delta_ts.total_packets_dropped;</div>
<div class="line">        ts.total_failed_enqueues += delta_ts.total_failed_enqueues;</div>
<div class="line">        ts.total_successful_enqueues +=</div>
<div class="line">            delta_ts.total_successful_enqueues;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    free(names_xstats);</div>
<div class="line">    free(xstats);</div>
<div class="line">    free(ids_xstats);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">update_mac_addrs(<span class="keyword">struct</span> <a name="_a10"></a><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *m, uint32_t dest_portid)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a11"></a><a class="code" href="structrte__ether__hdr.html">rte_ether_hdr</a> *eth;</div>
<div class="line">    <span class="keywordtype">void</span> *tmp;</div>
<div class="line"> </div>
<div class="line">    eth = <a name="a12"></a><a class="code" href="rte__mbuf__core_8h.html#a2a8b10263496c7b580e9d0c7f2a1f073">rte_pktmbuf_mtod</a>(m, <span class="keyword">struct</span> <a class="code" href="structrte__ether__hdr.html">rte_ether_hdr</a> *);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* 02:00:00:00:00:xx - overwriting 2 bytes of source address but</span></div>
<div class="line"><span class="comment">     * it&#39;s acceptable cause it gets overwritten by rte_ether_addr_copy</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    tmp = &amp;eth-&gt;<a name="a13"></a><a class="code" href="structrte__ether__hdr.html#a1d579e2782d36729c1f73608d8663124">d_addr</a>.<a name="a14"></a><a class="code" href="structrte__ether__addr.html#ad6f7cb65b39d12b5250ecf82c8ffaa45">addr_bytes</a>[0];</div>
<div class="line">    *((uint64_t *)tmp) = 0x000000000002 + ((uint64_t)dest_portid &lt;&lt; 40);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* src addr */</span></div>
<div class="line">    <a name="a15"></a><a class="code" href="rte__ether_8h.html#af5e7040b36584eacec1c5b9eee086eac">rte_ether_addr_copy</a>(&amp;ioat_ports_eth_addr[dest_portid], &amp;eth-&gt;<a name="a16"></a><a class="code" href="structrte__ether__hdr.html#acce632e0fded0f728a1ee1a1ffb5c9bf">s_addr</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span></div>
<div class="line">pktmbuf_sw_copy(<span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a> *src, <span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a> *dst)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Copy packet metadata */</span></div>
<div class="line">    <a name="a17"></a><a class="code" href="rte__memcpy_8h.html#a09f4d8cdb1a7c25398a363906e1db8cd">rte_memcpy</a>(&amp;dst-&gt;rearm_data,</div>
<div class="line">        &amp;src-&gt;rearm_data,</div>
<div class="line">        <a name="a18"></a><a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(<span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a>, cacheline1)</div>
<div class="line">        - <a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(<span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a>, rearm_data));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Copy packet data */</span></div>
<div class="line">    <a class="code" href="rte__memcpy_8h.html#a09f4d8cdb1a7c25398a363906e1db8cd">rte_memcpy</a>(<a class="code" href="rte__mbuf__core_8h.html#a2a8b10263496c7b580e9d0c7f2a1f073">rte_pktmbuf_mtod</a>(dst, <span class="keywordtype">char</span> *),</div>
<div class="line">        <a class="code" href="rte__mbuf__core_8h.html#a2a8b10263496c7b580e9d0c7f2a1f073">rte_pktmbuf_mtod</a>(src, <span class="keywordtype">char</span> *), src-&gt;data_len);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> uint32_t</div>
<div class="line">ioat_enqueue_packets(<span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a> **pkts,</div>
<div class="line">    uint32_t nb_rx, uint16_t dev_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *pkts_copy[MAX_PKT_BURST];</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> uint64_t addr_offset = <a name="a19"></a><a class="code" href="rte__common_8h.html#a59dd2418e7278f66471590e1fc8aa3cf">RTE_PTR_DIFF</a>(pkts[0]-&gt;<a name="a20"></a><a class="code" href="structrte__mbuf.html#a9db3d388a1381e68e509017a6e7d0f12">buf_addr</a>,</div>
<div class="line">        &amp;pkts[0]-&gt;rearm_data);</div>
<div class="line"> </div>
<div class="line">    ret = <a name="a21"></a><a class="code" href="rte__mempool_8h.html#a0d326354d53ef5068d86a8b7d9ec2d61">rte_mempool_get_bulk</a>(ioat_pktmbuf_pool,</div>
<div class="line">        (<span class="keywordtype">void</span> *)pkts_copy, nb_rx);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a22"></a><a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(ret &lt; 0))</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Unable to allocate memory.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_rx; i++) {</div>
<div class="line">        <span class="comment">/* Perform data copy */</span></div>
<div class="line">        ret = <a name="a23"></a><a class="code" href="rte__ioat__rawdev_8h.html#a8e39d2c68cc67b5c8a364fe5c2853f94">rte_ioat_enqueue_copy</a>(dev_id,</div>
<div class="line">            pkts[i]-&gt;buf_iova - addr_offset,</div>
<div class="line">            pkts_copy[i]-&gt;buf_iova - addr_offset,</div>
<div class="line">            <a name="a24"></a><a class="code" href="rte__mbuf_8h.html#a2a1e1b30162161ed11d3ba2faf7bbf13">rte_pktmbuf_data_len</a>(pkts[i]) + addr_offset,</div>
<div class="line">            (uintptr_t)pkts[i],</div>
<div class="line">            (uintptr_t)pkts_copy[i]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (ret != 1)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ret = i;</div>
<div class="line">    <span class="comment">/* Free any not enqueued packets. */</span></div>
<div class="line">    <a name="a25"></a><a class="code" href="rte__mempool_8h.html#a5e46fc827d764e516e8ff0c3f00e33fc">rte_mempool_put_bulk</a>(ioat_pktmbuf_pool, (<span class="keywordtype">void</span> *)&amp;pkts[i], nb_rx - i);</div>
<div class="line">    <a class="code" href="rte__mempool_8h.html#a5e46fc827d764e516e8ff0c3f00e33fc">rte_mempool_put_bulk</a>(ioat_pktmbuf_pool, (<span class="keywordtype">void</span> *)&amp;pkts_copy[i],</div>
<div class="line">        nb_rx - i);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Receive packets on one port and enqueue to IOAT rawdev or rte_ring. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">ioat_rx_port(<span class="keyword">struct</span> rxtx_port_config *rx_config)</div>
<div class="line">{</div>
<div class="line">    uint32_t nb_rx, nb_enq, i, j;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *pkts_burst[MAX_PKT_BURST];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; rx_config-&gt;nb_queues; i++) {</div>
<div class="line"> </div>
<div class="line">        nb_rx = <a name="a26"></a><a class="code" href="rte__ethdev_8h.html#a3e7d76a451b46348686ea97d6367f102">rte_eth_rx_burst</a>(rx_config-&gt;rxtx_port, i,</div>
<div class="line">            pkts_burst, MAX_PKT_BURST);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (nb_rx == 0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        port_statistics.rx[rx_config-&gt;rxtx_port] += nb_rx;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (copy_mode == COPY_MODE_IOAT_NUM) {</div>
<div class="line">            <span class="comment">/* Perform packet hardware copy */</span></div>
<div class="line">            nb_enq = ioat_enqueue_packets(pkts_burst,</div>
<div class="line">                nb_rx, rx_config-&gt;ioat_ids[i]);</div>
<div class="line">            <span class="keywordflow">if</span> (nb_enq &gt; 0)</div>
<div class="line">                <a name="a27"></a><a class="code" href="rte__ioat__rawdev_8h.html#a1e753508b96f22b06207458423104dca">rte_ioat_perform_ops</a>(rx_config-&gt;ioat_ids[i]);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">/* Perform packet software copy, free source packets */</span></div>
<div class="line">            <span class="keywordtype">int</span> ret;</div>
<div class="line">            <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *pkts_burst_copy[MAX_PKT_BURST];</div>
<div class="line"> </div>
<div class="line">            ret = <a class="code" href="rte__mempool_8h.html#a0d326354d53ef5068d86a8b7d9ec2d61">rte_mempool_get_bulk</a>(ioat_pktmbuf_pool,</div>
<div class="line">                (<span class="keywordtype">void</span> *)pkts_burst_copy, nb_rx);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(ret &lt; 0))</div>
<div class="line">                <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                    <span class="stringliteral">&quot;Unable to allocate memory.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; nb_rx; j++)</div>
<div class="line">                pktmbuf_sw_copy(pkts_burst[j],</div>
<div class="line">                    pkts_burst_copy[j]);</div>
<div class="line"> </div>
<div class="line">            <a class="code" href="rte__mempool_8h.html#a5e46fc827d764e516e8ff0c3f00e33fc">rte_mempool_put_bulk</a>(ioat_pktmbuf_pool,</div>
<div class="line">                (<span class="keywordtype">void</span> *)pkts_burst, nb_rx);</div>
<div class="line"> </div>
<div class="line">            nb_enq = <a name="a28"></a><a class="code" href="rte__ring_8h.html#a85ad08ed07e2e485c94466e03bf252c4">rte_ring_enqueue_burst</a>(</div>
<div class="line">                rx_config-&gt;rx_to_tx_ring,</div>
<div class="line">                (<span class="keywordtype">void</span> *)pkts_burst_copy, nb_rx, NULL);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* Free any not enqueued packets. */</span></div>
<div class="line">            <a class="code" href="rte__mempool_8h.html#a5e46fc827d764e516e8ff0c3f00e33fc">rte_mempool_put_bulk</a>(ioat_pktmbuf_pool,</div>
<div class="line">                (<span class="keywordtype">void</span> *)&amp;pkts_burst_copy[nb_enq],</div>
<div class="line">                nb_rx - nb_enq);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        port_statistics.copy_dropped[rx_config-&gt;rxtx_port] +=</div>
<div class="line">            (nb_rx - nb_enq);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Transmit packets from IOAT rawdev/rte_ring for one port. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">ioat_tx_port(<span class="keyword">struct</span> rxtx_port_config *tx_config)</div>
<div class="line">{</div>
<div class="line">    uint32_t i, j, nb_dq = 0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *mbufs_src[MAX_PKT_BURST];</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *mbufs_dst[MAX_PKT_BURST];</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; tx_config-&gt;nb_queues; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (copy_mode == COPY_MODE_IOAT_NUM) {</div>
<div class="line">            <span class="comment">/* Deque the mbufs from IOAT device. */</span></div>
<div class="line">            nb_dq = <a name="a29"></a><a class="code" href="rte__ioat__rawdev_8h.html#ab7de49248803a8630ec41d08c702853d">rte_ioat_completed_ops</a>(</div>
<div class="line">                tx_config-&gt;ioat_ids[i], MAX_PKT_BURST,</div>
<div class="line">                (<span class="keywordtype">void</span> *)mbufs_src, (<span class="keywordtype">void</span> *)mbufs_dst);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">/* Deque the mbufs from rx_to_tx_ring. */</span></div>
<div class="line">            nb_dq = <a name="a30"></a><a class="code" href="rte__ring_8h.html#a9dd35643c4cdc6fa00ece3cafbcd94d2">rte_ring_dequeue_burst</a>(</div>
<div class="line">                tx_config-&gt;rx_to_tx_ring, (<span class="keywordtype">void</span> *)mbufs_dst,</div>
<div class="line">                MAX_PKT_BURST, NULL);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((int32_t) nb_dq &lt;= 0)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (copy_mode == COPY_MODE_IOAT_NUM)</div>
<div class="line">            <a class="code" href="rte__mempool_8h.html#a5e46fc827d764e516e8ff0c3f00e33fc">rte_mempool_put_bulk</a>(ioat_pktmbuf_pool,</div>
<div class="line">                (<span class="keywordtype">void</span> *)mbufs_src, nb_dq);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Update macs if enabled */</span></div>
<div class="line">        <span class="keywordflow">if</span> (mac_updating) {</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; nb_dq; j++)</div>
<div class="line">                update_mac_addrs(mbufs_dst[j],</div>
<div class="line">                    tx_config-&gt;rxtx_port);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> uint16_t nb_tx = <a name="a31"></a><a class="code" href="rte__ethdev_8h.html#a83e56cabbd31637efd648e3fc010392b">rte_eth_tx_burst</a>(</div>
<div class="line">            tx_config-&gt;rxtx_port, 0,</div>
<div class="line">            (<span class="keywordtype">void</span> *)mbufs_dst, nb_dq);</div>
<div class="line"> </div>
<div class="line">        port_statistics.tx[tx_config-&gt;rxtx_port] += nb_tx;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Free any unsent packets. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(nb_tx &lt; nb_dq))</div>
<div class="line">            <a class="code" href="rte__mempool_8h.html#a5e46fc827d764e516e8ff0c3f00e33fc">rte_mempool_put_bulk</a>(ioat_pktmbuf_pool,</div>
<div class="line">            (<span class="keywordtype">void</span> *)&amp;mbufs_dst[nb_tx],</div>
<div class="line">                nb_dq - nb_tx);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Main rx processing loop for IOAT rawdev. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">rx_main_loop(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint16_t i;</div>
<div class="line">    uint16_t nb_ports = cfg.nb_ports;</div>
<div class="line"> </div>
<div class="line">    <a name="a32"></a><a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, IOAT, <span class="stringliteral">&quot;Entering main rx loop for copy on lcore %u\n&quot;</span>,</div>
<div class="line">        <a name="a33"></a><a class="code" href="rte__lcore_8h.html#adfb2b334e7e73f534f25e8888a8a775f">rte_lcore_id</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (!force_quit)</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; nb_ports; i++)</div>
<div class="line">            ioat_rx_port(&amp;cfg.ports[i]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Main tx processing loop for hardware copy. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">tx_main_loop(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint16_t i;</div>
<div class="line">    uint16_t nb_ports = cfg.nb_ports;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, IOAT, <span class="stringliteral">&quot;Entering main tx loop for copy on lcore %u\n&quot;</span>,</div>
<div class="line">        <a class="code" href="rte__lcore_8h.html#adfb2b334e7e73f534f25e8888a8a775f">rte_lcore_id</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (!force_quit)</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; nb_ports; i++)</div>
<div class="line">            ioat_tx_port(&amp;cfg.ports[i]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Main rx and tx loop if only one worker lcore available */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">rxtx_main_loop(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint16_t i;</div>
<div class="line">    uint16_t nb_ports = cfg.nb_ports;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, IOAT, <span class="stringliteral">&quot;Entering main rx and tx loop for copy on&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; lcore %u\n&quot;</span>, <a class="code" href="rte__lcore_8h.html#adfb2b334e7e73f534f25e8888a8a775f">rte_lcore_id</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (!force_quit)</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; nb_ports; i++) {</div>
<div class="line">            ioat_rx_port(&amp;cfg.ports[i]);</div>
<div class="line">            ioat_tx_port(&amp;cfg.ports[i]);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> start_forwarding_cores(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint32_t lcore_id = <a class="code" href="rte__lcore_8h.html#adfb2b334e7e73f534f25e8888a8a775f">rte_lcore_id</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, IOAT, <span class="stringliteral">&quot;Entering %s on lcore %u\n&quot;</span>,</div>
<div class="line">        __func__, <a class="code" href="rte__lcore_8h.html#adfb2b334e7e73f534f25e8888a8a775f">rte_lcore_id</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (cfg.nb_lcores == 1) {</div>
<div class="line">        lcore_id = <a name="a34"></a><a class="code" href="rte__lcore_8h.html#acab656f5b00c29090db4500efabedd98">rte_get_next_lcore</a>(lcore_id, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line">        <a name="a35"></a><a class="code" href="rte__launch_8h.html#a2bf98eda211728b3dc69aa7694758c6d">rte_eal_remote_launch</a>((<a name="a36"></a><a class="code" href="rte__launch_8h.html#a004fb75b67fce12894882853ef94d0b5">lcore_function_t</a> *)rxtx_main_loop,</div>
<div class="line">            NULL, lcore_id);</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg.nb_lcores &gt; 1) {</div>
<div class="line">        lcore_id = <a class="code" href="rte__lcore_8h.html#acab656f5b00c29090db4500efabedd98">rte_get_next_lcore</a>(lcore_id, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line">        <a class="code" href="rte__launch_8h.html#a2bf98eda211728b3dc69aa7694758c6d">rte_eal_remote_launch</a>((<a class="code" href="rte__launch_8h.html#a004fb75b67fce12894882853ef94d0b5">lcore_function_t</a> *)rx_main_loop,</div>
<div class="line">            NULL, lcore_id);</div>
<div class="line"> </div>
<div class="line">        lcore_id = <a class="code" href="rte__lcore_8h.html#acab656f5b00c29090db4500efabedd98">rte_get_next_lcore</a>(lcore_id, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line">        <a class="code" href="rte__launch_8h.html#a2bf98eda211728b3dc69aa7694758c6d">rte_eal_remote_launch</a>((<a class="code" href="rte__launch_8h.html#a004fb75b67fce12894882853ef94d0b5">lcore_function_t</a> *)tx_main_loop, NULL,</div>
<div class="line">            lcore_id);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Display usage */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">ioat_usage(<span class="keyword">const</span> <span class="keywordtype">char</span> *prgname)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s [EAL options] -- -p PORTMASK [-q NQ]\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  -p --portmask: hexadecimal bitmask of ports to configure\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  -q NQ: number of RX queues per port (default is 1)\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --[no-]mac-updating: Enable or disable MAC addresses updating (enabled by default)\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;      When enabled:\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       - The source MAC address is replaced by the TX port MAC address\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;       - The destination MAC address is replaced by 02:00:00:00:00:TX_PORT_ID\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  -c --copy-type CT: type of copy: sw|hw\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  -s --ring-size RS: size of IOAT rawdev ring for hardware copy mode or rte_ring for software copy mode\n&quot;</span>,</div>
<div class="line">            prgname);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">ioat_parse_portmask(<span class="keyword">const</span> <span class="keywordtype">char</span> *portmask)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> pm;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Parse hexadecimal string */</span></div>
<div class="line">    pm = strtoul(portmask, &amp;end, 16);</div>
<div class="line">    <span class="keywordflow">if</span> ((portmask[0] == <span class="charliteral">&#39;\0&#39;</span>) || (end == NULL) || (*end != <span class="charliteral">&#39;\0&#39;</span>))</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> pm;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> copy_mode_t</div>
<div class="line">ioat_parse_copy_mode(<span class="keyword">const</span> <span class="keywordtype">char</span> *copy_mode)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(copy_mode, COPY_MODE_SW) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> COPY_MODE_SW_NUM;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(copy_mode, COPY_MODE_IOAT) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> COPY_MODE_IOAT_NUM;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> COPY_MODE_INVALID_NUM;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Parse the argument given in the command line of the application */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">ioat_parse_args(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nb_ports)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> short_options[] =</div>
<div class="line">        <span class="stringliteral">&quot;p:&quot;</span>  <span class="comment">/* portmask */</span></div>
<div class="line">        <span class="stringliteral">&quot;q:&quot;</span>  <span class="comment">/* number of RX queues per port */</span></div>
<div class="line">        <span class="stringliteral">&quot;c:&quot;</span>  <span class="comment">/* copy type (sw|hw) */</span></div>
<div class="line">        <span class="stringliteral">&quot;s:&quot;</span>  <span class="comment">/* ring size */</span></div>
<div class="line">        ;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>option lgopts[] = {</div>
<div class="line">        {CMD_LINE_OPT_MAC_UPDATING, no_argument, &amp;mac_updating, 1},</div>
<div class="line">        {CMD_LINE_OPT_NO_MAC_UPDATING, no_argument, &amp;mac_updating, 0},</div>
<div class="line">        {CMD_LINE_OPT_PORTMASK, required_argument, NULL, <span class="charliteral">&#39;p&#39;</span>},</div>
<div class="line">        {CMD_LINE_OPT_NB_QUEUE, required_argument, NULL, <span class="charliteral">&#39;q&#39;</span>},</div>
<div class="line">        {CMD_LINE_OPT_COPY_TYPE, required_argument, NULL, <span class="charliteral">&#39;c&#39;</span>},</div>
<div class="line">        {CMD_LINE_OPT_RING_SIZE, required_argument, NULL, <span class="charliteral">&#39;s&#39;</span>},</div>
<div class="line">        {NULL, 0, 0, 0}</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> default_port_mask = (1 &lt;&lt; nb_ports) - 1;</div>
<div class="line">    <span class="keywordtype">int</span> opt, ret;</div>
<div class="line">    <span class="keywordtype">char</span> **argvopt;</div>
<div class="line">    <span class="keywordtype">int</span> option_index;</div>
<div class="line">    <span class="keywordtype">char</span> *prgname = argv[0];</div>
<div class="line"> </div>
<div class="line">    ioat_enabled_port_mask = default_port_mask;</div>
<div class="line">    argvopt = argv;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> ((opt = getopt_long(argc, argvopt, short_options,</div>
<div class="line">            lgopts, &amp;option_index)) != EOF) {</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">switch</span> (opt) {</div>
<div class="line">        <span class="comment">/* portmask */</span></div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div>
<div class="line">            ioat_enabled_port_mask = ioat_parse_portmask(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (ioat_enabled_port_mask &amp; ~default_port_mask ||</div>
<div class="line">                    ioat_enabled_port_mask &lt;= 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid portmask, %s, suggest 0x%x\n&quot;</span>,</div>
<div class="line">                        optarg, default_port_mask);</div>
<div class="line">                ioat_usage(prgname);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:</div>
<div class="line">            nb_queues = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (nb_queues == 0 || nb_queues &gt; MAX_RX_QUEUES_COUNT) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid RX queues number %s. Max %u\n&quot;</span>,</div>
<div class="line">                    optarg, MAX_RX_QUEUES_COUNT);</div>
<div class="line">                ioat_usage(prgname);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:</div>
<div class="line">            copy_mode = ioat_parse_copy_mode(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (copy_mode == COPY_MODE_INVALID_NUM) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid copy type. Use: sw, hw\n&quot;</span>);</div>
<div class="line">                ioat_usage(prgname);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">            ring_size = atoi(optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (ring_size == 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Invalid ring size, %s.\n&quot;</span>, optarg);</div>
<div class="line">                ioat_usage(prgname);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* long options */</span></div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            ioat_usage(prgname);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;MAC updating %s\n&quot;</span>, mac_updating ? <span class="stringliteral">&quot;enabled&quot;</span> : <span class="stringliteral">&quot;disabled&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (optind &gt;= 0)</div>
<div class="line">        argv[optind - 1] = prgname;</div>
<div class="line"> </div>
<div class="line">    ret = optind - 1;</div>
<div class="line">    optind = 1; <span class="comment">/* reset getopt lib */</span></div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* check link status, return true if at least one port is up */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">check_link_status(uint32_t port_mask)</div>
<div class="line">{</div>
<div class="line">    uint16_t portid;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a37"></a><a class="code" href="structrte__eth__link.html">rte_eth_link</a> link;</div>
<div class="line">    <span class="keywordtype">int</span> ret, <a name="a38"></a><a class="code" href="rte__ethdev_8h.html#a226d9406cdd84b64b3c3701e5ab8be88">link_status</a> = 0;</div>
<div class="line">    <span class="keywordtype">char</span> link_status_text[<a name="a39"></a><a class="code" href="rte__ethdev_8h.html#a7a31d6736244603b6a1d7efdd32a8834">RTE_ETH_LINK_MAX_STR_LEN</a>];</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;\nChecking link status\n&quot;</span>);</div>
<div class="line">    <a name="a40"></a><a class="code" href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a>(portid) {</div>
<div class="line">        <span class="keywordflow">if</span> ((port_mask &amp; (1 &lt;&lt; portid)) == 0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        memset(&amp;link, 0, <span class="keyword">sizeof</span>(link));</div>
<div class="line">        ret = <a name="a41"></a><a class="code" href="rte__ethdev_8h.html#a56200b0c25f3ecab5abe9bd2b647c215">rte_eth_link_get</a>(portid, &amp;link);</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Port %u link get failed: err=%d\n&quot;</span>,</div>
<div class="line">                    portid, ret);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Print link status */</span></div>
<div class="line">        <a name="a42"></a><a class="code" href="rte__ethdev_8h.html#a5f51139368b8d1a2c22fdecd90bc4d98">rte_eth_link_to_str</a>(link_status_text,</div>
<div class="line">            <span class="keyword">sizeof</span>(link_status_text), &amp;link);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Port %d %s\n&quot;</span>, portid, link_status_text);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (link.link_status)</div>
<div class="line">            <a class="code" href="rte__ethdev_8h.html#a226d9406cdd84b64b3c3701e5ab8be88">link_status</a> = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="rte__ethdev_8h.html#a226d9406cdd84b64b3c3701e5ab8be88">link_status</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">configure_rawdev_queue(uint32_t dev_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a43"></a><a class="code" href="structrte__ioat__rawdev__config.html">rte_ioat_rawdev_config</a> dev_config = { .<a name="a44"></a><a class="code" href="structrte__ioat__rawdev__config.html#a45955c944c4c2ecbfb7bbb1c71a5c0dc">ring_size</a> = <a class="code" href="structrte__ioat__rawdev__config.html#a45955c944c4c2ecbfb7bbb1c71a5c0dc">ring_size</a> };</div>
<div class="line">    <span class="keyword">struct </span>rte_rawdev_info info = { .dev_private = &amp;dev_config };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a45"></a><a class="code" href="rte__rawdev_8h.html#abf894153e16c9403e11c487bcc41b248">rte_rawdev_configure</a>(dev_id, &amp;info, <span class="keyword">sizeof</span>(dev_config)) != 0) {</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Error with rte_rawdev_configure()\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a46"></a><a class="code" href="rte__rawdev_8h.html#af2e470ce565295047c323fd2d8c449ad">rte_rawdev_start</a>(dev_id) != 0) {</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Error with rte_rawdev_start()\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">assign_rawdevs(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint16_t nb_rawdev = 0, rdev_id = 0;</div>
<div class="line">    uint32_t i, j;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; cfg.nb_ports; i++) {</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; cfg.ports[i].nb_queues; j++) {</div>
<div class="line">            <span class="keyword">struct </span>rte_rawdev_info rdev_info = { 0 };</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">do</span> {</div>
<div class="line">                <span class="keywordflow">if</span> (rdev_id == <a name="a47"></a><a class="code" href="rte__rawdev_8h.html#a79e12d6d63b67fe362b417d9addb347e">rte_rawdev_count</a>())</div>
<div class="line">                    <span class="keywordflow">goto</span> end;</div>
<div class="line">                <a name="a48"></a><a class="code" href="rte__rawdev_8h.html#aef72677f798a8370a64a8aa8c46beba7">rte_rawdev_info_get</a>(rdev_id++, &amp;rdev_info, 0);</div>
<div class="line">            } <span class="keywordflow">while</span> (rdev_info.driver_name == NULL ||</div>
<div class="line">                    strcmp(rdev_info.driver_name,</div>
<div class="line">                        <a name="a49"></a><a class="code" href="rte__ioat__rawdev_8h.html#a1c2c82f6a39165c1867ecd4ad0d0a601">IOAT_PMD_RAWDEV_NAME_STR</a>) != 0);</div>
<div class="line"> </div>
<div class="line">            cfg.ports[i].ioat_ids[j] = rdev_id - 1;</div>
<div class="line">            configure_rawdev_queue(cfg.ports[i].ioat_ids[j]);</div>
<div class="line">            ++nb_rawdev;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">end:</div>
<div class="line">    <span class="keywordflow">if</span> (nb_rawdev &lt; cfg.nb_ports * cfg.ports[0].nb_queues)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Not enough IOAT rawdevs (%u) for all queues (%u).\n&quot;</span>,</div>
<div class="line">            nb_rawdev, cfg.nb_ports * cfg.ports[0].nb_queues);</div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, IOAT, <span class="stringliteral">&quot;Number of used rawdevs: %u.\n&quot;</span>, nb_rawdev);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">assign_rings(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; cfg.nb_ports; i++) {</div>
<div class="line">        <span class="keywordtype">char</span> ring_name[<a name="a50"></a><a class="code" href="rte__ring__core_8h.html#a2e508ee16359c5851fed8ff7a24cca01">RTE_RING_NAMESIZE</a>];</div>
<div class="line"> </div>
<div class="line">        snprintf(ring_name, <span class="keyword">sizeof</span>(ring_name), <span class="stringliteral">&quot;rx_to_tx_ring_%u&quot;</span>, i);</div>
<div class="line">        <span class="comment">/* Create ring for inter core communication */</span></div>
<div class="line">        cfg.ports[i].rx_to_tx_ring = <a name="a51"></a><a class="code" href="rte__ring_8h.html#ae4dece63653850041afd5c16d3d6e052">rte_ring_create</a>(</div>
<div class="line">            ring_name, ring_size,</div>
<div class="line">            <a name="a52"></a><a class="code" href="rte__lcore_8h.html#a7c8da4664df26a64cf05dc508a4f26df">rte_socket_id</a>(), <a name="a53"></a><a class="code" href="rte__ring__core_8h.html#a127c66adbeab4653a47649993b94f35b">RING_F_SP_ENQ</a> | <a name="a54"></a><a class="code" href="rte__ring__core_8h.html#a421a61b2f94cdf65b3a6ac146c492fb9">RING_F_SC_DEQ</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (cfg.ports[i].rx_to_tx_ring == NULL)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Ring create failed: %s\n&quot;</span>,</div>
<div class="line">                <a name="a55"></a><a class="code" href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a>(<a name="a56"></a><a class="code" href="rte__errno_8h.html#a66171a00ea02084317df4dc9c2adaccb">rte_errno</a>));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Initializes a given port using global settings and with the RX buffers</span></div>
<div class="line"><span class="comment"> * coming from the mbuf_pool passed as a parameter.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span></div>
<div class="line">port_init(uint16_t portid, <span class="keyword">struct</span> <a class="code" href="structrte__mempool.html">rte_mempool</a> *mbuf_pool, uint16_t nb_queues)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* configuring port to use RSS for multiple RX queues */</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a name="_a57"></a><a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> port_conf = {</div>
<div class="line">        .<a name="a58"></a><a class="code" href="structrte__eth__conf.html#a346eef99c24f617b74c440c1aa565d01">rxmode</a> = {</div>
<div class="line">            .<a name="a59"></a><a class="code" href="structrte__eth__rxmode.html#aa0562513c4569f1aa53050f1beac6b5d">mq_mode</a> = <a name="a60"></a><a class="code" href="rte__ethdev_8h.html#a586b8e86131b4ec0ccaf464e847ccf3eaa06694239b7ecf1efa3c9243b9e7b4c0">ETH_MQ_RX_RSS</a>,</div>
<div class="line">            .max_rx_pkt_len = <a name="a61"></a><a class="code" href="rte__ether_8h.html#af1fb088707ce5b2ebb7825cb69b5cb58">RTE_ETHER_MAX_LEN</a></div>
<div class="line">        },</div>
<div class="line">        .rx_adv_conf = {</div>
<div class="line">            .rss_conf = {</div>
<div class="line">                .rss_key = NULL,</div>
<div class="line">                .rss_hf = ETH_RSS_PROTO_MASK,</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a name="_a62"></a><a class="code" href="structrte__eth__rxconf.html">rte_eth_rxconf</a> rxq_conf;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a63"></a><a class="code" href="structrte__eth__txconf.html">rte_eth_txconf</a> txq_conf;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> local_port_conf = port_conf;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a64"></a><a class="code" href="structrte__eth__dev__info.html">rte_eth_dev_info</a> dev_info;</div>
<div class="line">    <span class="keywordtype">int</span> ret, i;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Skip ports that are not enabled */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((ioat_enabled_port_mask &amp; (1 &lt;&lt; portid)) == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Skipping disabled port %u\n&quot;</span>, portid);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Init port */</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Initializing port %u... &quot;</span>, portid);</div>
<div class="line">    fflush(stdout);</div>
<div class="line">    ret = <a name="a65"></a><a class="code" href="rte__ethdev_8h.html#a7593f4fff04f4ae1b1d718db7ca7dc8c">rte_eth_dev_info_get</a>(portid, &amp;dev_info);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot get device info: %s, port=%u\n&quot;</span>,</div>
<div class="line">            <a class="code" href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a>(-ret), portid);</div>
<div class="line"> </div>
<div class="line">    local_port_conf.<a name="a66"></a><a class="code" href="structrte__eth__conf.html#a084e132696e8d0f59f643d822c8cedb7">rx_adv_conf</a>.<a name="a67"></a><a class="code" href="structrte__eth__conf.html#addc9c7bb19ed12f1171c543493553806">rss_conf</a>.<a name="a68"></a><a class="code" href="structrte__eth__rss__conf.html#ad70f17882a835e5d4e38c64a9f872fdc">rss_hf</a> &amp;=</div>
<div class="line">        dev_info.flow_type_rss_offloads;</div>
<div class="line">    <span class="keywordflow">if</span> (dev_info.tx_offload_capa &amp; <a name="a69"></a><a class="code" href="rte__ethdev_8h.html#ae7110b5d5dced8f42505bff5d9e3f0ea">DEV_TX_OFFLOAD_MBUF_FAST_FREE</a>)</div>
<div class="line">        local_port_conf.<a name="a70"></a><a class="code" href="structrte__eth__conf.html#a1c33c9d2e5cdb14b62ed386bf3159e07">txmode</a>.<a name="a71"></a><a class="code" href="structrte__eth__txmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">offloads</a> |=</div>
<div class="line">            <a class="code" href="rte__ethdev_8h.html#ae7110b5d5dced8f42505bff5d9e3f0ea">DEV_TX_OFFLOAD_MBUF_FAST_FREE</a>;</div>
<div class="line">    ret = <a name="a72"></a><a class="code" href="rte__ethdev_8h.html#a1a7d3a20b102fee222541fda50fd87bd">rte_eth_dev_configure</a>(portid, nb_queues, 1, &amp;local_port_conf);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot configure device:&quot;</span></div>
<div class="line">            <span class="stringliteral">&quot; err=%d, port=%u\n&quot;</span>, ret, portid);</div>
<div class="line"> </div>
<div class="line">    ret = <a name="a73"></a><a class="code" href="rte__ethdev_8h.html#ad31219b87a1733d5b367a7c04c7f7b48">rte_eth_dev_adjust_nb_rx_tx_desc</a>(portid, &amp;nb_rxd,</div>
<div class="line">            &amp;nb_txd);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Cannot adjust number of descriptors: err=%d, port=%u\n&quot;</span>,</div>
<div class="line">            ret, portid);</div>
<div class="line"> </div>
<div class="line">    <a name="a74"></a><a class="code" href="rte__ethdev_8h.html#a8a28375b279ded9125c99a46bf3956ef">rte_eth_macaddr_get</a>(portid, &amp;ioat_ports_eth_addr[portid]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Init RX queues */</span></div>
<div class="line">    rxq_conf = dev_info.default_rxconf;</div>
<div class="line">    rxq_conf.offloads = local_port_conf.<a class="code" href="structrte__eth__conf.html#a346eef99c24f617b74c440c1aa565d01">rxmode</a>.<a name="a75"></a><a class="code" href="structrte__eth__rxmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">offloads</a>;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nb_queues; i++) {</div>
<div class="line">        ret = <a name="a76"></a><a class="code" href="rte__ethdev_8h.html#a36ba70a5a6fce2c2c1f774828ba78f8d">rte_eth_rx_queue_setup</a>(portid, i, nb_rxd,</div>
<div class="line">            <a name="a77"></a><a class="code" href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a>(portid), &amp;rxq_conf,</div>
<div class="line">            mbuf_pool);</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                <span class="stringliteral">&quot;rte_eth_rx_queue_setup:err=%d,port=%u, queue_id=%u\n&quot;</span>,</div>
<div class="line">                ret, portid, i);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Init one TX queue on each port */</span></div>
<div class="line">    txq_conf = dev_info.default_txconf;</div>
<div class="line">    txq_conf.offloads = local_port_conf.<a class="code" href="structrte__eth__conf.html#a1c33c9d2e5cdb14b62ed386bf3159e07">txmode</a>.<a class="code" href="structrte__eth__txmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">offloads</a>;</div>
<div class="line">    ret = <a name="a78"></a><a class="code" href="rte__ethdev_8h.html#a796c2f20778984c6f41b271e36bae50e">rte_eth_tx_queue_setup</a>(portid, 0, nb_txd,</div>
<div class="line">            <a class="code" href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a>(portid),</div>
<div class="line">            &amp;txq_conf);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;rte_eth_tx_queue_setup:err=%d,port=%u\n&quot;</span>,</div>
<div class="line">            ret, portid);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize TX buffers */</span></div>
<div class="line">    tx_buffer[portid] = <a name="a79"></a><a class="code" href="rte__malloc_8h.html#a7e9f76b7e0b0921a617c6ab8b28f53b3">rte_zmalloc_socket</a>(<span class="stringliteral">&quot;tx_buffer&quot;</span>,</div>
<div class="line">            <a name="a80"></a><a class="code" href="rte__ethdev_8h.html#aff24ae3f48be43275b50966c3573a7a9">RTE_ETH_TX_BUFFER_SIZE</a>(MAX_PKT_BURST), 0,</div>
<div class="line">            <a class="code" href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a>(portid));</div>
<div class="line">    <span class="keywordflow">if</span> (tx_buffer[portid] == NULL)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Cannot allocate buffer for tx on port %u\n&quot;</span>,</div>
<div class="line">            portid);</div>
<div class="line"> </div>
<div class="line">    <a name="a81"></a><a class="code" href="rte__ethdev_8h.html#ac5323444ecbe84309a5fcc03aa3c99cb">rte_eth_tx_buffer_init</a>(tx_buffer[portid], MAX_PKT_BURST);</div>
<div class="line"> </div>
<div class="line">    ret = <a name="a82"></a><a class="code" href="rte__ethdev_8h.html#aacd4952d9f45acd463e203c21db9a7bb">rte_eth_tx_buffer_set_err_callback</a>(tx_buffer[portid],</div>
<div class="line">        <a name="a83"></a><a class="code" href="rte__ethdev_8h.html#ac2e9cb28245ce5e06f6b2caf0506cf60">rte_eth_tx_buffer_count_callback</a>,</div>
<div class="line">        &amp;port_statistics.tx_dropped[portid]);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;Cannot set error callback for tx buffer on port %u\n&quot;</span>,</div>
<div class="line">            portid);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Start device */</span></div>
<div class="line">    ret = <a name="a84"></a><a class="code" href="rte__ethdev_8h.html#afdc834c1c52e9fb512301990468ca7c2">rte_eth_dev_start</a>(portid);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;rte_eth_dev_start:err=%d, port=%u\n&quot;</span>,</div>
<div class="line">            ret, portid);</div>
<div class="line"> </div>
<div class="line">    <a name="a85"></a><a class="code" href="rte__ethdev_8h.html#a5dd1dedaa45f05c72bcc35495e441e91">rte_eth_promiscuous_enable</a>(portid);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;Port %u, MAC address: %02X:%02X:%02X:%02X:%02X:%02X\n\n&quot;</span>,</div>
<div class="line">            portid,</div>
<div class="line">            ioat_ports_eth_addr[portid].<a name="a86"></a><a class="code" href="rte__ether_8h.html#ad6f7cb65b39d12b5250ecf82c8ffaa45">addr_bytes</a>[0],</div>
<div class="line">            ioat_ports_eth_addr[portid].<a class="code" href="rte__ether_8h.html#ad6f7cb65b39d12b5250ecf82c8ffaa45">addr_bytes</a>[1],</div>
<div class="line">            ioat_ports_eth_addr[portid].<a class="code" href="rte__ether_8h.html#ad6f7cb65b39d12b5250ecf82c8ffaa45">addr_bytes</a>[2],</div>
<div class="line">            ioat_ports_eth_addr[portid].<a class="code" href="rte__ether_8h.html#ad6f7cb65b39d12b5250ecf82c8ffaa45">addr_bytes</a>[3],</div>
<div class="line">            ioat_ports_eth_addr[portid].<a class="code" href="rte__ether_8h.html#ad6f7cb65b39d12b5250ecf82c8ffaa45">addr_bytes</a>[4],</div>
<div class="line">            ioat_ports_eth_addr[portid].<a class="code" href="rte__ether_8h.html#ad6f7cb65b39d12b5250ecf82c8ffaa45">addr_bytes</a>[5]);</div>
<div class="line"> </div>
<div class="line">    cfg.ports[cfg.nb_ports].rxtx_port = portid;</div>
<div class="line">    cfg.ports[cfg.nb_ports++].nb_queues = nb_queues;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">signal_handler(<span class="keywordtype">int</span> signum)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (signum == SIGINT || signum == SIGTERM) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;\n\nSignal %d received, preparing to exit...\n&quot;</span>,</div>
<div class="line">            signum);</div>
<div class="line">        force_quit = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line">    uint16_t nb_ports, portid;</div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nb_mbufs;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Init EAL */</span></div>
<div class="line">    ret = <a name="a87"></a><a class="code" href="rte__eal_8h.html#a5c3f4dddc25e38c5a186ecd8a69260e3">rte_eal_init</a>(argc, argv);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Invalid EAL arguments\n&quot;</span>);</div>
<div class="line">    argc -= ret;</div>
<div class="line">    argv += ret;</div>
<div class="line"> </div>
<div class="line">    force_quit = <span class="keyword">false</span>;</div>
<div class="line">    signal(SIGINT, signal_handler);</div>
<div class="line">    signal(SIGTERM, signal_handler);</div>
<div class="line"> </div>
<div class="line">    nb_ports = <a name="a88"></a><a class="code" href="rte__ethdev_8h.html#a9ab708089665bebcd65cefe5383b24f2">rte_eth_dev_count_avail</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (nb_ports == 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;No Ethernet ports - bye\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Parse application arguments (after the EAL ones) */</span></div>
<div class="line">    ret = ioat_parse_args(argc, argv, nb_ports);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Invalid IOAT arguments\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    nb_mbufs = <a name="a89"></a><a class="code" href="rte__common_8h.html#a8df8b303b8ea240cf6aebf937fd21eaf">RTE_MAX</a>(nb_ports * (nb_queues * (nb_rxd + nb_txd +</div>
<div class="line">        4 * MAX_PKT_BURST) + <a class="code" href="rte__lcore_8h.html#a1728dc7f14571ba778d3b5b41aa09283">rte_lcore_count</a>() * MEMPOOL_CACHE_SIZE),</div>
<div class="line">        MIN_POOL_SIZE);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create the mbuf pool */</span></div>
<div class="line">    ioat_pktmbuf_pool = <a name="a90"></a><a class="code" href="rte__mbuf_8h.html#a593921f13307803b94bbb4e0932db962">rte_pktmbuf_pool_create</a>(<span class="stringliteral">&quot;mbuf_pool&quot;</span>, nb_mbufs,</div>
<div class="line">        MEMPOOL_CACHE_SIZE, 0, RTE_MBUF_DEFAULT_BUF_SIZE,</div>
<div class="line">        <a class="code" href="rte__lcore_8h.html#a7c8da4664df26a64cf05dc508a4f26df">rte_socket_id</a>());</div>
<div class="line">    <span class="keywordflow">if</span> (ioat_pktmbuf_pool == NULL)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot init mbuf pool\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialise each port */</span></div>
<div class="line">    cfg.nb_ports = 0;</div>
<div class="line">    <a class="code" href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a>(portid)</div>
<div class="line">        port_init(portid, ioat_pktmbuf_pool, nb_queues);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize port xstats */</span></div>
<div class="line">    memset(&amp;port_statistics, 0, <span class="keyword">sizeof</span>(port_statistics));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (!check_link_status(ioat_enabled_port_mask) &amp;&amp; !force_quit)</div>
<div class="line">        sleep(1);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Check if there is enough lcores for all ports. */</span></div>
<div class="line">    cfg.nb_lcores = <a class="code" href="rte__lcore_8h.html#a1728dc7f14571ba778d3b5b41aa09283">rte_lcore_count</a>() - 1;</div>
<div class="line">    <span class="keywordflow">if</span> (cfg.nb_lcores &lt; 1)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">            <span class="stringliteral">&quot;There should be at least one worker lcore.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (copy_mode == COPY_MODE_IOAT_NUM)</div>
<div class="line">        assign_rawdevs();</div>
<div class="line">    <span class="keywordflow">else</span> <span class="comment">/* copy_mode == COPY_MODE_SW_NUM */</span></div>
<div class="line">        assign_rings();</div>
<div class="line"> </div>
<div class="line">    start_forwarding_cores();</div>
<div class="line">    <span class="comment">/* main core prints stats while other cores forward */</span></div>
<div class="line">    print_stats(argv[0]);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* force_quit is true when we get here */</span></div>
<div class="line">    <a name="a91"></a><a class="code" href="rte__launch_8h.html#a7760d6e89a309af9b80767be641bfa18">rte_eal_mp_wait_lcore</a>();</div>
<div class="line"> </div>
<div class="line">    uint32_t j;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; cfg.nb_ports; i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Closing port %d\n&quot;</span>, cfg.ports[i].rxtx_port);</div>
<div class="line">        ret = <a name="a92"></a><a class="code" href="rte__ethdev_8h.html#a6fc010cf6216331c50bc02d2fd4e614f">rte_eth_dev_stop</a>(cfg.ports[i].rxtx_port);</div>
<div class="line">        <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">            <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(ERR, IOAT, <span class="stringliteral">&quot;rte_eth_dev_stop: err=%s, port=%u\n&quot;</span>,</div>
<div class="line">                <a class="code" href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a>(-ret), cfg.ports[i].rxtx_port);</div>
<div class="line"> </div>
<div class="line">        <a name="a93"></a><a class="code" href="rte__ethdev_8h.html#ac2c7507787a5520e8049fff94432169e">rte_eth_dev_close</a>(cfg.ports[i].rxtx_port);</div>
<div class="line">        <span class="keywordflow">if</span> (copy_mode == COPY_MODE_IOAT_NUM) {</div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; cfg.ports[i].nb_queues; j++) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Stopping rawdev %d\n&quot;</span>,</div>
<div class="line">                    cfg.ports[i].ioat_ids[j]);</div>
<div class="line">                <a name="a94"></a><a class="code" href="rte__rawdev_8h.html#a5395321daab8ff98447a296880cc4ae9">rte_rawdev_stop</a>(cfg.ports[i].ioat_ids[j]);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="comment">/* copy_mode == COPY_MODE_SW_NUM */</span></div>
<div class="line">            <a name="a95"></a><a class="code" href="rte__ring_8h.html#a564e012c1eb4ae08f9eea3acfd08b377">rte_ring_free</a>(cfg.ports[i].rx_to_tx_ring);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;Bye...\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="arte__common_8h_html_a8df8b303b8ea240cf6aebf937fd21eaf"><div class="ttname"><a href="rte__common_8h.html#a8df8b303b8ea240cf6aebf937fd21eaf">RTE_MAX</a></div><div class="ttdeci">#define RTE_MAX(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00583">rte_common.h:583</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ac5323444ecbe84309a5fcc03aa3c99cb"><div class="ttname"><a href="rte__ethdev_8h.html#ac5323444ecbe84309a5fcc03aa3c99cb">rte_eth_tx_buffer_init</a></div><div class="ttdeci">int rte_eth_tx_buffer_init(struct rte_eth_dev_tx_buffer *buffer, uint16_t size)</div></div>
<div class="ttc" id="arte__ring__core_8h_html_a2e508ee16359c5851fed8ff7a24cca01"><div class="ttname"><a href="rte__ring__core_8h.html#a2e508ee16359c5851fed8ff7a24cca01">RTE_RING_NAMESIZE</a></div><div class="ttdeci">#define RTE_RING_NAMESIZE</div><div class="ttdef"><b>Definition:</b> <a href="rte__ring__core_8h_source.html#l00053">rte_ring_core.h:53</a></div></div>
<div class="ttc" id="arte__launch_8h_html_a7760d6e89a309af9b80767be641bfa18"><div class="ttname"><a href="rte__launch_8h.html#a7760d6e89a309af9b80767be641bfa18">rte_eal_mp_wait_lcore</a></div><div class="ttdeci">void rte_eal_mp_wait_lcore(void)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a5f51139368b8d1a2c22fdecd90bc4d98"><div class="ttname"><a href="rte__ethdev_8h.html#a5f51139368b8d1a2c22fdecd90bc4d98">rte_eth_link_to_str</a></div><div class="ttdeci">__rte_experimental int rte_eth_link_to_str(char *str, size_t len, const struct rte_eth_link *eth_link)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_ad31219b87a1733d5b367a7c04c7f7b48"><div class="ttname"><a href="rte__ethdev_8h.html#ad31219b87a1733d5b367a7c04c7f7b48">rte_eth_dev_adjust_nb_rx_tx_desc</a></div><div class="ttdeci">int rte_eth_dev_adjust_nb_rx_tx_desc(uint16_t port_id, uint16_t *nb_rx_desc, uint16_t *nb_tx_desc)</div></div>
<div class="ttc" id="astructrte__ether__hdr_html_acce632e0fded0f728a1ee1a1ffb5c9bf"><div class="ttname"><a href="structrte__ether__hdr.html#acce632e0fded0f728a1ee1a1ffb5c9bf">rte_ether_hdr::s_addr</a></div><div class="ttdeci">struct rte_ether_addr s_addr</div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00000">rte_ether.h:266</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_a79e12d6d63b67fe362b417d9addb347e"><div class="ttname"><a href="rte__rawdev_8h.html#a79e12d6d63b67fe362b417d9addb347e">rte_rawdev_count</a></div><div class="ttdeci">uint8_t rte_rawdev_count(void)</div></div>
<div class="ttc" id="arte__rawdev_8h_html_aef72677f798a8370a64a8aa8c46beba7"><div class="ttname"><a href="rte__rawdev_8h.html#aef72677f798a8370a64a8aa8c46beba7">rte_rawdev_info_get</a></div><div class="ttdeci">int rte_rawdev_info_get(uint16_t dev_id, struct rte_rawdev_info *dev_info, size_t dev_private_size)</div></div>
<div class="ttc" id="arte__malloc_8h_html"><div class="ttname"><a href="rte__malloc_8h.html">rte_malloc.h</a></div></div>
<div class="ttc" id="astructrte__eth__rxconf_html"><div class="ttname"><a href="structrte__eth__rxconf.html">rte_eth_rxconf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01032">rte_ethdev.h:1032</a></div></div>
<div class="ttc" id="arte__branch__prediction_8h_html_ac6c45889010c1bd68631771b64f18101"><div class="ttname"><a href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a></div><div class="ttdeci">#define unlikely(x)</div><div class="ttdef"><b>Definition:</b> <a href="rte__branch__prediction_8h_source.html#l00038">rte_branch_prediction.h:38</a></div></div>
<div class="ttc" id="arte__ring_8h_html_ae4dece63653850041afd5c16d3d6e052"><div class="ttname"><a href="rte__ring_8h.html#ae4dece63653850041afd5c16d3d6e052">rte_ring_create</a></div><div class="ttdeci">struct rte_ring * rte_ring_create(const char *name, unsigned int count, int socket_id, unsigned int flags)</div></div>
<div class="ttc" id="arte__lcore_8h_html_a7c8da4664df26a64cf05dc508a4f26df"><div class="ttname"><a href="rte__lcore_8h.html#a7c8da4664df26a64cf05dc508a4f26df">rte_socket_id</a></div><div class="ttdeci">unsigned int rte_socket_id(void)</div></div>
<div class="ttc" id="astructrte__mempool_html_a1a1c0270e433d8ce66b34d3bd7c713fd"><div class="ttname"><a href="structrte__mempool.html#a1a1c0270e433d8ce66b34d3bd7c713fd">rte_mempool::name</a></div><div class="ttdeci">char name[RTE_MEMZONE_NAMESIZE]</div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l00213">rte_mempool.h:213</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a796c2f20778984c6f41b271e36bae50e"><div class="ttname"><a href="rte__ethdev_8h.html#a796c2f20778984c6f41b271e36bae50e">rte_eth_tx_queue_setup</a></div><div class="ttdeci">int rte_eth_tx_queue_setup(uint16_t port_id, uint16_t tx_queue_id, uint16_t nb_tx_desc, unsigned int socket_id, const struct rte_eth_txconf *tx_conf)</div></div>
<div class="ttc" id="astructrte__eth__txconf_html"><div class="ttname"><a href="structrte__eth__txconf.html">rte_eth_txconf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01060">rte_ethdev.h:1060</a></div></div>
<div class="ttc" id="astructrte__mbuf_html_a9db3d388a1381e68e509017a6e7d0f12"><div class="ttname"><a href="structrte__mbuf.html#a9db3d388a1381e68e509017a6e7d0f12">rte_mbuf::buf_addr</a></div><div class="ttdeci">void * buf_addr</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00476">rte_mbuf_core.h:476</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a1a7d3a20b102fee222541fda50fd87bd"><div class="ttname"><a href="rte__ethdev_8h.html#a1a7d3a20b102fee222541fda50fd87bd">rte_eth_dev_configure</a></div><div class="ttdeci">int rte_eth_dev_configure(uint16_t port_id, uint16_t nb_rx_queue, uint16_t nb_tx_queue, const struct rte_eth_conf *eth_conf)</div></div>
<div class="ttc" id="arte__errno_8h_html_a129a7eb4cfa1f5bdac5783bf49137d06"><div class="ttname"><a href="rte__errno_8h.html#a129a7eb4cfa1f5bdac5783bf49137d06">rte_strerror</a></div><div class="ttdeci">const char * rte_strerror(int errnum)</div></div>
<div class="ttc" id="astructrte__eth__link_html"><div class="ttname"><a href="structrte__eth__link.html">rte_eth_link</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00313">rte_ethdev.h:313</a></div></div>
<div class="ttc" id="astructrte__eth__conf_html_a346eef99c24f617b74c440c1aa565d01"><div class="ttname"><a href="structrte__eth__conf.html#a346eef99c24f617b74c440c1aa565d01">rte_eth_conf::rxmode</a></div><div class="ttdeci">struct rte_eth_rxmode rxmode</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01294">rte_ethdev.h:1301</a></div></div>
<div class="ttc" id="astructrte__eth__dev__tx__buffer_html"><div class="ttname"><a href="structrte__eth__dev__tx__buffer.html">rte_eth_dev_tx_buffer</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l03271">rte_ethdev.h:3271</a></div></div>
<div class="ttc" id="astructrte__eth__rxmode_html_aa0562513c4569f1aa53050f1beac6b5d"><div class="ttname"><a href="structrte__eth__rxmode.html#aa0562513c4569f1aa53050f1beac6b5d">rte_eth_rxmode::mq_mode</a></div><div class="ttdeci">enum rte_eth_rx_mq_mode mq_mode</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00336">rte_ethdev.h:402</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a3e7d76a451b46348686ea97d6367f102"><div class="ttname"><a href="rte__ethdev_8h.html#a3e7d76a451b46348686ea97d6367f102">rte_eth_rx_burst</a></div><div class="ttdeci">static uint16_t rte_eth_rx_burst(uint16_t port_id, uint16_t queue_id, struct rte_mbuf **rx_pkts, const uint16_t nb_pkts)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l04834">rte_ethdev.h:4834</a></div></div>
<div class="ttc" id="arte__memcpy_8h_html_a09f4d8cdb1a7c25398a363906e1db8cd"><div class="ttname"><a href="rte__memcpy_8h.html#a09f4d8cdb1a7c25398a363906e1db8cd">rte_memcpy</a></div><div class="ttdeci">static void * rte_memcpy(void *dst, const void *src, size_t n)</div></div>
<div class="ttc" id="arte__ether_8h_html_ad6f7cb65b39d12b5250ecf82c8ffaa45"><div class="ttname"><a href="rte__ether_8h.html#ad6f7cb65b39d12b5250ecf82c8ffaa45">addr_bytes</a></div><div class="ttdeci">uint8_t addr_bytes[RTE_ETHER_ADDR_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00000">rte_ether.h:0</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_a5395321daab8ff98447a296880cc4ae9"><div class="ttname"><a href="rte__rawdev_8h.html#a5395321daab8ff98447a296880cc4ae9">rte_rawdev_stop</a></div><div class="ttdeci">void rte_rawdev_stop(uint16_t dev_id)</div></div>
<div class="ttc" id="arte__ring_8h_html_a564e012c1eb4ae08f9eea3acfd08b377"><div class="ttname"><a href="rte__ring_8h.html#a564e012c1eb4ae08f9eea3acfd08b377">rte_ring_free</a></div><div class="ttdeci">void rte_ring_free(struct rte_ring *r)</div></div>
<div class="ttc" id="arte__lcore_8h_html_acab656f5b00c29090db4500efabedd98"><div class="ttname"><a href="rte__lcore_8h.html#acab656f5b00c29090db4500efabedd98">rte_get_next_lcore</a></div><div class="ttdeci">unsigned int rte_get_next_lcore(unsigned int i, int skip_main, int wrap)</div></div>
<div class="ttc" id="astructrte__ioat__rawdev__config_html_a45955c944c4c2ecbfb7bbb1c71a5c0dc"><div class="ttname"><a href="structrte__ioat__rawdev__config.html#a45955c944c4c2ecbfb7bbb1c71a5c0dc">rte_ioat_rawdev_config::ring_size</a></div><div class="ttdeci">unsigned short ring_size</div><div class="ttdef"><b>Definition:</b> <a href="rte__ioat__rawdev_8h_source.html#l00036">rte_ioat_rawdev.h:36</a></div></div>
<div class="ttc" id="astructrte__mbuf_html"><div class="ttname"><a href="structrte__mbuf.html">rte_mbuf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00473">rte_mbuf_core.h:473</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a7593f4fff04f4ae1b1d718db7ca7dc8c"><div class="ttname"><a href="rte__ethdev_8h.html#a7593f4fff04f4ae1b1d718db7ca7dc8c">rte_eth_dev_info_get</a></div><div class="ttdeci">int rte_eth_dev_info_get(uint16_t port_id, struct rte_eth_dev_info *dev_info)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a5dd1dedaa45f05c72bcc35495e441e91"><div class="ttname"><a href="rte__ethdev_8h.html#a5dd1dedaa45f05c72bcc35495e441e91">rte_eth_promiscuous_enable</a></div><div class="ttdeci">int rte_eth_promiscuous_enable(uint16_t port_id)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a8a28375b279ded9125c99a46bf3956ef"><div class="ttname"><a href="rte__ethdev_8h.html#a8a28375b279ded9125c99a46bf3956ef">rte_eth_macaddr_get</a></div><div class="ttdeci">int rte_eth_macaddr_get(uint16_t port_id, struct rte_ether_addr *mac_addr)</div></div>
<div class="ttc" id="arte__rawdev_8h_html_ae293a5d25d141ee348012c140d48b450"><div class="ttname"><a href="rte__rawdev_8h.html#ae293a5d25d141ee348012c140d48b450">rte_rawdev_xstats_names_get</a></div><div class="ttdeci">int rte_rawdev_xstats_names_get(uint16_t dev_id, struct rte_rawdev_xstats_name *xstats_names, unsigned int size)</div></div>
<div class="ttc" id="arte__common_8h_html_ac5169870c983b3463cb226bdb8a94880"><div class="ttname"><a href="rte__common_8h.html#ac5169870c983b3463cb226bdb8a94880">rte_exit</a></div><div class="ttdeci">__rte_noreturn void rte_exit(int exit_code, const char *format,...) __rte_format_printf(2</div></div>
<div class="ttc" id="arte__lcore_8h_html_a1728dc7f14571ba778d3b5b41aa09283"><div class="ttname"><a href="rte__lcore_8h.html#a1728dc7f14571ba778d3b5b41aa09283">rte_lcore_count</a></div><div class="ttdeci">unsigned int rte_lcore_count(void)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a83e56cabbd31637efd648e3fc010392b"><div class="ttname"><a href="rte__ethdev_8h.html#a83e56cabbd31637efd648e3fc010392b">rte_eth_tx_burst</a></div><div class="ttdeci">static uint16_t rte_eth_tx_burst(uint16_t port_id, uint16_t queue_id, struct rte_mbuf **tx_pkts, uint16_t nb_pkts)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l05112">rte_ethdev.h:5112</a></div></div>
<div class="ttc" id="arte__ring__core_8h_html_a127c66adbeab4653a47649993b94f35b"><div class="ttname"><a href="rte__ring__core_8h.html#a127c66adbeab4653a47649993b94f35b">RING_F_SP_ENQ</a></div><div class="ttdeci">#define RING_F_SP_ENQ</div><div class="ttdef"><b>Definition:</b> <a href="rte__ring__core_8h_source.html#l00161">rte_ring_core.h:161</a></div></div>
<div class="ttc" id="arte__lcore_8h_html_adfb2b334e7e73f534f25e8888a8a775f"><div class="ttname"><a href="rte__lcore_8h.html#adfb2b334e7e73f534f25e8888a8a775f">rte_lcore_id</a></div><div class="ttdeci">static unsigned rte_lcore_id(void)</div><div class="ttdef"><b>Definition:</b> <a href="rte__lcore_8h_source.html#l00075">rte_lcore.h:75</a></div></div>
<div class="ttc" id="astructrte__ring_html"><div class="ttname"><a href="structrte__ring.html">rte_ring</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ring__core_8h_source.html#l00123">rte_ring_core.h:123</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ae7110b5d5dced8f42505bff5d9e3f0ea"><div class="ttname"><a href="rte__ethdev_8h.html#ae7110b5d5dced8f42505bff5d9e3f0ea">DEV_TX_OFFLOAD_MBUF_FAST_FREE</a></div><div class="ttdeci">#define DEV_TX_OFFLOAD_MBUF_FAST_FREE</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01401">rte_ethdev.h:1397</a></div></div>
<div class="ttc" id="arte__common_8h_html_a59dd2418e7278f66471590e1fc8aa3cf"><div class="ttname"><a href="rte__common_8h.html#a59dd2418e7278f66471590e1fc8aa3cf">RTE_PTR_DIFF</a></div><div class="ttdeci">#define RTE_PTR_DIFF(ptr1, ptr2)</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00260">rte_common.h:260</a></div></div>
<div class="ttc" id="astructrte__eth__rss__conf_html_ad70f17882a835e5d4e38c64a9f872fdc"><div class="ttname"><a href="structrte__eth__rss__conf.html#ad70f17882a835e5d4e38c64a9f872fdc">rte_eth_rss_conf::rss_hf</a></div><div class="ttdeci">uint64_t rss_hf</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00457">rte_ethdev.h:457</a></div></div>
<div class="ttc" id="arte__mbuf__core_8h_html_a2a8b10263496c7b580e9d0c7f2a1f073"><div class="ttname"><a href="rte__mbuf__core_8h.html#a2a8b10263496c7b580e9d0c7f2a1f073">rte_pktmbuf_mtod</a></div><div class="ttdeci">#define rte_pktmbuf_mtod(m, t)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf__core_8h_source.html#l00726">rte_mbuf_core.h:726</a></div></div>
<div class="ttc" id="arte__ioat__rawdev_8h_html_a1e753508b96f22b06207458423104dca"><div class="ttname"><a href="rte__ioat__rawdev_8h.html#a1e753508b96f22b06207458423104dca">rte_ioat_perform_ops</a></div><div class="ttdeci">static void __rte_experimental rte_ioat_perform_ops(int dev_id)</div></div>
<div class="ttc" id="arte__ioat__rawdev_8h_html_ab7de49248803a8630ec41d08c702853d"><div class="ttname"><a href="rte__ioat__rawdev_8h.html#ab7de49248803a8630ec41d08c702853d">rte_ioat_completed_ops</a></div><div class="ttdeci">static int __rte_experimental rte_ioat_completed_ops(int dev_id, uint8_t max_copies, uintptr_t *src_hdls, uintptr_t *dst_hdls)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_afdc834c1c52e9fb512301990468ca7c2"><div class="ttname"><a href="rte__ethdev_8h.html#afdc834c1c52e9fb512301990468ca7c2">rte_eth_dev_start</a></div><div class="ttdeci">int rte_eth_dev_start(uint16_t port_id)</div></div>
<div class="ttc" id="arte__ether_8h_html_af5e7040b36584eacec1c5b9eee086eac"><div class="ttname"><a href="rte__ether_8h.html#af5e7040b36584eacec1c5b9eee086eac">rte_ether_addr_copy</a></div><div class="ttdeci">static void rte_ether_addr_copy(const struct rte_ether_addr *__restrict ea_from, struct rte_ether_addr *__restrict ea_to)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00222">rte_ether.h:222</a></div></div>
<div class="ttc" id="astructrte__ether__hdr_html"><div class="ttname"><a href="structrte__ether__hdr.html">rte_ether_hdr</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00264">rte_ether.h:264</a></div></div>
<div class="ttc" id="arte__ring_8h_html_a9dd35643c4cdc6fa00ece3cafbcd94d2"><div class="ttname"><a href="rte__ring_8h.html#a9dd35643c4cdc6fa00ece3cafbcd94d2">rte_ring_dequeue_burst</a></div><div class="ttdeci">static __rte_always_inline unsigned int rte_ring_dequeue_burst(struct rte_ring *r, void **obj_table, unsigned int n, unsigned int *available)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ring_8h_source.html#l00798">rte_ring.h:798</a></div></div>
<div class="ttc" id="astructrte__eth__txmode_html_a6cfe3b3ee46e9a8b8c62a64294b0b564"><div class="ttname"><a href="structrte__eth__txmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">rte_eth_txmode::offloads</a></div><div class="ttdeci">uint64_t offloads</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00959">rte_ethdev.h:959</a></div></div>
<div class="ttc" id="astructrte__ioat__rawdev__config_html"><div class="ttname"><a href="structrte__ioat__rawdev__config.html">rte_ioat_rawdev_config</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ioat__rawdev_8h_source.html#l00035">rte_ioat_rawdev.h:35</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a226d9406cdd84b64b3c3701e5ab8be88"><div class="ttname"><a href="rte__ethdev_8h.html#a226d9406cdd84b64b3c3701e5ab8be88">link_status</a></div><div class="ttdeci">uint16_t link_status</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00003">rte_ethdev.h:3</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a9ab708089665bebcd65cefe5383b24f2"><div class="ttname"><a href="rte__ethdev_8h.html#a9ab708089665bebcd65cefe5383b24f2">rte_eth_dev_count_avail</a></div><div class="ttdeci">uint16_t rte_eth_dev_count_avail(void)</div></div>
<div class="ttc" id="arte__launch_8h_html_a2bf98eda211728b3dc69aa7694758c6d"><div class="ttname"><a href="rte__launch_8h.html#a2bf98eda211728b3dc69aa7694758c6d">rte_eal_remote_launch</a></div><div class="ttdeci">int rte_eal_remote_launch(lcore_function_t *f, void *arg, unsigned worker_id)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_aacd4952d9f45acd463e203c21db9a7bb"><div class="ttname"><a href="rte__ethdev_8h.html#aacd4952d9f45acd463e203c21db9a7bb">rte_eth_tx_buffer_set_err_callback</a></div><div class="ttdeci">int rte_eth_tx_buffer_set_err_callback(struct rte_eth_dev_tx_buffer *buffer, buffer_tx_error_fn callback, void *userdata)</div></div>
<div class="ttc" id="astructrte__eth__rxmode_html_a6cfe3b3ee46e9a8b8c62a64294b0b564"><div class="ttname"><a href="structrte__eth__rxmode.html#a6cfe3b3ee46e9a8b8c62a64294b0b564">rte_eth_rxmode::offloads</a></div><div class="ttdeci">uint64_t offloads</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00412">rte_ethdev.h:412</a></div></div>
<div class="ttc" id="arte__eal_8h_html_a5c3f4dddc25e38c5a186ecd8a69260e3"><div class="ttname"><a href="rte__eal_8h.html#a5c3f4dddc25e38c5a186ecd8a69260e3">rte_eal_init</a></div><div class="ttdeci">int rte_eal_init(int argc, char **argv)</div></div>
<div class="ttc" id="astructrte__mempool_html"><div class="ttname"><a href="structrte__mempool.html">rte_mempool</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l00207">rte_mempool.h:207</a></div></div>
<div class="ttc" id="arte__common_8h_html_a276e8a32e0bbf024aadd9420b8f2d3b3"><div class="ttname"><a href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a></div><div class="ttdeci">#define offsetof(TYPE, MEMBER)</div><div class="ttdef"><b>Definition:</b> <a href="rte__common_8h_source.html#l00753">rte_common.h:753</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_aff24ae3f48be43275b50966c3573a7a9"><div class="ttname"><a href="rte__ethdev_8h.html#aff24ae3f48be43275b50966c3573a7a9">RTE_ETH_TX_BUFFER_SIZE</a></div><div class="ttdeci">#define RTE_ETH_TX_BUFFER_SIZE(sz)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l03286">rte_ethdev.h:3286</a></div></div>
<div class="ttc" id="arte__mbuf_8h_html_a593921f13307803b94bbb4e0932db962"><div class="ttname"><a href="rte__mbuf_8h.html#a593921f13307803b94bbb4e0932db962">rte_pktmbuf_pool_create</a></div><div class="ttdeci">struct rte_mempool * rte_pktmbuf_pool_create(const char *name, unsigned n, unsigned cache_size, uint16_t priv_size, uint16_t data_room_size, int socket_id)</div></div>
<div class="ttc" id="arte__rawdev_8h_html"><div class="ttname"><a href="rte__rawdev_8h.html">rte_rawdev.h</a></div></div>
<div class="ttc" id="arte__mempool_8h_html_a0d326354d53ef5068d86a8b7d9ec2d61"><div class="ttname"><a href="rte__mempool_8h.html#a0d326354d53ef5068d86a8b7d9ec2d61">rte_mempool_get_bulk</a></div><div class="ttdeci">static __rte_always_inline int rte_mempool_get_bulk(struct rte_mempool *mp, void **obj_table, unsigned int n)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l01521">rte_mempool.h:1521</a></div></div>
<div class="ttc" id="astructrte__rawdev__xstats__name_html"><div class="ttname"><a href="structrte__rawdev__xstats__name.html">rte_rawdev_xstats_name</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__rawdev_8h_source.html#l00455">rte_rawdev.h:455</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a36ba70a5a6fce2c2c1f774828ba78f8d"><div class="ttname"><a href="rte__ethdev_8h.html#a36ba70a5a6fce2c2c1f774828ba78f8d">rte_eth_rx_queue_setup</a></div><div class="ttdeci">int rte_eth_rx_queue_setup(uint16_t port_id, uint16_t rx_queue_id, uint16_t nb_rx_desc, unsigned int socket_id, const struct rte_eth_rxconf *rx_conf, struct rte_mempool *mb_pool)</div></div>
<div class="ttc" id="astructrte__eth__conf_html_addc9c7bb19ed12f1171c543493553806"><div class="ttname"><a href="structrte__eth__conf.html#addc9c7bb19ed12f1171c543493553806">rte_eth_conf::rss_conf</a></div><div class="ttdeci">struct rte_eth_rss_conf rss_conf</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01327">rte_ethdev.h:1309</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a56200b0c25f3ecab5abe9bd2b647c215"><div class="ttname"><a href="rte__ethdev_8h.html#a56200b0c25f3ecab5abe9bd2b647c215">rte_eth_link_get</a></div><div class="ttdeci">int rte_eth_link_get(uint16_t port_id, struct rte_eth_link *link)</div></div>
<div class="ttc" id="arte__mempool_8h_html_a5e46fc827d764e516e8ff0c3f00e33fc"><div class="ttname"><a href="rte__mempool_8h.html#a5e46fc827d764e516e8ff0c3f00e33fc">rte_mempool_put_bulk</a></div><div class="ttdeci">static __rte_always_inline void rte_mempool_put_bulk(struct rte_mempool *mp, void *const *obj_table, unsigned int n)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mempool_8h_source.html#l01367">rte_mempool.h:1367</a></div></div>
<div class="ttc" id="astructrte__eth__conf_html_a084e132696e8d0f59f643d822c8cedb7"><div class="ttname"><a href="structrte__eth__conf.html#a084e132696e8d0f59f643d822c8cedb7">rte_eth_conf::rx_adv_conf</a></div><div class="ttdeci">struct rte_eth_conf::@153 rx_adv_conf</div></div>
<div class="ttc" id="arte__ethdev_8h_html"><div class="ttname"><a href="rte__ethdev_8h.html">rte_ethdev.h</a></div></div>
<div class="ttc" id="arte__ioat__rawdev_8h_html_a8e39d2c68cc67b5c8a364fe5c2853f94"><div class="ttname"><a href="rte__ioat__rawdev_8h.html#a8e39d2c68cc67b5c8a364fe5c2853f94">rte_ioat_enqueue_copy</a></div><div class="ttdeci">static int __rte_experimental rte_ioat_enqueue_copy(int dev_id, phys_addr_t src, phys_addr_t dst, unsigned int length, uintptr_t src_hdl, uintptr_t dst_hdl)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_a6fc010cf6216331c50bc02d2fd4e614f"><div class="ttname"><a href="rte__ethdev_8h.html#a6fc010cf6216331c50bc02d2fd4e614f">rte_eth_dev_stop</a></div><div class="ttdeci">int rte_eth_dev_stop(uint16_t port_id)</div></div>
<div class="ttc" id="arte__log_8h_html_ac23caeb9833fd0fd0665c6c05ec806fe"><div class="ttname"><a href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a></div><div class="ttdeci">#define RTE_LOG(l, t,...)</div><div class="ttdef"><b>Definition:</b> <a href="rte__log_8h_source.html#l00331">rte_log.h:331</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_af2e470ce565295047c323fd2d8c449ad"><div class="ttname"><a href="rte__rawdev_8h.html#af2e470ce565295047c323fd2d8c449ad">rte_rawdev_start</a></div><div class="ttdeci">int rte_rawdev_start(uint16_t dev_id)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_ac2e9cb28245ce5e06f6b2caf0506cf60"><div class="ttname"><a href="rte__ethdev_8h.html#ac2e9cb28245ce5e06f6b2caf0506cf60">rte_eth_tx_buffer_count_callback</a></div><div class="ttdeci">void rte_eth_tx_buffer_count_callback(struct rte_mbuf **pkts, uint16_t unsent, void *userdata)</div></div>
<div class="ttc" id="astructrte__eth__conf_html_a1c33c9d2e5cdb14b62ed386bf3159e07"><div class="ttname"><a href="structrte__eth__conf.html#a1c33c9d2e5cdb14b62ed386bf3159e07">rte_eth_conf::txmode</a></div><div class="ttdeci">struct rte_eth_txmode txmode</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01294">rte_ethdev.h:1302</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a7a31d6736244603b6a1d7efdd32a8834"><div class="ttname"><a href="rte__ethdev_8h.html#a7a31d6736244603b6a1d7efdd32a8834">RTE_ETH_LINK_MAX_STR_LEN</a></div><div class="ttdeci">#define RTE_ETH_LINK_MAX_STR_LEN</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00327">rte_ethdev.h:327</a></div></div>
<div class="ttc" id="arte__ring__core_8h_html_a421a61b2f94cdf65b3a6ac146c492fb9"><div class="ttname"><a href="rte__ring__core_8h.html#a421a61b2f94cdf65b3a6ac146c492fb9">RING_F_SC_DEQ</a></div><div class="ttdeci">#define RING_F_SC_DEQ</div><div class="ttdef"><b>Definition:</b> <a href="rte__ring__core_8h_source.html#l00162">rte_ring_core.h:162</a></div></div>
<div class="ttc" id="astructrte__eth__dev__info_html"><div class="ttname"><a href="structrte__eth__dev__info.html">rte_eth_dev_info</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01504">rte_ethdev.h:1504</a></div></div>
<div class="ttc" id="arte__mbuf_8h_html_a2a1e1b30162161ed11d3ba2faf7bbf13"><div class="ttname"><a href="rte__mbuf_8h.html#a2a1e1b30162161ed11d3ba2faf7bbf13">rte_pktmbuf_data_len</a></div><div class="ttdeci">#define rte_pktmbuf_data_len(m)</div><div class="ttdef"><b>Definition:</b> <a href="rte__mbuf_8h_source.html#l01555">rte_mbuf.h:1555</a></div></div>
<div class="ttc" id="arte__ioat__rawdev_8h_html_a1c2c82f6a39165c1867ecd4ad0d0a601"><div class="ttname"><a href="rte__ioat__rawdev_8h.html#a1c2c82f6a39165c1867ecd4ad0d0a601">IOAT_PMD_RAWDEV_NAME_STR</a></div><div class="ttdeci">#define IOAT_PMD_RAWDEV_NAME_STR</div><div class="ttdef"><b>Definition:</b> <a href="rte__ioat__rawdev_8h_source.html#l00026">rte_ioat_rawdev.h:26</a></div></div>
<div class="ttc" id="astructrte__ether__addr_html"><div class="ttname"><a href="structrte__ether__addr.html">rte_ether_addr</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00064">rte_ether.h:64</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ad7b46c67203d37fe3a34f11076d970d6"><div class="ttname"><a href="rte__ethdev_8h.html#ad7b46c67203d37fe3a34f11076d970d6">RTE_ETH_FOREACH_DEV</a></div><div class="ttdeci">#define RTE_ETH_FOREACH_DEV(p)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01858">rte_ethdev.h:1858</a></div></div>
<div class="ttc" id="astructrte__eth__conf_html"><div class="ttname"><a href="structrte__eth__conf.html">rte_eth_conf</a></div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l01293">rte_ethdev.h:1293</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_ad032e25f712e6ffeb0c19eab1ec1fd2e"><div class="ttname"><a href="rte__ethdev_8h.html#ad032e25f712e6ffeb0c19eab1ec1fd2e">rte_eth_dev_socket_id</a></div><div class="ttdeci">int rte_eth_dev_socket_id(uint16_t port_id)</div></div>
<div class="ttc" id="arte__rawdev_8h_html_a23a6cb31d4c8ff7d7f46d9e24aa71230"><div class="ttname"><a href="rte__rawdev_8h.html#a23a6cb31d4c8ff7d7f46d9e24aa71230">rte_rawdev_xstats_get</a></div><div class="ttdeci">int rte_rawdev_xstats_get(uint16_t dev_id, const unsigned int ids[], uint64_t values[], unsigned int n)</div></div>
<div class="ttc" id="arte__launch_8h_html_a004fb75b67fce12894882853ef94d0b5"><div class="ttname"><a href="rte__launch_8h.html#a004fb75b67fce12894882853ef94d0b5">lcore_function_t</a></div><div class="ttdeci">int() lcore_function_t(void *)</div><div class="ttdef"><b>Definition:</b> <a href="rte__launch_8h_source.html#l00030">rte_launch.h:30</a></div></div>
<div class="ttc" id="arte__ethdev_8h_html_a586b8e86131b4ec0ccaf464e847ccf3eaa06694239b7ecf1efa3c9243b9e7b4c0"><div class="ttname"><a href="rte__ethdev_8h.html#a586b8e86131b4ec0ccaf464e847ccf3eaa06694239b7ecf1efa3c9243b9e7b4c0">ETH_MQ_RX_RSS</a></div><div class="ttdeci">@ ETH_MQ_RX_RSS</div><div class="ttdef"><b>Definition:</b> <a href="rte__ethdev_8h_source.html#l00355">rte_ethdev.h:355</a></div></div>
<div class="ttc" id="arte__rawdev_8h_html_abf894153e16c9403e11c487bcc41b248"><div class="ttname"><a href="rte__rawdev_8h.html#abf894153e16c9403e11c487bcc41b248">rte_rawdev_configure</a></div><div class="ttdeci">int rte_rawdev_configure(uint16_t dev_id, struct rte_rawdev_info *dev_conf, size_t dev_private_size)</div></div>
<div class="ttc" id="arte__ring_8h_html_a85ad08ed07e2e485c94466e03bf252c4"><div class="ttname"><a href="rte__ring_8h.html#a85ad08ed07e2e485c94466e03bf252c4">rte_ring_enqueue_burst</a></div><div class="ttdeci">static __rte_always_inline unsigned int rte_ring_enqueue_burst(struct rte_ring *r, void *const *obj_table, unsigned int n, unsigned int *free_space)</div><div class="ttdef"><b>Definition:</b> <a href="rte__ring_8h_source.html#l00718">rte_ring.h:718</a></div></div>
<div class="ttc" id="arte__ether_8h_html_af1fb088707ce5b2ebb7825cb69b5cb58"><div class="ttname"><a href="rte__ether_8h.html#af1fb088707ce5b2ebb7825cb69b5cb58">RTE_ETHER_MAX_LEN</a></div><div class="ttdeci">#define RTE_ETHER_MAX_LEN</div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00037">rte_ether.h:37</a></div></div>
<div class="ttc" id="astructrte__ether__hdr_html_a1d579e2782d36729c1f73608d8663124"><div class="ttname"><a href="structrte__ether__hdr.html#a1d579e2782d36729c1f73608d8663124">rte_ether_hdr::d_addr</a></div><div class="ttdeci">struct rte_ether_addr d_addr</div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00000">rte_ether.h:265</a></div></div>
<div class="ttc" id="astructrte__ether__addr_html_ad6f7cb65b39d12b5250ecf82c8ffaa45"><div class="ttname"><a href="structrte__ether__addr.html#ad6f7cb65b39d12b5250ecf82c8ffaa45">rte_ether_addr::addr_bytes</a></div><div class="ttdeci">uint8_t addr_bytes[RTE_ETHER_ADDR_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="rte__ether_8h_source.html#l00065">rte_ether.h:65</a></div></div>
<div class="ttc" id="arte__errno_8h_html_a66171a00ea02084317df4dc9c2adaccb"><div class="ttname"><a href="rte__errno_8h.html#a66171a00ea02084317df4dc9c2adaccb">rte_errno</a></div><div class="ttdeci">#define rte_errno</div><div class="ttdef"><b>Definition:</b> <a href="rte__errno_8h_source.html#l00029">rte_errno.h:29</a></div></div>
<div class="ttc" id="arte__malloc_8h_html_a7e9f76b7e0b0921a617c6ab8b28f53b3"><div class="ttname"><a href="rte__malloc_8h.html#a7e9f76b7e0b0921a617c6ab8b28f53b3">rte_zmalloc_socket</a></div><div class="ttdeci">void * rte_zmalloc_socket(const char *type, size_t size, unsigned align, int socket) __rte_alloc_size(2)</div></div>
<div class="ttc" id="arte__ethdev_8h_html_ac2c7507787a5520e8049fff94432169e"><div class="ttname"><a href="rte__ethdev_8h.html#ac2c7507787a5520e8049fff94432169e">rte_eth_dev_close</a></div><div class="ttdeci">int rte_eth_dev_close(uint16_t port_id)</div></div>
<div class="ttc" id="arte__ioat__rawdev_8h_html"><div class="ttname"><a href="rte__ioat__rawdev_8h.html">rte_ioat_rawdev.h</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
