

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>29. Flow Classification Library &mdash; Data Plane Development Kit 20.11.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="30. Packet Distributor Library" href="packet_distrib_lib.html" />
    <link rel="prev" title="28. LPM6 Library" href="lpm6_lib.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Data Plane Development Kit
          

          
            
            <img src="../_static/DPDK_logo_vertical_rev_small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                20.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Programmer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">2. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_abstraction_layer.html">3. Environment Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="service_cores.html">4. Service Cores</a></li>
<li class="toctree-l2"><a class="reference internal" href="trace_lib.html">5. Trace Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rcu_lib.html">6. RCU Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ring_lib.html">7. Ring Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="stack_lib.html">8. Stack Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="mempool_lib.html">9. Mempool Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="mbuf_lib.html">10. Mbuf Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="poll_mode_drv.html">11. Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="rte_flow.html">12. Generic flow API (rte_flow)</a></li>
<li class="toctree-l2"><a class="reference internal" href="switch_representation.html">13. Switch Representation within DPDK Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_metering_and_policing.html">14. Traffic Metering and Policing API</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_management.html">15. Traffic Management API</a></li>
<li class="toctree-l2"><a class="reference internal" href="bbdev.html">16. Wireless Baseband Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="cryptodev_lib.html">17. Cryptography Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="compressdev.html">18. Compression Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="regexdev.html">19. RegEx Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rte_security.html">20. Security Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rawdev.html">21. Rawdevice Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_bonding_poll_mode_drv_lib.html">22. Link Bonding Poll Mode Driver Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="timer_lib.html">23. Timer Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="hash_lib.html">24. Hash Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="efd_lib.html">25. Elastic Flow Distributor Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="member_lib.html">26. Membership Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="lpm_lib.html">27. LPM Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="lpm6_lib.html">28. LPM6 Library</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">29. Flow Classification Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">29.1. Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#classifier-creation">29.1.1. Classifier creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-a-table-to-the-classifier">29.1.2. Adding a table to the Classifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flow-parsing">29.1.3. Flow Parsing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-flow-rules">29.1.4. Adding Flow Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deleting-flow-rules">29.1.5. Deleting Flow Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#packet-matching">29.1.6. Packet Matching</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="packet_distrib_lib.html">30. Packet Distributor Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="reorder_lib.html">31. Reorder Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ip_fragment_reassembly_lib.html">32. IP Fragmentation and Reassembly Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic_receive_offload_lib.html">33. Generic Receive Offload Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic_segmentation_offload_lib.html">34. Generic Segmentation Offload Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="pdump_lib.html">35. The librte_pdump Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi_proc_support.html">36. Multi-process Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_nic_interface.html">37. Kernel NIC Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread_safety_dpdk_functions.html">38. Thread Safety of DPDK Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="eventdev.html">39. Event Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_ethernet_rx_adapter.html">40. Event Ethernet Rx Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_ethernet_tx_adapter.html">41. Event Ethernet Tx Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_timer_adapter.html">42. Event Timer Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_crypto_adapter.html">43. Event Crypto Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="qos_framework.html">44. Quality of Service (QoS) Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="power_man.html">45. Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_classif_access_ctrl.html">46. Packet Classification and Access Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_framework.html">47. Packet Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhost_lib.html">48. Vhost Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics_lib.html">49. Metrics Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="telemetry_lib.html">50. Telemetry Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="bpf_lib.html">51. Berkeley Packet Filter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipsec_lib.html">52. IPsec Packet Processing Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="graph_lib.html">53. Graph Library and Inbuilt Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="source_org.html">54. Source Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-sdk-meson.html">55. Installing DPDK Using the meson build system</a></li>
<li class="toctree-l2"><a class="reference internal" href="meson_ut.html">56. Running DPDK Unit Tests with Meson</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_app.html">57. Building Your Own Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf_opt_guidelines.html">58. Performance Optimization Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_efficient_code.html">59. Writing Efficient Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="lto.html">60. Link Time Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile_app.html">61. Profile Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="glossary.html">62. Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nics/index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor’s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Data Plane Development Kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Programmer’s Guide</a> &raquo;</li>
        
      <li><span class="section-number">29. </span>Flow Classification Library</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/prog_guide/flow_classify_lib.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="flow-classification-library">
<h1><span class="section-number">29. </span>Flow Classification Library</h1>
<p>DPDK provides a Flow Classification library that provides the ability
to classify an input packet by matching it against a set of Flow rules.</p>
<p>The initial implementation supports counting of IPv4 5-tuple packets which match
a particular Flow rule only.</p>
<p>Please refer to the
<a class="reference internal" href="rte_flow.html"><span class="doc">Generic flow API (rte_flow)</span></a>
for more information.</p>
<p>The Flow Classification library uses the <code class="docutils literal notranslate"><span class="pre">librte_table</span></code> API for managing Flow
rules and matching packets against the Flow rules.
The library is table agnostic and can use the following tables:
<code class="docutils literal notranslate"><span class="pre">Access</span> <span class="pre">Control</span> <span class="pre">List</span></code>, <code class="docutils literal notranslate"><span class="pre">Hash</span></code> and <code class="docutils literal notranslate"><span class="pre">Longest</span> <span class="pre">Prefix</span> <span class="pre">Match(LPM)</span></code>.
The <code class="docutils literal notranslate"><span class="pre">Access</span> <span class="pre">Control</span> <span class="pre">List</span></code> table is used in the initial implementation.</p>
<p>Please refer to the
<a class="reference internal" href="packet_framework.html"><span class="doc">Packet Framework</span></a>
for more information.on <code class="docutils literal notranslate"><span class="pre">librte_table</span></code>.</p>
<p>DPDK provides an Access Control List library that provides the ability to
classify an input packet based on a set of classification rules.</p>
<p>Please refer to the
<a class="reference internal" href="packet_classif_access_ctrl.html"><span class="doc">Packet Classification and Access Control</span></a>
library for more information on <code class="docutils literal notranslate"><span class="pre">librte_acl</span></code>.</p>
<p>There is also a Flow Classify sample application which demonstrates the use of
the Flow Classification Library API’s.</p>
<p>Please refer to the
<a class="reference internal" href="../sample_app_ug/flow_classify.html"><span class="doc">Flow Classify Sample Application</span></a>
for more information on the <code class="docutils literal notranslate"><span class="pre">flow_classify</span></code> sample application.</p>
<div class="section" id="overview">
<h2><span class="section-number">29.1. </span>Overview</h2>
<p>The library has the following API’s</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Flow classifier create</span>
<span class="cm"> *</span>
<span class="cm"> * @param params</span>
<span class="cm"> *   Parameters for flow classifier creation</span>
<span class="cm"> * @return</span>
<span class="cm"> *   Handle to flow classifier instance on success or NULL otherwise</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">rte_flow_classifier</span> <span class="o">*</span>
<span class="nf">rte_flow_classifier_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">rte_flow_classifier_params</span> <span class="o">*</span><span class="n">params</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Flow classifier free</span>
<span class="cm"> *</span>
<span class="cm"> * @param cls</span>
<span class="cm"> *   Handle to flow classifier instance</span>
<span class="cm"> * @return</span>
<span class="cm"> *   0 on success, error code otherwise</span>
<span class="cm"> */</span>
<span class="kt">int</span>
<span class="nf">rte_flow_classifier_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">rte_flow_classifier</span> <span class="o">*</span><span class="n">cls</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Flow classify table create</span>
<span class="cm"> *</span>
<span class="cm"> * @param cls</span>
<span class="cm"> *   Handle to flow classifier instance</span>
<span class="cm"> * @param params</span>
<span class="cm"> *   Parameters for flow_classify table creation</span>
<span class="cm"> * @return</span>
<span class="cm"> *   0 on success, error code otherwise</span>
<span class="cm"> */</span>
<span class="kt">int</span>
<span class="nf">rte_flow_classify_table_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">rte_flow_classifier</span> <span class="o">*</span><span class="n">cls</span><span class="p">,</span>
       <span class="k">struct</span> <span class="n">rte_flow_classify_table_params</span> <span class="o">*</span><span class="n">params</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Validate the flow classify rule</span>
<span class="cm"> *</span>
<span class="cm"> * @param[in] cls</span>
<span class="cm"> *   Handle to flow classifier instance</span>
<span class="cm"> * @param[in] attr</span>
<span class="cm"> *   Flow rule attributes</span>
<span class="cm"> * @param[in] pattern</span>
<span class="cm"> *   Pattern specification (list terminated by the END pattern item).</span>
<span class="cm"> * @param[in] actions</span>
<span class="cm"> *   Associated actions (list terminated by the END pattern item).</span>
<span class="cm"> * @param[out] error</span>
<span class="cm"> *   Perform verbose error reporting if not NULL. Structure</span>
<span class="cm"> *   initialised in case of error only.</span>
<span class="cm"> * @return</span>
<span class="cm"> *   0 on success, error code otherwise</span>
<span class="cm"> */</span>
<span class="kt">int</span>
<span class="nf">rte_flow_classify_validate</span><span class="p">(</span><span class="k">struct</span> <span class="n">rte_flow_classifier</span> <span class="o">*</span><span class="n">cls</span><span class="p">,</span>
        <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_attr</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
        <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_item</span> <span class="n">pattern</span><span class="p">[],</span>
        <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_action</span> <span class="n">actions</span><span class="p">[],</span>
        <span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Add a flow classify rule to the flow_classifier table.</span>
<span class="cm"> *</span>
<span class="cm"> * @param[in] cls</span>
<span class="cm"> *   Flow classifier handle</span>
<span class="cm"> * @param[in] attr</span>
<span class="cm"> *   Flow rule attributes</span>
<span class="cm"> * @param[in] pattern</span>
<span class="cm"> *   Pattern specification (list terminated by the END pattern item).</span>
<span class="cm"> * @param[in] actions</span>
<span class="cm"> *   Associated actions (list terminated by the END pattern item).</span>
<span class="cm"> * @param[out] key_found</span>
<span class="cm"> *   returns 1 if rule present already, 0 otherwise.</span>
<span class="cm"> * @param[out] error</span>
<span class="cm"> *   Perform verbose error reporting if not NULL. Structure</span>
<span class="cm"> *   initialised in case of error only.</span>
<span class="cm"> * @return</span>
<span class="cm"> *   A valid handle in case of success, NULL otherwise.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">rte_flow_classify_rule</span> <span class="o">*</span>
<span class="n">rte_flow_classify_table_entry_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">rte_flow_classifier</span> <span class="o">*</span><span class="n">cls</span><span class="p">,</span>
        <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_attr</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
        <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_item</span> <span class="n">pattern</span><span class="p">[],</span>
        <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_action</span> <span class="n">actions</span><span class="p">[],</span>
        <span class="kt">int</span> <span class="o">*</span><span class="n">key_found</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Delete a flow classify rule from the flow_classifier table.</span>
<span class="cm"> *</span>
<span class="cm"> * @param[in] cls</span>
<span class="cm"> *   Flow classifier handle</span>
<span class="cm"> * @param[in] rule</span>
<span class="cm"> *   Flow classify rule</span>
<span class="cm"> * @return</span>
<span class="cm"> *   0 on success, error code otherwise.</span>
<span class="cm"> */</span>
<span class="kt">int</span>
<span class="nf">rte_flow_classify_table_entry_delete</span><span class="p">(</span><span class="k">struct</span> <span class="n">rte_flow_classifier</span> <span class="o">*</span><span class="n">cls</span><span class="p">,</span>
        <span class="k">struct</span> <span class="n">rte_flow_classify_rule</span> <span class="o">*</span><span class="n">rule</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Query flow classifier for given rule.</span>
<span class="cm"> *</span>
<span class="cm"> * @param[in] cls</span>
<span class="cm"> *   Flow classifier handle</span>
<span class="cm"> * @param[in] pkts</span>
<span class="cm"> *   Pointer to packets to process</span>
<span class="cm"> * @param[in] nb_pkts</span>
<span class="cm"> *   Number of packets to process</span>
<span class="cm"> * @param[in] rule</span>
<span class="cm"> *   Flow classify rule</span>
<span class="cm"> * @param[in] stats</span>
<span class="cm"> *   Flow classify stats</span>
<span class="cm"> *</span>
<span class="cm"> * @return</span>
<span class="cm"> *   0 on success, error code otherwise.</span>
<span class="cm"> */</span>
<span class="kt">int</span>
<span class="nf">rte_flow_classifier_query</span><span class="p">(</span><span class="k">struct</span> <span class="n">rte_flow_classifier</span> <span class="o">*</span><span class="n">cls</span><span class="p">,</span>
        <span class="k">struct</span> <span class="n">rte_mbuf</span> <span class="o">**</span><span class="n">pkts</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">uint16_t</span> <span class="n">nb_pkts</span><span class="p">,</span>
        <span class="k">struct</span> <span class="n">rte_flow_classify_rule</span> <span class="o">*</span><span class="n">rule</span><span class="p">,</span>
        <span class="k">struct</span> <span class="n">rte_flow_classify_stats</span> <span class="o">*</span><span class="n">stats</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="classifier-creation">
<h3><span class="section-number">29.1.1. </span>Classifier creation</h3>
<p>The application creates the <code class="docutils literal notranslate"><span class="pre">Classifier</span></code> using the
<code class="docutils literal notranslate"><span class="pre">rte_flow_classifier_create</span></code> API.
The <code class="docutils literal notranslate"><span class="pre">rte_flow_classify_params</span></code> structure must be initialised by the
application before calling the API.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">rte_flow_classifier_params</span> <span class="p">{</span>
    <span class="cm">/** flow classifier name */</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>

    <span class="cm">/** CPU socket ID where memory for the flow classifier and its */</span>
    <span class="cm">/** elements (tables) should be allocated */</span>
    <span class="kt">int</span> <span class="n">socket_id</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Classifier</span></code> has the following internal structures:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">rte_cls_table</span> <span class="p">{</span>
    <span class="cm">/* Input parameters */</span>
    <span class="k">struct</span> <span class="n">rte_table_ops</span> <span class="n">ops</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">entry_size</span><span class="p">;</span>
    <span class="k">enum</span> <span class="n">rte_flow_classify_table_type</span> <span class="n">type</span><span class="p">;</span>

    <span class="cm">/* Handle to the low-level table object */</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">h_table</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define RTE_FLOW_CLASSIFIER_MAX_NAME_SZ 256</span>

<span class="k">struct</span> <span class="n">rte_flow_classifier</span> <span class="p">{</span>
    <span class="cm">/* Input parameters */</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="n">RTE_FLOW_CLASSIFIER_MAX_NAME_SZ</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">socket_id</span><span class="p">;</span>

    <span class="cm">/* Internal */</span>
    <span class="cm">/* ntuple_filter */</span>
    <span class="k">struct</span> <span class="n">rte_eth_ntuple_filter</span> <span class="n">ntuple_filter</span><span class="p">;</span>

    <span class="cm">/* classifier tables */</span>
    <span class="k">struct</span> <span class="n">rte_cls_table</span> <span class="n">tables</span><span class="p">[</span><span class="n">RTE_FLOW_CLASSIFY_TABLE_MAX</span><span class="p">];</span>
    <span class="kt">uint32_t</span> <span class="n">table_mask</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">num_tables</span><span class="p">;</span>

    <span class="kt">uint16_t</span> <span class="n">nb_pkts</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">rte_flow_classify_table_entry</span>
        <span class="o">*</span><span class="n">entries</span><span class="p">[</span><span class="n">RTE_PORT_IN_BURST_SIZE_MAX</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__rte_cache_aligned</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-a-table-to-the-classifier">
<h3><span class="section-number">29.1.2. </span>Adding a table to the Classifier</h3>
<p>The application adds a table to the <code class="docutils literal notranslate"><span class="pre">Classifier</span></code> using the
<code class="docutils literal notranslate"><span class="pre">rte_flow_classify_table_create</span></code> API.
The <code class="docutils literal notranslate"><span class="pre">rte_flow_classify_table_params</span></code> structure must be initialised by the
application before calling the API.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">rte_flow_classify_table_params</span> <span class="p">{</span>
    <span class="cm">/** Table operations (specific to each table type) */</span>
    <span class="k">struct</span> <span class="n">rte_table_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">;</span>

    <span class="cm">/** Opaque param to be passed to the table create operation */</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">arg_create</span><span class="p">;</span>

    <span class="cm">/** Classifier table type */</span>
    <span class="k">enum</span> <span class="n">rte_flow_classify_table_type</span> <span class="n">type</span><span class="p">;</span>
 <span class="p">};</span>
</pre></div>
</div>
<p>To create an ACL table the <code class="docutils literal notranslate"><span class="pre">rte_table_acl_params</span></code> structure must be
initialised and assigned to <code class="docutils literal notranslate"><span class="pre">arg_create</span></code> in the
<code class="docutils literal notranslate"><span class="pre">rte_flow_classify_table_params</span></code> structure.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">rte_table_acl_params</span> <span class="p">{</span>
    <span class="cm">/** Name */</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>

    <span class="cm">/** Maximum number of ACL rules in the table */</span>
    <span class="kt">uint32_t</span> <span class="n">n_rules</span><span class="p">;</span>

    <span class="cm">/** Number of fields in the ACL rule specification */</span>
    <span class="kt">uint32_t</span> <span class="n">n_rule_fields</span><span class="p">;</span>

    <span class="cm">/** Format specification of the fields of the ACL rule */</span>
    <span class="k">struct</span> <span class="n">rte_acl_field_def</span> <span class="n">field_format</span><span class="p">[</span><span class="n">RTE_ACL_MAX_FIELDS</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The fields for the ACL rule must also be initialised by the application.</p>
<p>An ACL table can be added to the <code class="docutils literal notranslate"><span class="pre">Classifier</span></code> for each ACL rule, for example
another table could be added for the IPv6 5-tuple rule.</p>
</div>
<div class="section" id="flow-parsing">
<h3><span class="section-number">29.1.3. </span>Flow Parsing</h3>
<p>The library currently supports three IPv4 5-tuple flow patterns, for UDP, TCP
and SCTP.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Pattern for IPv4 5-tuple UDP filter */</span>
<span class="k">static</span> <span class="k">enum</span> <span class="n">rte_flow_item_type</span> <span class="n">pattern_ntuple_1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_ETH</span><span class="p">,</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_IPV4</span><span class="p">,</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_UDP</span><span class="p">,</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_END</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Pattern for IPv4 5-tuple TCP filter */</span>
<span class="k">static</span> <span class="k">enum</span> <span class="n">rte_flow_item_type</span> <span class="n">pattern_ntuple_2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_ETH</span><span class="p">,</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_IPV4</span><span class="p">,</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_TCP</span><span class="p">,</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_END</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Pattern for IPv4 5-tuple SCTP filter */</span>
<span class="k">static</span> <span class="k">enum</span> <span class="n">rte_flow_item_type</span> <span class="n">pattern_ntuple_3</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_ETH</span><span class="p">,</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_IPV4</span><span class="p">,</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_SCTP</span><span class="p">,</span>
    <span class="n">RTE_FLOW_ITEM_TYPE_END</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The API function <code class="docutils literal notranslate"><span class="pre">rte_flow_classify_validate</span></code> parses the
IPv4 5-tuple pattern, attributes and actions and returns the 5-tuple data in the
<code class="docutils literal notranslate"><span class="pre">rte_eth_ntuple_filter</span></code> structure.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span>
<span class="n">rte_flow_classify_validate</span><span class="p">(</span><span class="k">struct</span> <span class="n">rte_flow_classifier</span> <span class="o">*</span><span class="n">cls</span><span class="p">,</span>
               <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_attr</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
               <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_item</span> <span class="n">pattern</span><span class="p">[],</span>
               <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_action</span> <span class="n">actions</span><span class="p">[],</span>
               <span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-flow-rules">
<h3><span class="section-number">29.1.4. </span>Adding Flow Rules</h3>
<p>The <code class="docutils literal notranslate"><span class="pre">rte_flow_classify_table_entry_add</span></code> API creates an
<code class="docutils literal notranslate"><span class="pre">rte_flow_classify</span></code> object which contains the flow_classify id and type, the
action, a union of add and delete keys and a union of rules.
It uses the <code class="docutils literal notranslate"><span class="pre">rte_flow_classify_validate</span></code> API function for parsing the
flow parameters.
The 5-tuple ACL key data is obtained from the <code class="docutils literal notranslate"><span class="pre">rte_eth_ntuple_filter</span></code>
structure populated by the <code class="docutils literal notranslate"><span class="pre">classify_parse_ntuple_filter</span></code> function which
parses the Flow rule.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">acl_keys</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">rte_table_acl_rule_add_params</span> <span class="n">key_add</span><span class="p">;</span> <span class="cm">/* add key */</span>
    <span class="k">struct</span> <span class="n">rte_table_acl_rule_delete_params</span> <span class="n">key_del</span><span class="p">;</span> <span class="cm">/* delete key */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">classify_rules</span> <span class="p">{</span>
    <span class="k">enum</span> <span class="n">rte_flow_classify_rule_type</span> <span class="n">type</span><span class="p">;</span>
    <span class="k">union</span> <span class="p">{</span>
        <span class="k">struct</span> <span class="n">rte_flow_classify_ipv4_5tuple</span> <span class="n">ipv4_5tuple</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">u</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rte_flow_classify</span> <span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">id</span><span class="p">;</span>  <span class="cm">/* unique ID of classify object */</span>
    <span class="k">enum</span> <span class="n">rte_flow_classify_table_type</span> <span class="n">tbl_type</span><span class="p">;</span> <span class="cm">/* rule table */</span>
    <span class="k">struct</span> <span class="n">classify_rules</span> <span class="n">rules</span><span class="p">;</span> <span class="cm">/* union of rules */</span>
    <span class="k">union</span> <span class="p">{</span>
        <span class="k">struct</span> <span class="n">acl_keys</span> <span class="n">key</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">u</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">key_found</span><span class="p">;</span> <span class="cm">/* rule key found in table */</span>
    <span class="k">struct</span> <span class="n">rte_flow_classify_table_entry</span> <span class="n">entry</span><span class="p">;</span>  <span class="cm">/* rule meta data */</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">entry_ptr</span><span class="p">;</span> <span class="cm">/* handle to the table entry for rule meta data */</span>
<span class="p">};</span>
</pre></div>
</div>
<p>It then calls the <code class="docutils literal notranslate"><span class="pre">table.ops.f_add</span></code> API to add the rule to the ACL
table.</p>
</div>
<div class="section" id="deleting-flow-rules">
<h3><span class="section-number">29.1.5. </span>Deleting Flow Rules</h3>
<p>The <code class="docutils literal notranslate"><span class="pre">rte_flow_classify_table_entry_delete</span></code> API calls the
<code class="docutils literal notranslate"><span class="pre">table.ops.f_delete</span></code> API to delete a rule from the ACL table.</p>
</div>
<div class="section" id="packet-matching">
<h3><span class="section-number">29.1.6. </span>Packet Matching</h3>
<p>The <code class="docutils literal notranslate"><span class="pre">rte_flow_classifier_query</span></code> API is used to find packets which match a
given flow Flow rule in the table.
This API calls the flow_classify_run internal function which calls the
<code class="docutils literal notranslate"><span class="pre">table.ops.f_lookup</span></code> API to see if any packets in a burst match any
of the Flow rules in the table.
The meta data for the highest priority rule matched for each packet is returned
in the entries array in the <code class="docutils literal notranslate"><span class="pre">rte_flow_classify</span></code> object.
The internal function <code class="docutils literal notranslate"><span class="pre">action_apply</span></code> implements the <code class="docutils literal notranslate"><span class="pre">Count</span></code> action which is
used to return data which matches a particular Flow rule.</p>
<p>The rte_flow_classifier_query API uses the following structures to return data
to the application.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/** IPv4 5-tuple data */</span>
<span class="k">struct</span> <span class="n">rte_flow_classify_ipv4_5tuple</span> <span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">dst_ip</span><span class="p">;</span>         <span class="cm">/**&lt; Destination IP address in big endian. */</span>
    <span class="kt">uint32_t</span> <span class="n">dst_ip_mask</span><span class="p">;</span>    <span class="cm">/**&lt; Mask of destination IP address. */</span>
    <span class="kt">uint32_t</span> <span class="n">src_ip</span><span class="p">;</span>         <span class="cm">/**&lt; Source IP address in big endian. */</span>
    <span class="kt">uint32_t</span> <span class="n">src_ip_mask</span><span class="p">;</span>    <span class="cm">/**&lt; Mask of destination IP address. */</span>
    <span class="kt">uint16_t</span> <span class="n">dst_port</span><span class="p">;</span>       <span class="cm">/**&lt; Destination port in big endian. */</span>
    <span class="kt">uint16_t</span> <span class="n">dst_port_mask</span><span class="p">;</span>  <span class="cm">/**&lt; Mask of destination port. */</span>
    <span class="kt">uint16_t</span> <span class="n">src_port</span><span class="p">;</span>       <span class="cm">/**&lt; Source Port in big endian. */</span>
    <span class="kt">uint16_t</span> <span class="n">src_port_mask</span><span class="p">;</span>  <span class="cm">/**&lt; Mask of source port. */</span>
    <span class="kt">uint8_t</span> <span class="n">proto</span><span class="p">;</span>           <span class="cm">/**&lt; L4 protocol. */</span>
    <span class="kt">uint8_t</span> <span class="n">proto_mask</span><span class="p">;</span>      <span class="cm">/**&lt; Mask of L4 protocol. */</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Flow stats</span>
<span class="cm"> *</span>
<span class="cm"> * For the count action, stats can be returned by the query API.</span>
<span class="cm"> *</span>
<span class="cm"> * Storage for stats is provided by the application.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">rte_flow_classify_stats</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">stats</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rte_flow_classify_5tuple_stats</span> <span class="p">{</span>
    <span class="cm">/** count of packets that match IPv4 5tuple pattern */</span>
    <span class="kt">uint64_t</span> <span class="n">counter1</span><span class="p">;</span>
    <span class="cm">/** IPv4 5tuple data */</span>
    <span class="k">struct</span> <span class="n">rte_flow_classify_ipv4_5tuple</span> <span class="n">ipv4_5tuple</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="packet_distrib_lib.html" class="btn btn-neutral float-right" title="30. Packet Distributor Library" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="lpm6_lib.html" class="btn btn-neutral float-left" title="28. LPM6 Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>