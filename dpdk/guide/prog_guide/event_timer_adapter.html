

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>42. Event Timer Adapter Library &mdash; Data Plane Development Kit 20.11.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="43. Event Crypto Adapter Library" href="event_crypto_adapter.html" />
    <link rel="prev" title="41. Event Ethernet Tx Adapter Library" href="event_ethernet_tx_adapter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Data Plane Development Kit
          

          
            
            <img src="../_static/DPDK_logo_vertical_rev_small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                20.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Programmerâ€™s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">2. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_abstraction_layer.html">3. Environment Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="service_cores.html">4. Service Cores</a></li>
<li class="toctree-l2"><a class="reference internal" href="trace_lib.html">5. Trace Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rcu_lib.html">6. RCU Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ring_lib.html">7. Ring Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="stack_lib.html">8. Stack Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="mempool_lib.html">9. Mempool Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="mbuf_lib.html">10. Mbuf Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="poll_mode_drv.html">11. Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="rte_flow.html">12. Generic flow API (rte_flow)</a></li>
<li class="toctree-l2"><a class="reference internal" href="switch_representation.html">13. Switch Representation within DPDK Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_metering_and_policing.html">14. Traffic Metering and Policing API</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_management.html">15. Traffic Management API</a></li>
<li class="toctree-l2"><a class="reference internal" href="bbdev.html">16. Wireless Baseband Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="cryptodev_lib.html">17. Cryptography Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="compressdev.html">18. Compression Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="regexdev.html">19. RegEx Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rte_security.html">20. Security Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rawdev.html">21. Rawdevice Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_bonding_poll_mode_drv_lib.html">22. Link Bonding Poll Mode Driver Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="timer_lib.html">23. Timer Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="hash_lib.html">24. Hash Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="efd_lib.html">25. Elastic Flow Distributor Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="member_lib.html">26. Membership Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="lpm_lib.html">27. LPM Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="lpm6_lib.html">28. LPM6 Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="flow_classify_lib.html">29. Flow Classification Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_distrib_lib.html">30. Packet Distributor Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="reorder_lib.html">31. Reorder Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ip_fragment_reassembly_lib.html">32. IP Fragmentation and Reassembly Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic_receive_offload_lib.html">33. Generic Receive Offload Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic_segmentation_offload_lib.html">34. Generic Segmentation Offload Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="pdump_lib.html">35. The librte_pdump Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi_proc_support.html">36. Multi-process Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_nic_interface.html">37. Kernel NIC Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread_safety_dpdk_functions.html">38. Thread Safety of DPDK Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="eventdev.html">39. Event Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_ethernet_rx_adapter.html">40. Event Ethernet Rx Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_ethernet_tx_adapter.html">41. Event Ethernet Tx Adapter Library</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">42. Event Timer Adapter Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#event-timer-struct">42.1. Event Timer struct</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#timer-expiry-event">42.1.1. Timer Expiry Event</a></li>
<li class="toctree-l4"><a class="reference internal" href="#timeout-ticks">42.1.2. Timeout Ticks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#state">42.1.3. State</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-metadata">42.1.4. User Metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#api-overview">42.2. API Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-and-configure-an-adapter-instance">42.2.1. Create and Configure an Adapter Instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retrieve-event-timer-adapter-contextual-information">42.2.2. Retrieve Event Timer Adapter Contextual Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-the-service-component">42.2.3. Configuring the Service Component</a></li>
<li class="toctree-l4"><a class="reference internal" href="#starting-the-adapter-instance">42.2.4. Starting the Adapter Instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arming-event-timers">42.2.5. Arming Event Timers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#canceling-event-timers">42.2.6. Canceling Event Timers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#processing-timer-expiry-events">42.3. Processing Timer Expiry Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary">42.4. Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="event_crypto_adapter.html">43. Event Crypto Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="qos_framework.html">44. Quality of Service (QoS) Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="power_man.html">45. Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_classif_access_ctrl.html">46. Packet Classification and Access Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_framework.html">47. Packet Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhost_lib.html">48. Vhost Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics_lib.html">49. Metrics Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="telemetry_lib.html">50. Telemetry Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="bpf_lib.html">51. Berkeley Packet Filter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipsec_lib.html">52. IPsec Packet Processing Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="graph_lib.html">53. Graph Library and Inbuilt Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="source_org.html">54. Source Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-sdk-meson.html">55. Installing DPDK Using the meson build system</a></li>
<li class="toctree-l2"><a class="reference internal" href="meson_ut.html">56. Running DPDK Unit Tests with Meson</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_app.html">57. Building Your Own Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf_opt_guidelines.html">58. Performance Optimization Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_efficient_code.html">59. Writing Efficient Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="lto.html">60. Link Time Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile_app.html">61. Profile Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="glossary.html">62. Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nics/index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributorâ€™s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Data Plane Development Kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Programmerâ€™s Guide</a> &raquo;</li>
        
      <li><span class="section-number">42. </span>Event Timer Adapter Library</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/prog_guide/event_timer_adapter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="event-timer-adapter-library">
<h1><span class="section-number">42. </span>Event Timer Adapter Library</h1>
<p>The DPDK <a class="reference internal" href="eventdev.html"><span class="doc">Event Device library</span></a>
introduces an event driven programming model which presents applications with
an alternative to the polling model traditionally used in DPDK
applications. Event devices can be coupled with arbitrary components to provide
new event sources by using <strong>event adapters</strong>. The Event Timer Adapter is one
such adapter; it bridges event devices and timer mechanisms.</p>
<p>The Event Timer Adapter library extends the event driven model
by introducing a <a class="reference internal" href="#timer-expiry-event"><span class="std std-ref">new type of event</span></a> that represents
a timer expiration, and providing an API with which adapters can be created or
destroyed, and <a class="reference internal" href="#event-timer"><span class="std std-ref">event timers</span></a> can be armed and canceled.</p>
<p>The Event Timer Adapter library is designed to interface with hardware or
software implementations of the timer mechanism; it will query an eventdev PMD
to determine which implementation should be used.  The default software
implementation manages timers using the DPDK
<a class="reference internal" href="timer_lib.html"><span class="doc">Timer library</span></a>.</p>
<p>Examples of using the API are presented in the <a class="reference internal" href="#api-overview">API Overview</a> and
<a class="reference internal" href="#processing-timer-expiry-events">Processing Timer Expiry Events</a> sections.  Code samples are abstracted and
are based on the example of handling a TCP retransmission.</p>
<div class="section" id="event-timer-struct">
<span id="event-timer"></span><h2><span class="section-number">42.1. </span>Event Timer struct</h2>
<p>Event timers are timers that enqueue a timer expiration event to an event
device upon timer expiration.</p>
<p>The Event Timer Adapter API represents each event timer with a generic struct,
which contains an event and user metadata.  The <code class="docutils literal notranslate"><span class="pre">rte_event_timer</span></code> struct is
defined in <code class="docutils literal notranslate"><span class="pre">lib/librte_event/librte_event_timer_adapter.h</span></code>.</p>
<div class="section" id="timer-expiry-event">
<span id="id1"></span><h3><span class="section-number">42.1.1. </span>Timer Expiry Event</h3>
<p>The event contained by an event timer is enqueued in the event device when the
timer expires, and the event device uses the attributes below when scheduling
it:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">event_queue_id</span></code> - Application should set this to specify an event queue to
which the timer expiry event should be enqueued</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">event_priority</span></code> - Application can set this to indicate the priority of the
timer expiry event in the event queue relative to other events</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sched_type</span></code> - Application can set this to specify the scheduling type of
the timer expiry event</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flow_id</span></code> - Application can set this to indicate which flow this timer
expiry event corresponds to</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">op</span></code> - Will be set to <code class="docutils literal notranslate"><span class="pre">RTE_EVENT_OP_NEW</span></code> by the event timer adapter</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">event_type</span></code> - Will be set to <code class="docutils literal notranslate"><span class="pre">RTE_EVENT_TYPE_TIMER</span></code> by the event timer
adapter</p></li>
</ul>
</div>
<div class="section" id="timeout-ticks">
<h3><span class="section-number">42.1.2. </span>Timeout Ticks</h3>
<p>The number of ticks from now in which the timer will expire. The ticks value
has a resolution (<code class="docutils literal notranslate"><span class="pre">timer_tick_ns</span></code>) that is specified in the event timer
adapter configuration.</p>
</div>
<div class="section" id="state">
<h3><span class="section-number">42.1.3. </span>State</h3>
<p>Before arming an event timer, the application should initialize its state to
RTE_EVENT_TIMER_NOT_ARMED. The event timerâ€™s state will be updated when a
request to arm or cancel it takes effect.</p>
<p>If the application wishes to rearm the timer after it has expired, it should
reset the state back to RTE_EVENT_TIMER_NOT_ARMED before doing so.</p>
</div>
<div class="section" id="user-metadata">
<h3><span class="section-number">42.1.4. </span>User Metadata</h3>
<p>Memory to store user specific metadata.  The event timer adapter implementation
will not modify this area.</p>
</div>
</div>
<div class="section" id="api-overview">
<h2><span class="section-number">42.2. </span>API Overview</h2>
<p>This section will introduce the reader to the event timer adapter API, showing
how to create and configure an event timer adapter and use it to manage event
timers.</p>
<p>From a high level, the setup steps are:</p>
<ul class="simple">
<li><p>rte_event_timer_adapter_create()</p></li>
<li><p>rte_event_timer_adapter_start()</p></li>
</ul>
<p>And to start and stop timers:</p>
<ul class="simple">
<li><p>rte_event_timer_arm_burst()</p></li>
<li><p>rte_event_timer_cancel_burst()</p></li>
</ul>
<div class="section" id="create-and-configure-an-adapter-instance">
<h3><span class="section-number">42.2.1. </span>Create and Configure an Adapter Instance</h3>
<p>To create an event timer adapter instance, initialize an
<code class="docutils literal notranslate"><span class="pre">rte_event_timer_adapter_conf</span></code> struct with the desired values, and pass it
to <code class="docutils literal notranslate"><span class="pre">rte_event_timer_adapter_create()</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define NSECPERSEC 1E9 </span><span class="c1">// No of ns in 1 sec</span>
<span class="k">const</span> <span class="k">struct</span> <span class="n">rte_event_timer_adapter_conf</span> <span class="n">adapter_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">event_dev_id</span> <span class="o">=</span> <span class="n">event_dev_id</span><span class="p">,</span>
        <span class="p">.</span><span class="n">timer_adapter_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">.</span><span class="n">clk_src</span> <span class="o">=</span> <span class="n">RTE_EVENT_TIMER_ADAPTER_CPU_CLK</span><span class="p">,</span>
        <span class="p">.</span><span class="n">timer_tick_ns</span> <span class="o">=</span> <span class="n">NSECPERSEC</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="c1">// 100 milliseconds</span>
        <span class="p">.</span><span class="n">max_tmo_nsec</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">NSECPERSEC</span> <span class="c1">// 2 minutes</span>
        <span class="p">.</span><span class="n">nb_timers</span> <span class="o">=</span> <span class="mi">40000</span><span class="p">,</span>
        <span class="p">.</span><span class="n">timer_adapter_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rte_event_timer_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">adapter</span> <span class="o">=</span> <span class="n">rte_event_timer_adapter_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter_config</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">adapter</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
</pre></div>
</div>
<p>Before creating an instance of a timer adapter, the application should create
and configure an event device along with its event ports. Based on the event
device capability, it might require creating an additional event port to be
used by the timer adapter.  If required, the
<code class="docutils literal notranslate"><span class="pre">rte_event_timer_adapter_create()</span></code> function will use a default method to
configure an event port;  it will examine the current event device
configuration, determine the next available port identifier number, and create
a new event port with a default port configuration.</p>
<p>If the application desires to have finer control of event port allocation
and setup, it can use the <code class="docutils literal notranslate"><span class="pre">rte_event_timer_adapter_create_ext()</span></code> function.
This function is passed a callback function that will be invoked if the
adapter needs to create an event port, giving the application the opportunity
to control how it is done.</p>
</div>
<div class="section" id="retrieve-event-timer-adapter-contextual-information">
<h3><span class="section-number">42.2.2. </span>Retrieve Event Timer Adapter Contextual Information</h3>
<p>The event timer adapter implementation may have constraints on tick resolution
or maximum timer expiry timeout based on the given event timer adapter or
system.  In this case, the implementation may adjust the tick resolution or
maximum timeout to the best possible configuration.</p>
<p>Upon successful event timer adapter creation, the application can get the
configured resolution and max timeout with
<code class="docutils literal notranslate"><span class="pre">rte_event_timer_adapter_get_info()</span></code>. This function will return an
<code class="docutils literal notranslate"><span class="pre">rte_event_timer_adapter_info</span></code> struct, which contains the following members:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">min_resolution_ns</span></code> - Minimum timer adapter tick resolution in ns.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_tmo_ns</span></code> - Maximum timer timeout(expiry) in ns.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">adapter_conf</span></code> - Configured event timer adapter attributes</p></li>
</ul>
</div>
<div class="section" id="configuring-the-service-component">
<h3><span class="section-number">42.2.3. </span>Configuring the Service Component</h3>
<p>If the adapter uses a service component, the application is required to map
the service to a service core before starting the adapter:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span> <span class="n">service_id</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rte_event_timer_adapter_service_id_get</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">service_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">rte_service_map_lcore_set</span><span class="p">(</span><span class="n">service_id</span><span class="p">,</span> <span class="n">EVTIM_CORE_ID</span><span class="p">);</span>
</pre></div>
</div>
<p>An event timer adapter uses a service component if the event device PMD
indicates that the adapter should use a software implementation.</p>
</div>
<div class="section" id="starting-the-adapter-instance">
<h3><span class="section-number">42.2.4. </span>Starting the Adapter Instance</h3>
<p>The application should call <code class="docutils literal notranslate"><span class="pre">rte_event_timer_adapter_start()</span></code> to start
running the event timer adapter. This function calls the start entry points
defined by eventdev PMDs for hardware implementations or puts a service
component into the running state in the software implementation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The eventdev to which the event_timer_adapter is connected needs to
be started before calling rte_event_timer_adapter_start().</p>
</div>
</div>
<div class="section" id="arming-event-timers">
<h3><span class="section-number">42.2.5. </span>Arming Event Timers</h3>
<p>Once an event timer adapter has been started, an application can begin to
manage event timers with it.</p>
<p>The application should allocate <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_event_timer</span></code> objects from a
mempool or huge-page backed application buffers of required size. Upon
successful allocation, the application should initialize the event timer, and
then set any of the necessary event attributes described in the
<a class="reference internal" href="#id1">Timer Expiry Event</a> section. In the following example, assume <code class="docutils literal notranslate"><span class="pre">conn</span></code>
represents a TCP connection and that <code class="docutils literal notranslate"><span class="pre">event_timer_pool</span></code> is a mempool that
was created previously:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">rte_mempool_get</span><span class="p">(</span><span class="n">event_timer_pool</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">conn</span><span class="o">-&gt;</span><span class="n">evtim</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">conn</span><span class="o">-&gt;</span><span class="n">evtim</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="cm">/* Set up the event timer. */</span>
<span class="n">conn</span><span class="o">-&gt;</span><span class="n">evtim</span><span class="o">-&gt;</span><span class="n">ev</span><span class="p">.</span><span class="n">op</span> <span class="o">=</span> <span class="n">RTE_EVENT_OP_NEW</span><span class="p">;</span>
<span class="n">conn</span><span class="o">-&gt;</span><span class="n">evtim</span><span class="o">-&gt;</span><span class="n">ev</span><span class="p">.</span><span class="n">queue_id</span> <span class="o">=</span> <span class="n">event_queue_id</span><span class="p">;</span>
<span class="n">conn</span><span class="o">-&gt;</span><span class="n">evtim</span><span class="o">-&gt;</span><span class="n">ev</span><span class="p">.</span><span class="n">sched_type</span> <span class="o">=</span> <span class="n">RTE_SCHED_TYPE_ATOMIC</span><span class="p">;</span>
<span class="n">conn</span><span class="o">-&gt;</span><span class="n">evtim</span><span class="o">-&gt;</span><span class="n">ev</span><span class="p">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">RTE_EVENT_DEV_PRIORITY_NORMAL</span><span class="p">;</span>
<span class="n">conn</span><span class="o">-&gt;</span><span class="n">evtim</span><span class="o">-&gt;</span><span class="n">ev</span><span class="p">.</span><span class="n">event_type</span> <span class="o">=</span> <span class="n">RTE_EVENT_TYPE_TIMER</span><span class="p">;</span>
<span class="n">conn</span><span class="o">-&gt;</span><span class="n">evtim</span><span class="o">-&gt;</span><span class="n">ev</span><span class="p">.</span><span class="n">event_ptr</span> <span class="o">=</span> <span class="n">conn</span><span class="p">;</span>
<span class="n">conn</span><span class="o">-&gt;</span><span class="n">evtim</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">RTE_EVENT_TIMER_NOT_ARMED</span><span class="p">;</span>
<span class="n">conn</span><span class="o">-&gt;</span><span class="n">evtim</span><span class="o">-&gt;</span><span class="n">timeout_ticks</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span> <span class="c1">//3 sec Per RFC1122(TCP returns)</span>
</pre></div>
</div>
<p>Note that it is necessary to initialize the event timer state to
RTE_EVENT_TIMER_NOT_ARMED.  Also note that we have saved a pointer to the
<code class="docutils literal notranslate"><span class="pre">conn</span></code> object in the timerâ€™s event payload. This will allow us to locate
the connection object again once we dequeue the timer expiry event from the
event device later.  As a convenience, the application may specify no value for
ev.event_ptr, and the adapter will by default set it to point at the event
timer itself.</p>
<p>Now we can arm the event timer with <code class="docutils literal notranslate"><span class="pre">rte_event_timer_arm_burst()</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ret</span> <span class="o">=</span> <span class="n">rte_event_timer_arm_burst</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conn</span><span class="o">-&gt;</span><span class="n">evtim</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>Once an event timer expires, the application may free it or rearm it as
necessary.  If the application will rearm the timer, the state should be reset
to RTE_EVENT_TIMER_NOT_ARMED by the application before rearming it.</p>
<div class="section" id="multiple-event-timers-with-same-expiry-value">
<h4><span class="section-number">42.2.5.1. </span>Multiple Event Timers with Same Expiry Value</h4>
<p>In the special case that there is a set of event timers that should all expire
at the same time, the application may call
<code class="docutils literal notranslate"><span class="pre">rte_event_timer_arm_tmo_tick_burst()</span></code>, which allows the implementation to
optimize the operation if possible.</p>
</div>
</div>
<div class="section" id="canceling-event-timers">
<h3><span class="section-number">42.2.6. </span>Canceling Event Timers</h3>
<p>An event timer that has been armed as described in <a class="reference internal" href="#arming-event-timers">Arming Event Timers</a> can
be canceled by calling <code class="docutils literal notranslate"><span class="pre">rte_event_timer_cancel_burst()</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Ack for the previous tcp data packet has been received;</span>
<span class="cm"> * cancel the retransmission timer</span>
<span class="cm"> */</span>
<span class="n">rte_event_timer_cancel_burst</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conn</span><span class="o">-&gt;</span><span class="n">timer</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="processing-timer-expiry-events">
<h2><span class="section-number">42.3. </span>Processing Timer Expiry Events</h2>
<p>Once an event timer has successfully enqueued a timer expiry event in the event
device, the application will subsequently dequeue it from the event device.
The application can use the event payload to retrieve a pointer to the object
associated with the event timer. It can then re-arm the event timer or free the
event timer object as desired:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">event_processing_loop</span><span class="p">(...)</span>
<span class="p">{</span>
        <span class="k">while</span> <span class="p">(...)</span> <span class="p">{</span>
                <span class="cm">/* Receive events from the configured event port. */</span>
                <span class="n">rte_event_dequeue_burst</span><span class="p">(</span><span class="n">event_dev_id</span><span class="p">,</span> <span class="n">event_port</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ev</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="p">...</span>
                <span class="k">switch</span><span class="p">(</span><span class="n">ev</span><span class="p">.</span><span class="n">event_type</span><span class="p">)</span> <span class="p">{</span>
                        <span class="p">...</span>
                        <span class="k">case</span> <span class="nl">RTE_EVENT_TYPE_TIMER</span><span class="p">:</span>
                                <span class="n">process_timer_event</span><span class="p">(</span><span class="n">ev</span><span class="p">);</span>
                                <span class="p">...</span>
                                <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>

<span class="kt">uint8_t</span>
<span class="nf">process_timer_event</span><span class="p">(...)</span>
<span class="p">{</span>
        <span class="cm">/* A retransmission timeout for the connection has been received. */</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">ev</span><span class="p">.</span><span class="n">event_ptr</span><span class="p">;</span>
        <span class="cm">/* Retransmit last packet (e.g. TCP segment). */</span>
        <span class="p">...</span>
        <span class="cm">/* Re-arm timer using original values. */</span>
        <span class="n">rte_event_timer_arm_burst</span><span class="p">(</span><span class="n">adapter_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conn</span><span class="o">-&gt;</span><span class="n">timer</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="summary">
<h2><span class="section-number">42.4. </span>Summary</h2>
<p>The Event Timer Adapter library extends the DPDK event-based programming model
by representing timer expirations as events in the system and allowing
applications to use existing event processing loops to arm and cancel event
timers or handle timer expiry events.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="event_crypto_adapter.html" class="btn btn-neutral float-right" title="43. Event Crypto Adapter Library" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="event_ethernet_tx_adapter.html" class="btn btn-neutral float-left" title="41. Event Ethernet Tx Adapter Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>