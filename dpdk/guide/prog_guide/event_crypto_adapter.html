

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>43. Event Crypto Adapter Library &mdash; Data Plane Development Kit 20.11.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="44. Quality of Service (QoS) Framework" href="qos_framework.html" />
    <link rel="prev" title="42. Event Timer Adapter Library" href="event_timer_adapter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Data Plane Development Kit
          

          
            
            <img src="../_static/DPDK_logo_vertical_rev_small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                20.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Programmer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">2. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_abstraction_layer.html">3. Environment Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="service_cores.html">4. Service Cores</a></li>
<li class="toctree-l2"><a class="reference internal" href="trace_lib.html">5. Trace Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rcu_lib.html">6. RCU Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ring_lib.html">7. Ring Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="stack_lib.html">8. Stack Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="mempool_lib.html">9. Mempool Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="mbuf_lib.html">10. Mbuf Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="poll_mode_drv.html">11. Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="rte_flow.html">12. Generic flow API (rte_flow)</a></li>
<li class="toctree-l2"><a class="reference internal" href="switch_representation.html">13. Switch Representation within DPDK Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_metering_and_policing.html">14. Traffic Metering and Policing API</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_management.html">15. Traffic Management API</a></li>
<li class="toctree-l2"><a class="reference internal" href="bbdev.html">16. Wireless Baseband Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="cryptodev_lib.html">17. Cryptography Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="compressdev.html">18. Compression Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="regexdev.html">19. RegEx Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rte_security.html">20. Security Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rawdev.html">21. Rawdevice Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_bonding_poll_mode_drv_lib.html">22. Link Bonding Poll Mode Driver Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="timer_lib.html">23. Timer Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="hash_lib.html">24. Hash Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="efd_lib.html">25. Elastic Flow Distributor Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="member_lib.html">26. Membership Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="lpm_lib.html">27. LPM Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="lpm6_lib.html">28. LPM6 Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="flow_classify_lib.html">29. Flow Classification Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_distrib_lib.html">30. Packet Distributor Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="reorder_lib.html">31. Reorder Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ip_fragment_reassembly_lib.html">32. IP Fragmentation and Reassembly Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic_receive_offload_lib.html">33. Generic Receive Offload Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic_segmentation_offload_lib.html">34. Generic Segmentation Offload Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="pdump_lib.html">35. The librte_pdump Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi_proc_support.html">36. Multi-process Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_nic_interface.html">37. Kernel NIC Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread_safety_dpdk_functions.html">38. Thread Safety of DPDK Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="eventdev.html">39. Event Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_ethernet_rx_adapter.html">40. Event Ethernet Rx Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_ethernet_tx_adapter.html">41. Event Ethernet Tx Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_timer_adapter.html">42. Event Timer Adapter Library</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">43. Event Crypto Adapter Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adapter-mode">43.1. Adapter Mode</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#rte-event-crypto-adapter-op-new-mode">43.1.1. RTE_EVENT_CRYPTO_ADAPTER_OP_NEW mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rte-event-crypto-adapter-op-forward-mode">43.1.2. RTE_EVENT_CRYPTO_ADAPTER_OP_FORWARD mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#api-overview">43.2. API Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-an-adapter-instance">43.2.1. Create an adapter instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#querying-adapter-capabilities">43.2.2. Querying adapter capabilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-queue-pair-to-the-adapter-instance">43.2.3. Adding queue pair to the adapter instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-the-service-function">43.2.4. Configure the service function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-event-request-response-information">43.2.5. Set event request/response information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#start-the-adapter-instance">43.2.6. Start the adapter instance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-adapter-statistics">43.2.7. Get adapter statistics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="qos_framework.html">44. Quality of Service (QoS) Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="power_man.html">45. Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_classif_access_ctrl.html">46. Packet Classification and Access Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_framework.html">47. Packet Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhost_lib.html">48. Vhost Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics_lib.html">49. Metrics Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="telemetry_lib.html">50. Telemetry Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="bpf_lib.html">51. Berkeley Packet Filter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipsec_lib.html">52. IPsec Packet Processing Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="graph_lib.html">53. Graph Library and Inbuilt Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="source_org.html">54. Source Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-sdk-meson.html">55. Installing DPDK Using the meson build system</a></li>
<li class="toctree-l2"><a class="reference internal" href="meson_ut.html">56. Running DPDK Unit Tests with Meson</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_app.html">57. Building Your Own Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf_opt_guidelines.html">58. Performance Optimization Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_efficient_code.html">59. Writing Efficient Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="lto.html">60. Link Time Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile_app.html">61. Profile Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="glossary.html">62. Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nics/index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor’s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Data Plane Development Kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Programmer’s Guide</a> &raquo;</li>
        
      <li><span class="section-number">43. </span>Event Crypto Adapter Library</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/prog_guide/event_crypto_adapter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="event-crypto-adapter-library">
<h1><span class="section-number">43. </span>Event Crypto Adapter Library</h1>
<p>The DPDK <a class="reference internal" href="eventdev.html"><span class="doc">Eventdev library</span></a> provides event driven
programming model with features to schedule events.
The <a class="reference internal" href="cryptodev_lib.html"><span class="doc">Cryptodev library</span></a> provides an interface to
the crypto poll mode drivers which supports different crypto operations.
The Event Crypto Adapter is one of the adapter which is intended to
bridge between the event device and the crypto device.</p>
<p>The packet flow from crypto device to the event device can be accomplished
using SW and HW based transfer mechanism.
The Adapter queries an eventdev PMD to determine which mechanism to be used.
The adapter uses an EAL service core function for SW based packet transfer
and uses the eventdev PMD functions to configure HW based packet transfer
between the crypto device and the event device. The crypto adapter uses a new
event type called <code class="docutils literal notranslate"><span class="pre">RTE_EVENT_TYPE_CRYPTODEV</span></code> to indicate the event source.</p>
<p>The application can choose to submit a crypto operation directly to
crypto device or send it to the crypto adapter via eventdev based on
RTE_EVENT_CRYPTO_ADAPTER_CAP_INTERNAL_PORT_OP_FWD capability.
The first mode is known as the event new(RTE_EVENT_CRYPTO_ADAPTER_OP_NEW)
mode and the second as the event forward(RTE_EVENT_CRYPTO_ADAPTER_OP_FORWARD)
mode. The choice of mode can be specified while creating the adapter.
In the former mode, it is an application responsibility to enable ingress
packet ordering. In the latter mode, it is the adapter responsibility to
enable the ingress packet ordering.</p>
<div class="section" id="adapter-mode">
<h2><span class="section-number">43.1. </span>Adapter Mode</h2>
<div class="section" id="rte-event-crypto-adapter-op-new-mode">
<h3><span class="section-number">43.1.1. </span>RTE_EVENT_CRYPTO_ADAPTER_OP_NEW mode</h3>
<p>In the RTE_EVENT_CRYPTO_ADAPTER_OP_NEW mode, application submits crypto
operations directly to crypto device. The adapter then dequeues crypto
completions from crypto device and enqueues them as events to the event device.
This mode does not ensure ingress ordering, if the application directly
enqueues to the cryptodev without going through crypto/atomic stage.
In this mode, events dequeued from the adapter will be treated as new events.
The application needs to specify event information (response information)
which is needed to enqueue an event after the crypto operation is completed.</p>
<div class="figure align-default" id="id1">
<span id="figure-event-crypto-adapter-op-new"></span><img alt="../_images/event_crypto_adapter_op_new.svg" src="../_images/event_crypto_adapter_op_new.svg" /><p class="caption"><span class="caption-number">Fig. 43.3 </span><span class="caption-text">Working model of <code class="docutils literal notranslate"><span class="pre">RTE_EVENT_CRYPTO_ADAPTER_OP_NEW</span></code> mode</span></p>
</div>
</div>
<div class="section" id="rte-event-crypto-adapter-op-forward-mode">
<h3><span class="section-number">43.1.2. </span>RTE_EVENT_CRYPTO_ADAPTER_OP_FORWARD mode</h3>
<p>In the RTE_EVENT_CRYPTO_ADAPTER_OP_FORWARD mode, if HW supports
RTE_EVENT_CRYPTO_ADAPTER_CAP_INTERNAL_PORT_OP_FWD capability the application
can directly submit the crypto operations to the cryptodev.
If not, application retrieves crypto adapter’s event port using
rte_event_crypto_adapter_event_port_get() API. Then, links its event
queue to this port and starts enqueuing crypto operations as events
to the eventdev. The adapter then dequeues the events and submits the
crypto operations to the cryptodev. After the crypto completions, the
adapter enqueues events to the event device.
Application can use this mode, when ingress packet ordering is needed.
In this mode, events dequeued from the adapter will be treated as
forwarded events. The application needs to specify the cryptodev ID
and queue pair ID (request information) needed to enqueue a crypto
operation in addition to the event information (response information)
needed to enqueue an event after the crypto operation has completed.</p>
<div class="figure align-default" id="id2">
<span id="figure-event-crypto-adapter-op-forward"></span><img alt="../_images/event_crypto_adapter_op_forward.svg" src="../_images/event_crypto_adapter_op_forward.svg" /><p class="caption"><span class="caption-number">Fig. 43.4 </span><span class="caption-text">Working model of <code class="docutils literal notranslate"><span class="pre">RTE_EVENT_CRYPTO_ADAPTER_OP_FORWARD</span></code> mode</span></p>
</div>
</div>
</div>
<div class="section" id="api-overview">
<h2><span class="section-number">43.2. </span>API Overview</h2>
<p>This section has a brief introduction to the event crypto adapter APIs.
The application is expected to create an adapter which is associated with
a single eventdev, then add cryptodev and queue pair to the adapter instance.</p>
<div class="section" id="create-an-adapter-instance">
<h3><span class="section-number">43.2.1. </span>Create an adapter instance</h3>
<p>An adapter instance is created using <code class="docutils literal notranslate"><span class="pre">rte_event_crypto_adapter_create()</span></code>. This
function is called with event device to be associated with the adapter and port
configuration for the adapter to setup an event port(if the adapter needs to use
a service function).</p>
<p>Adapter can be started in <code class="docutils literal notranslate"><span class="pre">RTE_EVENT_CRYPTO_ADAPTER_OP_NEW</span></code> or
<code class="docutils literal notranslate"><span class="pre">RTE_EVENT_CRYPTO_ADAPTER_OP_FORWARD</span></code> mode.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
<span class="kt">uint8_t</span> <span class="n">dev_id</span><span class="p">,</span> <span class="n">id</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">rte_event_dev_info</span> <span class="n">dev_info</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">rte_event_port_conf</span> <span class="n">conf</span><span class="p">;</span>
<span class="k">enum</span> <span class="n">rte_event_crypto_adapter_mode</span> <span class="n">mode</span><span class="p">;</span>

<span class="n">err</span> <span class="o">=</span> <span class="n">rte_event_dev_info_get</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev_info</span><span class="p">);</span>

<span class="n">conf</span><span class="p">.</span><span class="n">new_event_threshold</span> <span class="o">=</span> <span class="n">dev_info</span><span class="p">.</span><span class="n">max_num_events</span><span class="p">;</span>
<span class="n">conf</span><span class="p">.</span><span class="n">dequeue_depth</span> <span class="o">=</span> <span class="n">dev_info</span><span class="p">.</span><span class="n">max_event_port_dequeue_depth</span><span class="p">;</span>
<span class="n">conf</span><span class="p">.</span><span class="n">enqueue_depth</span> <span class="o">=</span> <span class="n">dev_info</span><span class="p">.</span><span class="n">max_event_port_enqueue_depth</span><span class="p">;</span>
<span class="n">mode</span> <span class="o">=</span> <span class="n">RTE_EVENT_CRYPTO_ADAPTER_OP_FORWARD</span><span class="p">;</span>
<span class="n">err</span> <span class="o">=</span> <span class="n">rte_event_crypto_adapter_create</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">dev_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conf</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
</pre></div>
</div>
<p>If the application desires to have finer control of eventdev port allocation
and setup, it can use the <code class="docutils literal notranslate"><span class="pre">rte_event_crypto_adapter_create_ext()</span></code> function.
The <code class="docutils literal notranslate"><span class="pre">rte_event_crypto_adapter_create_ext()</span></code> function is passed as a callback
function. The callback function is invoked if the adapter needs to use a
service function and needs to create an event port for it. The callback is
expected to fill the <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_event_crypto_adapter_conf</span></code> structure
passed to it.</p>
<p>For RTE_EVENT_CRYPTO_ADAPTER_OP_FORWARD mode, the event port created by adapter
can be retrieved using <code class="docutils literal notranslate"><span class="pre">rte_event_crypto_adapter_event_port_get()</span></code> API.
Application can use this event port to link with event queue on which it
enqueues events towards the crypto adapter.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span> <span class="n">id</span><span class="p">,</span> <span class="n">evdev</span><span class="p">,</span> <span class="n">crypto_ev_port_id</span><span class="p">,</span> <span class="n">app_qid</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">rte_event</span> <span class="n">ev</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">rte_event_crypto_adapter_event_port_get</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">crypto_ev_port_id</span><span class="p">);</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">rte_event_queue_setup</span><span class="p">(</span><span class="n">evdev</span><span class="p">,</span> <span class="n">app_qid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">rte_event_port_link</span><span class="p">(</span><span class="n">evdev</span><span class="p">,</span> <span class="n">crypto_ev_port_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">app_qid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// Fill in event info and update event_ptr with rte_crypto_op</span>
<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ev</span><span class="p">));</span>
<span class="n">ev</span><span class="p">.</span><span class="n">queue_id</span> <span class="o">=</span> <span class="n">app_qid</span><span class="p">;</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="n">ev</span><span class="p">.</span><span class="n">event_ptr</span> <span class="o">=</span> <span class="n">op</span><span class="p">;</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">rte_event_enqueue_burst</span><span class="p">(</span><span class="n">evdev</span><span class="p">,</span> <span class="n">app_ev_port_id</span><span class="p">,</span> <span class="n">ev</span><span class="p">,</span> <span class="n">nb_events</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="querying-adapter-capabilities">
<h3><span class="section-number">43.2.2. </span>Querying adapter capabilities</h3>
<p>The <code class="docutils literal notranslate"><span class="pre">rte_event_crypto_adapter_caps_get()</span></code> function allows
the application to query the adapter capabilities for an eventdev and cryptodev
combination. This API provides whether cryptodev and eventdev are connected using
internal HW port or not.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">rte_event_crypto_adapter_caps_get</span><span class="p">(</span><span class="n">dev_id</span><span class="p">,</span> <span class="n">cdev_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cap</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-queue-pair-to-the-adapter-instance">
<h3><span class="section-number">43.2.3. </span>Adding queue pair to the adapter instance</h3>
<p>Cryptodev device id and queue pair are created using cryptodev APIs.
For more information see <a class="reference internal" href="cryptodev_lib.html"><span class="doc">here</span></a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">rte_cryptodev_config</span> <span class="n">conf</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">rte_cryptodev_qp_conf</span> <span class="n">qp_conf</span><span class="p">;</span>
<span class="kt">uint8_t</span> <span class="n">cdev_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">uint16_t</span> <span class="n">qp_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="n">rte_cryptodev_configure</span><span class="p">(</span><span class="n">cdev_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">conf</span><span class="p">);</span>
<span class="n">rte_cryptodev_queue_pair_setup</span><span class="p">(</span><span class="n">cdev_id</span><span class="p">,</span> <span class="n">qp_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">qp_conf</span><span class="p">);</span>
</pre></div>
</div>
<p>These cryptodev id and queue pair are added to the instance using the
<code class="docutils literal notranslate"><span class="pre">rte_event_crypto_adapter_queue_pair_add()</span></code> API.
The same is removed using <code class="docutils literal notranslate"><span class="pre">rte_event_crypto_adapter_queue_pair_del()</span></code> API.
If HW supports RTE_EVENT_CRYPTO_ADAPTER_CAP_INTERNAL_PORT_QP_EV_BIND
capability, event information must be passed to the add API.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span> <span class="n">cap</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">rte_event_crypto_adapter_caps_get</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">evdev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cap</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">cap</span> <span class="o">&amp;</span> <span class="n">RTE_EVENT_CRYPTO_ADAPTER_CAP_INTERNAL_PORT_QP_EV_BIND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">struct</span> <span class="n">rte_event</span> <span class="n">event</span><span class="p">;</span>

        <span class="c1">// Fill in event information &amp; pass it to add API</span>
        <span class="n">rte_event_crypto_adapter_queue_pair_add</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">cdev_id</span><span class="p">,</span> <span class="n">qp_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">event</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span>
        <span class="n">rte_event_crypto_adapter_queue_pair_add</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">cdev_id</span><span class="p">,</span> <span class="n">qp_id</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-the-service-function">
<h3><span class="section-number">43.2.4. </span>Configure the service function</h3>
<p>If the adapter uses a service function, the application is required to assign
a service core to the service function as show below.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span> <span class="n">service_id</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rte_event_crypto_adapter_service_id_get</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">service_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">rte_service_map_lcore_set</span><span class="p">(</span><span class="n">service_id</span><span class="p">,</span> <span class="n">CORE_ID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="set-event-request-response-information">
<h3><span class="section-number">43.2.5. </span>Set event request/response information</h3>
<p>In the RTE_EVENT_CRYPTO_ADAPTER_OP_FORWARD mode, the application needs
to specify the cryptodev ID and queue pair ID (request information) in
addition to the event information (response information) needed to enqueue
an event after the crypto operation has completed. The request and response
information are specified in the <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_crypto_op</span></code> private data or
session’s private data.</p>
<p>In the RTE_EVENT_CRYPTO_ADAPTER_OP_NEW mode, the application is required
to provide only the response information.</p>
<p>The SW adapter or HW PMD uses <code class="docutils literal notranslate"><span class="pre">rte_crypto_op::sess_type</span></code> to
decide whether request/response data is located in the crypto session/
crypto security session or at an offset in the <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_crypto_op</span></code>.
The <code class="docutils literal notranslate"><span class="pre">rte_crypto_op::private_data_offset</span></code> is used to locate the request/
response in the <code class="docutils literal notranslate"><span class="pre">rte_crypto_op</span></code>.</p>
<p>For crypto session, <code class="docutils literal notranslate"><span class="pre">rte_cryptodev_sym_session_set_user_data()</span></code> API
will be used to set request/response data. The same data will be obtained
by <code class="docutils literal notranslate"><span class="pre">rte_cryptodev_sym_session_get_user_data()</span></code> API.  The
RTE_EVENT_CRYPTO_ADAPTER_CAP_SESSION_PRIVATE_DATA capability indicates
whether HW or SW supports this feature.</p>
<p>For security session, <code class="docutils literal notranslate"><span class="pre">rte_security_session_set_private_data()</span></code> API
will be used to set request/response data. The same data will be obtained
by <code class="docutils literal notranslate"><span class="pre">rte_security_session_get_private_data()</span></code> API.</p>
<p>For session-less it is mandatory to place the request/response data with
the <code class="docutils literal notranslate"><span class="pre">rte_crypto_op</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">union</span> <span class="n">rte_event_crypto_metadata</span> <span class="n">m_data</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">rte_event</span> <span class="n">ev</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">rte_crypto_op</span> <span class="o">*</span><span class="n">op</span><span class="p">;</span>

<span class="cm">/* Allocate &amp; fill op structure */</span>
<span class="n">op</span> <span class="o">=</span> <span class="n">rte_crypto_op_alloc</span><span class="p">();</span>

<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">m_data</span><span class="p">));</span>
<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ev</span><span class="p">));</span>
<span class="cm">/* Fill event information and update event_ptr to rte_crypto_op */</span>
<span class="n">ev</span><span class="p">.</span><span class="n">event_ptr</span> <span class="o">=</span> <span class="n">op</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">op</span><span class="o">-&gt;</span><span class="n">sess_type</span> <span class="o">==</span> <span class="n">RTE_CRYPTO_OP_WITH_SESSION</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* Copy response information */</span>
        <span class="n">rte_memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_data</span><span class="p">.</span><span class="n">response_info</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ev</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ev</span><span class="p">));</span>
        <span class="cm">/* Copy request information */</span>
        <span class="n">m_data</span><span class="p">.</span><span class="n">request_info</span><span class="p">.</span><span class="n">cdev_id</span> <span class="o">=</span> <span class="n">cdev_id</span><span class="p">;</span>
        <span class="n">m_data</span><span class="p">.</span><span class="n">request_info</span><span class="p">.</span><span class="n">queue_pair_id</span> <span class="o">=</span> <span class="n">qp_id</span><span class="p">;</span>
        <span class="cm">/* Call set API to store private data information */</span>
        <span class="n">rte_cryptodev_sym_session_set_user_data</span><span class="p">(</span>
                <span class="n">op</span><span class="o">-&gt;</span><span class="n">sym</span><span class="o">-&gt;</span><span class="n">session</span><span class="p">,</span>
                <span class="o">&amp;</span><span class="n">m_data</span><span class="p">,</span>
                <span class="k">sizeof</span><span class="p">(</span><span class="n">m_data</span><span class="p">));</span>
<span class="p">}</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span><span class="o">-&gt;</span><span class="n">sess_type</span> <span class="o">==</span> <span class="n">RTE_CRYPTO_OP_SESSIONLESS</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint32_t</span> <span class="n">len</span> <span class="o">=</span> <span class="n">IV_OFFSET</span> <span class="o">+</span> <span class="n">MAXIMUM_IV_LENGTH</span> <span class="o">+</span>
                       <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">rte_crypto_sym_xform</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">op</span><span class="o">-&gt;</span><span class="n">private_data_offset</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
        <span class="cm">/* Copy response information */</span>
        <span class="n">rte_memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_data</span><span class="p">.</span><span class="n">response_info</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ev</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ev</span><span class="p">));</span>
        <span class="cm">/* Copy request information */</span>
        <span class="n">m_data</span><span class="p">.</span><span class="n">request_info</span><span class="p">.</span><span class="n">cdev_id</span> <span class="o">=</span> <span class="n">cdev_id</span><span class="p">;</span>
        <span class="n">m_data</span><span class="p">.</span><span class="n">request_info</span><span class="p">.</span><span class="n">queue_pair_id</span> <span class="o">=</span> <span class="n">qp_id</span><span class="p">;</span>
        <span class="cm">/* Store private data information along with rte_crypto_op */</span>
        <span class="n">rte_memcpy</span><span class="p">(</span><span class="n">op</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m_data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">m_data</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="start-the-adapter-instance">
<h3><span class="section-number">43.2.6. </span>Start the adapter instance</h3>
<p>The application calls <code class="docutils literal notranslate"><span class="pre">rte_event_crypto_adapter_start()</span></code> to start the adapter.
This function calls the start callbacks of the eventdev PMDs for hardware based
eventdev-cryptodev connections and <code class="docutils literal notranslate"><span class="pre">rte_service_run_state_set()</span></code> to enable the
service function if one exists.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">rte_event_crypto_adapter_start</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The eventdev to which the event_crypto_adapter is connected needs to
be started before calling rte_event_crypto_adapter_start().</p>
</div>
</div>
<div class="section" id="get-adapter-statistics">
<h3><span class="section-number">43.2.7. </span>Get adapter statistics</h3>
<p>The  <code class="docutils literal notranslate"><span class="pre">rte_event_crypto_adapter_stats_get()</span></code> function reports counters defined
in struct <code class="docutils literal notranslate"><span class="pre">rte_event_crypto_adapter_stats</span></code>. The received packet and
enqueued event counts are a sum of the counts from the eventdev PMD callbacks
if the callback is supported, and the counts maintained by the service function,
if one exists.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="qos_framework.html" class="btn btn-neutral float-right" title="44. Quality of Service (QoS) Framework" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="event_timer_adapter.html" class="btn btn-neutral float-left" title="42. Event Timer Adapter Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>