

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>12. Generic flow API (rte_flow) &mdash; Data Plane Development Kit 20.11.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="13. Switch Representation within DPDK Applications" href="switch_representation.html" />
    <link rel="prev" title="11. Poll Mode Driver" href="poll_mode_drv.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Data Plane Development Kit
          

          
            
            <img src="../_static/DPDK_logo_vertical_rev_small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                20.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Programmer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">2. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_abstraction_layer.html">3. Environment Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="service_cores.html">4. Service Cores</a></li>
<li class="toctree-l2"><a class="reference internal" href="trace_lib.html">5. Trace Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rcu_lib.html">6. RCU Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ring_lib.html">7. Ring Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="stack_lib.html">8. Stack Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="mempool_lib.html">9. Mempool Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="mbuf_lib.html">10. Mbuf Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="poll_mode_drv.html">11. Poll Mode Driver</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">12. Generic flow API (rte_flow)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">12.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flow-rule">12.2. Flow rule</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#description">12.2.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#attributes">12.2.2. Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pattern-item">12.2.3. Pattern item</a></li>
<li class="toctree-l4"><a class="reference internal" href="#matching-pattern">12.2.4. Matching pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="#meta-item-types">12.2.5. Meta item types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-matching-item-types">12.2.6. Data matching item types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#actions">12.2.7. Actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-types">12.2.8. Action types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#negative-types">12.2.9. Negative types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#planned-types">12.2.10. Planned types</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#rules-management">12.3. Rules management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#validation">12.3.1. Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creation">12.3.2. Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#destruction">12.3.3. Destruction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flush">12.3.4. Flush</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query">12.3.5. Query</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#flow-isolated-mode">12.4. Flow isolated mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verbose-error-reporting">12.5. Verbose error reporting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#helpers">12.6. Helpers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#error-initializer">12.6.1. Error initializer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#object-conversion">12.6.2. Object conversion</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tunneled-traffic-offload">12.6.3. Tunneled traffic offload</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#caveats">12.7. Caveats</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pmd-interface">12.8. PMD interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#device-compatibility">12.9. Device compatibility</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#global-bit-masks">12.9.1. Global bit-masks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unsupported-layer-types">12.9.2. Unsupported layer types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#any-pattern-item">12.9.3. <code class="docutils literal notranslate"><span class="pre">ANY</span></code> pattern item</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unsupported-actions">12.9.4. Unsupported actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flow-rules-priority">12.9.5. Flow rules priority</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#future-evolutions">12.10. Future evolutions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="switch_representation.html">13. Switch Representation within DPDK Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_metering_and_policing.html">14. Traffic Metering and Policing API</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_management.html">15. Traffic Management API</a></li>
<li class="toctree-l2"><a class="reference internal" href="bbdev.html">16. Wireless Baseband Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="cryptodev_lib.html">17. Cryptography Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="compressdev.html">18. Compression Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="regexdev.html">19. RegEx Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rte_security.html">20. Security Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="rawdev.html">21. Rawdevice Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_bonding_poll_mode_drv_lib.html">22. Link Bonding Poll Mode Driver Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="timer_lib.html">23. Timer Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="hash_lib.html">24. Hash Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="efd_lib.html">25. Elastic Flow Distributor Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="member_lib.html">26. Membership Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="lpm_lib.html">27. LPM Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="lpm6_lib.html">28. LPM6 Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="flow_classify_lib.html">29. Flow Classification Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_distrib_lib.html">30. Packet Distributor Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="reorder_lib.html">31. Reorder Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ip_fragment_reassembly_lib.html">32. IP Fragmentation and Reassembly Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic_receive_offload_lib.html">33. Generic Receive Offload Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic_segmentation_offload_lib.html">34. Generic Segmentation Offload Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="pdump_lib.html">35. The librte_pdump Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="multi_proc_support.html">36. Multi-process Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_nic_interface.html">37. Kernel NIC Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread_safety_dpdk_functions.html">38. Thread Safety of DPDK Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="eventdev.html">39. Event Device Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_ethernet_rx_adapter.html">40. Event Ethernet Rx Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_ethernet_tx_adapter.html">41. Event Ethernet Tx Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_timer_adapter.html">42. Event Timer Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_crypto_adapter.html">43. Event Crypto Adapter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="qos_framework.html">44. Quality of Service (QoS) Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="power_man.html">45. Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_classif_access_ctrl.html">46. Packet Classification and Access Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_framework.html">47. Packet Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhost_lib.html">48. Vhost Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics_lib.html">49. Metrics Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="telemetry_lib.html">50. Telemetry Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="bpf_lib.html">51. Berkeley Packet Filter Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipsec_lib.html">52. IPsec Packet Processing Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="graph_lib.html">53. Graph Library and Inbuilt Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="source_org.html">54. Source Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-sdk-meson.html">55. Installing DPDK Using the meson build system</a></li>
<li class="toctree-l2"><a class="reference internal" href="meson_ut.html">56. Running DPDK Unit Tests with Meson</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_app.html">57. Building Your Own Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="perf_opt_guidelines.html">58. Performance Optimization Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_efficient_code.html">59. Writing Efficient Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="lto.html">60. Link Time Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile_app.html">61. Profile Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="glossary.html">62. Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nics/index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor’s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Data Plane Development Kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Programmer’s Guide</a> &raquo;</li>
        
      <li><span class="section-number">12. </span>Generic flow API (rte_flow)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/prog_guide/rte_flow.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="generic-flow-api-rte-flow">
<h1><span class="section-number">12. </span>Generic flow API (rte_flow)</h1>
<div class="section" id="overview">
<h2><span class="section-number">12.1. </span>Overview</h2>
<p>This API provides a generic means to configure hardware to match specific
ingress or egress traffic, alter its fate and query related counters
according to any number of user-defined rules.</p>
<p>It is named <em>rte_flow</em> after the prefix used for all its symbols, and is
defined in <code class="docutils literal notranslate"><span class="pre">rte_flow.h</span></code>.</p>
<ul class="simple">
<li><p>Matching can be performed on packet data (protocol headers, payload) and
properties (e.g. associated physical port, virtual device function ID).</p></li>
<li><p>Possible operations include dropping traffic, diverting it to specific
queues, to virtual/physical device functions or ports, performing tunnel
offloads, adding marks and so on.</p></li>
</ul>
<p>It is slightly higher-level than the legacy filtering framework which it
encompasses and supersedes (including all functions and filter types) in
order to expose a single interface with an unambiguous behavior that is
common to all poll-mode drivers (PMDs).</p>
</div>
<div class="section" id="flow-rule">
<h2><span class="section-number">12.2. </span>Flow rule</h2>
<div class="section" id="description">
<h3><span class="section-number">12.2.1. </span>Description</h3>
<p>A flow rule is the combination of attributes with a matching pattern and a
list of actions. Flow rules form the basis of this API.</p>
<p>Flow rules can have several distinct actions (such as counting,
encapsulating, decapsulating before redirecting packets to a particular
queue, etc.), instead of relying on several rules to achieve this and having
applications deal with hardware implementation details regarding their
order.</p>
<p>Support for different priority levels on a rule basis is provided, for
example in order to force a more specific rule to come before a more generic
one for packets matched by both. However hardware support for more than a
single priority level cannot be guaranteed. When supported, the number of
available priority levels is usually low, which is why they can also be
implemented in software by PMDs (e.g. missing priority levels may be
emulated by reordering rules).</p>
<p>In order to remain as hardware-agnostic as possible, by default all rules
are considered to have the same priority, which means that the order between
overlapping rules (when a packet is matched by several filters) is
undefined.</p>
<p>PMDs may refuse to create overlapping rules at a given priority level when
they can be detected (e.g. if a pattern matches an existing filter).</p>
<p>Thus predictable results for a given priority level can only be achieved
with non-overlapping rules, using perfect matching on all protocol layers.</p>
<p>Flow rules can also be grouped, the flow rule priority is specific to the
group they belong to. All flow rules in a given group are thus processed within
the context of that group. Groups are not linked by default, so the logical
hierarchy of groups must be explicitly defined by flow rules themselves in each
group using the JUMP action to define the next group to redirect too. Only flow
rules defined in the default group 0 are guarantee to be matched against, this
makes group 0 the origin of any group hierarchy defined by an application.</p>
<p>Support for multiple actions per rule may be implemented internally on top
of non-default hardware priorities, as a result both features may not be
simultaneously available to applications.</p>
<p>Considering that allowed pattern/actions combinations cannot be known in
advance and would result in an impractically large number of capabilities to
expose, a method is provided to validate a given rule from the current
device configuration state.</p>
<p>This enables applications to check if the rule types they need is supported
at initialization time, before starting their data path. This method can be
used anytime, its only requirement being that the resources needed by a rule
should exist (e.g. a target RX queue should be configured first).</p>
<p>Each defined rule is associated with an opaque handle managed by the PMD,
applications are responsible for keeping it. These can be used for queries
and rules management, such as retrieving counters or other data and
destroying them.</p>
<p>To avoid resource leaks on the PMD side, handles must be explicitly
destroyed by the application before releasing associated resources such as
queues and ports.</p>
<p>The following sections cover:</p>
<ul class="simple">
<li><p><strong>Attributes</strong> (represented by <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_attr</span></code>): properties of a
flow rule such as its direction (ingress or egress) and priority.</p></li>
<li><p><strong>Pattern item</strong> (represented by <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_item</span></code>): part of a
matching pattern that either matches specific packet data or traffic
properties. It can also describe properties of the pattern itself, such as
inverted matching.</p></li>
<li><p><strong>Matching pattern</strong>: traffic properties to look for, a combination of any
number of items.</p></li>
<li><p><strong>Actions</strong> (represented by <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_action</span></code>): operations to
perform whenever a packet is matched by a pattern.</p></li>
</ul>
</div>
<div class="section" id="attributes">
<h3><span class="section-number">12.2.2. </span>Attributes</h3>
<div class="section" id="attribute-group">
<h4><span class="section-number">12.2.2.1. </span>Attribute: Group</h4>
<p>Flow rules can be grouped by assigning them a common group number. Groups
allow a logical hierarchy of flow rule groups (tables) to be defined. These
groups can be supported virtually in the PMD or in the physical device.
Group 0 is the default group and this is the only group which flows are
guarantee to matched against, all subsequent groups can only be reached by
way of the JUMP action from a matched flow rule.</p>
<p>Although optional, applications are encouraged to group similar rules as
much as possible to fully take advantage of hardware capabilities
(e.g. optimized matching) and work around limitations (e.g. a single pattern
type possibly allowed in a given group), while being aware that the groups
hierarchies must be programmed explicitly.</p>
<p>Note that support for more than a single group is not guaranteed.</p>
</div>
<div class="section" id="attribute-priority">
<h4><span class="section-number">12.2.2.2. </span>Attribute: Priority</h4>
<p>A priority level can be assigned to a flow rule, lower values
denote higher priority, with 0 as the maximum.</p>
<p>Priority levels are arbitrary and up to the application, they do
not need to be contiguous nor start from 0, however the maximum number
varies between devices and may be affected by existing flow rules.</p>
<p>A flow which matches multiple rules in the same group will always matched by
the rule with the highest priority in that group.</p>
<p>If a packet is matched by several rules of a given group for a given
priority level, the outcome is undefined. It can take any path, may be
duplicated or even cause unrecoverable errors.</p>
<p>Note that support for more than a single priority level is not guaranteed.</p>
</div>
<div class="section" id="attribute-traffic-direction">
<h4><span class="section-number">12.2.2.3. </span>Attribute: Traffic direction</h4>
<p>Flow rule patterns apply to inbound and/or outbound traffic.</p>
<p>In the context of this API, <strong>ingress</strong> and <strong>egress</strong> respectively stand
for <strong>inbound</strong> and <strong>outbound</strong> based on the standpoint of the application
creating a flow rule.</p>
<p>There are no exceptions to this definition.</p>
<p>Several pattern items and actions are valid and can be used in both
directions. At least one direction must be specified.</p>
<p>Specifying both directions at once for a given rule is not recommended but
may be valid in a few cases (e.g. shared counters).</p>
</div>
<div class="section" id="attribute-transfer">
<h4><span class="section-number">12.2.2.4. </span>Attribute: Transfer</h4>
<p>Instead of simply matching the properties of traffic as it would appear on a
given DPDK port ID, enabling this attribute transfers a flow rule to the
lowest possible level of any device endpoints found in the pattern.</p>
<p>When supported, this effectively enables an application to reroute traffic
not necessarily intended for it (e.g. coming from or addressed to different
physical ports, VFs or applications) at the device level.</p>
<p>It complements the behavior of some pattern items such as <a class="reference internal" href="#item-phy-port">Item: PHY_PORT</a>
and is meaningless without them.</p>
<p>When transferring flow rules, <strong>ingress</strong> and <strong>egress</strong> attributes
(<a class="reference internal" href="#attribute-traffic-direction">Attribute: Traffic direction</a>) keep their original meaning, as if
processing traffic emitted or received by the application.</p>
</div>
</div>
<div class="section" id="pattern-item">
<h3><span class="section-number">12.2.3. </span>Pattern item</h3>
<p>Pattern items fall in two categories:</p>
<ul class="simple">
<li><p>Matching protocol headers and packet data, usually associated with a
specification structure. These must be stacked in the same order as the
protocol layers to match inside packets, starting from the lowest.</p></li>
<li><p>Matching meta-data or affecting pattern processing, often without a
specification structure. Since they do not match packet contents, their
position in the list is usually not relevant.</p></li>
</ul>
<p>Item specification structures are used to match specific values among
protocol fields (or item properties). Documentation describes for each item
whether they are associated with one and their type name if so.</p>
<p>Up to three structures of the same type can be set for a given item:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">spec</span></code>: values to match (e.g. a given IPv4 address).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last</span></code>: upper bound for an inclusive range with corresponding fields in
<code class="docutils literal notranslate"><span class="pre">spec</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code>: bit-mask applied to both <code class="docutils literal notranslate"><span class="pre">spec</span></code> and <code class="docutils literal notranslate"><span class="pre">last</span></code> whose purpose is
to distinguish the values to take into account and/or partially mask them
out (e.g. in order to match an IPv4 address prefix).</p></li>
</ul>
<p>Usage restrictions and expected behavior:</p>
<ul class="simple">
<li><p>Setting either <code class="docutils literal notranslate"><span class="pre">mask</span></code> or <code class="docutils literal notranslate"><span class="pre">last</span></code> without <code class="docutils literal notranslate"><span class="pre">spec</span></code> is an error.</p></li>
<li><p>Field values in <code class="docutils literal notranslate"><span class="pre">last</span></code> which are either 0 or equal to the corresponding
values in <code class="docutils literal notranslate"><span class="pre">spec</span></code> are ignored; they do not generate a range. Nonzero
values lower than those in <code class="docutils literal notranslate"><span class="pre">spec</span></code> are not supported.</p></li>
<li><p>Setting <code class="docutils literal notranslate"><span class="pre">spec</span></code> and optionally <code class="docutils literal notranslate"><span class="pre">last</span></code> without <code class="docutils literal notranslate"><span class="pre">mask</span></code> causes the PMD
to use the default mask defined for that item (defined as
<code class="docutils literal notranslate"><span class="pre">rte_flow_item_{name}_mask</span></code> constants).</p></li>
<li><p>Not setting any of them (assuming item type allows it) is equivalent to
providing an empty (zeroed) <code class="docutils literal notranslate"><span class="pre">mask</span></code> for broad (nonspecific) matching.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code> is a simple bit-mask applied before interpreting the contents of
<code class="docutils literal notranslate"><span class="pre">spec</span></code> and <code class="docutils literal notranslate"><span class="pre">last</span></code>, which may yield unexpected results if not used
carefully. For example, if for an IPv4 address field, <code class="docutils literal notranslate"><span class="pre">spec</span></code> provides
<em>10.1.2.3</em>, <code class="docutils literal notranslate"><span class="pre">last</span></code> provides <em>10.3.4.5</em> and <code class="docutils literal notranslate"><span class="pre">mask</span></code> provides
<em>255.255.0.0</em>, the effective range becomes <em>10.1.0.0</em> to <em>10.3.255.255</em>.</p></li>
</ul>
<p>Example of an item specification matching an Ethernet header:</p>
<span id="table-rte-flow-pattern-item-example"></span><table class="docutils align-default" id="id3">
<caption><span class="caption-number">Table 12.1 </span><span class="caption-text">Ethernet item</span></caption>
<colgroup>
<col style="width: 23%" />
<col style="width: 23%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Subfield</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="3"><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">src</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">00:00:01:02:03:04</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dst</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">00:00:2a:66:00:01</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0x22aa</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td colspan="2"><p>unspecified</p></td>
</tr>
<tr class="row-even"><td rowspan="3"><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">src</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">00:00:ff:ff:ff:00</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dst</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">00:00:00:00:00:ff</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0x0000</span></code></p></td>
</tr>
</tbody>
</table>
<p>Non-masked bits stand for any value (shown as <code class="docutils literal notranslate"><span class="pre">?</span></code> below), Ethernet headers
with the following properties are thus matched:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">src</span></code>: <code class="docutils literal notranslate"><span class="pre">??:??:01:02:03:??</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dst</span></code>: <code class="docutils literal notranslate"><span class="pre">??:??:??:??:??:01</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: <code class="docutils literal notranslate"><span class="pre">0x????</span></code></p></li>
</ul>
</div>
<div class="section" id="matching-pattern">
<h3><span class="section-number">12.2.4. </span>Matching pattern</h3>
<p>A pattern is formed by stacking items starting from the lowest protocol
layer to match. This stacking restriction does not apply to meta items which
can be placed anywhere in the stack without affecting the meaning of the
resulting pattern.</p>
<p>Patterns are terminated by END items.</p>
<p>Examples:</p>
<span id="table-rte-flow-tcpv4-as-l4"></span><table class="docutils align-default" id="id4">
<caption><span class="caption-number">Table 12.2 </span><span class="caption-text">TCPv4 as L4</span></caption>
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Ethernet</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>IPv4</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>TCP</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<span id="table-rte-flow-tcpv6-in-vxlan"></span><table class="docutils align-default" id="id5">
<caption><span class="caption-number">Table 12.3 </span><span class="caption-text">TCPv6 in VXLAN</span></caption>
<colgroup>
<col style="width: 37%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Ethernet</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>IPv4</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>UDP</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>VXLAN</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Ethernet</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>IPv6</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>TCP</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<span id="table-rte-flow-tcpv4-as-l4-meta"></span><table class="docutils align-default" id="id6">
<caption><span class="caption-number">Table 12.4 </span><span class="caption-text">TCPv4 as L4 with meta items</span></caption>
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>VOID</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Ethernet</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>VOID</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>IPv4</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>TCP</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>VOID</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>VOID</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
<p>The above example shows how meta items do not affect packet data matching
items, as long as those remain stacked properly. The resulting matching
pattern is identical to “TCPv4 as L4”.</p>
<span id="table-rte-flow-udpv6-anywhere"></span><table class="docutils align-default" id="id7">
<caption><span class="caption-number">Table 12.5 </span><span class="caption-text">UDPv6 anywhere</span></caption>
<colgroup>
<col style="width: 54%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>IPv6</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>UDP</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
<p>If supported by the PMD, omitting one or several protocol layers at the
bottom of the stack as in the above example (missing an Ethernet
specification) enables looking up anywhere in packets.</p>
<p>It is unspecified whether the payload of supported encapsulations
(e.g. VXLAN payload) is matched by such a pattern, which may apply to inner,
outer or both packets.</p>
<span id="table-rte-flow-invalid-l3"></span><table class="docutils align-default" id="id8">
<caption><span class="caption-number">Table 12.6 </span><span class="caption-text">Invalid, missing L3</span></caption>
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Ethernet</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>UDP</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
<p>The above pattern is invalid due to a missing L3 specification between L2
(Ethernet) and L4 (UDP). Doing so is only allowed at the bottom and at the
top of the stack.</p>
</div>
<div class="section" id="meta-item-types">
<h3><span class="section-number">12.2.5. </span>Meta item types</h3>
<p>They match meta-data or affect pattern processing instead of matching packet
data directly, most of them do not need a specification structure. This
particularity allows them to be specified anywhere in the stack without
causing any side effect.</p>
<div class="section" id="item-end">
<h4><span class="section-number">12.2.5.1. </span>Item: <code class="docutils literal notranslate"><span class="pre">END</span></code></h4>
<p>End marker for item lists. Prevents further processing of items, thereby
ending the pattern.</p>
<ul class="simple">
<li><p>Its numeric value is 0 for convenience.</p></li>
<li><p>PMD support is mandatory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spec</span></code>, <code class="docutils literal notranslate"><span class="pre">last</span></code> and <code class="docutils literal notranslate"><span class="pre">mask</span></code> are ignored.</p></li>
</ul>
<span id="table-rte-flow-item-end"></span><table class="docutils align-default" id="id9">
<caption><span class="caption-number">Table 12.7 </span><span class="caption-text">END</span></caption>
<colgroup>
<col style="width: 53%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p>ignored</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td><p>ignored</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p>ignored</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="item-void">
<h4><span class="section-number">12.2.5.2. </span>Item: <code class="docutils literal notranslate"><span class="pre">VOID</span></code></h4>
<p>Used as a placeholder for convenience. It is ignored and simply discarded by
PMDs.</p>
<ul class="simple">
<li><p>PMD support is mandatory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spec</span></code>, <code class="docutils literal notranslate"><span class="pre">last</span></code> and <code class="docutils literal notranslate"><span class="pre">mask</span></code> are ignored.</p></li>
</ul>
<span id="table-rte-flow-item-void"></span><table class="docutils align-default" id="id10">
<caption><span class="caption-number">Table 12.8 </span><span class="caption-text">VOID</span></caption>
<colgroup>
<col style="width: 53%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p>ignored</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td><p>ignored</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p>ignored</p></td>
</tr>
</tbody>
</table>
<p>One usage example for this type is generating rules that share a common
prefix quickly without reallocating memory, only by updating item types:</p>
<span id="table-rte-flow-item-void-example"></span><table class="docutils align-default" id="id11">
<caption><span class="caption-number">Table 12.9 </span><span class="caption-text">TCP, UDP or ICMP as L4</span></caption>
<colgroup>
<col style="width: 28%" />
<col style="width: 24%" />
<col style="width: 24%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head" colspan="3"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td colspan="3"><p>Ethernet</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td colspan="3"><p>IPv4</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>UDP</p></td>
<td><p>VOID</p></td>
<td><p>VOID</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>VOID</p></td>
<td><p>TCP</p></td>
<td><p>VOID</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>VOID</p></td>
<td><p>VOID</p></td>
<td><p>ICMP</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td colspan="3"><p>END</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="item-invert">
<h4><span class="section-number">12.2.5.3. </span>Item: <code class="docutils literal notranslate"><span class="pre">INVERT</span></code></h4>
<p>Inverted matching, i.e. process packets that do not match the pattern.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">spec</span></code>, <code class="docutils literal notranslate"><span class="pre">last</span></code> and <code class="docutils literal notranslate"><span class="pre">mask</span></code> are ignored.</p></li>
</ul>
<span id="table-rte-flow-item-invert"></span><table class="docutils align-default" id="id12">
<caption><span class="caption-number">Table 12.10 </span><span class="caption-text">INVERT</span></caption>
<colgroup>
<col style="width: 53%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p>ignored</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td><p>ignored</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p>ignored</p></td>
</tr>
</tbody>
</table>
<p>Usage example, matching non-TCPv4 packets only:</p>
<span id="table-rte-flow-item-invert-example"></span><table class="docutils align-default" id="id13">
<caption><span class="caption-number">Table 12.11 </span><span class="caption-text">Anything but TCPv4</span></caption>
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>INVERT</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Ethernet</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>IPv4</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>TCP</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="item-pf">
<h4><span class="section-number">12.2.5.4. </span>Item: <code class="docutils literal notranslate"><span class="pre">PF</span></code></h4>
<p>Matches traffic originating from (ingress) or going to (egress) the physical
function of the current device.</p>
<p>If supported, should work even if the physical function is not managed by
the application and thus not associated with a DPDK port ID.</p>
<ul class="simple">
<li><p>Can be combined with any number of <a class="reference internal" href="#item-vf">Item: VF</a> to match both PF and VF
traffic.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spec</span></code>, <code class="docutils literal notranslate"><span class="pre">last</span></code> and <code class="docutils literal notranslate"><span class="pre">mask</span></code> must not be set.</p></li>
</ul>
<span id="table-rte-flow-item-pf"></span><table class="docutils align-default" id="id14">
<caption><span class="caption-number">Table 12.12 </span><span class="caption-text">PF</span></caption>
<colgroup>
<col style="width: 59%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p>unset</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td><p>unset</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p>unset</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="item-vf">
<h4><span class="section-number">12.2.5.5. </span>Item: <code class="docutils literal notranslate"><span class="pre">VF</span></code></h4>
<p>Matches traffic originating from (ingress) or going to (egress) a given
virtual function of the current device.</p>
<p>If supported, should work even if the virtual function is not managed by the
application and thus not associated with a DPDK port ID.</p>
<p>Note this pattern item does not match VF representors traffic which, as
separate entities, should be addressed through their own DPDK port IDs.</p>
<ul class="simple">
<li><p>Can be specified multiple times to match traffic addressed to several VF
IDs.</p></li>
<li><p>Can be combined with a PF item to match both PF and VF traffic.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches any VF ID.</p></li>
</ul>
<span id="table-rte-flow-item-vf"></span><table class="docutils align-default" id="id15">
<caption><span class="caption-number">Table 12.13 </span><span class="caption-text">VF</span></caption>
<colgroup>
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Subfield</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>destination VF ID</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>upper range value</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>zeroed to match any VF ID</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="item-phy-port">
<h4><span class="section-number">12.2.5.6. </span>Item: <code class="docutils literal notranslate"><span class="pre">PHY_PORT</span></code></h4>
<p>Matches traffic originating from (ingress) or going to (egress) a physical
port of the underlying device.</p>
<p>The first PHY_PORT item overrides the physical port normally associated with
the specified DPDK input port (port_id). This item can be provided several
times to match additional physical ports.</p>
<p>Note that physical ports are not necessarily tied to DPDK input ports
(port_id) when those are not under DPDK control. Possible values are
specific to each device, they are not necessarily indexed from zero and may
not be contiguous.</p>
<p>As a device property, the list of allowed values as well as the value
associated with a port_id should be retrieved by other means.</p>
<ul class="simple">
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches any port index.</p></li>
</ul>
<span id="table-rte-flow-item-phy-port"></span><table class="docutils align-default" id="id16">
<caption><span class="caption-number">Table 12.14 </span><span class="caption-text">PHY_PORT</span></caption>
<colgroup>
<col style="width: 19%" />
<col style="width: 21%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Subfield</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>physical port index</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>upper range value</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>zeroed to match any port index</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="item-port-id">
<h4><span class="section-number">12.2.5.7. </span>Item: <code class="docutils literal notranslate"><span class="pre">PORT_ID</span></code></h4>
<p>Matches traffic originating from (ingress) or going to (egress) a given DPDK
port ID.</p>
<p>Normally only supported if the port ID in question is known by the
underlying PMD and related to the device the flow rule is created against.</p>
<p>This must not be confused with <a class="reference internal" href="#item-phy-port">Item: PHY_PORT</a> which refers to the
physical port of a device, whereas <a class="reference internal" href="#item-port-id">Item: PORT_ID</a> refers to a <code class="docutils literal notranslate"><span class="pre">struct</span>
<span class="pre">rte_eth_dev</span></code> object on the application side (also known as “port
representor” depending on the kind of underlying device).</p>
<ul class="simple">
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches the specified DPDK port ID.</p></li>
</ul>
<span id="table-rte-flow-item-port-id"></span><table class="docutils align-default" id="id17">
<caption><span class="caption-number">Table 12.15 </span><span class="caption-text">PORT_ID</span></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Subfield</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>DPDK port ID</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>upper range value</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>zeroed to match any port ID</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="item-mark">
<h4><span class="section-number">12.2.5.8. </span>Item: <code class="docutils literal notranslate"><span class="pre">MARK</span></code></h4>
<p>Matches an arbitrary integer value which was set using the <code class="docutils literal notranslate"><span class="pre">MARK</span></code> action in
a previously matched rule.</p>
<p>This item can only specified once as a match criteria as the <code class="docutils literal notranslate"><span class="pre">MARK</span></code> action can
only be specified once in a flow action.</p>
<p>Note the value of MARK field is arbitrary and application defined.</p>
<p>Depending on the underlying implementation the MARK item may be supported on
the physical device, with virtual groups in the PMD or not at all.</p>
<ul class="simple">
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches any integer value.</p></li>
</ul>
<span id="table-rte-flow-item-mark"></span><table class="docutils align-default" id="id18">
<caption><span class="caption-number">Table 12.16 </span><span class="caption-text">MARK</span></caption>
<colgroup>
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Subfield</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">id</span></code>   | integer value</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">id</span></code>   | upper range value</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>zeroed to match any value</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="item-tag">
<h4><span class="section-number">12.2.5.9. </span>Item: <code class="docutils literal notranslate"><span class="pre">TAG</span></code></h4>
<p>Matches tag item set by other flows. Multiple tags are supported by specifying
<code class="docutils literal notranslate"><span class="pre">index</span></code>.</p>
<ul class="simple">
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches the specified tag value and index.</p></li>
</ul>
<span id="table-rte-flow-item-tag"></span><table class="docutils align-default" id="id19">
<caption><span class="caption-number">Table 12.17 </span><span class="caption-text">TAG</span></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 0%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head" colspan="3"><p>Subfield  | Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>32 bit flow tag value</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>index of flow tag</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>upper range value</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>field is ignored</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>bit-mask applies to “spec” and “last”</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>field is ignored</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="item-meta">
<h4><span class="section-number">12.2.5.10. </span>Item: <code class="docutils literal notranslate"><span class="pre">META</span></code></h4>
<p>Matches 32 bit metadata item set.</p>
<p>On egress, metadata can be set either by mbuf metadata field with
PKT_TX_DYNF_METADATA flag or <code class="docutils literal notranslate"><span class="pre">SET_META</span></code> action. On ingress, <code class="docutils literal notranslate"><span class="pre">SET_META</span></code>
action sets metadata for a packet and the metadata will be reported via
<code class="docutils literal notranslate"><span class="pre">metadata</span></code> dynamic field of <code class="docutils literal notranslate"><span class="pre">rte_mbuf</span></code> with PKT_RX_DYNF_METADATA flag.</p>
<ul class="simple">
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches the specified Rx metadata value.</p></li>
</ul>
<span id="table-rte-flow-item-meta"></span><table class="docutils align-default" id="id20">
<caption><span class="caption-number">Table 12.18 </span><span class="caption-text">META</span></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Subfield</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>32 bit metadata value</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>upper range value</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>bit-mask applies to “spec” and “last”</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="data-matching-item-types">
<h3><span class="section-number">12.2.6. </span>Data matching item types</h3>
<p>Most of these are basically protocol header definitions with associated
bit-masks. They must be specified (stacked) from lowest to highest protocol
layer to form a matching pattern.</p>
<p>The following list is not exhaustive, new protocols will be added in the
future.</p>
<div class="section" id="item-any">
<h4><span class="section-number">12.2.6.1. </span>Item: <code class="docutils literal notranslate"><span class="pre">ANY</span></code></h4>
<p>Matches any protocol in place of the current layer, a single ANY may also
stand for several protocol layers.</p>
<p>This is usually specified as the first pattern item when looking for a
protocol anywhere in a packet.</p>
<ul class="simple">
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> stands for any number of layers.</p></li>
</ul>
<span id="table-rte-flow-item-any"></span><table class="docutils align-default" id="id21">
<caption><span class="caption-number">Table 12.19 </span><span class="caption-text">ANY</span></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Subfield</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">num</span></code></p></td>
<td><p>number of layers covered</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">num</span></code></p></td>
<td><p>upper range value</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">num</span></code></p></td>
<td><p>zeroed to cover any number of layers</p></td>
</tr>
</tbody>
</table>
<p>Example for VXLAN TCP payload matching regardless of outer L3 (IPv4 or IPv6)
and L4 (UDP) both matched by the first ANY specification, and inner L3 (IPv4
or IPv6) matched by the second ANY specification:</p>
<span id="table-rte-flow-item-any-example"></span><table class="docutils align-default" id="id22">
<caption><span class="caption-number">Table 12.20 </span><span class="caption-text">TCP in VXLAN with wildcards</span></caption>
<colgroup>
<col style="width: 18%" />
<col style="width: 15%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 18%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
<th class="head"><p>Field</p></th>
<th class="head"><p>Subfield</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td colspan="4"><p>Ethernet</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>ANY</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">num</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td colspan="4"><p>VXLAN</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td colspan="4"><p>Ethernet</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>ANY</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">num</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td colspan="4"><p>TCP</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td colspan="4"><p>END</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="item-raw">
<h4><span class="section-number">12.2.6.2. </span>Item: <code class="docutils literal notranslate"><span class="pre">RAW</span></code></h4>
<p>Matches a byte string of a given length at a given offset.</p>
<p>Offset is either absolute (using the start of the packet) or relative to the
end of the previous matched item in the stack, in which case negative values
are allowed.</p>
<p>If search is enabled, offset is used as the starting point. The search area
can be delimited by setting limit to a nonzero value, which is the maximum
number of bytes after offset where the pattern may start.</p>
<p>Matching a zero-length pattern is allowed, doing so resets the relative
offset for subsequent items.</p>
<ul class="simple">
<li><p>This type does not support ranges (<code class="docutils literal notranslate"><span class="pre">last</span></code> field).</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches all fields exactly.</p></li>
</ul>
<span id="table-rte-flow-item-raw"></span><table class="docutils align-default" id="id23">
<caption><span class="caption-number">Table 12.21 </span><span class="caption-text">RAW</span></caption>
<colgroup>
<col style="width: 14%" />
<col style="width: 19%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Subfield</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="7"><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">relative</span></code></p></td>
<td><p>look for pattern after the previous item</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">search</span></code></p></td>
<td><p>search pattern from offset (see also <code class="docutils literal notranslate"><span class="pre">limit</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">reserved</span></code></p></td>
<td><p>reserved, must be set to zero</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">offset</span></code></p></td>
<td><p>absolute or relative offset for <code class="docutils literal notranslate"><span class="pre">pattern</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">limit</span></code></p></td>
<td><p>search area limit for start of <code class="docutils literal notranslate"><span class="pre">pattern</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code> length</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code></p></td>
<td><p>byte string to look for</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td colspan="2"><p>if specified, either all 0 or with the same values as <code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td colspan="2"><p>bit-mask applied to <code class="docutils literal notranslate"><span class="pre">spec</span></code> values with usual behavior</p></td>
</tr>
</tbody>
</table>
<p>Example pattern looking for several strings at various offsets of a UDP
payload, using combined RAW items:</p>
<span id="table-rte-flow-item-raw-example"></span><table class="docutils align-default" id="id24">
<caption><span class="caption-number">Table 12.22 </span><span class="caption-text">UDP payload matching</span></caption>
<colgroup>
<col style="width: 16%" />
<col style="width: 14%" />
<col style="width: 23%" />
<col style="width: 32%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
<th class="head"><p>Field</p></th>
<th class="head"><p>Subfield</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td colspan="4"><p>Ethernet</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td colspan="4"><p>IPv4</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td colspan="4"><p>UDP</p></td>
</tr>
<tr class="row-odd"><td rowspan="6"><p>3</p></td>
<td rowspan="6"><p>RAW</p></td>
<td rowspan="6"><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">relative</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">search</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">offset</span></code></p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">limit</span></code></p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code></p></td>
<td><p>“foo”</p></td>
</tr>
<tr class="row-odd"><td rowspan="6"><p>4</p></td>
<td rowspan="6"><p>RAW</p></td>
<td rowspan="6"><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">relative</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">search</span></code></p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">offset</span></code></p></td>
<td><p>20</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">limit</span></code></p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code></p></td>
<td><p>“bar”</p></td>
</tr>
<tr class="row-odd"><td rowspan="6"><p>5</p></td>
<td rowspan="6"><p>RAW</p></td>
<td rowspan="6"><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">relative</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">search</span></code></p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">offset</span></code></p></td>
<td><p>-29</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">limit</span></code></p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code></p></td>
<td><p>“baz”</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td colspan="4"><p>END</p></td>
</tr>
</tbody>
</table>
<p>This translates to:</p>
<ul class="simple">
<li><p>Locate “foo” at least 10 bytes deep inside UDP payload.</p></li>
<li><p>Locate “bar” after “foo” plus 20 bytes.</p></li>
<li><p>Locate “baz” after “bar” minus 29 bytes.</p></li>
</ul>
<p>Such a packet may be represented as follows (not to scale):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0                     &gt;= 10 B           == 20 B
|                  |&lt;---------&gt;|     |&lt;---------&gt;|
|                  |           |     |           |
|-----|------|-----|-----|-----|-----|-----------|-----|------|
| ETH | IPv4 | UDP | ... | baz | foo | ......... | bar | .... |
|-----|------|-----|-----|-----|-----|-----------|-----|------|
                         |                             |
                         |&lt;---------------------------&gt;|
                                     == 29 B
</pre></div>
</div>
<p>Note that matching subsequent pattern items would resume after “baz”, not
“bar” since matching is always performed after the previous item of the
stack.</p>
</div>
<div class="section" id="item-eth">
<h4><span class="section-number">12.2.6.3. </span>Item: <code class="docutils literal notranslate"><span class="pre">ETH</span></code></h4>
<p>Matches an Ethernet header.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> field either stands for “EtherType” or “TPID” when followed by
so-called layer 2.5 pattern items such as <code class="docutils literal notranslate"><span class="pre">RTE_FLOW_ITEM_TYPE_VLAN</span></code>. In
the latter case, <code class="docutils literal notranslate"><span class="pre">type</span></code> refers to that of the outer header, with the inner
EtherType/TPID provided by the subsequent pattern item. This is the same
order as on the wire.
If the <code class="docutils literal notranslate"><span class="pre">type</span></code> field contains a TPID value, then only tagged packets with the
specified TPID will match the pattern.
The field <code class="docutils literal notranslate"><span class="pre">has_vlan</span></code> can be used to match any type of tagged packets,
instead of using the <code class="docutils literal notranslate"><span class="pre">type</span></code> field.
If the <code class="docutils literal notranslate"><span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">has_vlan</span></code> fields are not specified, then both tagged
and untagged packets will match the pattern.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dst</span></code>: destination MAC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src</span></code>: source MAC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: EtherType or TPID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_vlan</span></code>: packet header contains at least one VLAN.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches destination and source addresses only.</p></li>
</ul>
</div>
<div class="section" id="item-vlan">
<h4><span class="section-number">12.2.6.4. </span>Item: <code class="docutils literal notranslate"><span class="pre">VLAN</span></code></h4>
<p>Matches an 802.1Q/ad VLAN tag.</p>
<p>The corresponding standard outer EtherType (TPID) values are
<code class="docutils literal notranslate"><span class="pre">RTE_ETHER_TYPE_VLAN</span></code> or <code class="docutils literal notranslate"><span class="pre">RTE_ETHER_TYPE_QINQ</span></code>. It can be overridden by the
preceding pattern item.
If a <code class="docutils literal notranslate"><span class="pre">VLAN</span></code> item is present in the pattern, then only tagged packets will
match the pattern.
The field <code class="docutils literal notranslate"><span class="pre">has_more_vlan</span></code> can be used to match any type of tagged packets,
instead of using the <code class="docutils literal notranslate"><span class="pre">inner_type</span> <span class="pre">field</span></code>.
If the <code class="docutils literal notranslate"><span class="pre">inner_type</span></code> and <code class="docutils literal notranslate"><span class="pre">has_more_vlan</span></code> fields are not specified,
then any tagged packets will match the pattern.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tci</span></code>: tag control information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inner_type</span></code>: inner EtherType or TPID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_more_vlan</span></code>: packet header contains at least one more VLAN, after this VLAN.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches the VID part of TCI only (lower 12 bits).</p></li>
</ul>
</div>
<div class="section" id="item-ipv4">
<h4><span class="section-number">12.2.6.5. </span>Item: <code class="docutils literal notranslate"><span class="pre">IPV4</span></code></h4>
<p>Matches an IPv4 header.</p>
<p>Note: IPv4 options are handled by dedicated pattern items.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hdr</span></code>: IPv4 header definition (<code class="docutils literal notranslate"><span class="pre">rte_ip.h</span></code>).</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches source and destination addresses only.</p></li>
</ul>
</div>
<div class="section" id="item-ipv6">
<h4><span class="section-number">12.2.6.6. </span>Item: <code class="docutils literal notranslate"><span class="pre">IPV6</span></code></h4>
<p>Matches an IPv6 header.</p>
<p>Dedicated flags indicate if header contains specific extension headers.
To match on packets containing a specific extension header, an application
should match on the dedicated flag set to 1.
To match on packets not containing a specific extension header, an application
should match on the dedicated flag clear to 0.
In case application doesn’t care about the existence of a specific extension
header, it should not specify the dedicated flag for matching.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hdr</span></code>: IPv6 header definition (<code class="docutils literal notranslate"><span class="pre">rte_ip.h</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_hop_ext</span></code>: header contains Hop-by-Hop Options extension header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_route_ext</span></code>: header contains Routing extension header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_frag_ext</span></code>: header contains Fragment extension header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_auth_ext</span></code>: header contains Authentication extension header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_esp_ext</span></code>: header contains Encapsulation Security Payload extension header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_dest_ext</span></code>: header contains Destination Options extension header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_mobil_ext</span></code>: header contains Mobility extension header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_hip_ext</span></code>: header contains Host Identity Protocol extension header.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">has_shim6_ext</span></code>: header contains Shim6 Protocol extension header.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches <code class="docutils literal notranslate"><span class="pre">hdr</span></code> source and destination addresses only.</p></li>
</ul>
</div>
<div class="section" id="item-icmp">
<h4><span class="section-number">12.2.6.7. </span>Item: <code class="docutils literal notranslate"><span class="pre">ICMP</span></code></h4>
<p>Matches an ICMP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hdr</span></code>: ICMP header definition (<code class="docutils literal notranslate"><span class="pre">rte_icmp.h</span></code>).</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches ICMP type and code only.</p></li>
</ul>
</div>
<div class="section" id="item-udp">
<h4><span class="section-number">12.2.6.8. </span>Item: <code class="docutils literal notranslate"><span class="pre">UDP</span></code></h4>
<p>Matches a UDP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hdr</span></code>: UDP header definition (<code class="docutils literal notranslate"><span class="pre">rte_udp.h</span></code>).</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches source and destination ports only.</p></li>
</ul>
</div>
<div class="section" id="item-tcp">
<h4><span class="section-number">12.2.6.9. </span>Item: <code class="docutils literal notranslate"><span class="pre">TCP</span></code></h4>
<p>Matches a TCP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hdr</span></code>: TCP header definition (<code class="docutils literal notranslate"><span class="pre">rte_tcp.h</span></code>).</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches source and destination ports only.</p></li>
</ul>
</div>
<div class="section" id="item-sctp">
<h4><span class="section-number">12.2.6.10. </span>Item: <code class="docutils literal notranslate"><span class="pre">SCTP</span></code></h4>
<p>Matches a SCTP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hdr</span></code>: SCTP header definition (<code class="docutils literal notranslate"><span class="pre">rte_sctp.h</span></code>).</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches source and destination ports only.</p></li>
</ul>
</div>
<div class="section" id="item-vxlan">
<h4><span class="section-number">12.2.6.11. </span>Item: <code class="docutils literal notranslate"><span class="pre">VXLAN</span></code></h4>
<p>Matches a VXLAN header (RFC 7348).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flags</span></code>: normally 0x08 (I flag).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rsvd0</span></code>: reserved, normally 0x000000.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vni</span></code>: VXLAN network identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rsvd1</span></code>: reserved, normally 0x00.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches VNI only.</p></li>
</ul>
</div>
<div class="section" id="item-e-tag">
<h4><span class="section-number">12.2.6.12. </span>Item: <code class="docutils literal notranslate"><span class="pre">E_TAG</span></code></h4>
<p>Matches an IEEE 802.1BR E-Tag header.</p>
<p>The corresponding standard outer EtherType (TPID) value is
<code class="docutils literal notranslate"><span class="pre">RTE_ETHER_TYPE_ETAG</span></code>. It can be overridden by the preceding pattern item.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">epcp_edei_in_ecid_b</span></code>: E-Tag control information (E-TCI), E-PCP (3b),
E-DEI (1b), ingress E-CID base (12b).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rsvd_grp_ecid_b</span></code>: reserved (2b), GRP (2b), E-CID base (12b).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in_ecid_e</span></code>: ingress E-CID ext.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ecid_e</span></code>: E-CID ext.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inner_type</span></code>: inner EtherType or TPID.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> simultaneously matches GRP and E-CID base.</p></li>
</ul>
</div>
<div class="section" id="item-nvgre">
<h4><span class="section-number">12.2.6.13. </span>Item: <code class="docutils literal notranslate"><span class="pre">NVGRE</span></code></h4>
<p>Matches a NVGRE header (RFC 7637).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">c_k_s_rsvd0_ver</span></code>: checksum (1b), undefined (1b), key bit (1b),
sequence number (1b), reserved 0 (9b), version (3b). This field must have
value 0x2000 according to RFC 7637.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">protocol</span></code>: protocol type (0x6558).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tni</span></code>: virtual subnet ID.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flow_id</span></code>: flow ID.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches TNI only.</p></li>
</ul>
</div>
<div class="section" id="item-mpls">
<h4><span class="section-number">12.2.6.14. </span>Item: <code class="docutils literal notranslate"><span class="pre">MPLS</span></code></h4>
<p>Matches a MPLS header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">label_tc_s_ttl</span></code>: label, TC, Bottom of Stack and TTL.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches label only.</p></li>
</ul>
</div>
<div class="section" id="item-gre">
<h4><span class="section-number">12.2.6.15. </span>Item: <code class="docutils literal notranslate"><span class="pre">GRE</span></code></h4>
<p>Matches a GRE header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">c_rsvd0_ver</span></code>: checksum, reserved 0 and version.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">protocol</span></code>: protocol type.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches protocol only.</p></li>
</ul>
</div>
<div class="section" id="item-gre-key">
<h4><span class="section-number">12.2.6.16. </span>Item: <code class="docutils literal notranslate"><span class="pre">GRE_KEY</span></code></h4>
<p>Matches a GRE key field.
This should be preceded by item <code class="docutils literal notranslate"><span class="pre">GRE</span></code>.</p>
<ul class="simple">
<li><p>Value to be matched is a big-endian 32 bit integer.</p></li>
<li><p>When this item present it implicitly match K bit in default mask as “1”</p></li>
</ul>
</div>
<div class="section" id="item-fuzzy">
<h4><span class="section-number">12.2.6.17. </span>Item: <code class="docutils literal notranslate"><span class="pre">FUZZY</span></code></h4>
<p>Fuzzy pattern match, expect faster than default.</p>
<p>This is for device that support fuzzy match option. Usually a fuzzy match is
fast but the cost is accuracy. i.e. Signature Match only match pattern’s hash
value, but it is possible two different patterns have the same hash value.</p>
<p>Matching accuracy level can be configured by threshold. Driver can divide the
range of threshold and map to different accuracy levels that device support.</p>
<p>Threshold 0 means perfect match (no fuzziness), while threshold 0xffffffff
means fuzziest match.</p>
<span id="table-rte-flow-item-fuzzy"></span><table class="docutils align-default" id="id25">
<caption><span class="caption-number">Table 12.23 </span><span class="caption-text">FUZZY</span></caption>
<colgroup>
<col style="width: 13%" />
<col style="width: 20%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Subfield</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">spec</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">threshold</span></code></p></td>
<td><p>0 as perfect match, 0xffffffff as fuzziest match</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">threshold</span></code></p></td>
<td><p>upper range value</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">threshold</span></code></p></td>
<td><p>bit-mask apply to “spec” and “last”</p></td>
</tr>
</tbody>
</table>
<p>Usage example, fuzzy match a TCPv4 packets:</p>
<span id="table-rte-flow-item-fuzzy-example"></span><table class="docutils align-default" id="id26">
<caption><span class="caption-number">Table 12.24 </span><span class="caption-text">Fuzzy matching</span></caption>
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>FUZZY</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Ethernet</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>IPv4</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>TCP</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="item-gtp-gtpc-gtpu">
<h4><span class="section-number">12.2.6.18. </span>Item: <code class="docutils literal notranslate"><span class="pre">GTP</span></code>, <code class="docutils literal notranslate"><span class="pre">GTPC</span></code>, <code class="docutils literal notranslate"><span class="pre">GTPU</span></code></h4>
<p>Matches a GTPv1 header.</p>
<p>Note: GTP, GTPC and GTPU use the same structure. GTPC and GTPU item
are defined for a user-friendly API when creating GTP-C and GTP-U
flow rules.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">v_pt_rsv_flags</span></code>: version (3b), protocol type (1b), reserved (1b),
extension header flag (1b), sequence number flag (1b), N-PDU number
flag (1b).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg_type</span></code>: message type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg_len</span></code>: message length.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">teid</span></code>: tunnel endpoint identifier.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches teid only.</p></li>
</ul>
</div>
<div class="section" id="item-esp">
<h4><span class="section-number">12.2.6.19. </span>Item: <code class="docutils literal notranslate"><span class="pre">ESP</span></code></h4>
<p>Matches an ESP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hdr</span></code>: ESP header definition (<code class="docutils literal notranslate"><span class="pre">rte_esp.h</span></code>).</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches SPI only.</p></li>
</ul>
</div>
<div class="section" id="item-geneve">
<h4><span class="section-number">12.2.6.20. </span>Item: <code class="docutils literal notranslate"><span class="pre">GENEVE</span></code></h4>
<p>Matches a GENEVE header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ver_opt_len_o_c_rsvd0</span></code>: version (2b), length of the options fields (6b),
OAM packet (1b), critical options present (1b), reserved 0 (6b).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">protocol</span></code>: protocol type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vni</span></code>: virtual network identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rsvd1</span></code>: reserved, normally 0x00.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches VNI only.</p></li>
</ul>
</div>
<div class="section" id="item-vxlan-gpe">
<h4><span class="section-number">12.2.6.21. </span>Item: <code class="docutils literal notranslate"><span class="pre">VXLAN-GPE</span></code></h4>
<p>Matches a VXLAN-GPE header (draft-ietf-nvo3-vxlan-gpe-05).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flags</span></code>: normally 0x0C (I and P flags).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rsvd0</span></code>: reserved, normally 0x0000.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">protocol</span></code>: protocol type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vni</span></code>: VXLAN network identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rsvd1</span></code>: reserved, normally 0x00.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches VNI only.</p></li>
</ul>
</div>
<div class="section" id="item-arp-eth-ipv4">
<h4><span class="section-number">12.2.6.22. </span>Item: <code class="docutils literal notranslate"><span class="pre">ARP_ETH_IPV4</span></code></h4>
<p>Matches an ARP header for Ethernet/IPv4.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hdr</span></code>: hardware type, normally 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pro</span></code>: protocol type, normally 0x0800.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hln</span></code>: hardware address length, normally 6.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pln</span></code>: protocol address length, normally 4.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">op</span></code>: opcode (1 for request, 2 for reply).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sha</span></code>: sender hardware address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spa</span></code>: sender IPv4 address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tha</span></code>: target hardware address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tpa</span></code>: target IPv4 address.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches SHA, SPA, THA and TPA.</p></li>
</ul>
</div>
<div class="section" id="item-ipv6-ext">
<h4><span class="section-number">12.2.6.23. </span>Item: <code class="docutils literal notranslate"><span class="pre">IPV6_EXT</span></code></h4>
<p>Matches the presence of any IPv6 extension header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">next_hdr</span></code>: next header.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches <code class="docutils literal notranslate"><span class="pre">next_hdr</span></code>.</p></li>
</ul>
<p>Normally preceded by any of:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#item-ipv6">Item: IPV6</a></p></li>
<li><p><a class="reference internal" href="#item-ipv6-ext">Item: IPV6_EXT</a></p></li>
</ul>
</div>
<div class="section" id="item-ipv6-frag-ext">
<h4><span class="section-number">12.2.6.24. </span>Item: <code class="docutils literal notranslate"><span class="pre">IPV6_FRAG_EXT</span></code></h4>
<p>Matches the presence of IPv6 fragment extension header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hdr</span></code>: IPv6 fragment extension header definition (<code class="docutils literal notranslate"><span class="pre">rte_ip.h</span></code>).</p></li>
</ul>
<p>Normally preceded by any of:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#item-ipv6">Item: IPV6</a></p></li>
<li><p><a class="reference internal" href="#item-ipv6-ext">Item: IPV6_EXT</a></p></li>
</ul>
</div>
<div class="section" id="item-icmp6">
<h4><span class="section-number">12.2.6.25. </span>Item: <code class="docutils literal notranslate"><span class="pre">ICMP6</span></code></h4>
<p>Matches any ICMPv6 header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: ICMPv6 type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code>: ICMPv6 code.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checksum</span></code>: ICMPv6 checksum.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches <code class="docutils literal notranslate"><span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">code</span></code>.</p></li>
</ul>
</div>
<div class="section" id="item-icmp6-nd-ns">
<h4><span class="section-number">12.2.6.26. </span>Item: <code class="docutils literal notranslate"><span class="pre">ICMP6_ND_NS</span></code></h4>
<p>Matches an ICMPv6 neighbor discovery solicitation.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: ICMPv6 type, normally 135.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code>: ICMPv6 code, normally 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checksum</span></code>: ICMPv6 checksum.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reserved</span></code>: reserved, normally 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_addr</span></code>: target address.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches target address only.</p></li>
</ul>
</div>
<div class="section" id="item-icmp6-nd-na">
<h4><span class="section-number">12.2.6.27. </span>Item: <code class="docutils literal notranslate"><span class="pre">ICMP6_ND_NA</span></code></h4>
<p>Matches an ICMPv6 neighbor discovery advertisement.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: ICMPv6 type, normally 136.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code>: ICMPv6 code, normally 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checksum</span></code>: ICMPv6 checksum.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rso_reserved</span></code>: route flag (1b), solicited flag (1b), override flag
(1b), reserved (29b).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_addr</span></code>: target address.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches target address only.</p></li>
</ul>
</div>
<div class="section" id="item-icmp6-nd-opt">
<h4><span class="section-number">12.2.6.28. </span>Item: <code class="docutils literal notranslate"><span class="pre">ICMP6_ND_OPT</span></code></h4>
<p>Matches the presence of any ICMPv6 neighbor discovery option.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: ND option type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code>: ND option length.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches type only.</p></li>
</ul>
<p>Normally preceded by any of:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#item-icmp6-nd-na">Item: ICMP6_ND_NA</a></p></li>
<li><p><a class="reference internal" href="#item-icmp6-nd-ns">Item: ICMP6_ND_NS</a></p></li>
<li><p><a class="reference internal" href="#item-icmp6-nd-opt">Item: ICMP6_ND_OPT</a></p></li>
</ul>
</div>
<div class="section" id="item-icmp6-nd-opt-sla-eth">
<h4><span class="section-number">12.2.6.29. </span>Item: <code class="docutils literal notranslate"><span class="pre">ICMP6_ND_OPT_SLA_ETH</span></code></h4>
<p>Matches an ICMPv6 neighbor discovery source Ethernet link-layer address
option.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: ND option type, normally 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code>: ND option length, normally 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sla</span></code>: source Ethernet LLA.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches source link-layer address only.</p></li>
</ul>
<p>Normally preceded by any of:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#item-icmp6-nd-na">Item: ICMP6_ND_NA</a></p></li>
<li><p><a class="reference internal" href="#item-icmp6-nd-opt">Item: ICMP6_ND_OPT</a></p></li>
</ul>
</div>
<div class="section" id="item-icmp6-nd-opt-tla-eth">
<h4><span class="section-number">12.2.6.30. </span>Item: <code class="docutils literal notranslate"><span class="pre">ICMP6_ND_OPT_TLA_ETH</span></code></h4>
<p>Matches an ICMPv6 neighbor discovery target Ethernet link-layer address
option.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: ND option type, normally 2.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code>: ND option length, normally 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tla</span></code>: target Ethernet LLA.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches target link-layer address only.</p></li>
</ul>
<p>Normally preceded by any of:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#item-icmp6-nd-ns">Item: ICMP6_ND_NS</a></p></li>
<li><p><a class="reference internal" href="#item-icmp6-nd-opt">Item: ICMP6_ND_OPT</a></p></li>
</ul>
</div>
<div class="section" id="id1">
<h4><span class="section-number">12.2.6.31. </span>Item: <code class="docutils literal notranslate"><span class="pre">META</span></code></h4>
<p>Matches an application specific 32 bit metadata item.</p>
<ul class="simple">
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches the specified metadata value.</p></li>
</ul>
</div>
<div class="section" id="item-gtp-psc">
<h4><span class="section-number">12.2.6.32. </span>Item: <code class="docutils literal notranslate"><span class="pre">GTP_PSC</span></code></h4>
<p>Matches a GTP PDU extension header with type 0x85.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pdu_type</span></code>: PDU type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">qfi</span></code>: QoS flow identifier.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches QFI only.</p></li>
</ul>
</div>
<div class="section" id="item-pppoes-pppoed">
<h4><span class="section-number">12.2.6.33. </span>Item: <code class="docutils literal notranslate"><span class="pre">PPPOES</span></code>, <code class="docutils literal notranslate"><span class="pre">PPPOED</span></code></h4>
<p>Matches a PPPoE header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">version_type</span></code>: version (4b), type (4b).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code>: message type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">session_id</span></code>: session identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code>: payload length.</p></li>
</ul>
</div>
<div class="section" id="item-pppoe-proto-id">
<h4><span class="section-number">12.2.6.34. </span>Item: <code class="docutils literal notranslate"><span class="pre">PPPOE_PROTO_ID</span></code></h4>
<p>Matches a PPPoE session protocol identifier.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">proto_id</span></code>: PPP protocol identifier.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches proto_id only.</p></li>
</ul>
</div>
<div class="section" id="item-nsh">
<h4><span class="section-number">12.2.6.35. </span>Item: <code class="docutils literal notranslate"><span class="pre">NSH</span></code></h4>
<p>Matches a network service header (RFC 8300).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">version</span></code>: normally 0x0 (2 bits).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oam_pkt</span></code>: indicate oam packet (1 bit).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reserved</span></code>: reserved bit (1 bit).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ttl</span></code>: maximum SFF hopes (6 bits).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code>: total length in 4 bytes words (6 bits).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reserved1</span></code>: reserved1 bits (4 bits).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mdtype</span></code>: ndicates format of NSH header (4 bits).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next_proto</span></code>: indicates protocol type of encap data (8 bits).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spi</span></code>: service path identifier (3 bytes).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sindex</span></code>: service index (1 byte).</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches mdtype, next_proto, spi, sindex.</p></li>
</ul>
</div>
<div class="section" id="item-igmp">
<h4><span class="section-number">12.2.6.36. </span>Item: <code class="docutils literal notranslate"><span class="pre">IGMP</span></code></h4>
<p>Matches a Internet Group Management Protocol (RFC 2236).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: IGMP message type (Query/Report).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_resp_time</span></code>: max time allowed before sending report.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">checksum</span></code>: checksum, 1s complement of whole IGMP message.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">group_addr</span></code>: group address, for Query value will be 0.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches group_addr.</p></li>
</ul>
</div>
<div class="section" id="item-ah">
<h4><span class="section-number">12.2.6.37. </span>Item: <code class="docutils literal notranslate"><span class="pre">AH</span></code></h4>
<p>Matches a IP Authentication Header (RFC 4302).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">next_hdr</span></code>: next payload after AH.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">payload_len</span></code>: total length of AH in 4B words.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reserved</span></code>: reserved bits.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spi</span></code>: security parameters index.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seq_num</span></code>: counter value increased by 1 on each packet sent.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches spi.</p></li>
</ul>
</div>
<div class="section" id="item-higig2">
<h4><span class="section-number">12.2.6.38. </span>Item: <code class="docutils literal notranslate"><span class="pre">HIGIG2</span></code></h4>
<p>Matches a HIGIG2 header field. It is layer 2.5 protocol and used in
Broadcom switches.</p>
<ul class="simple">
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches classification and vlan.</p></li>
</ul>
</div>
<div class="section" id="item-l2tpv3oip">
<h4><span class="section-number">12.2.6.39. </span>Item: <code class="docutils literal notranslate"><span class="pre">L2TPV3OIP</span></code></h4>
<p>Matches a L2TPv3 over IP header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">session_id</span></code>: L2TPv3 over IP session identifier.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches session_id only.</p></li>
</ul>
</div>
<div class="section" id="item-pfcp">
<h4><span class="section-number">12.2.6.40. </span>Item: <code class="docutils literal notranslate"><span class="pre">PFCP</span></code></h4>
<p>Matches a PFCP Header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">s_field</span></code>: S field.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg_type</span></code>: message type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg_len</span></code>: message length.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seid</span></code>: session endpoint identifier.</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches s_field and seid.</p></li>
</ul>
</div>
<div class="section" id="item-ecpri">
<h4><span class="section-number">12.2.6.41. </span>Item: <code class="docutils literal notranslate"><span class="pre">ECPRI</span></code></h4>
<p>Matches a eCPRI header.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hdr</span></code>: eCPRI header definition (<code class="docutils literal notranslate"><span class="pre">rte_ecpri.h</span></code>).</p></li>
<li><p>Default <code class="docutils literal notranslate"><span class="pre">mask</span></code> matches nothing, for all eCPRI messages.</p></li>
</ul>
</div>
</div>
<div class="section" id="actions">
<h3><span class="section-number">12.2.7. </span>Actions</h3>
<p>Each possible action is represented by a type.
An action can have an associated configuration object.
Several actions combined in a list can be assigned
to a flow rule and are performed in order.</p>
<p>They fall in three categories:</p>
<ul class="simple">
<li><p>Actions that modify the fate of matching traffic, for instance by dropping
or assigning it a specific destination.</p></li>
<li><p>Actions that modify matching traffic contents or its properties. This
includes adding/removing encapsulation, encryption, compression and marks.</p></li>
<li><p>Actions related to the flow rule itself, such as updating counters or
making it non-terminating.</p></li>
</ul>
<p>Flow rules being terminating by default, not specifying any action of the
fate kind results in undefined behavior. This applies to both ingress and
egress.</p>
<p>PASSTHRU, when supported, makes a flow rule non-terminating.</p>
<p>Like matching patterns, action lists are terminated by END items.</p>
<p>Example of action that redirects packets to queue index 10:</p>
<span id="table-rte-flow-action-example"></span><table class="docutils align-default" id="id27">
<caption><span class="caption-number">Table 12.25 </span><span class="caption-text">Queue action</span></caption>
<colgroup>
<col style="width: 61%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>10</p></td>
</tr>
</tbody>
</table>
<p>Actions are performed in list order:</p>
<span id="table-rte-flow-count-then-drop"></span><table class="docutils align-default" id="id28">
<caption><span class="caption-number">Table 12.26 </span><span class="caption-text">Count then drop</span></caption>
<colgroup>
<col style="width: 47%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Action</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>COUNT</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>DROP</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<span id="table-rte-flow-mark-count-redirect"></span><table class="docutils align-default" id="id29">
<caption><span class="caption-number">Table 12.27 </span><span class="caption-text">Mark, count then redirect</span></caption>
<colgroup>
<col style="width: 21%" />
<col style="width: 24%" />
<col style="width: 35%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Action</p></th>
<th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>MARK</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">mark</span></code></p></td>
<td><p>0x2a</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>1</p></td>
<td rowspan="2"><p>COUNT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">shared</span></code></p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>QUEUE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">queue</span></code></p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td colspan="3"><p>END</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<span id="table-rte-flow-redirect-queue-5"></span><table class="docutils align-default" id="id30">
<caption><span class="caption-number">Table 12.28 </span><span class="caption-text">Redirect to queue 5</span></caption>
<colgroup>
<col style="width: 21%" />
<col style="width: 24%" />
<col style="width: 33%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Action</p></th>
<th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td colspan="3"><p>DROP</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>QUEUE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">queue</span></code></p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td colspan="3"><p>END</p></td>
</tr>
</tbody>
</table>
<p>In the above example, while DROP and QUEUE must be performed in order, both
have to happen before reaching END. Only QUEUE has a visible effect.</p>
<p>Note that such a list may be thought as ambiguous and rejected on that
basis.</p>
<span id="table-rte-flow-redirect-queue-5-3"></span><table class="docutils align-default" id="id31">
<caption><span class="caption-number">Table 12.29 </span><span class="caption-text">Redirect to queues 5 and 3</span></caption>
<colgroup>
<col style="width: 21%" />
<col style="width: 24%" />
<col style="width: 33%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Action</p></th>
<th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>QUEUE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">queue</span></code></p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td colspan="3"><p>VOID</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>QUEUE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">queue</span></code></p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td colspan="3"><p>END</p></td>
</tr>
</tbody>
</table>
<p>As previously described, all actions must be taken into account. This
effectively duplicates traffic to both queues. The above example also shows
that VOID is ignored.</p>
</div>
<div class="section" id="action-types">
<h3><span class="section-number">12.2.8. </span>Action types</h3>
<p>Common action types are described in this section. Like pattern item types,
this list is not exhaustive as new actions will be added in the future.</p>
<div class="section" id="action-end">
<h4><span class="section-number">12.2.8.1. </span>Action: <code class="docutils literal notranslate"><span class="pre">END</span></code></h4>
<p>End marker for action lists. Prevents further processing of actions, thereby
ending the list.</p>
<ul class="simple">
<li><p>Its numeric value is 0 for convenience.</p></li>
<li><p>PMD support is mandatory.</p></li>
<li><p>No configurable properties.</p></li>
</ul>
<span id="table-rte-flow-action-end"></span><table class="docutils align-default" id="id32">
<caption><span class="caption-number">Table 12.30 </span><span class="caption-text">END</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-void">
<h4><span class="section-number">12.2.8.2. </span>Action: <code class="docutils literal notranslate"><span class="pre">VOID</span></code></h4>
<p>Used as a placeholder for convenience. It is ignored and simply discarded by
PMDs.</p>
<ul class="simple">
<li><p>PMD support is mandatory.</p></li>
<li><p>No configurable properties.</p></li>
</ul>
<span id="table-rte-flow-action-void"></span><table class="docutils align-default" id="id33">
<caption><span class="caption-number">Table 12.31 </span><span class="caption-text">VOID</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-passthru">
<h4><span class="section-number">12.2.8.3. </span>Action: <code class="docutils literal notranslate"><span class="pre">PASSTHRU</span></code></h4>
<p>Leaves traffic up for additional processing by subsequent flow rules; makes
a flow rule non-terminating.</p>
<ul class="simple">
<li><p>No configurable properties.</p></li>
</ul>
<span id="table-rte-flow-action-passthru"></span><table class="docutils align-default" id="id34">
<caption><span class="caption-number">Table 12.32 </span><span class="caption-text">PASSTHRU</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
<p>Example to copy a packet to a queue and continue processing by subsequent
flow rules:</p>
<span id="table-rte-flow-action-passthru-example"></span><table class="docutils align-default" id="id35">
<caption><span class="caption-number">Table 12.33 </span><span class="caption-text">Copy to queue 8</span></caption>
<colgroup>
<col style="width: 21%" />
<col style="width: 24%" />
<col style="width: 33%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Action</p></th>
<th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td colspan="3"><p>PASSTHRU</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>QUEUE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">queue</span></code></p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td colspan="3"><p>END</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-jump">
<h4><span class="section-number">12.2.8.4. </span>Action: <code class="docutils literal notranslate"><span class="pre">JUMP</span></code></h4>
<p>Redirects packets to a group on the current device.</p>
<p>In a hierarchy of groups, which can be used to represent physical or logical
flow group/tables on the device, this action redirects the matched flow to
the specified group on that device.</p>
<p>If a matched flow is redirected to a table which doesn’t contain a matching
rule for that flow then the behavior is undefined and the resulting behavior
is up to the specific device. Best practice when using groups would be define
a default flow rule for each group which a defines the default actions in that
group so a consistent behavior is defined.</p>
<p>Defining an action for matched flow in a group to jump to a group which is
higher in the group hierarchy may not be supported by physical devices,
depending on how groups are mapped to the physical devices. In the
definitions of jump actions, applications should be aware that it may be
possible to define flow rules which trigger an undefined behavior causing
flows to loop between groups.</p>
<span id="table-rte-flow-action-jump"></span><table class="docutils align-default" id="id36">
<caption><span class="caption-number">Table 12.34 </span><span class="caption-text">JUMP</span></caption>
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">group</span></code></p></td>
<td><p>Group to redirect packets to</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-mark">
<h4><span class="section-number">12.2.8.5. </span>Action: <code class="docutils literal notranslate"><span class="pre">MARK</span></code></h4>
<p>Attaches an integer value to packets and sets <code class="docutils literal notranslate"><span class="pre">PKT_RX_FDIR</span></code> and
<code class="docutils literal notranslate"><span class="pre">PKT_RX_FDIR_ID</span></code> mbuf flags.</p>
<p>This value is arbitrary and application-defined. Maximum allowed value
depends on the underlying implementation. It is returned in the
<code class="docutils literal notranslate"><span class="pre">hash.fdir.hi</span></code> mbuf field.</p>
<span id="table-rte-flow-action-mark"></span><table class="docutils align-default" id="id37">
<caption><span class="caption-number">Table 12.35 </span><span class="caption-text">MARK</span></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>integer value to return with packets</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-flag">
<h4><span class="section-number">12.2.8.6. </span>Action: <code class="docutils literal notranslate"><span class="pre">FLAG</span></code></h4>
<p>Flags packets. Similar to <a class="reference internal" href="#action-mark">Action: MARK</a> without a specific value; only
sets the <code class="docutils literal notranslate"><span class="pre">PKT_RX_FDIR</span></code> mbuf flag.</p>
<ul class="simple">
<li><p>No configurable properties.</p></li>
</ul>
<span id="table-rte-flow-action-flag"></span><table class="docutils align-default" id="id38">
<caption><span class="caption-number">Table 12.36 </span><span class="caption-text">FLAG</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-queue">
<h4><span class="section-number">12.2.8.7. </span>Action: <code class="docutils literal notranslate"><span class="pre">QUEUE</span></code></h4>
<p>Assigns packets to a given queue index.</p>
<span id="table-rte-flow-action-queue"></span><table class="docutils align-default" id="id39">
<caption><span class="caption-number">Table 12.37 </span><span class="caption-text">QUEUE</span></caption>
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>queue index to use</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-drop">
<h4><span class="section-number">12.2.8.8. </span>Action: <code class="docutils literal notranslate"><span class="pre">DROP</span></code></h4>
<p>Drop packets.</p>
<ul class="simple">
<li><p>No configurable properties.</p></li>
</ul>
<span id="table-rte-flow-action-drop"></span><table class="docutils align-default" id="id40">
<caption><span class="caption-number">Table 12.38 </span><span class="caption-text">DROP</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-count">
<h4><span class="section-number">12.2.8.9. </span>Action: <code class="docutils literal notranslate"><span class="pre">COUNT</span></code></h4>
<p>Adds a counter action to a matched flow.</p>
<p>If more than one count action is specified in a single flow rule, then each
action must specify a unique id.</p>
<p>Counters can be retrieved and reset through <code class="docutils literal notranslate"><span class="pre">rte_flow_query()</span></code>, see
<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_query_count</span></code>.</p>
<p>The shared flag indicates whether the counter is unique to the flow rule the
action is specified with, or whether it is a shared counter.</p>
<p>For a count action with the shared flag set, then a global device
namespace is assumed for the counter id, so that any matched flow rules using
a count action with the same counter id on the same port will contribute to
that counter.</p>
<p>For ports within the same switch domain then the counter id namespace extends
to all ports within that switch domain.</p>
<p>The shared flag is DEPRECATED and <code class="docutils literal notranslate"><span class="pre">SHARED</span></code> <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> action should be used
to make shared counters.</p>
<span id="table-rte-flow-action-count"></span><table class="docutils align-default" id="id41">
<caption><span class="caption-number">Table 12.39 </span><span class="caption-text">COUNT</span></caption>
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">shared</span></code></p></td>
<td><p>DEPRECATED, shared counter flag</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>counter id</p></td>
</tr>
</tbody>
</table>
<p>Query structure to retrieve and reset flow rule counters:</p>
<span id="table-rte-flow-query-count"></span><table class="docutils align-default" id="id42">
<caption><span class="caption-number">Table 12.40 </span><span class="caption-text">COUNT query</span></caption>
<colgroup>
<col style="width: 27%" />
<col style="width: 9%" />
<col style="width: 64%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>I/O</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">reset</span></code></p></td>
<td><p>in</p></td>
<td><p>reset counter after query</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hits_set</span></code></p></td>
<td><p>out</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">hits</span></code> field is set</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bytes_set</span></code></p></td>
<td><p>out</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bytes</span></code> field is set</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hits</span></code></p></td>
<td><p>out</p></td>
<td><p>number of hits for this rule</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bytes</span></code></p></td>
<td><p>out</p></td>
<td><p>number of bytes through this rule</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-rss">
<h4><span class="section-number">12.2.8.10. </span>Action: <code class="docutils literal notranslate"><span class="pre">RSS</span></code></h4>
<p>Similar to QUEUE, except RSS is additionally performed on packets to spread
them among several queues according to the provided parameters.</p>
<p>Unlike global RSS settings used by other DPDK APIs, unsetting the <code class="docutils literal notranslate"><span class="pre">types</span></code>
field does not disable RSS in a flow rule. Doing so instead requests safe
unspecified “best-effort” settings from the underlying PMD, which depending
on the flow rule, may result in anything ranging from empty (single queue)
to all-inclusive RSS.</p>
<p>If non-applicable for matching packets RSS types are requested,
these RSS types are simply ignored. For example, it happens if:</p>
<ul class="simple">
<li><p>Hashing of both TCP and UDP ports is requested
(only one can be present in a packet).</p></li>
<li><p>Requested RSS types contradict to flow rule pattern
(e.g. pattern has UDP item, but RSS types contain TCP).</p></li>
</ul>
<p>If requested RSS hash types are not supported by the Ethernet device at all
(not reported in <code class="docutils literal notranslate"><span class="pre">dev_info.flow_type_rss_offloads</span></code>),
the flow creation will fail.</p>
<p>Note: RSS hash result is stored in the <code class="docutils literal notranslate"><span class="pre">hash.rss</span></code> mbuf field which
overlaps <code class="docutils literal notranslate"><span class="pre">hash.fdir.lo</span></code>. Since <a class="reference internal" href="#action-mark">Action: MARK</a> sets the <code class="docutils literal notranslate"><span class="pre">hash.fdir.hi</span></code>
field only, both can be requested simultaneously.</p>
<p>Also, regarding packet encapsulation <code class="docutils literal notranslate"><span class="pre">level</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> requests the default behavior. Depending on the packet type, it can
mean outermost, innermost, anything in between or even no RSS.</p>
<p>It basically stands for the innermost encapsulation level RSS can be
performed on according to PMD and device capabilities.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> requests RSS to be performed on the outermost packet encapsulation
level.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">2</span></code> and subsequent values request RSS to be performed on the specified</dt><dd><p>inner packet encapsulation level, from outermost to innermost (lower to
higher values).</p>
</dd>
</dl>
</li>
</ul>
<p>Values other than <code class="docutils literal notranslate"><span class="pre">0</span></code> are not necessarily supported.</p>
<p>Requesting a specific RSS level on unrecognized traffic results in undefined
behavior. For predictable results, it is recommended to make the flow rule
pattern match packet headers up to the requested encapsulation level so that
only matching traffic goes through.</p>
<span id="table-rte-flow-action-rss"></span><table class="docutils align-default" id="id43">
<caption><span class="caption-number">Table 12.41 </span><span class="caption-text">RSS</span></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">func</span></code></p></td>
<td><p>RSS hash function to apply</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">level</span></code></p></td>
<td><p>encapsulation level for <code class="docutils literal notranslate"><span class="pre">types</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">types</span></code></p></td>
<td><p>specific RSS hash types (see <code class="docutils literal notranslate"><span class="pre">ETH_RSS_*</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">key_len</span></code></p></td>
<td><p>hash key length in bytes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">queue_num</span></code></p></td>
<td><p>number of entries in <code class="docutils literal notranslate"><span class="pre">queue</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p></td>
<td><p>hash key</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">queue</span></code></p></td>
<td><p>queue indices to use</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-pf">
<h4><span class="section-number">12.2.8.11. </span>Action: <code class="docutils literal notranslate"><span class="pre">PF</span></code></h4>
<p>Directs matching traffic to the physical function (PF) of the current
device.</p>
<p>See <a class="reference internal" href="#item-pf">Item: PF</a>.</p>
<ul class="simple">
<li><p>No configurable properties.</p></li>
</ul>
<span id="table-rte-flow-action-pf"></span><table class="docutils align-default" id="id44">
<caption><span class="caption-number">Table 12.42 </span><span class="caption-text">PF</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-vf">
<h4><span class="section-number">12.2.8.12. </span>Action: <code class="docutils literal notranslate"><span class="pre">VF</span></code></h4>
<p>Directs matching traffic to a given virtual function of the current device.</p>
<p>Packets matched by a VF pattern item can be redirected to their original VF
ID instead of the specified one. This parameter may not be available and is
not guaranteed to work properly if the VF part is matched by a prior flow
rule or if packets are not addressed to a VF in the first place.</p>
<p>See <a class="reference internal" href="#item-vf">Item: VF</a>.</p>
<span id="table-rte-flow-action-vf"></span><table class="docutils align-default" id="id45">
<caption><span class="caption-number">Table 12.43 </span><span class="caption-text">VF</span></caption>
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">original</span></code></p></td>
<td><p>use original VF ID if possible</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>VF ID</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-phy-port">
<h4><span class="section-number">12.2.8.13. </span>Action: <code class="docutils literal notranslate"><span class="pre">PHY_PORT</span></code></h4>
<p>Directs matching traffic to a given physical port index of the underlying
device.</p>
<p>See <a class="reference internal" href="#item-phy-port">Item: PHY_PORT</a>.</p>
<span id="table-rte-flow-action-phy-port"></span><table class="docutils align-default" id="id46">
<caption><span class="caption-number">Table 12.44 </span><span class="caption-text">PHY_PORT</span></caption>
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">original</span></code></p></td>
<td><p>use original port index if possible</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>physical port index</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-port-id">
<h4><span class="section-number">12.2.8.14. </span>Action: <code class="docutils literal notranslate"><span class="pre">PORT_ID</span></code></h4>
<p>Directs matching traffic to a given DPDK port ID.</p>
<p>See <a class="reference internal" href="#item-port-id">Item: PORT_ID</a>.</p>
<span id="table-rte-flow-action-port-id"></span><table class="docutils align-default" id="id47">
<caption><span class="caption-number">Table 12.45 </span><span class="caption-text">PORT_ID</span></caption>
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">original</span></code></p></td>
<td><p>use original DPDK port ID if possible</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>DPDK port ID</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-meter">
<h4><span class="section-number">12.2.8.15. </span>Action: <code class="docutils literal notranslate"><span class="pre">METER</span></code></h4>
<p>Applies a stage of metering and policing.</p>
<p>The metering and policing (MTR) object has to be first created using the
rte_mtr_create() API function. The ID of the MTR object is specified as
action parameter. More than one flow can use the same MTR object through
the meter action. The MTR object can be further updated or queried using
the rte_mtr* API.</p>
<span id="table-rte-flow-action-meter"></span><table class="docutils align-default" id="id48">
<caption><span class="caption-number">Table 12.46 </span><span class="caption-text">METER</span></caption>
<colgroup>
<col style="width: 48%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mtr_id</span></code></p></td>
<td><p>MTR object ID</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-security">
<h4><span class="section-number">12.2.8.16. </span>Action: <code class="docutils literal notranslate"><span class="pre">SECURITY</span></code></h4>
<p>Perform the security action on flows matched by the pattern items
according to the configuration of the security session.</p>
<p>This action modifies the payload of matched flows. For INLINE_CRYPTO, the
security protocol headers and IV are fully provided by the application as
specified in the flow pattern. The payload of matching packets is
encrypted on egress, and decrypted and authenticated on ingress.
For INLINE_PROTOCOL, the security protocol is fully offloaded to HW,
providing full encapsulation and decapsulation of packets in security
protocols. The flow pattern specifies both the outer security header fields
and the inner packet fields. The security session specified in the action
must match the pattern parameters.</p>
<p>The security session specified in the action must be created on the same
port as the flow action that is being specified.</p>
<p>The ingress/egress flow attribute should match that specified in the
security session if the security session supports the definition of the
direction.</p>
<p>Multiple flows can be configured to use the same security session.</p>
<span id="table-rte-flow-action-security"></span><table class="docutils align-default" id="id49">
<caption><span class="caption-number">Table 12.47 </span><span class="caption-text">SECURITY</span></caption>
<colgroup>
<col style="width: 37%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">security_session</span></code></p></td>
<td><p>security session to apply</p></td>
</tr>
</tbody>
</table>
<p>The following is an example of configuring IPsec inline using the
INLINE_CRYPTO security session:</p>
<p>The encryption algorithm, keys and salt are part of the opaque
<code class="docutils literal notranslate"><span class="pre">rte_security_session</span></code>. The SA is identified according to the IP and ESP
fields in the pattern items.</p>
<span id="table-rte-flow-item-esp-inline-example"></span><table class="docutils align-default" id="id50">
<caption><span class="caption-number">Table 12.48 </span><span class="caption-text">IPsec inline crypto flow pattern items.</span></caption>
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Ethernet</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>IPv4</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>ESP</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
<span id="table-rte-flow-action-esp-inline-example"></span><table class="docutils align-default" id="id51">
<caption><span class="caption-number">Table 12.49 </span><span class="caption-text">IPsec inline flow actions.</span></caption>
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Action</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>SECURITY</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-set-mpls-ttl">
<h4><span class="section-number">12.2.8.17. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_SET_MPLS_TTL</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_SET_MPLS_TTL</span></code> (“MPLS TTL”) as defined by the <a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow
Switch Specification</a>.</p>
<span id="table-rte-flow-action-of-set-mpls-ttl"></span><table class="docutils align-default" id="id52">
<caption><span class="caption-number">Table 12.50 </span><span class="caption-text">OF_SET_MPLS_TTL</span></caption>
<colgroup>
<col style="width: 58%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mpls_ttl</span></code></p></td>
<td><p>MPLS TTL</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-dec-mpls-ttl">
<h4><span class="section-number">12.2.8.18. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_DEC_MPLS_TTL</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_DEC_MPLS_TTL</span></code> (“decrement MPLS TTL”) as defined by the
<a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow Switch Specification</a>.</p>
<span id="table-rte-flow-action-of-dec-mpls-ttl"></span><table class="docutils align-default" id="id53">
<caption><span class="caption-number">Table 12.51 </span><span class="caption-text">OF_DEC_MPLS_TTL</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-set-nw-ttl">
<h4><span class="section-number">12.2.8.19. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_SET_NW_TTL</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_SET_NW_TTL</span></code> (“IP TTL”) as defined by the <a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow
Switch Specification</a>.</p>
<span id="table-rte-flow-action-of-set-nw-ttl"></span><table class="docutils align-default" id="id54">
<caption><span class="caption-number">Table 12.52 </span><span class="caption-text">OF_SET_NW_TTL</span></caption>
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nw_ttl</span></code></p></td>
<td><p>IP TTL</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-dec-nw-ttl">
<h4><span class="section-number">12.2.8.20. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_DEC_NW_TTL</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_DEC_NW_TTL</span></code> (“decrement IP TTL”) as defined by the
<a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow Switch Specification</a>.</p>
<span id="table-rte-flow-action-of-dec-nw-ttl"></span><table class="docutils align-default" id="id55">
<caption><span class="caption-number">Table 12.53 </span><span class="caption-text">OF_DEC_NW_TTL</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-copy-ttl-out">
<h4><span class="section-number">12.2.8.21. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_COPY_TTL_OUT</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_COPY_TTL_OUT</span></code> (“copy TTL “outwards” – from
next-to-outermost to outermost”) as defined by the <a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow Switch
Specification</a>.</p>
<span id="table-rte-flow-action-of-copy-ttl-out"></span><table class="docutils align-default" id="id56">
<caption><span class="caption-number">Table 12.54 </span><span class="caption-text">OF_COPY_TTL_OUT</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-copy-ttl-in">
<h4><span class="section-number">12.2.8.22. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_COPY_TTL_IN</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_COPY_TTL_IN</span></code> (“copy TTL “inwards” – from outermost to
next-to-outermost”) as defined by the <a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow Switch Specification</a>.</p>
<span id="table-rte-flow-action-of-copy-ttl-in"></span><table class="docutils align-default" id="id57">
<caption><span class="caption-number">Table 12.55 </span><span class="caption-text">OF_COPY_TTL_IN</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-pop-vlan">
<h4><span class="section-number">12.2.8.23. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_POP_VLAN</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_POP_VLAN</span></code> (“pop the outer VLAN tag”) as defined
by the <a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow Switch Specification</a>.</p>
<span id="table-rte-flow-action-of-pop-vlan"></span><table class="docutils align-default" id="id58">
<caption><span class="caption-number">Table 12.56 </span><span class="caption-text">OF_POP_VLAN</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-push-vlan">
<h4><span class="section-number">12.2.8.24. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_PUSH_VLAN</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_PUSH_VLAN</span></code> (“push a new VLAN tag”) as defined by the
<a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow Switch Specification</a>.</p>
<span id="table-rte-flow-action-of-push-vlan"></span><table class="docutils align-default" id="id59">
<caption><span class="caption-number">Table 12.57 </span><span class="caption-text">OF_PUSH_VLAN</span></caption>
<colgroup>
<col style="width: 58%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ethertype</span></code></p></td>
<td><p>EtherType</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-set-vlan-vid">
<h4><span class="section-number">12.2.8.25. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_SET_VLAN_VID</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_SET_VLAN_VID</span></code> (“set the 802.1q VLAN id”) as defined by
the <a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow Switch Specification</a>.</p>
<span id="table-rte-flow-action-of-set-vlan-vid"></span><table class="docutils align-default" id="id60">
<caption><span class="caption-number">Table 12.58 </span><span class="caption-text">OF_SET_VLAN_VID</span></caption>
<colgroup>
<col style="width: 61%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">vlan_vid</span></code></p></td>
<td><p>VLAN id</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-set-vlan-pcp">
<h4><span class="section-number">12.2.8.26. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_SET_VLAN_PCP</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_SET_LAN_PCP</span></code> (“set the 802.1q priority”) as defined by
the <a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow Switch Specification</a>.</p>
<span id="table-rte-flow-action-of-set-vlan-pcp"></span><table class="docutils align-default" id="id61">
<caption><span class="caption-number">Table 12.59 </span><span class="caption-text">OF_SET_VLAN_PCP</span></caption>
<colgroup>
<col style="width: 48%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">vlan_pcp</span></code></p></td>
<td><p>VLAN priority</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-pop-mpls">
<h4><span class="section-number">12.2.8.27. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_POP_MPLS</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_POP_MPLS</span></code> (“pop the outer MPLS tag”) as defined by the
<a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow Switch Specification</a>.</p>
<span id="table-rte-flow-action-of-pop-mpls"></span><table class="docutils align-default" id="id62">
<caption><span class="caption-number">Table 12.60 </span><span class="caption-text">OF_POP_MPLS</span></caption>
<colgroup>
<col style="width: 58%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ethertype</span></code></p></td>
<td><p>EtherType</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-of-push-mpls">
<h4><span class="section-number">12.2.8.28. </span>Action: <code class="docutils literal notranslate"><span class="pre">OF_PUSH_MPLS</span></code></h4>
<p>Implements <code class="docutils literal notranslate"><span class="pre">OFPAT_PUSH_MPLS</span></code> (“push a new MPLS tag”) as defined by the
<a class="reference external" href="https://www.opennetworking.org/software-defined-standards/specifications/">OpenFlow Switch Specification</a>.</p>
<span id="table-rte-flow-action-of-push-mpls"></span><table class="docutils align-default" id="id63">
<caption><span class="caption-number">Table 12.61 </span><span class="caption-text">OF_PUSH_MPLS</span></caption>
<colgroup>
<col style="width: 58%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ethertype</span></code></p></td>
<td><p>EtherType</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-vxlan-encap">
<h4><span class="section-number">12.2.8.29. </span>Action: <code class="docutils literal notranslate"><span class="pre">VXLAN_ENCAP</span></code></h4>
<p>Performs a VXLAN encapsulation action by encapsulating the matched flow in the
VXLAN tunnel as defined in the``rte_flow_action_vxlan_encap`` flow items
definition.</p>
<p>This action modifies the payload of matched flows. The flow definition specified
in the <code class="docutils literal notranslate"><span class="pre">rte_flow_action_tunnel_encap</span></code> action structure must define a valid
VLXAN network overlay which conforms with RFC 7348 (Virtual eXtensible Local
Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks
over Layer 3 Networks). The pattern must be terminated with the
RTE_FLOW_ITEM_TYPE_END item type.</p>
<span id="table-rte-flow-action-vxlan-encap"></span><table class="docutils align-default" id="id64">
<caption><span class="caption-number">Table 12.62 </span><span class="caption-text">VXLAN_ENCAP</span></caption>
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">definition</span></code></p></td>
<td><p>Tunnel end-point overlay definition</p></td>
</tr>
</tbody>
</table>
<span id="table-rte-flow-action-vxlan-encap-example"></span><table class="docutils align-default" id="id65">
<caption><span class="caption-number">Table 12.63 </span><span class="caption-text">IPv4 VxLAN flow pattern example.</span></caption>
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Ethernet</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>IPv4</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>UDP</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>VXLAN</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-vxlan-decap">
<h4><span class="section-number">12.2.8.30. </span>Action: <code class="docutils literal notranslate"><span class="pre">VXLAN_DECAP</span></code></h4>
<p>Performs a decapsulation action by stripping all headers of the VXLAN tunnel
network overlay from the matched flow.</p>
<p>The flow items pattern defined for the flow rule with which a <code class="docutils literal notranslate"><span class="pre">VXLAN_DECAP</span></code>
action is specified, must define a valid VXLAN tunnel as per RFC7348. If the
flow pattern does not specify a valid VXLAN tunnel then a
RTE_FLOW_ERROR_TYPE_ACTION error should be returned.</p>
<p>This action modifies the payload of matched flows.</p>
</div>
<div class="section" id="action-nvgre-encap">
<h4><span class="section-number">12.2.8.31. </span>Action: <code class="docutils literal notranslate"><span class="pre">NVGRE_ENCAP</span></code></h4>
<p>Performs a NVGRE encapsulation action by encapsulating the matched flow in the
NVGRE tunnel as defined in the``rte_flow_action_tunnel_encap`` flow item
definition.</p>
<p>This action modifies the payload of matched flows. The flow definition specified
in the <code class="docutils literal notranslate"><span class="pre">rte_flow_action_tunnel_encap</span></code> action structure must defined a valid
NVGRE network overlay which conforms with RFC 7637 (NVGRE: Network
Virtualization Using Generic Routing Encapsulation). The pattern must be
terminated with the RTE_FLOW_ITEM_TYPE_END item type.</p>
<span id="table-rte-flow-action-nvgre-encap"></span><table class="docutils align-default" id="id66">
<caption><span class="caption-number">Table 12.64 </span><span class="caption-text">NVGRE_ENCAP</span></caption>
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">definition</span></code></p></td>
<td><p>NVGRE end-point overlay definition</p></td>
</tr>
</tbody>
</table>
<span id="table-rte-flow-action-nvgre-encap-example"></span><table class="docutils align-default" id="id67">
<caption><span class="caption-number">Table 12.65 </span><span class="caption-text">IPv4 NVGRE flow pattern example.</span></caption>
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Ethernet</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>IPv4</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>NVGRE</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-nvgre-decap">
<h4><span class="section-number">12.2.8.32. </span>Action: <code class="docutils literal notranslate"><span class="pre">NVGRE_DECAP</span></code></h4>
<p>Performs a decapsulation action by stripping all headers of the NVGRE tunnel
network overlay from the matched flow.</p>
<p>The flow items pattern defined for the flow rule with which a <code class="docutils literal notranslate"><span class="pre">NVGRE_DECAP</span></code>
action is specified, must define a valid NVGRE tunnel as per RFC7637. If the
flow pattern does not specify a valid NVGRE tunnel then a
RTE_FLOW_ERROR_TYPE_ACTION error should be returned.</p>
<p>This action modifies the payload of matched flows.</p>
</div>
<div class="section" id="action-raw-encap">
<h4><span class="section-number">12.2.8.33. </span>Action: <code class="docutils literal notranslate"><span class="pre">RAW_ENCAP</span></code></h4>
<p>Adds outer header whose template is provided in its data buffer,
as defined in the <code class="docutils literal notranslate"><span class="pre">rte_flow_action_raw_encap</span></code> definition.</p>
<p>This action modifies the payload of matched flows. The data supplied must
be a valid header, either holding layer 2 data in case of adding layer 2 after
decap layer 3 tunnel (for example MPLSoGRE) or complete tunnel definition
starting from layer 2 and moving to the tunnel item itself. When applied to
the original packet the resulting packet must be a valid packet.</p>
<span id="table-rte-flow-action-raw-encap"></span><table class="docutils align-default" id="id68">
<caption><span class="caption-number">Table 12.66 </span><span class="caption-text">RAW_ENCAP</span></caption>
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>Encapsulation data</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">preserve</span></code></p></td>
<td><p>Bit-mask of data to preserve on output</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">size</span></code></p></td>
<td><p>Size of data and preserve</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-raw-decap">
<h4><span class="section-number">12.2.8.34. </span>Action: <code class="docutils literal notranslate"><span class="pre">RAW_DECAP</span></code></h4>
<p>Remove outer header whose template is provided in its data buffer,
as defined in the <code class="docutils literal notranslate"><span class="pre">rte_flow_action_raw_decap</span></code></p>
<p>This action modifies the payload of matched flows. The data supplied must
be a valid header, either holding layer 2 data in case of removing layer 2
before encapsulation of layer 3 tunnel (for example MPLSoGRE) or complete
tunnel definition starting from layer 2 and moving to the tunnel item itself.
When applied to the original packet the resulting packet must be a
valid packet.</p>
<span id="table-rte-flow-action-raw-decap"></span><table class="docutils align-default" id="id69">
<caption><span class="caption-number">Table 12.67 </span><span class="caption-text">RAW_DECAP</span></caption>
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>Decapsulation data</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">size</span></code></p></td>
<td><p>Size of data</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-ipv4-src">
<h4><span class="section-number">12.2.8.35. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_IPV4_SRC</span></code></h4>
<p>Set a new IPv4 source address in the outermost IPv4 header.</p>
<p>It must be used with a valid RTE_FLOW_ITEM_TYPE_IPV4 flow pattern item.
Otherwise, RTE_FLOW_ERROR_TYPE_ACTION error will be returned.</p>
<span id="table-rte-flow-action-set-ipv4-src"></span><table class="docutils align-default" id="id70">
<caption><span class="caption-number">Table 12.68 </span><span class="caption-text">SET_IPV4_SRC</span></caption>
<colgroup>
<col style="width: 38%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Field         | Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ipv4_addr</span></code></p></td>
<td><p>new IPv4 source address</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-ipv4-dst">
<h4><span class="section-number">12.2.8.36. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_IPV4_DST</span></code></h4>
<p>Set a new IPv4 destination address in the outermost IPv4 header.</p>
<p>It must be used with a valid RTE_FLOW_ITEM_TYPE_IPV4 flow pattern item.
Otherwise, RTE_FLOW_ERROR_TYPE_ACTION error will be returned.</p>
<span id="table-rte-flow-action-set-ipv4-dst"></span><table class="docutils align-default" id="id71">
<caption><span class="caption-number">Table 12.69 </span><span class="caption-text">SET_IPV4_DST</span></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ipv4_addr</span></code></p></td>
<td><p>new IPv4 destination address</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-ipv6-src">
<h4><span class="section-number">12.2.8.37. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_IPV6_SRC</span></code></h4>
<p>Set a new IPv6 source address in the outermost IPv6 header.</p>
<p>It must be used with a valid RTE_FLOW_ITEM_TYPE_IPV6 flow pattern item.
Otherwise, RTE_FLOW_ERROR_TYPE_ACTION error will be returned.</p>
<span id="table-rte-flow-action-set-ipv6-src"></span><table class="docutils align-default" id="id72">
<caption><span class="caption-number">Table 12.70 </span><span class="caption-text">SET_IPV6_SRC</span></caption>
<colgroup>
<col style="width: 38%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ipv6_addr</span></code></p></td>
<td><p>new IPv6 source address</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-ipv6-dst">
<h4><span class="section-number">12.2.8.38. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_IPV6_DST</span></code></h4>
<p>Set a new IPv6 destination address in the outermost IPv6 header.</p>
<p>It must be used with a valid RTE_FLOW_ITEM_TYPE_IPV6 flow pattern item.
Otherwise, RTE_FLOW_ERROR_TYPE_ACTION error will be returned.</p>
<span id="table-rte-flow-action-set-ipv6-dst"></span><table class="docutils align-default" id="id73">
<caption><span class="caption-number">Table 12.71 </span><span class="caption-text">SET_IPV6_DST</span></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ipv6_addr</span></code></p></td>
<td><p>new IPv6 destination address</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-tp-src">
<h4><span class="section-number">12.2.8.39. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_TP_SRC</span></code></h4>
<p>Set a new source port number in the outermost TCP/UDP header.</p>
<p>It must be used with a valid RTE_FLOW_ITEM_TYPE_TCP or RTE_FLOW_ITEM_TYPE_UDP
flow pattern item. Otherwise, RTE_FLOW_ERROR_TYPE_ACTION error will be returned.</p>
<span id="table-rte-flow-action-set-tp-src"></span><table class="docutils align-default" id="id74">
<caption><span class="caption-number">Table 12.72 </span><span class="caption-text">SET_TP_SRC</span></caption>
<colgroup>
<col style="width: 29%" />
<col style="width: 12%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head" colspan="2"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><code class="docutils literal notranslate"><span class="pre">port</span></code> | new TCP/UDP source port</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-tp-dst">
<h4><span class="section-number">12.2.8.40. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_TP_DST</span></code></h4>
<p>Set a new destination port number in the outermost TCP/UDP header.</p>
<p>It must be used with a valid RTE_FLOW_ITEM_TYPE_TCP or RTE_FLOW_ITEM_TYPE_UDP
flow pattern item. Otherwise, RTE_FLOW_ERROR_TYPE_ACTION error will be returned.</p>
<span id="table-rte-flow-action-set-tp-dst"></span><table class="docutils align-default" id="id75">
<caption><span class="caption-number">Table 12.73 </span><span class="caption-text">SET_TP_DST</span></caption>
<colgroup>
<col style="width: 26%" />
<col style="width: 10%" />
<col style="width: 64%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head" colspan="2"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p><code class="docutils literal notranslate"><span class="pre">port</span></code> | new TCP/UDP destination port</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-mac-swap">
<h4><span class="section-number">12.2.8.41. </span>Action: <code class="docutils literal notranslate"><span class="pre">MAC_SWAP</span></code></h4>
<p>Swap the source and destination MAC addresses in the outermost Ethernet
header.</p>
<p>It must be used with a valid RTE_FLOW_ITEM_TYPE_ETH flow pattern item.
Otherwise, RTE_FLOW_ERROR_TYPE_ACTION error will be returned.</p>
<span id="table-rte-flow-action-mac-swap"></span><table class="docutils align-default" id="id76">
<caption><span class="caption-number">Table 12.74 </span><span class="caption-text">MAC_SWAP</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-dec-ttl">
<h4><span class="section-number">12.2.8.42. </span>Action: <code class="docutils literal notranslate"><span class="pre">DEC_TTL</span></code></h4>
<p>Decrease TTL value.</p>
<p>If there is no valid RTE_FLOW_ITEM_TYPE_IPV4 or RTE_FLOW_ITEM_TYPE_IPV6
in pattern, Some PMDs will reject rule because behavior will be undefined.</p>
<span id="table-rte-flow-action-dec-ttl"></span><table class="docutils align-default" id="id77">
<caption><span class="caption-number">Table 12.75 </span><span class="caption-text">DEC_TTL</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-ttl">
<h4><span class="section-number">12.2.8.43. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_TTL</span></code></h4>
<p>Assigns a new TTL value.</p>
<p>If there is no valid RTE_FLOW_ITEM_TYPE_IPV4 or RTE_FLOW_ITEM_TYPE_IPV6
in pattern, Some PMDs will reject rule because behavior will be undefined.</p>
<span id="table-rte-flow-action-set-ttl"></span><table class="docutils align-default" id="id78">
<caption><span class="caption-number">Table 12.76 </span><span class="caption-text">SET_TTL</span></caption>
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ttl_value</span></code></p></td>
<td><p>new TTL value</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-mac-src">
<h4><span class="section-number">12.2.8.44. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_MAC_SRC</span></code></h4>
<p>Set source MAC address.</p>
<p>It must be used with a valid RTE_FLOW_ITEM_TYPE_ETH flow pattern item.
Otherwise, RTE_FLOW_ERROR_TYPE_ACTION error will be returned.</p>
<span id="table-rte-flow-action-set-mac-src"></span><table class="docutils align-default" id="id79">
<caption><span class="caption-number">Table 12.77 </span><span class="caption-text">SET_MAC_SRC</span></caption>
<colgroup>
<col style="width: 48%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mac_addr</span></code></p></td>
<td><p>MAC address</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-mac-dst">
<h4><span class="section-number">12.2.8.45. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_MAC_DST</span></code></h4>
<p>Set destination MAC address.</p>
<p>It must be used with a valid RTE_FLOW_ITEM_TYPE_ETH flow pattern item.
Otherwise, RTE_FLOW_ERROR_TYPE_ACTION error will be returned.</p>
<span id="table-rte-flow-action-set-mac-dst"></span><table class="docutils align-default" id="id80">
<caption><span class="caption-number">Table 12.78 </span><span class="caption-text">SET_MAC_DST</span></caption>
<colgroup>
<col style="width: 48%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mac_addr</span></code></p></td>
<td><p>MAC address</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-inc-tcp-seq">
<h4><span class="section-number">12.2.8.46. </span>Action: <code class="docutils literal notranslate"><span class="pre">INC_TCP_SEQ</span></code></h4>
<p>Increase sequence number in the outermost TCP header.
Value to increase TCP sequence number by is a big-endian 32 bit integer.</p>
<p>Using this action on non-matching traffic will result in undefined behavior.</p>
</div>
<div class="section" id="action-dec-tcp-seq">
<h4><span class="section-number">12.2.8.47. </span>Action: <code class="docutils literal notranslate"><span class="pre">DEC_TCP_SEQ</span></code></h4>
<p>Decrease sequence number in the outermost TCP header.
Value to decrease TCP sequence number by is a big-endian 32 bit integer.</p>
<p>Using this action on non-matching traffic will result in undefined behavior.</p>
</div>
<div class="section" id="action-inc-tcp-ack">
<h4><span class="section-number">12.2.8.48. </span>Action: <code class="docutils literal notranslate"><span class="pre">INC_TCP_ACK</span></code></h4>
<p>Increase acknowledgment number in the outermost TCP header.
Value to increase TCP acknowledgment number by is a big-endian 32 bit integer.</p>
<p>Using this action on non-matching traffic will result in undefined behavior.</p>
</div>
<div class="section" id="action-dec-tcp-ack">
<h4><span class="section-number">12.2.8.49. </span>Action: <code class="docutils literal notranslate"><span class="pre">DEC_TCP_ACK</span></code></h4>
<p>Decrease acknowledgment number in the outermost TCP header.
Value to decrease TCP acknowledgment number by is a big-endian 32 bit integer.</p>
<p>Using this action on non-matching traffic will result in undefined behavior.</p>
</div>
<div class="section" id="action-set-tag">
<h4><span class="section-number">12.2.8.50. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_TAG</span></code></h4>
<p>Set Tag.</p>
<p>Tag is a transient data used during flow matching. This is not delivered to
application. Multiple tags are supported by specifying index.</p>
<span id="table-rte-flow-action-set-tag"></span><table class="docutils align-default" id="id81">
<caption><span class="caption-number">Table 12.79 </span><span class="caption-text">SET_TAG</span></caption>
<colgroup>
<col style="width: 28%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>32 bit tag value</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p>bit-mask applies to “data”</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>index of tag to set</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-meta">
<h4><span class="section-number">12.2.8.51. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_META</span></code></h4>
<p>Set metadata. Item <code class="docutils literal notranslate"><span class="pre">META</span></code> matches metadata.</p>
<p>Metadata set by mbuf metadata field with PKT_TX_DYNF_METADATA flag on egress
will be overridden by this action. On ingress, the metadata will be carried by
<code class="docutils literal notranslate"><span class="pre">metadata</span></code> dynamic field of <code class="docutils literal notranslate"><span class="pre">rte_mbuf</span></code> which can be accessed by
<code class="docutils literal notranslate"><span class="pre">RTE_FLOW_DYNF_METADATA()</span></code>. PKT_RX_DYNF_METADATA flag will be set along
with the data.</p>
<p>The mbuf dynamic field must be registered by calling
<code class="docutils literal notranslate"><span class="pre">rte_flow_dynf_metadata_register()</span></code> prior to use <code class="docutils literal notranslate"><span class="pre">SET_META</span></code> action.</p>
<p>Altering partial bits is supported with <code class="docutils literal notranslate"><span class="pre">mask</span></code>. For bits which have never been
set, unpredictable value will be seen depending on driver implementation. For
loopback/hairpin packet, metadata set on Rx/Tx may or may not be propagated to
the other path depending on HW capability.</p>
<p>In hairpin case with Tx explicit flow mode, metadata could (not mandatory) be
used to connect the Rx and Tx flows if it can be propagated from Rx to Tx path.</p>
<span id="table-rte-flow-action-set-meta"></span><table class="docutils align-default" id="id82">
<caption><span class="caption-number">Table 12.80 </span><span class="caption-text">SET_META</span></caption>
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>32 bit metadata value</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mask</span></code></p></td>
<td><p>bit-mask applies to “data”</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-ipv4-dscp">
<h4><span class="section-number">12.2.8.52. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_IPV4_DSCP</span></code></h4>
<p>Set IPv4 DSCP.</p>
<p>Modify DSCP in IPv4 header.</p>
<p>It must be used with RTE_FLOW_ITEM_TYPE_IPV4 in pattern.
Otherwise, RTE_FLOW_ERROR_TYPE_ACTION error will be returned.</p>
<span id="table-rte-flow-action-set-ipv4-dscp"></span><table class="docutils align-default" id="id83">
<caption><span class="caption-number">Table 12.81 </span><span class="caption-text">SET_IPV4_DSCP</span></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dscp</span></code></p></td>
<td><p>DSCP in low 6 bits, rest ignore</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-set-ipv6-dscp">
<h4><span class="section-number">12.2.8.53. </span>Action: <code class="docutils literal notranslate"><span class="pre">SET_IPV6_DSCP</span></code></h4>
<p>Set IPv6 DSCP.</p>
<p>Modify DSCP in IPv6 header.</p>
<p>It must be used with RTE_FLOW_ITEM_TYPE_IPV6 in pattern.
Otherwise, RTE_FLOW_ERROR_TYPE_ACTION error will be returned.</p>
<span id="table-rte-flow-action-set-ipv6-dscp"></span><table class="docutils align-default" id="id84">
<caption><span class="caption-number">Table 12.82 </span><span class="caption-text">SET_IPV6_DSCP</span></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dscp</span></code></p></td>
<td><p>DSCP in low 6 bits, rest ignore</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-age">
<h4><span class="section-number">12.2.8.54. </span>Action: <code class="docutils literal notranslate"><span class="pre">AGE</span></code></h4>
<p>Set ageing timeout configuration to a flow.</p>
<p>Event RTE_ETH_EVENT_FLOW_AGED will be reported if
timeout passed without any matching on the flow.</p>
<span id="table-rte-flow-action-age"></span><table class="docutils align-default" id="id85">
<caption><span class="caption-number">Table 12.83 </span><span class="caption-text">AGE</span></caption>
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">timeout</span></code></p></td>
<td><p>24 bits timeout value</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">reserved</span></code></p></td>
<td><p>8 bits reserved, must be zero</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">context</span></code></p></td>
<td><p>user input flow context</p></td>
</tr>
</tbody>
</table>
<p>Query structure to retrieve ageing status information of a
shared AGE action, or a flow rule using the AGE action:</p>
<span id="table-rte-flow-query-age"></span><table class="docutils align-default" id="id86">
<caption><span class="caption-number">Table 12.84 </span><span class="caption-text">AGE query</span></caption>
<colgroup>
<col style="width: 40%" />
<col style="width: 7%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>I/O</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">aged</span></code></p></td>
<td><p>out</p></td>
<td><p>Aging timeout expired</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sec_since_last_hit_valid</span></code></p></td>
<td><p>out</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sec_since_last_hit</span></code> value is valid</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sec_since_last_hit</span></code></p></td>
<td><p>out</p></td>
<td><p>Seconds since last traffic hit</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-sample">
<h4><span class="section-number">12.2.8.55. </span>Action: <code class="docutils literal notranslate"><span class="pre">SAMPLE</span></code></h4>
<p>Adds a sample action to a matched flow.</p>
<p>The matching packets will be duplicated with the specified <code class="docutils literal notranslate"><span class="pre">ratio</span></code> and
applied with own set of actions with a fate action, the packets sampled
equals is ‘1/ratio’. All the packets continue to the target destination.</p>
<p>When the <code class="docutils literal notranslate"><span class="pre">ratio</span></code> is set to 1 then the packets will be 100% mirrored.
<code class="docutils literal notranslate"><span class="pre">actions</span></code> represent the different set of actions for the sampled or mirrored
packets, and must have a fate action.</p>
<span id="table-rte-flow-action-sample"></span><table class="docutils align-default" id="id87">
<caption><span class="caption-number">Table 12.85 </span><span class="caption-text">SAMPLE</span></caption>
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ratio</span></code></p></td>
<td><p>32 bits sample ratio value</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">actions</span></code></p></td>
<td><p>sub-action list for sampling</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="action-shared">
<h4><span class="section-number">12.2.8.56. </span>Action: <code class="docutils literal notranslate"><span class="pre">SHARED</span></code></h4>
<p>Flow utilize shared action by handle as returned from
<code class="docutils literal notranslate"><span class="pre">rte_flow_shared_action_create()</span></code>.</p>
<p>The behaviour of the shared action defined by <code class="docutils literal notranslate"><span class="pre">action</span></code> argument of type
<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_action</span></code> passed to <code class="docutils literal notranslate"><span class="pre">rte_flow_shared_action_create()</span></code>.</p>
<span id="table-rte-flow-shared-action"></span><table class="docutils align-default" id="id88">
<caption><span class="caption-number">Table 12.86 </span><span class="caption-text">SHARED</span></caption>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>no properties</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="negative-types">
<h3><span class="section-number">12.2.9. </span>Negative types</h3>
<p>All specified pattern items (<code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">rte_flow_item_type</span></code>) and actions
(<code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">rte_flow_action_type</span></code>) use positive identifiers.</p>
<p>The negative space is reserved for dynamic types generated by PMDs during
run-time. PMDs may encounter them as a result but must not accept negative
identifiers they are not aware of.</p>
<p>A method to generate them remains to be defined.</p>
<p>Application may use PMD dynamic items or actions in flow rules. In that case
size of configuration object in dynamic element must be a pointer size.</p>
</div>
<div class="section" id="planned-types">
<h3><span class="section-number">12.2.10. </span>Planned types</h3>
<p>Pattern item types will be added as new protocols are implemented.</p>
<p>Variable headers support through dedicated pattern items, for example in
order to match specific IPv4 options and IPv6 extension headers would be
stacked after IPv4/IPv6 items.</p>
<p>Other action types are planned but are not defined yet. These include the
ability to alter packet data in several ways, such as performing
encapsulation/decapsulation of tunnel headers.</p>
</div>
</div>
<div class="section" id="rules-management">
<h2><span class="section-number">12.3. </span>Rules management</h2>
<p>A rather simple API with few functions is provided to fully manage flow
rules.</p>
<p>Each created flow rule is associated with an opaque, PMD-specific handle
pointer. The application is responsible for keeping it until the rule is
destroyed.</p>
<p>Flows rules are represented by <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow</span></code> objects.</p>
<div class="section" id="validation">
<h3><span class="section-number">12.3.1. </span>Validation</h3>
<p>Given that expressing a definite set of device capabilities is not
practical, a dedicated function is provided to check if a flow rule is
supported and can be created.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">rte_flow_validate</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">port_id</span><span class="p">,</span>
                  <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_attr</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
                  <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_item</span> <span class="n">pattern</span><span class="p">[],</span>
                  <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_action</span> <span class="n">actions</span><span class="p">[],</span>
                  <span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>
</pre></div>
</div>
<p>The flow rule is validated for correctness and whether it could be accepted
by the device given sufficient resources. The rule is checked against the
current device mode and queue configuration. The flow rule may also
optionally be validated against existing flow rules and device resources.
This function has no effect on the target device.</p>
<p>The returned value is guaranteed to remain valid only as long as no
successful calls to <code class="docutils literal notranslate"><span class="pre">rte_flow_create()</span></code> or <code class="docutils literal notranslate"><span class="pre">rte_flow_destroy()</span></code> are made
in the meantime and no device parameter affecting flow rules in any way are
modified, due to possible collisions or resource limitations (although in
such cases <code class="docutils literal notranslate"><span class="pre">EINVAL</span></code> should not be returned).</p>
<p>Arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: port identifier of Ethernet device.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attr</span></code>: flow rule attributes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code>: pattern specification (list terminated by the END pattern
item).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actions</span></code>: associated actions (list terminated by the END action).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code>: perform verbose error reporting if not NULL. PMDs initialize
this structure in case of error only.</p></li>
</ul>
<p>Return values:</p>
<ul class="simple">
<li><p>0 if flow rule is valid and can be created. A negative errno value
otherwise (<code class="docutils literal notranslate"><span class="pre">rte_errno</span></code> is also set), the following errors are defined.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ENOSYS</span></code>: underlying device does not support this functionality.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-EINVAL</span></code>: unknown or invalid rule specification.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ENOTSUP</span></code>: valid but unsupported rule specification (e.g. partial
bit-masks are unsupported).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EEXIST</span></code>: collision with an existing rule. Only returned if device
supports flow rule collision checking and there was a flow rule
collision. Not receiving this return code is no guarantee that creating
the rule will not fail due to a collision.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ENOMEM</span></code>: not enough memory to execute the function, or if the device
supports resource validation, resource limitation on the device.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-EBUSY</span></code>: action cannot be performed due to busy device resources, may
succeed if the affected queues or even the entire port are in a stopped
state (see <code class="docutils literal notranslate"><span class="pre">rte_eth_dev_rx_queue_stop()</span></code> and <code class="docutils literal notranslate"><span class="pre">rte_eth_dev_stop()</span></code>).</p></li>
</ul>
</div>
<div class="section" id="creation">
<h3><span class="section-number">12.3.2. </span>Creation</h3>
<p>Creating a flow rule is similar to validating one, except the rule is
actually created and a handle returned.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">rte_flow</span> <span class="o">*</span>
<span class="nf">rte_flow_create</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">port_id</span><span class="p">,</span>
                <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_attr</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
                <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_item</span> <span class="n">pattern</span><span class="p">[],</span>
                <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_action</span> <span class="o">*</span><span class="n">actions</span><span class="p">[],</span>
                <span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>
</pre></div>
</div>
<p>Arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: port identifier of Ethernet device.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attr</span></code>: flow rule attributes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code>: pattern specification (list terminated by the END pattern
item).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">actions</span></code>: associated actions (list terminated by the END action).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code>: perform verbose error reporting if not NULL. PMDs initialize
this structure in case of error only.</p></li>
</ul>
<p>Return values:</p>
<p>A valid handle in case of success, NULL otherwise and <code class="docutils literal notranslate"><span class="pre">rte_errno</span></code> is set
to the positive version of one of the error codes defined for
<code class="docutils literal notranslate"><span class="pre">rte_flow_validate()</span></code>.</p>
</div>
<div class="section" id="destruction">
<h3><span class="section-number">12.3.3. </span>Destruction</h3>
<p>Flow rules destruction is not automatic, and a queue or a port should not be
released if any are still attached to them. Applications must take care of
performing this step before releasing resources.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">rte_flow_destroy</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">port_id</span><span class="p">,</span>
                 <span class="k">struct</span> <span class="n">rte_flow</span> <span class="o">*</span><span class="n">flow</span><span class="p">,</span>
                 <span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>
</pre></div>
</div>
<p>Failure to destroy a flow rule handle may occur when other flow rules depend
on it, and destroying it would result in an inconsistent state.</p>
<p>This function is only guaranteed to succeed if handles are destroyed in
reverse order of their creation.</p>
<p>Arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: port identifier of Ethernet device.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flow</span></code>: flow rule handle to destroy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code>: perform verbose error reporting if not NULL. PMDs initialize
this structure in case of error only.</p></li>
</ul>
<p>Return values:</p>
<ul class="simple">
<li><p>0 on success, a negative errno value otherwise and <code class="docutils literal notranslate"><span class="pre">rte_errno</span></code> is set.</p></li>
</ul>
</div>
<div class="section" id="flush">
<h3><span class="section-number">12.3.4. </span>Flush</h3>
<p>Convenience function to destroy all flow rule handles associated with a
port. They are released as with successive calls to <code class="docutils literal notranslate"><span class="pre">rte_flow_destroy()</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">rte_flow_flush</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">port_id</span><span class="p">,</span>
               <span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>
</pre></div>
</div>
<p>In the unlikely event of failure, handles are still considered destroyed and
no longer valid but the port must be assumed to be in an inconsistent state.</p>
<p>Arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: port identifier of Ethernet device.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code>: perform verbose error reporting if not NULL. PMDs initialize
this structure in case of error only.</p></li>
</ul>
<p>Return values:</p>
<ul class="simple">
<li><p>0 on success, a negative errno value otherwise and <code class="docutils literal notranslate"><span class="pre">rte_errno</span></code> is set.</p></li>
</ul>
</div>
<div class="section" id="query">
<h3><span class="section-number">12.3.5. </span>Query</h3>
<p>Query an existing flow rule.</p>
<p>This function allows retrieving flow-specific data such as counters. Data
is gathered by special actions which must be present in the flow rule
definition.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">rte_flow_query</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">port_id</span><span class="p">,</span>
               <span class="k">struct</span> <span class="n">rte_flow</span> <span class="o">*</span><span class="n">flow</span><span class="p">,</span>
               <span class="k">const</span> <span class="k">struct</span> <span class="n">rte_flow_action</span> <span class="o">*</span><span class="n">action</span><span class="p">,</span>
               <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
               <span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>
</pre></div>
</div>
<p>Arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: port identifier of Ethernet device.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flow</span></code>: flow rule handle to query.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">action</span></code>: action to query, this must match prototype from flow rule.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>: pointer to storage for the associated query data type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code>: perform verbose error reporting if not NULL. PMDs initialize
this structure in case of error only.</p></li>
</ul>
<p>Return values:</p>
<ul class="simple">
<li><p>0 on success, a negative errno value otherwise and <code class="docutils literal notranslate"><span class="pre">rte_errno</span></code> is set.</p></li>
</ul>
</div>
</div>
<div class="section" id="flow-isolated-mode">
<span id="id2"></span><h2><span class="section-number">12.4. </span>Flow isolated mode</h2>
<p>The general expectation for ingress traffic is that flow rules process it
first; the remaining unmatched or pass-through traffic usually ends up in a
queue (with or without RSS, locally or in some sub-device instance)
depending on the global configuration settings of a port.</p>
<p>While fine from a compatibility standpoint, this approach makes drivers more
complex as they have to check for possible side effects outside of this API
when creating or destroying flow rules. It results in a more limited set of
available rule types due to the way device resources are assigned (e.g. no
support for the RSS action even on capable hardware).</p>
<p>Given that nonspecific traffic can be handled by flow rules as well,
isolated mode is a means for applications to tell a driver that ingress on
the underlying port must be injected from the defined flow rules only; that
no default traffic is expected outside those rules.</p>
<p>This has the following benefits:</p>
<ul class="simple">
<li><p>Applications get finer-grained control over the kind of traffic they want
to receive (no traffic by default).</p></li>
<li><p>More importantly they control at what point nonspecific traffic is handled
relative to other flow rules, by adjusting priority levels.</p></li>
<li><p>Drivers can assign more hardware resources to flow rules and expand the
set of supported rule types.</p></li>
</ul>
<p>Because toggling isolated mode may cause profound changes to the ingress
processing path of a driver, it may not be possible to leave it once
entered. Likewise, existing flow rules or global configuration settings may
prevent a driver from entering isolated mode.</p>
<p>Applications relying on this mode are therefore encouraged to toggle it as
soon as possible after device initialization, ideally before the first call
to <code class="docutils literal notranslate"><span class="pre">rte_eth_dev_configure()</span></code> to avoid possible failures due to conflicting
settings.</p>
<p>Once effective, the following functionality has no effect on the underlying
port and may return errors such as <code class="docutils literal notranslate"><span class="pre">ENOTSUP</span></code> (“not supported”):</p>
<ul class="simple">
<li><p>Toggling promiscuous mode.</p></li>
<li><p>Toggling allmulticast mode.</p></li>
<li><p>Configuring MAC addresses.</p></li>
<li><p>Configuring multicast addresses.</p></li>
<li><p>Configuring VLAN filters.</p></li>
<li><p>Configuring Rx filters through the legacy API (e.g. FDIR).</p></li>
<li><p>Configuring global RSS settings.</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">rte_flow_isolate</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">port_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">set</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>
</pre></div>
</div>
<p>Arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">port_id</span></code>: port identifier of Ethernet device.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set</span></code>: nonzero to enter isolated mode, attempt to leave it otherwise.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code>: perform verbose error reporting if not NULL. PMDs initialize
this structure in case of error only.</p></li>
</ul>
<p>Return values:</p>
<ul class="simple">
<li><p>0 on success, a negative errno value otherwise and <code class="docutils literal notranslate"><span class="pre">rte_errno</span></code> is set.</p></li>
</ul>
</div>
<div class="section" id="verbose-error-reporting">
<h2><span class="section-number">12.5. </span>Verbose error reporting</h2>
<p>The defined <em>errno</em> values may not be accurate enough for users or
application developers who want to investigate issues related to flow rules
management. A dedicated error object is defined for this purpose:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">rte_flow_error_type</span> <span class="p">{</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_NONE</span><span class="p">,</span> <span class="cm">/**&lt; No error. */</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_UNSPECIFIED</span><span class="p">,</span> <span class="cm">/**&lt; Cause unspecified. */</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_HANDLE</span><span class="p">,</span> <span class="cm">/**&lt; Flow rule (handle). */</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_ATTR_GROUP</span><span class="p">,</span> <span class="cm">/**&lt; Group field. */</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_ATTR_PRIORITY</span><span class="p">,</span> <span class="cm">/**&lt; Priority field. */</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_ATTR_INGRESS</span><span class="p">,</span> <span class="cm">/**&lt; Ingress field. */</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_ATTR_EGRESS</span><span class="p">,</span> <span class="cm">/**&lt; Egress field. */</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_ATTR</span><span class="p">,</span> <span class="cm">/**&lt; Attributes structure. */</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_ITEM_NUM</span><span class="p">,</span> <span class="cm">/**&lt; Pattern length. */</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_ITEM</span><span class="p">,</span> <span class="cm">/**&lt; Specific pattern item. */</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_ACTION_NUM</span><span class="p">,</span> <span class="cm">/**&lt; Number of actions. */</span>
    <span class="n">RTE_FLOW_ERROR_TYPE_ACTION</span><span class="p">,</span> <span class="cm">/**&lt; Specific action. */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="p">{</span>
    <span class="k">enum</span> <span class="n">rte_flow_error_type</span> <span class="n">type</span><span class="p">;</span> <span class="cm">/**&lt; Cause field and error types. */</span>
    <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">cause</span><span class="p">;</span> <span class="cm">/**&lt; Object responsible for the error. */</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">;</span> <span class="cm">/**&lt; Human-readable error message. */</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Error type <code class="docutils literal notranslate"><span class="pre">RTE_FLOW_ERROR_TYPE_NONE</span></code> stands for no error, in which case
remaining fields can be ignored. Other error types describe the type of the
object pointed by <code class="docutils literal notranslate"><span class="pre">cause</span></code>.</p>
<p>If non-NULL, <code class="docutils literal notranslate"><span class="pre">cause</span></code> points to the object responsible for the error. For a
flow rule, this may be a pattern item or an individual action.</p>
<p>If non-NULL, <code class="docutils literal notranslate"><span class="pre">message</span></code> provides a human-readable error message.</p>
<p>This object is normally allocated by applications and set by PMDs in case of
error, the message points to a constant string which does not need to be
freed by the application, however its pointer can be considered valid only
as long as its associated DPDK port remains configured. Closing the
underlying device or unloading the PMD invalidates it.</p>
</div>
<div class="section" id="helpers">
<h2><span class="section-number">12.6. </span>Helpers</h2>
<div class="section" id="error-initializer">
<h3><span class="section-number">12.6.1. </span>Error initializer</h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span>
<span class="nf">rte_flow_error_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="o">*</span><span class="n">error</span><span class="p">,</span>
                   <span class="kt">int</span> <span class="n">code</span><span class="p">,</span>
                   <span class="k">enum</span> <span class="n">rte_flow_error_type</span> <span class="n">type</span><span class="p">,</span>
                   <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">cause</span><span class="p">,</span>
                   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">);</span>
</pre></div>
</div>
<p>This function initializes <code class="docutils literal notranslate"><span class="pre">error</span></code> (if non-NULL) with the provided
parameters and sets <code class="docutils literal notranslate"><span class="pre">rte_errno</span></code> to <code class="docutils literal notranslate"><span class="pre">code</span></code>. A negative error <code class="docutils literal notranslate"><span class="pre">code</span></code> is
then returned.</p>
</div>
<div class="section" id="object-conversion">
<h3><span class="section-number">12.6.2. </span>Object conversion</h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">rte_flow_conv</span><span class="p">(</span><span class="k">enum</span> <span class="n">rte_flow_conv_op</span> <span class="n">op</span><span class="p">,</span>
              <span class="kt">void</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span>
              <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span>
              <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span>
              <span class="k">struct</span> <span class="n">rte_flow_error</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>
</pre></div>
</div>
<p>Convert <code class="docutils literal notranslate"><span class="pre">src</span></code> to <code class="docutils literal notranslate"><span class="pre">dst</span></code> according to operation <code class="docutils literal notranslate"><span class="pre">op</span></code>. Possible
operations include:</p>
<ul class="simple">
<li><p>Attributes, pattern item or action duplication.</p></li>
<li><p>Duplication of an entire pattern or list of actions.</p></li>
<li><p>Duplication of a complete flow rule description.</p></li>
<li><p>Pattern item or action name retrieval.</p></li>
</ul>
</div>
<div class="section" id="tunneled-traffic-offload">
<h3><span class="section-number">12.6.3. </span>Tunneled traffic offload</h3>
<p>rte_flow API provides the building blocks for vendor-agnostic flow
classification offloads. The rte_flow “patterns” and “actions”
primitives are fine-grained, thus enabling DPDK applications the
flexibility to offload network stacks and complex pipelines.
Applications wishing to offload tunneled traffic are required to use
the rte_flow primitives, such as group, meta, mark, tag, and others to
model their high-level objects.  The hardware model design for
high-level software objects is not trivial.  Furthermore, an optimal
design is often vendor-specific.</p>
<p>When hardware offloads tunneled traffic in multi-group logic,
partially offloaded packets may arrive to the application after they
were modified in hardware. In this case, the application may need to
restore the original packet headers. Consider the following sequence:
The application decaps a packet in one group and jumps to a second
group where it tries to match on a 5-tuple, that will miss and send
the packet to the application. In this case, the application does not
receive the original packet but a modified one. Also, in this case,
the application cannot match on the outer header fields, such as VXLAN
vni and 5-tuple.</p>
<p>There are several possible ways to use rte_flow “patterns” and
“actions” to resolve the issues above. For example:</p>
<p>1 Mapping headers to a hardware registers using the
rte_flow_action_mark/rte_flow_action_tag/rte_flow_set_meta objects.</p>
<p>2 Apply the decap only at the last offload stage after all the
“patterns” were matched and the packet will be fully offloaded.</p>
<p>Every approach has its pros and cons and is highly dependent on the
hardware vendor.  For example, some hardware may have a limited number
of registers while other hardware could not support inner actions and
must decap before accessing inner headers.</p>
<p>The tunnel offload model resolves these issues. The model goals are:</p>
<p>1 Provide a unified application API to offload tunneled traffic that
is capable to match on outer headers after decap.</p>
<p>2 Allow the application to restore the outer header of partially
offloaded packets.</p>
<p>The tunnel offload model does not introduce new elements to the
existing RTE flow model and is implemented as a set of helper
functions.</p>
<p>For the application to work with the tunnel offload API it
has to adjust flow rules in multi-table tunnel offload in the
following way:</p>
<p>1 Remove explicit call to decap action and replace it with PMD actions
obtained from rte_flow_tunnel_decap_and_set() helper.</p>
<p>2 Add PMD items obtained from rte_flow_tunnel_match() helper to all
other rules in the tunnel offload sequence.</p>
<p>The model requirements:</p>
<p>Software application must initialize
rte_tunnel object with tunnel parameters before calling
rte_flow_tunnel_decap_set() &amp; rte_flow_tunnel_match().</p>
<p>PMD actions array obtained in rte_flow_tunnel_decap_set() must be
released by application with rte_flow_action_release() call.</p>
<p>PMD items array obtained with rte_flow_tunnel_match() must be released
by application with rte_flow_item_release() call.  Application can
release PMD items and actions after rule was created. However, if the
application needs to create additional rule for the same tunnel it
will need to obtain PMD items again.</p>
<p>Application cannot destroy rte_tunnel object before it releases all
PMD actions &amp; PMD items referencing that tunnel.</p>
</div>
</div>
<div class="section" id="caveats">
<h2><span class="section-number">12.7. </span>Caveats</h2>
<ul class="simple">
<li><p>DPDK does not keep track of flow rules definitions or flow rule objects
automatically. Applications may keep track of the former and must keep
track of the latter. PMDs may also do it for internal needs, however this
must not be relied on by applications.</p></li>
<li><p>Flow rules are not maintained between successive port initializations. An
application exiting without releasing them and restarting must re-create
them from scratch.</p></li>
<li><p>API operations are synchronous and blocking (<code class="docutils literal notranslate"><span class="pre">EAGAIN</span></code> cannot be
returned).</p></li>
<li><p>Stopping the data path (TX/RX) should not be necessary when managing flow
rules. If this cannot be achieved naturally or with workarounds (such as
temporarily replacing the burst function pointers), an appropriate error
code must be returned (<code class="docutils literal notranslate"><span class="pre">EBUSY</span></code>).</p></li>
<li><p>Applications, not PMDs, are responsible for maintaining flow rules
configuration when closing, stopping or restarting a port or performing other
actions which may affect them.
Applications must assume that after port close, stop or restart all flows
related to that port are not valid, hardware rules are destroyed and relevant
PMD resources are released.</p></li>
</ul>
<p>For devices exposing multiple ports sharing global settings affected by flow
rules:</p>
<ul class="simple">
<li><p>All ports under DPDK control must behave consistently, PMDs are
responsible for making sure that existing flow rules on a port are not
affected by other ports.</p></li>
<li><p>Ports not under DPDK control (unaffected or handled by other applications)
are user’s responsibility. They may affect existing flow rules and cause
undefined behavior. PMDs aware of this may prevent flow rules creation
altogether in such cases.</p></li>
</ul>
</div>
<div class="section" id="pmd-interface">
<h2><span class="section-number">12.8. </span>PMD interface</h2>
<p>The PMD interface is defined in <code class="docutils literal notranslate"><span class="pre">rte_flow_driver.h</span></code>. It is not subject to
API/ABI versioning constraints as it is not exposed to applications and may
evolve independently.</p>
<p>It is currently implemented on top of the legacy filtering framework through
filter type <em>RTE_ETH_FILTER_GENERIC</em> that accepts the single operation
<em>RTE_ETH_FILTER_GET</em> to return PMD-specific <em>rte_flow</em> callbacks wrapped
inside <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_flow_ops</span></code>.</p>
<p>This overhead is temporarily necessary in order to keep compatibility with
the legacy filtering framework, which should eventually disappear.</p>
<ul class="simple">
<li><p>PMD callbacks implement exactly the interface described in <a class="reference internal" href="#rules-management">Rules
management</a>, except for the port ID argument which has already been
converted to a pointer to the underlying <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">rte_eth_dev</span></code>.</p></li>
<li><p>Public API functions do not process flow rules definitions at all before
calling PMD functions (no basic error checking, no validation
whatsoever). They only make sure these callbacks are non-NULL or return
the <code class="docutils literal notranslate"><span class="pre">ENOSYS</span></code> (function not supported) error.</p></li>
</ul>
<p>This interface additionally defines the following helper function:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rte_flow_ops_get()</span></code>: get generic flow operations structure from a
port.</p></li>
</ul>
<p>If PMD interfaces don’t support re-entrancy/multi-thread safety,
the rte_flow API functions will protect threads by mutex per port.
The application can check whether <code class="docutils literal notranslate"><span class="pre">RTE_ETH_DEV_FLOW_OPS_THREAD_SAFE</span></code>
is set in <code class="docutils literal notranslate"><span class="pre">dev_flags</span></code>, meaning the PMD is thread-safe regarding rte_flow,
so the API level protection is disabled.
Please note that this API-level mutex protects only rte_flow functions,
other control path functions are not in scope.</p>
<p>More will be added over time.</p>
</div>
<div class="section" id="device-compatibility">
<h2><span class="section-number">12.9. </span>Device compatibility</h2>
<p>No known implementation supports all the described features.</p>
<p>Unsupported features or combinations are not expected to be fully emulated
in software by PMDs for performance reasons. Partially supported features
may be completed in software as long as hardware performs most of the work
(such as queue redirection and packet recognition).</p>
<p>However PMDs are expected to do their best to satisfy application requests
by working around hardware limitations as long as doing so does not affect
the behavior of existing flow rules.</p>
<p>The following sections provide a few examples of such cases and describe how
PMDs should handle them, they are based on limitations built into the
previous APIs.</p>
<div class="section" id="global-bit-masks">
<h3><span class="section-number">12.9.1. </span>Global bit-masks</h3>
<p>Each flow rule comes with its own, per-layer bit-masks, while hardware may
support only a single, device-wide bit-mask for a given layer type, so that
two IPv4 rules cannot use different bit-masks.</p>
<p>The expected behavior in this case is that PMDs automatically configure
global bit-masks according to the needs of the first flow rule created.</p>
<p>Subsequent rules are allowed only if their bit-masks match those, the
<code class="docutils literal notranslate"><span class="pre">EEXIST</span></code> error code should be returned otherwise.</p>
</div>
<div class="section" id="unsupported-layer-types">
<h3><span class="section-number">12.9.2. </span>Unsupported layer types</h3>
<p>Many protocols can be simulated by crafting patterns with the <a class="reference internal" href="#item-raw">Item: RAW</a>
type.</p>
<p>PMDs can rely on this capability to simulate support for protocols with
headers not directly recognized by hardware.</p>
</div>
<div class="section" id="any-pattern-item">
<h3><span class="section-number">12.9.3. </span><code class="docutils literal notranslate"><span class="pre">ANY</span></code> pattern item</h3>
<p>This pattern item stands for anything, which can be difficult to translate
to something hardware would understand, particularly if followed by more
specific types.</p>
<p>Consider the following pattern:</p>
<span id="table-rte-flow-unsupported-any"></span><table class="docutils align-default" id="id89">
<caption><span class="caption-number">Table 12.87 </span><span class="caption-text">Pattern with ANY as L3</span></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 18%" />
<col style="width: 32%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head" colspan="3"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td colspan="3"><p>ETHER</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>ANY</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">num</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td colspan="3"><p>TCP</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td colspan="3"><p>END</p></td>
</tr>
</tbody>
</table>
<p>Knowing that TCP does not make sense with something other than IPv4 and IPv6
as L3, such a pattern may be translated to two flow rules instead:</p>
<span id="table-rte-flow-unsupported-any-ipv4"></span><table class="docutils align-default" id="id90">
<caption><span class="caption-number">Table 12.88 </span><span class="caption-text">ANY replaced with IPV4</span></caption>
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>ETHER</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>IPV4 (zeroed mask)</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>TCP</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<span id="table-rte-flow-unsupported-any-ipv6"></span><table class="docutils align-default" id="id91">
<caption><span class="caption-number">Table 12.89 </span><span class="caption-text">ANY replaced with IPV6</span></caption>
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Item</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>ETHER</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>IPV6 (zeroed mask)</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>TCP</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>END</p></td>
</tr>
</tbody>
</table>
<p>Note that as soon as a ANY rule covers several layers, this approach may
yield a large number of hidden flow rules. It is thus suggested to only
support the most common scenarios (anything as L2 and/or L3).</p>
</div>
<div class="section" id="unsupported-actions">
<h3><span class="section-number">12.9.4. </span>Unsupported actions</h3>
<ul class="simple">
<li><p>When combined with <a class="reference internal" href="#action-queue">Action: QUEUE</a>, packet counting (<a class="reference internal" href="#action-count">Action: COUNT</a>)
and tagging (<a class="reference internal" href="#action-mark">Action: MARK</a> or <a class="reference internal" href="#action-flag">Action: FLAG</a>) may be implemented in
software as long as the target queue is used by a single rule.</p></li>
<li><p>When a single target queue is provided, <a class="reference internal" href="#action-rss">Action: RSS</a> can also be
implemented through <a class="reference internal" href="#action-queue">Action: QUEUE</a>.</p></li>
</ul>
</div>
<div class="section" id="flow-rules-priority">
<h3><span class="section-number">12.9.5. </span>Flow rules priority</h3>
<p>While it would naturally make sense, flow rules cannot be assumed to be
processed by hardware in the same order as their creation for several
reasons:</p>
<ul class="simple">
<li><p>They may be managed internally as a tree or a hash table instead of a
list.</p></li>
<li><p>Removing a flow rule before adding another one can either put the new rule
at the end of the list or reuse a freed entry.</p></li>
<li><p>Duplication may occur when packets are matched by several rules.</p></li>
</ul>
<p>For overlapping rules (particularly in order to use <a class="reference internal" href="#action-passthru">Action: PASSTHRU</a>)
predictable behavior is only guaranteed by using different priority levels.</p>
<p>Priority levels are not necessarily implemented in hardware, or may be
severely limited (e.g. a single priority bit).</p>
<p>For these reasons, priority levels may be implemented purely in software by
PMDs.</p>
<ul class="simple">
<li><p>For devices expecting flow rules to be added in the correct order, PMDs
may destroy and re-create existing rules after adding a new one with
a higher priority.</p></li>
<li><p>A configurable number of dummy or empty rules can be created at
initialization time to save high priority slots for later.</p></li>
<li><p>In order to save priority levels, PMDs may evaluate whether rules are
likely to collide and adjust their priority accordingly.</p></li>
</ul>
</div>
</div>
<div class="section" id="future-evolutions">
<h2><span class="section-number">12.10. </span>Future evolutions</h2>
<ul class="simple">
<li><p>A device profile selection function which could be used to force a
permanent profile instead of relying on its automatic configuration based
on existing flow rules.</p></li>
<li><p>A method to optimize <em>rte_flow</em> rules with specific pattern items and
action types generated on the fly by PMDs. DPDK should assign negative
numbers to these in order to not collide with the existing types. See
<a class="reference internal" href="#negative-types">Negative types</a>.</p></li>
<li><p>Adding specific egress pattern items and actions as described in
<a class="reference internal" href="#attribute-traffic-direction">Attribute: Traffic direction</a>.</p></li>
<li><p>Optional software fallback when PMDs are unable to handle requested flow
rules so applications do not have to implement their own.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="switch_representation.html" class="btn btn-neutral float-right" title="13. Switch Representation within DPDK Applications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="poll_mode_drv.html" class="btn btn-neutral float-left" title="11. Poll Mode Driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>