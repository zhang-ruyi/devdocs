

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>8. Enabling Additional Functionality &mdash; Data Plane Development Kit 20.11.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. How to get best performance with NICs on Intel platforms" href="nic_perf_intel_platform.html" />
    <link rel="prev" title="7. EAL parameters" href="linux_eal_parameters.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Data Plane Development Kit
          

          
            
            <img src="../_static/DPDK_logo_vertical_rev_small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                20.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started Guide for Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="sys_reqs.html">2. System Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_dpdk.html">3. Compiling the DPDK Target from Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="cross_build_dpdk_for_arm64.html">4. Cross compile DPDK for ARM64</a></li>
<li class="toctree-l2"><a class="reference internal" href="linux_drivers.html">5. Linux Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_sample_apps.html">6. Running Sample Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="linux_eal_parameters.html">7. EAL parameters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8. Enabling Additional Functionality</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#high-precision-event-timer-hpet-functionality">8.1. High Precision Event Timer (HPET) Functionality</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bios-support">8.1.1. BIOS Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linux-kernel-support">8.1.2. Linux Kernel Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enabling-hpet-in-the-dpdk">8.1.3. Enabling HPET in the DPDK</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#running-dpdk-applications-without-root-privileges">8.2. Running DPDK Applications Without Root Privileges</a></li>
<li class="toctree-l3"><a class="reference internal" href="#power-management-and-power-saving-functionality">8.3. Power Management and Power Saving Functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-linux-core-isolation-to-reduce-context-switches">8.4. Using Linux Core Isolation to Reduce Context Switches</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-the-dpdk-kni-kernel-module">8.5. Loading the DPDK KNI Kernel Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-linux-iommu-pass-through-to-run-dpdk-with-intel-vt-d">8.6. Using Linux IOMMU Pass-Through to Run DPDK with Intel® VT-d</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="nic_perf_intel_platform.html">9. How to get best performance with NICs on Intel platforms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prog_guide/index.html">Programmer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nics/index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor’s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Data Plane Development Kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Getting Started Guide for Linux</a> &raquo;</li>
        
      <li><span class="section-number">8. </span>Enabling Additional Functionality</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/linux_gsg/enable_func.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="enabling-additional-functionality">
<span id="id1"></span><h1><span class="section-number">8. </span>Enabling Additional Functionality</h1>
<div class="section" id="high-precision-event-timer-hpet-functionality">
<span id="high-precision-event-timer"></span><h2><span class="section-number">8.1. </span>High Precision Event Timer (HPET) Functionality</h2>
<div class="section" id="bios-support">
<h3><span class="section-number">8.1.1. </span>BIOS Support</h3>
<p>The High Precision Timer (HPET) must be enabled in the platform BIOS if the HPET is to be used.
Otherwise, the Time Stamp Counter (TSC) is used by default.
The BIOS is typically accessed by pressing F2 while the platform is starting up.
The user can then navigate to the HPET option. On the Crystal Forest platform BIOS, the path is:
<strong>Advanced -&gt; PCH-IO Configuration -&gt; High Precision Timer -&gt;</strong> (Change from Disabled to Enabled if necessary).</p>
<p>On a system that has already booted, the following command can be issued to check if HPET is enabled:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>grep hpet /proc/timer_list
</pre></div>
</div>
<p>If no entries are returned, HPET must be enabled in the BIOS (as per the instructions above) and the system rebooted.</p>
</div>
<div class="section" id="linux-kernel-support">
<h3><span class="section-number">8.1.2. </span>Linux Kernel Support</h3>
<p>The DPDK makes use of the platform HPET timer by mapping the timer counter into the process address space, and as such,
requires that the <code class="docutils literal notranslate"><span class="pre">HPET_MMAP</span></code> kernel configuration option be enabled.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>On Fedora, and other common distributions such as Ubuntu, the <code class="docutils literal notranslate"><span class="pre">HPET_MMAP</span></code> kernel option is not enabled by default.
To recompile the Linux kernel with this option enabled, please consult the distributions documentation for the relevant instructions.</p>
</div>
</div>
<div class="section" id="enabling-hpet-in-the-dpdk">
<h3><span class="section-number">8.1.3. </span>Enabling HPET in the DPDK</h3>
<p>By default, HPET support is disabled in the DPDK build configuration files.
To use HPET, use the following meson build option which will enable the HPET settings at compile time:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>meson configure -Duse_hpet=true
</pre></div>
</div>
<p>For an application to use the <code class="docutils literal notranslate"><span class="pre">rte_get_hpet_cycles()</span></code> and <code class="docutils literal notranslate"><span class="pre">rte_get_hpet_hz()</span></code> API calls,
and optionally to make the HPET the default time source for the rte_timer library,
the new <code class="docutils literal notranslate"><span class="pre">rte_eal_hpet_init()</span></code> API call should be called at application initialization.
This API call will ensure that the HPET is accessible, returning an error to the application if it is not,
for example, if <code class="docutils literal notranslate"><span class="pre">HPET_MMAP</span></code> is not enabled in the kernel.
The application can then determine what action to take, if any, if the HPET is not available at run-time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For applications that require timing APIs, but not the HPET timer specifically,
it is recommended that the <code class="docutils literal notranslate"><span class="pre">rte_get_timer_cycles()</span></code> and <code class="docutils literal notranslate"><span class="pre">rte_get_timer_hz()</span></code> API calls be used instead of the HPET-specific APIs.
These generic APIs can work with either TSC or HPET time sources, depending on what is requested by an application call to <code class="docutils literal notranslate"><span class="pre">rte_eal_hpet_init()</span></code>,
if any, and on what is available on the system at runtime.</p>
</div>
</div>
</div>
<div class="section" id="running-dpdk-applications-without-root-privileges">
<span id="running-without-root-privileges"></span><h2><span class="section-number">8.2. </span>Running DPDK Applications Without Root Privileges</h2>
<p>In order to run DPDK as non-root, the following Linux filesystem objects’
permissions should be adjusted to ensure that the Linux account being used to
run the DPDK application has access to them:</p>
<ul class="simple">
<li><p>All directories which serve as hugepage mount points, for example, <code class="docutils literal notranslate"><span class="pre">/dev/hugepages</span></code></p></li>
<li><p>If the HPET is to be used,  <code class="docutils literal notranslate"><span class="pre">/dev/hpet</span></code></p></li>
</ul>
<p>When running as non-root user, there may be some additional resource limits
that are imposed by the system. Specifically, the following resource limits may
need to be adjusted in order to ensure normal DPDK operation:</p>
<ul class="simple">
<li><p>RLIMIT_LOCKS (number of file locks that can be held by a process)</p></li>
<li><p>RLIMIT_NOFILE (number of open file descriptors that can be held open by a process)</p></li>
<li><p>RLIMIT_MEMLOCK (amount of pinned pages the process is allowed to have)</p></li>
</ul>
<p>The above limits can usually be adjusted by editing
<code class="docutils literal notranslate"><span class="pre">/etc/security/limits.conf</span></code> file, and rebooting.</p>
<p>Additionally, depending on which kernel driver is in use, the relevant
resources also should be accessible by the user running the DPDK application.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">vfio-pci</span></code> kernel driver, the following Linux file system objects’
permissions should be adjusted:</p>
<ul class="simple">
<li><p>The VFIO device file, <code class="docutils literal notranslate"><span class="pre">/dev/vfio/vfio</span></code></p></li>
<li><p>The directories under <code class="docutils literal notranslate"><span class="pre">/dev/vfio</span></code> that correspond to IOMMU group numbers of
devices intended to be used by DPDK, for example, <code class="docutils literal notranslate"><span class="pre">/dev/vfio/50</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The instructions below will allow running DPDK with <code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> or
<code class="docutils literal notranslate"><span class="pre">uio_pci_generic</span></code> drivers as non-root with older Linux kernel versions.
However, since version 4.0, the kernel does not allow unprivileged processes
to read the physical address information from the pagemaps file, making it
impossible for those processes to be used by non-privileged users. In such
cases, using the VFIO driver is recommended.</p>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> or <code class="docutils literal notranslate"><span class="pre">uio_pci_generic</span></code> kernel drivers, the following Linux file
system objects’ permissions should be adjusted:</p>
<ul>
<li><p>The userspace-io device files in  <code class="docutils literal notranslate"><span class="pre">/dev</span></code>, for example,  <code class="docutils literal notranslate"><span class="pre">/dev/uio0</span></code>, <code class="docutils literal notranslate"><span class="pre">/dev/uio1</span></code>, and so on</p></li>
<li><p>The userspace-io sysfs config and resource files, for example for <code class="docutils literal notranslate"><span class="pre">uio0</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/class/uio/uio0/device/config
/sys/class/uio/uio0/device/resource*
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="power-management-and-power-saving-functionality">
<h2><span class="section-number">8.3. </span>Power Management and Power Saving Functionality</h2>
<p>Enhanced Intel SpeedStep® Technology must be enabled in the platform BIOS if the power management feature of DPDK is to be used.
Otherwise, the sys file folder <code class="docutils literal notranslate"><span class="pre">/sys/devices/system/cpu/cpu0/cpufreq</span></code> will not exist, and the CPU frequency- based power management cannot be used.
Consult the relevant BIOS documentation to determine how these settings can be accessed.</p>
<p>For example, on some Intel reference platform BIOS variants, the path to Enhanced Intel SpeedStep® Technology is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Advanced
  -&gt; Processor Configuration
  -&gt; Enhanced Intel SpeedStep® Tech
</pre></div>
</div>
<p>In addition, C3 and C6 should be enabled as well for power management. The path of C3 and C6 on the same platform BIOS is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Advanced
  -&gt; Processor Configuration
  -&gt; Processor C3 Advanced
  -&gt; Processor Configuration
  -&gt; Processor C6
</pre></div>
</div>
</div>
<div class="section" id="using-linux-core-isolation-to-reduce-context-switches">
<h2><span class="section-number">8.4. </span>Using Linux Core Isolation to Reduce Context Switches</h2>
<p>While the threads used by a DPDK application are pinned to logical cores on the system,
it is possible for the Linux scheduler to run other tasks on those cores also.
To help prevent additional workloads from running on those cores,
it is possible to use the <code class="docutils literal notranslate"><span class="pre">isolcpus</span></code> Linux kernel parameter to isolate them from the general Linux scheduler.</p>
<p>For example, if DPDK applications are to run on logical cores 2, 4 and 6,
the following should be added to the kernel parameter list:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">isolcpus=2,4,6</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-the-dpdk-kni-kernel-module">
<h2><span class="section-number">8.5. </span>Loading the DPDK KNI Kernel Module</h2>
<p>To run the DPDK Kernel NIC Interface (KNI) sample application, an extra kernel module (the kni module) must be loaded into the running kernel.
The module is found in the kernel/linux sub-directory of the DPDK build directory.
It should be loaded using the insmod command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>insmod &lt;build_dir&gt;/kernel/linux/kni/rte_kni.ko
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the “Kernel NIC Interface Sample Application” chapter in the <em>DPDK Sample Applications User Guide</em> for more details.</p>
</div>
</div>
<div class="section" id="using-linux-iommu-pass-through-to-run-dpdk-with-intel-vt-d">
<h2><span class="section-number">8.6. </span>Using Linux IOMMU Pass-Through to Run DPDK with Intel® VT-d</h2>
<p>To enable Intel® VT-d in a Linux kernel, a number of kernel configuration options must be set. These include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IOMMU_SUPPORT</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IOMMU_API</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INTEL_IOMMU</span></code></p></li>
</ul>
<p>In addition, to run the DPDK with Intel® VT-d, the <code class="docutils literal notranslate"><span class="pre">iommu=pt</span></code> kernel parameter must be used when using <code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> driver.
This results in pass-through of the DMAR (DMA Remapping) lookup in the host.
Also, if <code class="docutils literal notranslate"><span class="pre">INTEL_IOMMU_DEFAULT_ON</span></code> is not set in the kernel, the <code class="docutils literal notranslate"><span class="pre">intel_iommu=on</span></code> kernel parameter must be used too.
This ensures that the Intel IOMMU is being initialized as expected.</p>
<p>Please note that while using <code class="docutils literal notranslate"><span class="pre">iommu=pt</span></code> is compulsory for <code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> driver,
the <code class="docutils literal notranslate"><span class="pre">vfio-pci</span></code> driver can actually work with both <code class="docutils literal notranslate"><span class="pre">iommu=pt</span></code> and <code class="docutils literal notranslate"><span class="pre">iommu=on</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="nic_perf_intel_platform.html" class="btn btn-neutral float-right" title="9. How to get best performance with NICs on Intel platforms" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="linux_eal_parameters.html" class="btn btn-neutral float-left" title="7. EAL parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>