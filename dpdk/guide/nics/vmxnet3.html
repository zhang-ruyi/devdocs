

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>54. Poll Mode Driver for Paravirtual VMXNET3 NIC &mdash; Data Plane Development Kit 20.11.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="55. Libpcap and Ring Based Poll Mode Drivers" href="pcap_ring.html" />
    <link rel="prev" title="53. Poll Mode Driver that wraps vhost library" href="vhost.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Data Plane Development Kit
          

          
            
            <img src="../_static/DPDK_logo_vertical_rev_small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                20.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prog_guide/index.html">Programmer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Network Interface Controller Drivers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">1. Overview of Networking Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html">2. Features Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_and_test.html">3. Compiling and testing a PMD for a NIC</a></li>
<li class="toctree-l2"><a class="reference internal" href="af_packet.html">4. AF_PACKET Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="af_xdp.html">5. AF_XDP Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ark.html">6. ARK Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="atlantic.html">7. Aquantia Atlantic DPDK Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="avp.html">8. AVP Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="axgbe.html">9. AXGBE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="bnx2x.html">10. BNX2X Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="bnxt.html">11. BNXT Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxgbe.html">12. CXGBE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="dpaa.html">13. DPAA Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="dpaa2.html">14. DPAA2 Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="e1000em.html">15. Driver for VM Emulated Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="ena.html">16. ENA Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="enetc.html">17. ENETC Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="enic.html">18. ENIC Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="fm10k.html">19. FM10K Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="hinic.html">20. HINIC Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="hns3.html">21. HNS3 Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="i40e.html">22. I40E Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ice.html">23. ICE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="igb.html">24. IGB Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="igc.html">25. IGC Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ionic.html">26. IONIC Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipn3ke.html">27. IPN3KE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ixgbe.html">28. IXGBE Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="intel_vf.html">29. Intel Virtual Function Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="kni.html">30. KNI Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="liquidio.html">31. LiquidIO VF Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="memif.html">32. Memif Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlx4.html">33. MLX4 poll mode driver library</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlx5.html">34. MLX5 poll mode driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="mvneta.html">35. MVNETA Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="mvpp2.html">36. MVPP2 Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="netvsc.html">37. Netvsc poll mode driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfb.html">38. NFB poll mode driver library</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfp.html">39. NFP poll mode driver library</a></li>
<li class="toctree-l2"><a class="reference internal" href="null.html">40. NULL Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="octeontx.html">41. OCTEON TX Poll Mode driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="octeontx2.html">42. OCTEON TX2 Poll Mode driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="pfe.html">43. PFE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="qede.html">44. QEDE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfc_efx.html">45. Solarflare libefx-based Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="softnic.html">46. Soft NIC Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="szedata2.html">47. SZEDATA2 poll mode driver library</a></li>
<li class="toctree-l2"><a class="reference internal" href="tap.html">48. Tun|Tap Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="thunderx.html">49. ThunderX NICVF Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="txgbe.html">50. TXGBE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="vdev_netvsc.html">51. VDEV_NETVSC driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtio.html">52. Poll Mode Driver for Emulated Virtio NIC</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhost.html">53. Poll Mode Driver that wraps vhost library</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">54. Poll Mode Driver for Paravirtual VMXNET3 NIC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vmxnet3-implementation-in-the-dpdk">54.1. VMXNET3 Implementation in the DPDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features-and-limitations-of-vmxnet3-pmd">54.2. Features and Limitations of VMXNET3 PMD</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">54.3. Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vmxnet3-with-a-native-nic-connected-to-a-vswitch">54.4. VMXNET3 with a Native NIC Connected to a vSwitch</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vmxnet3-chaining-vms-connected-to-a-vswitch">54.5. VMXNET3 Chaining VMs Connected to a vSwitch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pcap_ring.html">55. Libpcap and Ring Based Poll Mode Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="fail_safe.html">56. Fail-safe poll mode driver library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor’s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Data Plane Development Kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Network Interface Controller Drivers</a> &raquo;</li>
        
      <li><span class="section-number">54. </span>Poll Mode Driver for Paravirtual VMXNET3 NIC</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/nics/vmxnet3.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="poll-mode-driver-for-paravirtual-vmxnet3-nic">
<h1><span class="section-number">54. </span>Poll Mode Driver for Paravirtual VMXNET3 NIC</h1>
<p>The VMXNET3 adapter is the next generation of a paravirtualized NIC, introduced by VMware* ESXi.
It is designed for performance, offers all the features available in VMXNET2, and adds several new features such as,
multi-queue support (also known as Receive Side Scaling, RSS),
IPv6 offloads, and MSI/MSI-X interrupt delivery.
One can use the same device in a DPDK application with VMXNET3 PMD introduced in DPDK API.</p>
<p>In this chapter, two setups with the use of the VMXNET3 PMD are demonstrated:</p>
<ol class="arabic simple">
<li><p>Vmxnet3 with a native NIC connected to a vSwitch</p></li>
<li><p>Vmxnet3 chaining VMs connected to a vSwitch</p></li>
</ol>
<div class="section" id="vmxnet3-implementation-in-the-dpdk">
<h2><span class="section-number">54.1. </span>VMXNET3 Implementation in the DPDK</h2>
<p>For details on the VMXNET3 device, refer to the VMXNET3 driver’s vmxnet3 directory and support manual from VMware*.</p>
<p>For performance details, refer to the following link from VMware:</p>
<p><a class="reference external" href="http://www.vmware.com/pdf/vsp_4_vmxnet3_perf.pdf">http://www.vmware.com/pdf/vsp_4_vmxnet3_perf.pdf</a></p>
<p>As a PMD, the VMXNET3 driver provides the packet reception and transmission callbacks, vmxnet3_recv_pkts and vmxnet3_xmit_pkts.</p>
<p>The VMXNET3 PMD handles all the packet buffer memory allocation and resides in guest address space
and it is solely responsible to free that memory when not needed.
The packet buffers and features to be supported are made available to hypervisor via VMXNET3 PCI configuration space BARs.
During RX/TX, the packet buffers are exchanged by their GPAs,
and the hypervisor loads the buffers with packets in the RX case and sends packets to vSwitch in the TX case.</p>
<p>The VMXNET3 PMD is compiled with vmxnet3 device headers.
The interface is similar to that of the other PMDs available in the DPDK API.
The driver pre-allocates the packet buffers and loads the command ring descriptors in advance.
The hypervisor fills those packet buffers on packet arrival and write completion ring descriptors,
which are eventually pulled by the PMD.
After reception, the DPDK application frees the descriptors and loads new packet buffers for the coming packets.
The interrupts are disabled and there is no notification required.
This keeps performance up on the RX side, even though the device provides a notification feature.</p>
<p>In the transmit routine, the DPDK application fills packet buffer pointers in the descriptors of the command ring
and notifies the hypervisor.
In response the hypervisor takes packets and passes them to the vSwitch, It writes into the completion descriptors ring.
The rings are read by the PMD in the next transmit routine call and the buffers and descriptors are freed from memory.</p>
</div>
<div class="section" id="features-and-limitations-of-vmxnet3-pmd">
<h2><span class="section-number">54.2. </span>Features and Limitations of VMXNET3 PMD</h2>
<p>In release 1.6.0, the VMXNET3 PMD provides the basic functionality of packet reception and transmission.
There are several options available for filtering packets at VMXNET3 device level including:</p>
<ol class="arabic simple">
<li><p>MAC Address based filtering:</p>
<ul class="simple">
<li><p>Unicast, Broadcast, All Multicast modes - SUPPORTED BY DEFAULT</p></li>
<li><p>Multicast with Multicast Filter table - NOT SUPPORTED</p></li>
<li><p>Promiscuous mode - SUPPORTED</p></li>
<li><p>RSS based load balancing between queues - SUPPORTED</p></li>
</ul>
</li>
<li><p>VLAN filtering:</p>
<ul class="simple">
<li><p>VLAN tag based filtering without load balancing - SUPPORTED</p></li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Release 1.6.0 does not support separate headers and body receive cmd_ring and hence,
multiple segment buffers are not supported.
Only cmd_ring_0 is used for packet buffers, one for each descriptor.</p></li>
<li><p>Receive and transmit of scattered packets is not supported.</p></li>
<li><p>Multicast with Multicast Filter table is not supported.</p></li>
</ul>
</div>
</div>
<div class="section" id="prerequisites">
<h2><span class="section-number">54.3. </span>Prerequisites</h2>
<p>The following prerequisites apply:</p>
<ul class="simple">
<li><p>Before starting a VM, a VMXNET3 interface to a VM through VMware vSphere Client must be assigned.
This is shown in the figure below.</p></li>
</ul>
<div class="figure align-default" id="id1">
<span id="figure-vmxnet3-int"></span><img alt="../_images/vmxnet3_int.png" src="../_images/vmxnet3_int.png" />
<p class="caption"><span class="caption-number">Fig. 54.1 </span><span class="caption-text">Assigning a VMXNET3 interface to a VM using VMware vSphere Client</span></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depending on the Virtual Machine type, the VMware vSphere Client shows Ethernet adaptors while adding an Ethernet device.
Ensure that the VM type used offers a VMXNET3 device. Refer to the VMware documentation for a listed of VMs.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Follow the <em>DPDK Getting Started Guide</em> to setup the basic DPDK environment.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Follow the <em>DPDK Sample Application’s User Guide</em>, L2 Forwarding/L3 Forwarding and
TestPMD for instructions on how to run a DPDK application using an assigned VMXNET3 device.</p>
</div>
</div>
<div class="section" id="vmxnet3-with-a-native-nic-connected-to-a-vswitch">
<h2><span class="section-number">54.4. </span>VMXNET3 with a Native NIC Connected to a vSwitch</h2>
<p>This section describes an example setup for Phy-vSwitch-VM-Phy communication.</p>
<div class="figure align-default" id="id2">
<span id="figure-vswitch-vm"></span><img alt="../_images/vswitch_vm.png" src="../_images/vswitch_vm.png" />
<p class="caption"><span class="caption-number">Fig. 54.2 </span><span class="caption-text">VMXNET3 with a Native NIC Connected to a vSwitch</span></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Other instructions on preparing to use DPDK such as, hugepage enabling, uio port binding are not listed here.
Please refer to <em>DPDK Getting Started Guide and DPDK Sample Application’s User Guide</em> for detailed instructions.</p>
</div>
<p>The packet reception and transmission flow path is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Packet generator -&gt; 82576
                 -&gt; VMware ESXi vSwitch
                 -&gt; VMXNET3 device
                 -&gt; Guest VM VMXNET3 port 0 rx burst
                 -&gt; Guest VM 82599 VF port 0 tx burst
                 -&gt; 82599 VF
                 -&gt; Packet generator
</pre></div>
</div>
</div>
<div class="section" id="vmxnet3-chaining-vms-connected-to-a-vswitch">
<h2><span class="section-number">54.5. </span>VMXNET3 Chaining VMs Connected to a vSwitch</h2>
<p>The following figure shows an example VM-to-VM communication over a Phy-VM-vSwitch-VM-Phy communication channel.</p>
<div class="figure align-default" id="id3">
<span id="figure-vm-vm-comms"></span><img alt="../_images/vm_vm_comms.png" src="../_images/vm_vm_comms.png" />
<p class="caption"><span class="caption-number">Fig. 54.3 </span><span class="caption-text">VMXNET3 Chaining VMs Connected to a vSwitch</span></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using the L2 Forwarding or L3 Forwarding applications,
a destination MAC address needs to be written in packets to hit the other VM’s VMXNET3 interface.</p>
</div>
<p>In this example, the packet flow path is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Packet generator -&gt; 82599 VF
                 -&gt; Guest VM 82599 port 0 rx burst
                 -&gt; Guest VM VMXNET3 port 1 tx burst
                 -&gt; VMXNET3 device
                 -&gt; VMware ESXi vSwitch
                 -&gt; VMXNET3 device
                 -&gt; Guest VM VMXNET3 port 0 rx burst
                 -&gt; Guest VM 82599 VF port 1 tx burst
                 -&gt; 82599 VF
                 -&gt; Packet generator
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="pcap_ring.html" class="btn btn-neutral float-right" title="55. Libpcap and Ring Based Poll Mode Drivers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="vhost.html" class="btn btn-neutral float-left" title="53. Poll Mode Driver that wraps vhost library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>