

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>16. ENA Poll Mode Driver &mdash; Data Plane Development Kit 20.11.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="17. ENETC Poll Mode Driver" href="enetc.html" />
    <link rel="prev" title="15. Driver for VM Emulated Devices" href="e1000em.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Data Plane Development Kit
          

          
            
            <img src="../_static/DPDK_logo_vertical_rev_small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                20.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../linux_gsg/index.html">Getting Started Guide for Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows_gsg/index.html">Getting Started Guide for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prog_guide/index.html">Programmer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/index.html">HowTo Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">DPDK Tools User Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Network Interface Controller Drivers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">1. Overview of Networking Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="features.html">2. Features Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_and_test.html">3. Compiling and testing a PMD for a NIC</a></li>
<li class="toctree-l2"><a class="reference internal" href="af_packet.html">4. AF_PACKET Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="af_xdp.html">5. AF_XDP Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ark.html">6. ARK Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="atlantic.html">7. Aquantia Atlantic DPDK Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="avp.html">8. AVP Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="axgbe.html">9. AXGBE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="bnx2x.html">10. BNX2X Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="bnxt.html">11. BNXT Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="cxgbe.html">12. CXGBE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="dpaa.html">13. DPAA Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="dpaa2.html">14. DPAA2 Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="e1000em.html">15. Driver for VM Emulated Devices</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">16. ENA Poll Mode Driver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">16.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#management-interface">16.2. Management Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-path-interface">16.3. Data Path Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-information">16.4. Configuration information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-dpdk">16.5. Building DPDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="#supported-ena-adapters">16.6. Supported ENA adapters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#supported-operating-systems">16.7. Supported Operating Systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="#supported-features">16.8. Supported features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">16.9. Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage-example">16.10. Usage example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="enetc.html">17. ENETC Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="enic.html">18. ENIC Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="fm10k.html">19. FM10K Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="hinic.html">20. HINIC Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="hns3.html">21. HNS3 Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="i40e.html">22. I40E Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ice.html">23. ICE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="igb.html">24. IGB Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="igc.html">25. IGC Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ionic.html">26. IONIC Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipn3ke.html">27. IPN3KE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ixgbe.html">28. IXGBE Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="intel_vf.html">29. Intel Virtual Function Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="kni.html">30. KNI Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="liquidio.html">31. LiquidIO VF Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="memif.html">32. Memif Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlx4.html">33. MLX4 poll mode driver library</a></li>
<li class="toctree-l2"><a class="reference internal" href="mlx5.html">34. MLX5 poll mode driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="mvneta.html">35. MVNETA Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="mvpp2.html">36. MVPP2 Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="netvsc.html">37. Netvsc poll mode driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfb.html">38. NFB poll mode driver library</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfp.html">39. NFP poll mode driver library</a></li>
<li class="toctree-l2"><a class="reference internal" href="null.html">40. NULL Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="octeontx.html">41. OCTEON TX Poll Mode driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="octeontx2.html">42. OCTEON TX2 Poll Mode driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="pfe.html">43. PFE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="qede.html">44. QEDE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfc_efx.html">45. Solarflare libefx-based Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="softnic.html">46. Soft NIC Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="szedata2.html">47. SZEDATA2 poll mode driver library</a></li>
<li class="toctree-l2"><a class="reference internal" href="tap.html">48. Tun|Tap Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="thunderx.html">49. ThunderX NICVF Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="txgbe.html">50. TXGBE Poll Mode Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="vdev_netvsc.html">51. VDEV_NETVSC driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtio.html">52. Poll Mode Driver for Emulated Virtio NIC</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhost.html">53. Poll Mode Driver that wraps vhost library</a></li>
<li class="toctree-l2"><a class="reference internal" href="vmxnet3.html">54. Poll Mode Driver for Paravirtual VMXNET3 NIC</a></li>
<li class="toctree-l2"><a class="reference internal" href="pcap_ring.html">55. Libpcap and Ring Based Poll Mode Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="fail_safe.html">56. Fail-safe poll mode driver library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bbdevs/index.html">Baseband Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compressdevs/index.html">Compression Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vdpadevs/index.html">vDPA Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../regexdevs/index.html">REGEX Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventdevs/index.html">Event Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rawdevs/index.html">Rawdev Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mempool/index.html">Mempool Device Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform/index.html">Platform Specific Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor’s Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Data Plane Development Kit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Network Interface Controller Drivers</a> &raquo;</li>
        
      <li><span class="section-number">16. </span>ENA Poll Mode Driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/nics/ena.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ena-poll-mode-driver">
<h1><span class="section-number">16. </span>ENA Poll Mode Driver</h1>
<p>The ENA PMD is a DPDK poll-mode driver for the Amazon Elastic
Network Adapter (ENA) family.</p>
<div class="section" id="overview">
<h2><span class="section-number">16.1. </span>Overview</h2>
<p>The ENA driver exposes a lightweight management interface with a
minimal set of memory mapped registers and an extendable command set
through an Admin Queue.</p>
<p>The driver supports a wide range of ENA adapters, is link-speed
independent (i.e., the same driver is used for 10GbE, 25GbE, 40GbE,
etc.), and it negotiates and supports an extendable feature set.</p>
<p>ENA adapters allow high speed and low overhead Ethernet traffic
processing by providing a dedicated Tx/Rx queue pair per CPU core.</p>
<p>The ENA driver supports industry standard TCP/IP offload features such
as checksum offload and TCP transmit segmentation offload (TSO).</p>
<p>Receive-side scaling (RSS) is supported for multi-core scaling.</p>
<p>Some of the ENA devices support a working mode called Low-latency
Queue (LLQ), which saves several more microseconds.</p>
</div>
<div class="section" id="management-interface">
<h2><span class="section-number">16.2. </span>Management Interface</h2>
<p>ENA management interface is exposed by means of:</p>
<ul class="simple">
<li><p>Device Registers</p></li>
<li><p>Admin Queue (AQ) and Admin Completion Queue (ACQ)</p></li>
</ul>
<p>ENA device memory-mapped PCIe space for registers (MMIO registers)
are accessed only during driver initialization and are not involved
in further normal device operation.</p>
<p>AQ is used for submitting management commands, and the
results/responses are reported asynchronously through ACQ.</p>
<p>ENA introduces a very small set of management commands with room for
vendor-specific extensions. Most of the management operations are
framed in a generic Get/Set feature command.</p>
<p>The following admin queue commands are supported:</p>
<ul class="simple">
<li><p>Create I/O submission queue</p></li>
<li><p>Create I/O completion queue</p></li>
<li><p>Destroy I/O submission queue</p></li>
<li><p>Destroy I/O completion queue</p></li>
<li><p>Get feature</p></li>
<li><p>Set feature</p></li>
<li><p>Get statistics</p></li>
</ul>
<p>Refer to <code class="docutils literal notranslate"><span class="pre">ena_admin_defs.h</span></code> for the list of supported Get/Set Feature
properties.</p>
</div>
<div class="section" id="data-path-interface">
<h2><span class="section-number">16.3. </span>Data Path Interface</h2>
<p>I/O operations are based on Tx and Rx Submission Queues (Tx SQ and Rx
SQ correspondingly). Each SQ has a completion queue (CQ) associated
with it.</p>
<p>The SQs and CQs are implemented as descriptor rings in contiguous
physical memory.</p>
<p>Refer to <code class="docutils literal notranslate"><span class="pre">ena_eth_io_defs.h</span></code> for the detailed structure of the descriptor</p>
<p>The driver supports multi-queue for both Tx and Rx.</p>
</div>
<div class="section" id="configuration-information">
<h2><span class="section-number">16.4. </span>Configuration information</h2>
<p><strong>Runtime Configuration Parameters</strong></p>
<blockquote>
<div><ul>
<li><p><strong>large_llq_hdr</strong> (default 0)</p>
<p>Enables or disables usage of large LLQ headers. This option will have
effect only if the device also supports large LLQ headers. Otherwise, the
default value will be used.</p>
</li>
</ul>
</div></blockquote>
<p><strong>ENA Configuration Parameters</strong></p>
<blockquote>
<div><ul>
<li><p><strong>Number of Queues</strong></p>
<p>This is the requested number of queues upon initialization, however, the actual
number of receive and transmit queues to be created will be the minimum between
the maximal number supported by the device and number of queues requested.</p>
</li>
<li><p><strong>Size of Queues</strong></p>
<p>This is the requested size of receive/transmit queues, while the actual size
will be the minimum between the requested size and the maximal receive/transmit
supported by the device.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="building-dpdk">
<h2><span class="section-number">16.5. </span>Building DPDK</h2>
<p>See the <a class="reference internal" href="../linux_gsg/index.html#linux-gsg"><span class="std std-ref">DPDK Getting Started Guide for Linux</span></a> for
instructions on how to build DPDK.</p>
<p>By default the ENA PMD library will be built into the DPDK library.</p>
<p>For configuring and using UIO and VFIO frameworks, please also refer <a class="reference internal" href="../linux_gsg/index.html#linux-gsg"><span class="std std-ref">the
documentation that comes with DPDK suite</span></a>.</p>
</div>
<div class="section" id="supported-ena-adapters">
<h2><span class="section-number">16.6. </span>Supported ENA adapters</h2>
<p>Current ENA PMD supports the following ENA adapters including:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1d0f:ec20</span></code> - ENA VF</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1d0f:ec21</span></code> - ENA VF RSERV0</p></li>
</ul>
</div>
<div class="section" id="supported-operating-systems">
<h2><span class="section-number">16.7. </span>Supported Operating Systems</h2>
<p>Any Linux distribution fulfilling the conditions described in <code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Requirements</span></code>
section of <a class="reference internal" href="../linux_gsg/index.html#linux-gsg"><span class="std std-ref">the DPDK documentation</span></a> or refer to <em>DPDK Release Notes</em>.</p>
</div>
<div class="section" id="supported-features">
<h2><span class="section-number">16.8. </span>Supported features</h2>
<ul class="simple">
<li><p>MTU configuration</p></li>
<li><p>Jumbo frames up to 9K</p></li>
<li><p>IPv4/TCP/UDP checksum offload</p></li>
<li><p>TSO offload</p></li>
<li><p>Multiple receive and transmit queues</p></li>
<li><p>RSS hash</p></li>
<li><p>RSS indirection table configuration</p></li>
<li><p>Low Latency Queue for Tx</p></li>
<li><p>Basic and extended statistics</p></li>
<li><p>LSC event notification</p></li>
<li><p>Watchdog (requires handling of timers in the application)</p></li>
<li><p>Device reset upon failure</p></li>
</ul>
</div>
<div class="section" id="prerequisites">
<h2><span class="section-number">16.9. </span>Prerequisites</h2>
<ol class="arabic">
<li><p>Prepare the system as recommended by DPDK suite.  This includes environment
variables, hugepages configuration, tool-chains and configuration.</p></li>
<li><p>ENA PMD can operate with <code class="docutils literal notranslate"><span class="pre">vfio-pci``(*)</span> <span class="pre">or</span> <span class="pre">``igb_uio</span></code> driver.</p>
<p>(*) ENAv2 hardware supports Low Latency Queue v2 (LLQv2). This feature
reduces the latency of the packets by pushing the header directly through
the PCI to the device, before the DMA is even triggered. For proper work
kernel PCI driver must support write combining (WC).
In DPDK <code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> it must be enabled by loading module with
<code class="docutils literal notranslate"><span class="pre">wc_activate=1</span></code> flag (example below). However, mainline’s vfio-pci
driver in kernel doesn’t have WC support yet (planed to be added).
If vfio-pci used user should be either turn off ENAv2 (to avoid performance
impact) or recompile vfio-pci driver with patch provided in
<a class="reference external" href="https://github.com/amzn/amzn-drivers/tree/master/userspace/dpdk/enav2-vfio-patch">amzn-github</a>.</p>
</li>
<li><p>Insert <code class="docutils literal notranslate"><span class="pre">vfio-pci</span></code> or <code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> kernel module using the command
<code class="docutils literal notranslate"><span class="pre">modprobe</span> <span class="pre">vfio-pci</span></code> or <code class="docutils literal notranslate"><span class="pre">modprobe</span> <span class="pre">uio;</span> <span class="pre">insmod</span> <span class="pre">igb_uio.ko</span> <span class="pre">wc_activate=1</span></code>
respectively.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">vfio-pci</span></code> users only:
Please make sure that <code class="docutils literal notranslate"><span class="pre">IOMMU</span></code> is enabled in your system,
or use <code class="docutils literal notranslate"><span class="pre">vfio</span></code> driver in <code class="docutils literal notranslate"><span class="pre">noiommu</span></code> mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 1 &gt; /sys/module/vfio/parameters/enable_unsafe_noiommu_mode
</pre></div>
</div>
<p>To use <code class="docutils literal notranslate"><span class="pre">noiommu</span></code> mode, the <code class="docutils literal notranslate"><span class="pre">vfio-pci</span></code> must be built with flag
<code class="docutils literal notranslate"><span class="pre">CONFIG_VFIO_NOIOMMU</span></code>.</p>
</li>
<li><p>Bind the intended ENA device to <code class="docutils literal notranslate"><span class="pre">vfio-pci</span></code> or <code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> module.</p></li>
</ol>
<p>At this point the system should be ready to run DPDK applications. Once the
application runs to completion, the ENA can be detached from attached module if
necessary.</p>
<p><strong>Note about usage on *.metal instances</strong></p>
<p>On AWS, the metal instances are supporting IOMMU for both arm64 and x86_64
hosts.</p>
<ul>
<li><dl>
<dt>x86_64 (e.g. c5.metal, i3.metal):</dt><dd><p>IOMMU should be disabled by default. In that situation, the <code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> can
be used as it is but <code class="docutils literal notranslate"><span class="pre">vfio-pci</span></code> should be working in no-IOMMU mode (please
see above).</p>
<p>When IOMMU is enabled, <code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> cannot be used as it’s not supporting this
feature, while <code class="docutils literal notranslate"><span class="pre">vfio-pci</span></code> should work without any changes.
To enable IOMMU on those hosts, please update <code class="docutils literal notranslate"><span class="pre">GRUB_CMDLINE_LINUX</span></code> in file
<code class="docutils literal notranslate"><span class="pre">/etc/default/grub</span></code> with the below extra boot arguments:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>iommu=1 intel_iommu=on
</pre></div>
</div>
<p>Then, make the changes live by executing as a root:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># grub2-mkconfig &gt; /boot/grub2/grub.cfg
</pre></div>
</div>
<p>Finally, reboot should result in IOMMU being enabled.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>arm64 (a1.metal):</dt><dd><p>IOMMU should be enabled by default. Unfortunately, <code class="docutils literal notranslate"><span class="pre">vfio-pci</span></code> isn’t
supporting SMMU, which is implementation of IOMMU for arm64 architecture and
<code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> isn’t supporting IOMMU at all, so to use DPDK with ENA on those
hosts, one must disable IOMMU. This can be done by updating
<code class="docutils literal notranslate"><span class="pre">GRUB_CMDLINE_LINUX</span></code> in file <code class="docutils literal notranslate"><span class="pre">/etc/default/grub</span></code> with the extra boot
argument:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>iommu.passthrough=1
</pre></div>
</div>
<p>Then, make the changes live by executing as a root:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># grub2-mkconfig &gt; /boot/grub2/grub.cfg
</pre></div>
</div>
<p>Finally, reboot should result in IOMMU being disabled.
Without IOMMU, <code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> can be used as it is but <code class="docutils literal notranslate"><span class="pre">vfio-pci</span></code> should be
working in no-IOMMU mode (please see above).</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="usage-example">
<h2><span class="section-number">16.10. </span>Usage example</h2>
<p>Follow instructions available in the document
<a class="reference internal" href="build_and_test.html#pmd-build-and-test"><span class="std std-ref">compiling and testing a PMD for a NIC</span></a> to launch
<strong>testpmd</strong> with Amazon ENA devices managed by librte_net_ena.</p>
<p>Example output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[...]</span>
<span class="go">EAL: PCI device 0000:00:06.0 on NUMA socket -1</span>
<span class="go">EAL:   Invalid NUMA socket, default to 0</span>
<span class="go">EAL:   probe driver: 1d0f:ec20 net_ena</span>

<span class="go">Interactive-mode selected</span>
<span class="go">testpmd: create a new mbuf pool &lt;mbuf_pool_socket_0&gt;: n=171456, size=2176, socket=0</span>
<span class="go">testpmd: preferred mempool ops selected: ring_mp_mc</span>
<span class="go">Warning! port-topology=paired and odd forward ports number, the last port will pair with itself.</span>
<span class="go">Configuring Port 0 (socket 0)</span>
<span class="go">Port 0: 00:00:00:11:00:01</span>
<span class="go">Checking link statuses...</span>

<span class="go">Done</span>
<span class="go">testpmd&gt;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="enetc.html" class="btn btn-neutral float-right" title="17. ENETC Poll Mode Driver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="e1000em.html" class="btn btn-neutral float-left" title="15. Driver for VM Emulated Devices" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>