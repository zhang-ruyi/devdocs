<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8">
  <meta name="generator" content="Doxygen 1.8.20">
  <title>SPDK: shfmt</title>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="two.min.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,900" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="tabs.css" type="text/css">
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="container-fluid">
  <div id="top">  <!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('shfmt.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">shfmt </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_shfmt"></a> </p>
<h1><a class="anchor" id="shfmt_toc"></a>
In this document</h1>
<ul>
<li><a class="el" href="shfmt.html#shfmt_overview">Overview</a></li>
<li><a class="el" href="shfmt.html#shfmt_usage">Usage</a></li>
<li><a class="el" href="shfmt.html#shfmt_installation">Installation</a></li>
<li><a class="el" href="shfmt.html#shfmt_examples">Examples</a></li>
</ul>
<h1><a class="anchor" id="shfmt_overview"></a>
Overview</h1>
<p>The majority of tests (and scripts overall) in the SPDK repo are written in Bash (with a quite significant emphasis on "Bashism"), thus a style formatter, shfmt, was introduced to help keep the .sh code consistent across the entire repo. For more details on the tool itself, please see <a href="https://github.com/mvdan/sh">shfmt</a>.</p>
<h1><a class="anchor" id="shfmt_usage"></a>
Usage</h1>
<p>On the CI pool, the shfmt is run against all the updated .sh files that have been committed but not merged yet. Additionally, shfmt will pick all .sh present in the staging area when run locally from our pre-commit hook (via check_format.sh). In case any style errors are detected, a patch with needed changes is going to be generated and either build (CI) or the commit will be aborted. Said patch can be then easily applied:</p>
<div class="fragment"><div class="line"># Run from the root of the SPDK repo</div>
<div class="line">patch --merge -p0 &lt;shfmt-3.1.0.patch</div>
</div><!-- fragment --><p>The name of the patch is derived from the version of shfmt that is currently in use (3.1.0 is currently supported).</p>
<p>Please, see ./scripts/check_format.sh for all the arguments the shfmt is run with. Additionally, <a class="el" href="shfmt.html#shfmt_examples">Examples</a> has more details on how each of the arguments behave.</p>
<h1><a class="anchor" id="shfmt_installation"></a>
Installation</h1>
<p>The shfmt can be easily installed via pkgdep.sh:</p>
<div class="fragment"><div class="line">./scripts/pkgdep.sh -d</div>
</div><!-- fragment --><p>This will install all the developers tools, including shfmt, on the local system. The precompiled binary will be saved, by default, to /opt/shfmt and then linked under /usr/bin. Both paths can be changed by setting SHFMT_DIR and SHFMT_DIR_OUT in the environment. Example:</p>
<div class="fragment"><div class="line">SHFMT_DIR=/keep_the_binary_here \</div>
<div class="line">SHFMT_DIR_OUT=/and_link_it_here \</div>
<div class="line">  ./scripts/pkgdep.sh -d</div>
</div><!-- fragment --><h1><a class="anchor" id="shfmt_examples"></a>
Examples</h1>
<div class="fragment"><div class="line">#######################################</div>
<div class="line">if foo=$(bar); then</div>
<div class="line">  echo &quot;$foo&quot;</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">exec &quot;$foo&quot; \</div>
<div class="line">  --bar \</div>
<div class="line">  --foo</div>
<div class="line"> </div>
<div class="line"># indent_style = tab</div>
<div class="line"> </div>
<div class="line">if foo=$(bar); then</div>
<div class="line">        echo &quot;$foo&quot;</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">exec foobar \</div>
<div class="line">        --bar \</div>
<div class="line">        --foo</div>
<div class="line">######################################</div>
<div class="line">if foo=$(bar); then</div>
<div class="line">        echo &quot;$foo&quot; &amp;&amp; \</div>
<div class="line">        echo &quot;$(bar)&quot;</div>
<div class="line">fi</div>
<div class="line"># binary_next_line = true</div>
<div class="line">if foo=$(bar); then</div>
<div class="line">        echo &quot;$foo&quot; \</div>
<div class="line">                &amp;&amp; echo &quot;$(bar)&quot;</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line"># Note that each break line is also being indented:</div>
<div class="line"> </div>
<div class="line">if [[ -v foo ]] \</div>
<div class="line">&amp;&amp; [[ -v bar ]] \</div>
<div class="line">&amp;&amp; [[ -v foobar ]]; then</div>
<div class="line">        echo &quot;This is foo&quot;</div>
<div class="line">fi</div>
<div class="line"># -&gt;</div>
<div class="line">if [[ -v foo ]] \</div>
<div class="line">        &amp;&amp; [[ -v bar ]] \</div>
<div class="line">        &amp;&amp; [[ -v foobar ]]; then</div>
<div class="line">        echo &quot;This is foo&quot;</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line"># Currently, newlines are being escaped even if syntax-wise</div>
<div class="line"># they are not needed, thus watch for the following:</div>
<div class="line">if [[ -v foo</div>
<div class="line">        &amp;&amp; -v bar</div>
<div class="line">        &amp;&amp; -v foobar ]]; then</div>
<div class="line">        echo &quot;This is foo&quot;</div>
<div class="line">fi</div>
<div class="line">#-&gt;</div>
<div class="line">if [[ -v foo &amp;&amp; -v \</div>
<div class="line">        bar &amp;&amp; -v \</div>
<div class="line">        foobar ]]; then</div>
<div class="line">        echo &quot;This is foo&quot;</div>
<div class="line">fi</div>
<div class="line"># This, unfortunately, also breaks the -bn behavior.</div>
<div class="line"># (see https://github.com/mvdan/sh/issues/565) for details.</div>
<div class="line">######################################</div>
<div class="line">case &quot;$FOO&quot; in</div>
<div class="line">        BAR)</div>
<div class="line">        echo &quot;$FOO&quot; ;;</div>
<div class="line">esac</div>
<div class="line"># switch_case_indent = true</div>
<div class="line">case &quot;$FOO&quot; in</div>
<div class="line">        BAR)</div>
<div class="line">                echo &quot;$FOO&quot;</div>
<div class="line">                ;;</div>
<div class="line">esac</div>
<div class="line">######################################</div>
<div class="line">exec {foo}&gt;bar</div>
<div class="line">:&gt;foo</div>
<div class="line">exec {bar}&lt;foo</div>
<div class="line"># -sr</div>
<div class="line">exec {foo}&gt; bar</div>
<div class="line">: &gt; foo</div>
<div class="line">exec {bar}&lt; foo</div>
<div class="line">######################################</div>
<div class="line"># miscellaneous, enforced by shfmt</div>
<div class="line">(( no_spacing_at_the_beginning &amp; ~and_no_spacing_at_the_end ))</div>
<div class="line">: $(( no_spacing_at_the_beginning &amp; ~and_no_spacing_at_the_end ))</div>
<div class="line"> </div>
<div class="line"># -&gt;</div>
<div class="line">((no_spacing_at_the_beginning &amp; ~and_no_spacing_at_the_end))</div>
<div class="line">: $((no_spacing_at_the_beginning &amp; ~and_no_spacing_at_the_end))</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
</div>
