<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8">
  <meta name="generator" content="Doxygen 1.8.20">
  <title>SPDK: Using bdevperf application</title>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="two.min.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,900" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="tabs.css" type="text/css">
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="container-fluid">
  <div id="top">  <!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('bdevperf.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Using bdevperf application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_bdevperf"></a> </p><h1>Introduction</h1>
<p>bdevperf is an SPDK application that is used for performance testing of block devices (bdevs) exposed by the SPDK bdev layer. It is an alternative to the SPDK bdev fio plugin for benchmarking SPDK bdevs. In some cases, bdevperf can provide much lower overhead than the fio plugin, resulting in much better performance for tests using a limited number of CPU cores.</p>
<p>bdevperf exposes command line interface that allows to specify SPDK framework options as well as testing options. Since SPDK 20.07, bdevperf supports configuration file that is similar to FIO. It allows user to create jobs parameterized by filename, cpumask, blocksize, queuesize, etc.</p>
<h1>Config file</h1>
<p>Bdevperf's config file is similar to FIO's config file format.</p>
<p>Below is an example config file that uses all available parameters:</p>
<div class="fragment"><div class="line">[global]</div>
<div class="line">filename=Malloc0:Malloc1</div>
<div class="line">bs=1024</div>
<div class="line">iosize=256</div>
<div class="line">rw=randrw</div>
<div class="line">rwmixread=90</div>
<div class="line"> </div>
<div class="line">[A]</div>
<div class="line">cpumask=0xff</div>
<div class="line"> </div>
<div class="line">[B]</div>
<div class="line">cpumask=[0-128]</div>
<div class="line">filename=Malloc1</div>
<div class="line"> </div>
<div class="line">[global]</div>
<div class="line">filename=Malloc0</div>
<div class="line">rw=write</div>
<div class="line"> </div>
<div class="line">[C]</div>
<div class="line">bs=4096</div>
<div class="line">iosize=128</div>
<div class="line">offset=1000000</div>
<div class="line">length=1000000</div>
</div><!-- fragment --><p>Jobs <code>[A]</code> <code>[B]</code> or <code>[C]</code>, inherit default values from <code>[global]</code> section residing above them. So in the example, job <code>[A]</code> inherits <code>filename</code> value and uses both <code>Malloc0</code> and <code>Malloc1</code> bdevs as targets, job <code>[B]</code> overrides its <code>filename</code> value and uses <code>Malloc1</code> and job <code>[C]</code> inherits value <code>Malloc0</code> for its <code>filename</code>.</p>
<p>Interaction with CLI arguments is not the same as in FIO however. If bdevperf receives CLI argument, it overrides values of corresponding parameter for all <code>[global]</code> sections of config file. So if example config is used, specifying <code>-q</code> argument will make jobs <code>[A]</code> and <code>[B]</code> use its value.</p>
<p>Below is a full list of supported parameters with descriptions.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Param  </th><th class="markdownTableHeadNone">Default  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">filename  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Bdevs to use, separated by ":"   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">cpumask  </td><td class="markdownTableBodyNone">Maximum available  </td><td class="markdownTableBodyNone">CPU mask. Format is defined at cpu_mask   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bs  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Block size (io size)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">iodepth  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Queue depth   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">rwmixread  </td><td class="markdownTableBodyNone"><code>50</code>  </td><td class="markdownTableBodyNone">Percentage of a mixed workload that should be reads   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">offset  </td><td class="markdownTableBodyNone"><code>0</code>  </td><td class="markdownTableBodyNone">Start I/O at the provided offset on the bdev   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">length  </td><td class="markdownTableBodyNone">100% of bdev size  </td><td class="markdownTableBodyNone">End I/O at <code>offset</code>+<code>length</code> on the bdev   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">rw  </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">Type of I/O pattern   </td></tr>
</table>
<p>Available rw types:</p><ul>
<li>read</li>
<li>randread</li>
<li>write</li>
<li>randwrite</li>
<li>verify</li>
<li>reset</li>
<li>unmap</li>
<li>write_zeroes</li>
<li>flush</li>
<li>rw</li>
<li>randrw </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
</div>
